# ๐ ุฏููู ูุธุงู ุงูุญุณุงุจุงุช ุงููุนููุฉ - EgyGo

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุดุงูู ููุฑุงุฌุนุฉ ูุงูููุงููุฉ ุนูู ุญุณุงุจุงุช ุงูุชุฌุงุฑ ูุงููุณูููู ุงูุฌุฏุฏ ูุจู ููุญูู ุงููุตูู ุงููุงูู ูููุญุงุช ุงูุชุญูู.

---

## ๐ ููู ูุนูู ุงููุธุงูุ

### 1๏ธโฃ **ุงูุชุณุฌูู (ููุชุงุฌุฑ/ุงููุณูู)**

#### ุงูุฎุทูุงุช:
1. ุงููุณุชุฎุฏู ููุชุญ ุตูุญุฉ ุงูุชุณุฌูู:
   - `/register?type=merchant` ููุชุฌุงุฑ
   - `/register?type=affiliate` ูููุณูููู

2. ูููุฃ ุงูุจูุงูุงุช:
   - ุงูุงุณู
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
   - ุฑูู ุงููุงุชู (ูุทููุจ)
   - ุฑูู ุจุฏูู (ุงุฎุชูุงุฑู)
   - ูููุฉ ุงููุฑูุฑ

3. ุนูุฏ ุงูุถุบุท ุนูู "ุฅูุดุงุก ุญุณุงุจ":
   ```typescript
   // ูุชู ุฅูุดุงุก ุงูุญุณุงุจ ูู Appwrite Auth
   await register(email, password, name, accountType, phone, alternativePhone);
   
   // ูุชู ุญูุธ ุงูุจูุงูุงุช ูู users collection:
   {
     email: "user@example.com",
     name: "ุงุณู ุงููุณุชุฎุฏู",
     phone: "01234567890",
     alternativePhone: "01098765432",
     isAffiliate: true,  // ุฃู isMerchant: true
     affiliateCode: "AFF123ABC",  // ูุชู ุชูููุฏู ุชููุงุฆูุงู
     commissionRate: 0.15,  // 15% ุนูููุฉ ุงูุชุฑุงุถูุฉ
     accountStatus: "pending",  // โญ ุงูุญุงูุฉ: ูุนูู
     isActive: false,  // ุบูุฑ ูุดุท ุญุชู ุงูููุงููุฉ
     approvedAt: null
   }
   ```

4. ูุฑู ุฑุณุงูุฉ:
   ```
   โณ ุญุณุงุจู ููุฏ ุงููุฑุงุฌุนุฉ ูู ูุจู ุงูุฅุฏุงุฑุฉ
   ๐ง ุณูุชู ุฅุฎุทุงุฑู ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููุฑ ุงูููุงููุฉ
   โ๏ธ ูู ุชุชููู ูู ุงููุตูู ููุงูู ุงููููุฒุงุช ุญุชู ุชุชู ุงูููุงููุฉ
   ```

5. ูุชู ุฅูุดุงุก ุฅุดุนุงุฑ ุชุฑุญูุจู:
   ```
   ๐ ูุฑุญุจุงู ุจู ูู ุฅูุฌู ุฌู
   โณ ุชู ุงุณุชูุงู ุทูุจู ูุฌุงุฑู ุงููุฑุงุฌุนุฉ
   ```

---

### 2๏ธโฃ **ุงููุฑุงุฌุนุฉ (ููุฃุฏูู)**

#### ุงููุตูู:
1. ุงููุฏูุฑ ูุณุฌู ุฏุฎูู
2. ูุฑู ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ: **"ุงูุญุณุงุจุงุช ุงููุนููุฉ"**
3. ุฅุฐุง ูุงู ููุงู ุญุณุงุจุงุช ูุนููุฉุ ูุธูุฑ badge ุฃุญูุฑ ุจุงูุนุฏุฏ

#### ุงููุงุฌูุฉ:
```
๐ ุงูุฅุญุตุงุฆูุงุช:
- ุฅุฌูุงูู ุงูุญุณุงุจุงุช ุงููุนููุฉ: 5
- ุงูุชุฌุงุฑ: 3
- ุงููุณูููู: 2

๐ ุงูุจุญุซ ูุงูููุชุฑุฉ:
- ุจุญุซ ุจุงูุงุณู/ุงูุจุฑูุฏ/ุงููุงุชู
- ููุชุฑุฉ: ุงููู | ุงูุชุฌุงุฑ | ุงููุณูููู

๐ ุงูุฌุฏูู:
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโฌโโโโโโโโโโโ
โ ุงููุณุชุฎุฏู    โ ุงูุจุฑูุฏ           โ ุงููุงุชู       โ ุงูููุน      โ ุงูุฅุฌุฑุงุกุงุชโ
โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโผโโโโโโโโโโโค
โ ุฃุญูุฏ ูุญูุฏ   โ ahmed@mail.com   โ 01234567890  โ ๐ช ุชุงุฌุฑ   โ โ โ ๐๏ธ โ
โ ุณุงุฑุฉ ุนูู    โ sara@mail.com    โ 01098765432  โ ๐ฐ ูุณูู   โ โ โ ๐๏ธ โ
โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโดโโโโโโโโโโโ
```

#### ุงูุฅุฌุฑุงุกุงุช:
- โ **ููุงููุฉ**: ูุจูู ุงูุญุณุงุจ
- โ **ุฑูุถ**: ุฑูุถ ุงูุญุณุงุจ ูุน ุฐูุฑ ุงูุณุจุจ
- ๐๏ธ **ุชูุงุตูู**: ุนุฑุถ ูุนูููุงุช ูุงููุฉ
- ๐ฌ **WhatsApp**: ุงูุชูุงุตู ุงููุจุงุดุฑ

---

### 3๏ธโฃ **ุงูููุงููุฉ**

ุนูุฏ ุงูุถุบุท ุนูู โ **ููุงููุฉ**:

```typescript
// 1. ุชุญุฏูุซ ุญุงูุฉ ุงูุญุณุงุจ
await databases.updateDocument(
  appwriteConfig.databaseId,
  appwriteConfig.collections.users,
  userId,
  {
    accountStatus: 'approved',  // โ ุชูุช ุงูููุงููุฉ
    approvedAt: new Date().toISOString(),
    approvedBy: adminId,
    isActive: true  // ุงูุญุณุงุจ ูุดุท ุงูุขู
  }
);

// 2. ุฅูุดุงุก ุฅุดุนุงุฑ ูููุณุชุฎุฏู
await databases.createDocument(
  appwriteConfig.databaseId,
  appwriteConfig.collections.notifications,
  'unique()',
  {
    userId: userId,
    title: '๐ ุชูุช ุงูููุงููุฉ ุนูู ุญุณุงุจู',
    message: 'ูุฑุญุจุงู ุจู! ุชู ูุจูู ุญุณุงุจู ูููููู ุงูุขู ุงูุงุณุชูุงุฏุฉ ูู ุฌููุน ุงููููุฒุงุช',
    type: 'account_approved',
    isRead: false,
    link: '/dashboard'
  }
);

// 3. ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู (TODO)
// await sendApprovalEmail(userId);
```

**ุงููุชูุฌุฉ:**
- โ ุงูุญุณุงุจ ูุตุจุญ ูุดุท
- โ ุงููุณุชุฎุฏู ููููู ุงููุตูู ูููุญุฉ ุงูุชุญูู
- โ ูุชููู ุฅุดุนุงุฑ ุจุงูููุงููุฉ
- โ ูุฎุชูู ูู ูุงุฆูุฉ ุงูุญุณุงุจุงุช ุงููุนููุฉ

---

### 4๏ธโฃ **ุงูุฑูุถ**

ุนูุฏ ุงูุถุบุท ุนูู โ **ุฑูุถ**:

1. ูุธูุฑ ูุงูุฐุฉ ูุฅุฏุฎุงู ุณุจุจ ุงูุฑูุถ (ูุทููุจ)
2. ุนูุฏ ุงูุชุฃููุฏ:

```typescript
// 1. ุชุญุฏูุซ ุญุงูุฉ ุงูุญุณุงุจ
await databases.updateDocument(
  appwriteConfig.databaseId,
  appwriteConfig.collections.users,
  userId,
  {
    accountStatus: 'rejected',  // โ ุชู ุงูุฑูุถ
    rejectionReason: 'ุงูุณุจุจ...',
    isActive: false
  }
);

// 2. ุฅูุดุงุก ุฅุดุนุงุฑ ูููุณุชุฎุฏู
await databases.createDocument(
  appwriteConfig.databaseId,
  appwriteConfig.collections.notifications,
  'unique()',
  {
    userId: userId,
    title: 'ุชุญุฏูุซ ุญูู ุทูุจ ุญุณุงุจู',
    message: `ุนุฐุฑุงูุ ูู ูุชู ูุจูู ุญุณุงุจู. ุงูุณุจุจ: ${rejectionReason}`,
    type: 'account_rejected',
    isRead: false
  }
);

// 3. ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู (TODO)
// await sendRejectionEmail(userId, rejectionReason);
```

**ุงููุชูุฌุฉ:**
- โ ุงูุญุณุงุจ ูุฑููุถ
- โ ูุง ูููู ุงููุตูู ูููุญุฉ ุงูุชุญูู
- ๐ง ูุชููู ุฅุดุนุงุฑ ุจุงูุฑูุถ ูุน ุงูุณุจุจ
- โ ูุฎุชูู ูู ูุงุฆูุฉ ุงูุญุณุงุจุงุช ุงููุนููุฉ

---

## ๐ ุงูุญูุงูุฉ ูุงูุฃูุงู

### ProtectedRoute Component

ูุญูู ุฌููุน ุตูุญุงุช ููุญุงุช ุงูุชุญูู:

```typescript
<Route 
  path="/affiliate/dashboard" 
  element={
    <ProtectedRoute requiredRole="affiliate">
      <AffiliateDashboard />
    </ProtectedRoute>
  } 
/>
```

#### ุงูุชุญููุงุช:
1. **ุงููุตุงุฏูุฉ**: ูู ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎููุ
2. **ุงูุฏูุฑ**: ูู ูุฏูู ุงูุฏูุฑ ุงููุทููุจุ
3. **ุญุงูุฉ ุงูุญุณุงุจ**: ูู ุชูุช ุงูููุงููุฉ ุนูููุ

#### ุงูุณููุงุฑูููุงุช:

| ุงูุญุงูุฉ | ุงููุชูุฌุฉ |
|--------|---------|
| ุบูุฑ ูุณุฌู ุฏุฎูู | ุฅุนุงุฏุฉ ุชูุฌูู ูู `/login` |
| ุฏูุฑ ุฎุงุทุฆ | ุฅุนุงุฏุฉ ุชูุฌูู ูููุญุฉ ุงูููุงุณุจุฉ |
| `accountStatus: 'pending'` | ุนุฑุถ ุดุงุดุฉ "ุญุณุงุจู ููุฏ ุงููุฑุงุฌุนุฉ" |
| `accountStatus: 'rejected'` | ุนุฑุถ ุดุงุดุฉ "ุชู ุฑูุถ ุญุณุงุจู" + ุงูุณุจุจ |
| `accountStatus: 'approved'` | โ ุงููุตูู ูููุญุฉ ุงูุชุญูู |

---

## ๐ ุงูุญุงูุงุช ุงูููููุฉ

### accountStatus Values:

| ุงููููุฉ | ุงููุตู | isActive | ุงููุตูู |
|--------|-------|----------|--------|
| `pending` | ููุฏ ุงููุฑุงุฌุนุฉ | `false` | โ ูุญุธูุฑ |
| `approved` | ุชูุช ุงูููุงููุฉ | `true` | โ ูุณููุญ |
| `rejected` | ุชู ุงูุฑูุถ | `false` | โ ูุญุธูุฑ |

---

## ๐๏ธ ูููู ุงูุจูุงูุงุช

### Users Collection Schema:

```typescript
{
  $id: string,                    // User ID ูู Appwrite Auth
  email: string,                  // ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
  name: string,                   // ุงูุงุณู
  phone: string,                  // ุฑูู ุงููุงุชู
  alternativePhone?: string,      // ุฑูู ุจุฏูู
  
  // ููุน ุงูุญุณุงุจ
  isAffiliate: boolean,           // ูุณููุ
  isMerchant: boolean,            // ุชุงุฌุฑุ
  isIntermediary: boolean,        // ูุณูุทุ
  
  // ุจูุงูุงุช ุงููุณูู
  affiliateCode?: string,         // ููุฏ ุงููุณูู (AFF123ABC)
  commissionRate?: number,        // ูุณุจุฉ ุงูุนูููุฉ (0.15 = 15%)
  
  // ุญุงูุฉ ุงูุญุณุงุจ
  accountStatus: 'pending' | 'approved' | 'rejected',
  isActive: boolean,              // ูุดุทุ
  
  // ุชูุงุฑูุฎ
  approvedAt?: string,            // ุชุงุฑูุฎ ุงูููุงููุฉ
  approvedBy?: string,            // ูู ูุงูู (Admin ID)
  rejectionReason?: string,       // ุณุจุจ ุงูุฑูุถ
  
  $createdAt: string,             // ุชุงุฑูุฎ ุงูุชุณุฌูู
  $updatedAt: string              // ุขุฎุฑ ุชุญุฏูุซ
}
```

---

## ๐ง ุงููููุงุช ุงููุนุฏูุฉ

### 1. **client/contexts/AppwriteAuthContext.tsx**
- ุฏุงูุฉ `register()`: ุฅูุดุงุก ูุณุชูุฏ ุงููุณุชุฎุฏู ูุน `accountStatus`
- ุงุณุชุฎุฏุงู `appwriteConfig.collections.users`

### 2. **client/pages/Register.tsx**
- ุฅูุดุงุก ุฅุดุนุงุฑ ุชุฑุญูุจู
- ุงุณุชุฎุฏุงู `appwriteConfig.collections.notifications`

### 3. **client/pages/AdminPendingAccounts.tsx**
- ูุงุฌูุฉ ูุฑุงุฌุนุฉ ุงูุญุณุงุจุงุช
- ุฏูุงู ุงูููุงููุฉ ูุงูุฑูุถ
- ุงุณุชุฎุฏุงู collection IDs ุงูุตุญูุญุฉ

### 4. **client/components/AdminLayout.tsx**
- ุฅุถุงูุฉ ุฑุงุจุท "ุงูุญุณุงุจุงุช ุงููุนููุฉ"
- ุนุฏุงุฏ ุงูุญุณุงุจุงุช ุงููุนููุฉ (Badge)

### 5. **client/components/ProtectedRoute.tsx**
- ุญูุงูุฉ ุงููุณุงุฑุงุช
- ุงูุชุญูู ูู `accountStatus`
- ุนุฑุถ ุฑุณุงุฆู ููุงุณุจุฉ

### 6. **client/hooks/usePendingAccountsCount.ts** (ุฌุฏูุฏ)
- Hook ูุฌูุจ ุนุฏุฏ ุงูุญุณุงุจุงุช ุงููุนููุฉ
- ุชุญุฏูุซ ุชููุงุฆู ูู ุฏูููุฉ

### 7. **client/lib/appwrite.ts**
- ุฅุถุงูุฉ `notifications` ุฅูู collections

---

## โ ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. **ุงุฎุชุจุงุฑ ุงูุชุณุฌูู:**
```bash
# 1. ุงูุชุญ ุตูุญุฉ ุงูุชุณุฌูู ููุณูู
https://egygo.me/#/register?type=affiliate

# 2. ุงููุฃ ุงูุจูุงูุงุช ูุณุฌู
# 3. ุชุญูู ูู:
- โ ุธููุฑ ุฑุณุงูุฉ "ุญุณุงุจู ููุฏ ุงููุฑุงุฌุนุฉ"
- โ ุฅุนุงุฏุฉ ุชูุฌูู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
```

### 2. **ุงุฎุชุจุงุฑ ููุญุฉ ุงูุฃุฏูู:**
```bash
# 1. ุณุฌู ุฏุฎูู ูุฃุฏูู
https://egygo.me/#/admin

# 2. ุชุญูู ูู:
- โ ุธููุฑ ุฑุงุจุท "ุงูุญุณุงุจุงุช ุงููุนููุฉ" ูู ุงููุงุฆูุฉ
- โ ุธููุฑ badge ุฃุญูุฑ ุจุนุฏุฏ ุงูุญุณุงุจุงุช
- โ ูุชุญ ุงูุตูุญุฉ ูุนุฑุถ ุงูุญุณุงุจุงุช

# 3. ุงูุชุญ Console ูุงุจุญุซ ุนู:
"Pending users fetched: [...]"
```

### 3. **ุงุฎุชุจุงุฑ ุงูููุงููุฉ:**
```bash
# 1. ุงุถุบุท ุนูู โ ููุงููุฉ ูุญุณุงุจ ูุนูู
# 2. ุชุญูู ูู:
- โ ุงุฎุชูุงุก ุงูุญุณุงุจ ูู ุงููุงุฆูุฉ
- โ ุธููุฑ ุฑุณุงูุฉ ูุฌุงุญ
- โ ุชุญุฏูุซ ุงูุนุฏุงุฏ

# 3. ุณุฌู ุฏุฎูู ุจุงูุญุณุงุจ ุงูููุงูู ุนููู
# 4. ุชุญูู ูู:
- โ ุงููุตูู ูููุญุฉ ุงูุชุญูู
- โ ุธููุฑ ุฅุดุนุงุฑ ุงูููุงููุฉ
```

### 4. **ุงุฎุชุจุงุฑ ุงูุฑูุถ:**
```bash
# 1. ุงุถุบุท ุนูู โ ุฑูุถ ูุญุณุงุจ ูุนูู
# 2. ุฃุฏุฎู ุณุจุจ ุงูุฑูุถ
# 3. ุชุญูู ูู:
- โ ุงุฎุชูุงุก ุงูุญุณุงุจ ูู ุงููุงุฆูุฉ
- โ ุธููุฑ ุฑุณุงูุฉ ูุฌุงุญ

# 4. ุณุฌู ุฏุฎูู ุจุงูุญุณุงุจ ุงููุฑููุถ
# 5. ุชุญูู ูู:
- โ ุนุฏู ุงููุตูู ูููุญุฉ ุงูุชุญูู
- โ ุธููุฑ ุฑุณุงูุฉ ุงูุฑูุถ + ุงูุณุจุจ
```

---

## ๐ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ

### 1. **ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู**
```typescript
// TODO: Implement email notifications
await sendApprovalEmail(userId, userEmail);
await sendRejectionEmail(userId, userEmail, reason);
```

### 2. **ุฅุดุนุงุฑุงุช ููุฑูุฉ**
- ุงุณุชุฎุฏุงู Appwrite Realtime
- ุฅุดุนุงุฑ ููุฑู ุนูุฏ ุงูููุงููุฉ/ุงูุฑูุถ

### 3. **ุชูุงุฑูุฑ ูุฅุญุตุงุฆูุงุช**
- ุนุฏุฏ ุงูุญุณุงุจุงุช ุงููุนููุฉ ููููุงู
- ูุชูุณุท ููุช ุงููุฑุงุฌุนุฉ
- ูุนุฏู ุงูููุงููุฉ/ุงูุฑูุถ

### 4. **ุชุตุฏูุฑ ุงูุจูุงูุงุช**
- ุชุตุฏูุฑ ูุงุฆูุฉ ุงูุญุณุงุจุงุช ุงููุนููุฉ (CSV/Excel)
- ุชูุงุฑูุฑ ุดูุฑูุฉ

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุญุณุงุจุงุช ุงููุฏููุฉ ูุง ุชุธูุฑ

**ุงูุณุจุจ**: ุงูุญุณุงุจุงุช ุงููุฏููุฉ ููุณ ูุฏููุง ุญูู `accountStatus`

**ุงูุญู**:
```typescript
// ูู Appwrite Console > Database > users collection
// ูู ุจุชุญุฏูุซ ุงูุญุณุงุจุงุช ุงููุฏููุฉ:
{
  accountStatus: 'approved',  // ุฃู 'pending' ุญุณุจ ุงูุญุงุฌุฉ
  isActive: true
}
```

### ุงููุดููุฉ: ุฎุทุฃ 404 ุนูุฏ ุฌูุจ ุงูุญุณุงุจุงุช

**ุงูุณุจุจ**: ุงุณุชุฎุฏุงู `'users'` ุจุฏูุงู ูู collection ID

**ุงูุญู**: ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู `appwriteConfig.collections.users`

### ุงููุดููุฉ: ุงูุนุฏุงุฏ ูุง ูุชุญุฏุซ

**ุงูุณุจุจ**: Hook ูุง ูุนูู ุฃู ุฎุทุฃ ูู API

**ุงูุญู**: 
1. ุงูุชุญ Console
2. ุงุจุญุซ ุนู ุฃุฎุทุงุก ูู `usePendingAccountsCount`
3. ุชุญูู ูู ุตูุงุญูุงุช Appwrite

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุงูุชุญ Console ูู ุงููุชุตูุญ (F12)
2. ุงุจุญุซ ุนู ุงูุฃุฎุทุงุก
3. ุชุญูู ูู Network tab
4. ุชุฃูุฏ ูู ุตูุงุญูุงุช Appwrite

---

## ๐ ุงูุฎูุงุตุฉ

โ **ูุธุงู ูุงูู ููุชูุงูู** ููุฑุงุฌุนุฉ ุงูุญุณุงุจุงุช  
โ **ูุงุฌูุฉ ุณููุฉ ุงูุงุณุชุฎุฏุงู** ููุฃุฏูู  
โ **ุญูุงูุฉ ุดุงููุฉ** ูุฌููุน ุงููุณุงุฑุงุช  
โ **ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ** ูููุณุชุฎุฏููู  
โ **ุชุญุฏูุซ ููุฑู** ููุนุฏุงุฏุงุช  

**ุงููููุน ุฌุงูุฒ ูุงุณุชูุจุงู ุงูุชุณุฌููุงุช ุงูุฌุฏูุฏุฉ! ๐**
