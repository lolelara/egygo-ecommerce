# 📢 مراجعة شاملة لنظام الإعلانات الداخلي للتجار

تاريخ المراجعة: 22 أكتوبر 2025

---

## 📋 نظرة عامة على النظام

نظام الإعلانات الداخلي هو **نظام إعلانات مدفوع** يسمح للتجار بالترويج لمنتجاتهم في مواقع مميزة على المنصة مقابل رسوم.

---

## ✅ المكونات الموجودة

### 1. **نظام إدارة الإعلانات**
📁 الملف: `client/lib/ads-manager.ts`

#### الوظائف المُنفذة:

```typescript
✅ إنشاء إعلانات جديدة
✅ جلب الإعلانات النشطة
✅ جلب إعلانات تاجر محدد
✅ تتبع المشاهدات (Impressions)
✅ تتبع النقرات (Clicks)
✅ حساب التكلفة
✅ الموافقة على الإعلانات (أدمن)
✅ رفض الإعلانات (أدمن)
✅ جلب الإعلانات المعلقة
✅ فحص الإعلانات المنتهية
✅ تحليلات الإعلانات (CTR, CPC)
✅ إحصائيات الإيرادات
```

#### أنواع الإعلانات:

```typescript
1. homepage_banner      // بانر الصفحة الرئيسية
2. homepage_featured    // منتج مميز في الصفحة الرئيسية
3. category_top         // أعلى صفحة التصنيف
4. search_sponsored     // نتائج البحث المدعومة
```

#### الأسعار:

```typescript
homepage_banner:      500 ج.م/أسبوع
homepage_featured:    300 ج.م/أسبوع
category_top:         200 ج.م/أسبوع
search_sponsored:     150 ج.م/أسبوع
```

---

### 2. **صفحة التاجر**
📁 الملف: `client/pages/MerchantAdvertising.tsx`

#### المميزات:

```tsx
✅ عرض إعلانات التاجر
✅ إنشاء إعلان جديد
✅ اختيار المنتج من منتجات التاجر المعتمدة
✅ اختيار نوع الإعلان
✅ تحديد المدة (بالأسابيع)
✅ حساب التكلفة التلقائي
✅ عرض إحصائيات:
   - الإعلانات النشطة
   - إجمالي الإنفاق
   - إجمالي المشاهدات والنقرات
✅ عرض تفاصيل كل إعلان:
   - الحالة (معلق/نشط/منتهي/مرفوض)
   - المشاهدات والنقرات
   - CTR (نسبة النقر للظهور)
   - المدة المتبقية
✅ عرض جدول الأسعار
```

---

### 3. **قاعدة البيانات**
📁 الملف: `scripts/setup-enhanced-collections.js`

#### Collection: `advertisements`

**Attributes:**

```javascript
merchantId        : string (255)  - معرف التاجر
merchantName      : string (255)  - اسم التاجر
productId         : string (255)  - معرف المنتج
productName       : string (255)  - اسم المنتج
productImage      : string (2000) - رابط صورة المنتج
adType            : string (100)  - نوع الإعلان
placement         : string (50)   - موقع العرض
duration          : integer       - المدة بالأيام
price             : float         - السعر
startDate         : string (50)   - تاريخ البداية
endDate           : string (50)   - تاريخ الانتهاء
status            : string (50)   - الحالة
clicks            : integer       - عدد النقرات
impressions       : integer       - عدد المشاهدات
paymentProof      : string (2000) - إثبات الدفع (اختياري)
createdAt         : string (50)   - تاريخ الإنشاء
```

**حالات الإعلان:**

```
pending   → في انتظار موافقة الأدمن
active    → نشط ويظهر للزوار
expired   → انتهت مدته
rejected  → تم رفضه من الأدمن
```

---

## 🎯 كيف يعمل النظام

### **تدفق العمل (Workflow):**

```
1️⃣ التاجر ينشئ إعلان:
   ↓
   - يختار منتج من منتجاته المعتمدة
   - يختار نوع الإعلان
   - يحدد المدة (أسابيع)
   - يشاهد التكلفة الإجمالية
   - يؤكد الإنشاء

2️⃣ الإعلان يُحفظ بحالة "pending":
   ↓
   - ينتظر موافقة الأدمن
   - التاجر يرى "قيد المراجعة"

3️⃣ الأدمن يراجع الإعلان:
   ↓
   - يوافق → status = "active"
   - يرفض → status = "rejected"

4️⃣ إذا تمت الموافقة (active):
   ↓
   - يبدأ العد من startDate
   - يظهر في الموقع المحدد
   - يتم تتبع impressions & clicks

5️⃣ عند انتهاء المدة:
   ↓
   - endDate < الآن
   - status = "expired"
   - يتوقف عن الظهور
```

---

### **تتبع الأداء:**

```typescript
// عند عرض الإعلان
adsManager.trackImpression(adId);
// impressions++

// عند النقر على الإعلان
adsManager.trackClick(adId);
// clicks++

// حساب التحليلات
CTR = (clicks / impressions) × 100
Cost Per Click = price / clicks
Days Remaining = (endDate - today) / (1 day)
```

---

## ❌ المكونات الناقصة

### 1. **صفحة الأدمن لإدارة الإعلانات** 🔴

```
❌ لا يوجد: AdminAdvertisementsManager.tsx

المطلوب:
- عرض جميع الإعلانات
- تصفية حسب الحالة
- الموافقة/الرفض
- عرض إحصائيات شاملة
- إدارة الإعلانات المنتهية
- تقارير الإيرادات
```

---

### 2. **دمج الإعلانات في الصفحات** 🔴

#### أ) الصفحة الرئيسية (Index.tsx):

```tsx
❌ لم يتم دمج:
- homepage_banner (بانر كبير)
- homepage_featured (منتجات مميزة)

المطلوب:
- إضافة مكون AdBanner للبانرات
- إضافة مكون FeaturedAds للمنتجات المميزة
- تتبع المشاهدات والنقرات
```

#### ب) صفحات التصنيفات:

```tsx
❌ لم يتم دمج:
- category_top (منتجات مدعومة أعلى التصنيف)

المطلوب:
- عرض إعلانات في أعلى الصفحة
- تمييزها بـ badge "مدعوم"
- تتبع الأداء
```

#### ج) صفحة البحث:

```tsx
❌ لم يتم دمج:
- search_sponsored (نتائج مدعومة)

المطلوب:
- عرض نتائج مدعومة في أعلى البحث
- badge "إعلان"
- فصل واضح عن النتائج العادية
```

---

### 3. **مكونات واجهة المستخدم** 🔴

```tsx
❌ AdBanner.tsx
- عرض بانرات الصفحة الرئيسية
- تصميم جذاب
- دعم الصور الكبيرة
- زر CTA واضح
- تتبع تلقائي

❌ SponsoredProductCard.tsx
- كارت منتج مدعوم
- badge "إعلان" أو "مدعوم"
- تصميم مميز عن المنتجات العادية
- تتبع النقرات

❌ AdPlaceholder.tsx
- عرض مكان احتياطي إذا لم توجد إعلانات
- تشجيع التجار على الإعلان
```

---

### 4. **نظام الدفع** 🟡

```tsx
⚠️ موجود جزئياً:
- حقل paymentProof في الإعلان
- حقل price محفوظ

❌ المطلوب:
- صفحة دفع مخصصة للإعلانات
- رفع إثبات التحويل
- تكامل مع بوابة دفع (Paymob/Fawry)
- إشعارات الدفع
- فواتير تلقائية
```

---

### 5. **التقارير والتحليلات** 🟡

```tsx
✅ موجود للتاجر:
- المشاهدات، النقرات، CTR

❌ المطلوب للأدمن:
- إجمالي إيرادات الإعلانات
- أكثر أنواع الإعلانات مبيعاً
- متوسط CTR لكل نوع
- تقارير شهرية/سنوية
- Export Excel/PDF
```

---

### 6. **نظام الإشعارات** 🔴

```tsx
❌ إشعار عند إنشاء إعلان (للأدمن)
❌ إشعار عند موافقة/رفض (للتاجر)
❌ إشعار قبل انتهاء الإعلان بـ 3 أيام
❌ إشعار عند انتهاء الإعلان
❌ اقتراح تجديد الإعلان
```

---

### 7. **إدارة تلقائية** 🟡

```typescript
✅ موجود:
- checkExpiredAds() لتحديث الإعلانات المنتهية

❌ المطلوب:
- Cron job يومي لفحص الإعلانات
- تجديد تلقائي (إذا اختار التاجر)
- إرسال إشعارات تلقائية
- تنظيف الإعلانات القديمة
```

---

### 8. **إعدادات الإعلانات** 🔴

```tsx
❌ صفحة إعدادات الأدمن:
- تعديل الأسعار
- تفعيل/تعطيل أنواع معينة
- الحد الأقصى للإعلانات في الصفحة
- موافقة تلقائية لتجار موثوقين
```

---

## 📊 إحصائيات الإكمال

```
┌─────────────────────────────────┬──────────┐
│ المكون                          │ الإكمال │
├─────────────────────────────────┼──────────┤
│ النظام الأساسي (ads-manager)    │   100%  │
│ صفحة التاجر                     │   100%  │
│ قاعدة البيانات                  │   100%  │
│ صفحة الأدمن                     │     0%  │
│ دمج في الصفحات                  │     0%  │
│ مكونات واجهة المستخدم            │     0%  │
│ نظام الدفع                      │    20%  │
│ التقارير المتقدمة               │    30%  │
│ نظام الإشعارات                  │     0%  │
│ الإدارة التلقائية               │    50%  │
│ إعدادات النظام                  │     0%  │
├─────────────────────────────────┼──────────┤
│ الإكمال الإجمالي                │    45%  │
└─────────────────────────────────┴──────────┘
```

---

## 🎯 خطة الإكمال (Roadmap)

### **المرحلة 1: صفحة الأدمن** (أولوية عالية) 🔴

```tsx
✅ إنشاء AdminAdvertisementsManager.tsx:
   - عرض جميع الإعلانات
   - تصفية (pending/active/expired/rejected)
   - الموافقة/الرفض مع ملاحظات
   - إحصائيات الإيرادات
   - تقارير الأداء
```

---

### **المرحلة 2: دمج في الصفحات** (أولوية عالية) 🔴

```tsx
✅ مكون AdBanner.tsx
✅ مكون SponsoredProductCard.tsx
✅ تحديث Index.tsx (بانرات + منتجات مميزة)
✅ تحديث CategoryPage.tsx (إعلانات التصنيف)
✅ تحديث SearchPage.tsx (نتائج مدعومة)
✅ إضافة تتبع المشاهدات والنقرات
```

---

### **المرحلة 3: نظام الدفع** (أولوية متوسطة) 🟡

```tsx
✅ صفحة رفع إثبات الدفع
✅ تكامل مع Paymob/Fawry
✅ إشعارات الدفع
✅ فواتير تلقائية PDF
```

---

### **المرحلة 4: الإشعارات** (أولوية متوسطة) 🟡

```tsx
✅ إشعار إنشاء إعلان
✅ إشعار الموافقة/الرفض
✅ إشعار قبل الانتهاء
✅ إشعار الانتهاء
✅ اقتراح التجديد
```

---

### **المرحلة 5: التحليلات المتقدمة** (أولوية منخفضة) 🟢

```tsx
✅ تقارير شاملة للأدمن
✅ مقارنة أداء الإعلانات
✅ ROI Calculator للتجار
✅ تصدير التقارير
```

---

## 💡 مثال على التدفق الكامل

### **سيناريو: تاجر يريد الإعلان عن منتج**

```
1. التاجر يذهب لـ /merchant/advertising

2. يضغط "إنشاء إعلان جديد"

3. يملأ النموذج:
   - المنتج: "آيفون 15 برو ماكس"
   - النوع: "منتج مميز - الصفحة الرئيسية"
   - المدة: 2 أسبوع
   - التكلفة: 600 ج.م

4. يضغط "إنشاء الإعلان"
   → status = "pending"
   → إشعار للأدمن ✉️

5. الأدمن يراجع في /admin/advertisements
   → يضغط "موافقة"
   → status = "active"
   → إشعار للتاجر ✉️

6. الإعلان يظهر في الصفحة الرئيسية
   → كل عرض: impressions++
   → كل نقرة: clicks++

7. بعد 14 يوم:
   → status = "expired"
   → إشعار للتاجر مع اقتراح تجديد ✉️

8. التاجر يشاهد التحليلات:
   - 15,000 مشاهدة
   - 450 نقرة
   - CTR: 3%
   - تكلفة النقرة: 1.33 ج.م
```

---

## 🔧 إعداد النظام (Setup)

### **1. إنشاء Collection:**

```bash
npm run setup-enhanced-collections
```

أو يدوياً:

```bash
node scripts/setup-enhanced-collections.js
```

---

### **2. إضافة Route للتاجر:**

```tsx
// في App.tsx
import MerchantAdvertising from '@/pages/MerchantAdvertising';

<Route path="/merchant/advertising" element={<MerchantAdvertising />} />
```

---

### **3. إضافة في قائمة التاجر:**

```tsx
// في MerchantLayout أو Sidebar
<Link to="/merchant/advertising">
  <TrendingUp className="h-4 w-4" />
  الإعلانات
</Link>
```

---

## 📝 الملفات المطلوب إنشاؤها

```
Server Side:
❌ server/routes/advertisements.ts (إدارة الإعلانات API)

Client Side:
❌ client/pages/AdminAdvertisementsManager.tsx
❌ client/components/ads/AdBanner.tsx
❌ client/components/ads/SponsoredProductCard.tsx
❌ client/components/ads/AdPlaceholder.tsx
❌ client/pages/AdPaymentPage.tsx
❌ client/lib/ad-notifications.ts
```

---

## 💰 نموذج الإيرادات

```
إذا كان لديك:
- 10 إعلانات homepage_featured نشطة = 3,000 ج.م/أسبوع
- 5 إعلانات homepage_banner نشطة = 2,500 ج.م/أسبوع
- 15 إعلانات category_top نشطة = 3,000 ج.م/أسبوع
- 20 إعلانات search_sponsored نشطة = 3,000 ج.م/أسبوع

= 11,500 ج.م/أسبوع
= 46,000 ج.م/شهر
= 552,000 ج.م/سنة

💡 هذا مصدر دخل إضافي ممتاز للمنصة!
```

---

## 🎯 التوصيات

### **فوري (خلال أسبوع):**

1. ✅ إنشاء صفحة AdminAdvertisementsManager
2. ✅ دمج الإعلانات في الصفحة الرئيسية
3. ✅ إضافة تتبع المشاهدات والنقرات

### **قصير المدى (خلال أسبوعين):**

4. ✅ إنشاء مكونات العرض (AdBanner, SponsoredProductCard)
5. ✅ دمج في صفحات التصنيفات والبحث
6. ✅ نظام الإشعارات الأساسي

### **متوسط المدى (خلال شهر):**

7. ✅ تكامل بوابة الدفع
8. ✅ التقارير المتقدمة
9. ✅ نظام التجديد التلقائي

### **طويل المدى (خلال 3 أشهر):**

10. ✅ A/B Testing للإعلانات
11. ✅ إعلانات فيديو
12. ✅ استهداف جغرافي

---

## 📞 ملاحظات مهمة

### **1. الأسعار:**

```
يمكن تعديلها في: client/lib/ads-manager.ts
const AD_PRICES = {
  homepage_banner: 500,      // قابل للتعديل
  homepage_featured: 300,    // قابل للتعديل
  category_top: 200,         // قابل للتعديل
  search_sponsored: 150,     // قابل للتعديل
};
```

### **2. الصلاحيات:**

```
التاجر: إنشاء وعرض إعلاناته فقط
الأدمن: عرض وإدارة جميع الإعلانات
```

### **3. القيود:**

```
⚠️ فقط المنتجات المعتمدة يمكن الإعلان عنها
⚠️ لا يمكن تعديل الإعلان بعد الإنشاء (يجب إنشاء إعلان جديد)
⚠️ الحد الأدنى للمدة: 1 أسبوع
⚠️ الحد الأقصى: 12 أسبوع
```

---

## ✅ الخلاصة

### **النظام الحالي:**

```
✅ البنية الأساسية قوية ومتينة
✅ صفحة التاجر كاملة ومحترفة
✅ قاعدة البيانات جاهزة
✅ التتبع والتحليلات موجودة
```

### **المطلوب:**

```
❌ صفحة الأدمن (ضرورية)
❌ دمج في الصفحات (ضرورية)
❌ مكونات العرض (ضرورية)
⚠️ نظام الدفع (مهم)
⚠️ الإشعارات (مهم)
🟢 التحليلات المتقدمة (اختياري)
```

---

**📊 نسبة الإكمال: 45%**  
**🎯 المتبقي: 55%**  
**⏱️ الوقت المقدر للإكمال: 3-4 أسابيع عمل**

---

**تم إعداد التقرير بواسطة:** Cascade AI  
**التاريخ:** 22 أكتوبر 2025  
**الحالة:** جاهز للتطوير
