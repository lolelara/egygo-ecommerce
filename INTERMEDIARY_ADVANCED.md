# ๐ ุชุญุณููุงุช ูุธุงู ุงููุณูุท ุงููุชูุฏูุฉ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุงููุณูุท (Intermediary System) ุจููุฒุงุช ูุชูุฏูุฉ ุชุดูู:

### โจ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

#### 1. **ูุธุงู ุงูุชุญุฏูุซ ุงูุชููุงุฆู (Auto-Sync)**
- โ ุชุญุฏูุซ ุชููุงุฆู ููููุชุฌุงุช ูู 10 ุฏูุงุฆู ูู ุงููุตุฏุฑ ุงูุฃุตูู
- โ ุชุชุจุน ุขุฎุฑ ููุช ุชุญุฏูุซ ููู ููุชุฌ
- โ ุฅููุงููุฉ ุชูุนูู/ุชุนุทูู ุงูุชุญุฏูุซ ููู ููุชุฌ
- โ ุชุญุฏูุซ ุฌูุงุนู ูุฌููุน ุงูููุชุฌุงุช ุจุถุบุทุฉ ูุงุญุฏุฉ
- โ Worker ูุนูู ูู ุงูุฎูููุฉ ุชููุงุฆูุงู

#### 2. **ุชุนุฏูู ุงููุตู ูุงูุณุนุฑ**
- โ ุชุนุฏูู ูุตู ุงูููุชุฌ ูุน ุญูุธ ุงููุตู ุงูุฃุตูู
- โ ุชุนุฏูู ุงูุณุนุฑ ุงูููุงุฆู ูุน ุญูุธ ุงูุณุนุฑ ุงูุฃุตูู
- โ ุฅููุงููุฉ ุงุณุชุนุงุฏุฉ ุงููุตู ุงูุฃุตูู ุจุถุบุทุฉ ูุงุญุฏุฉ
- โ ุนุฑุถ ูุคุดุฑุงุช ูููุญุชูู ุงููุนุฏูู

#### 3. **ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ููุฃุฏูู**
- โ ุตูุญุฉ ูุงููุฉ ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
- โ ุฅูุดุงุก ุญุณุงุจุงุช ูุณุทุงุก ุฌุฏูุฏุฉ
- โ ุจุญุซ ูุชุตููุฉ ูุชูุฏู
- โ ุนุฑุถ ุฌููุน ุงูุจูุงูุงุช (ุงูุฃููุงุฏุ ุงูุฃุฏูุงุฑุ ุงูุชูุงุฑูุฎ)

---

## ๐๏ธ ุชุญุฏูุซุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุญููู Products Collection ุงูุฌุฏูุฏุฉ:

```typescript
{
  // ุญููู ุงูุชุญุฏูุซ ุงูุชููุงุฆู
  lastSyncedAt: datetime,           // ุขุฎุฑ ููุช ุชู ููู ุชุญุฏูุซ ุงูููุชุฌ
  autoSyncEnabled: boolean,          // ูู ุงูุชุญุฏูุซ ุงูุชููุงุฆู ููุนู
  syncIntervalMinutes: integer,      // ุงููุชุฑุฉ ุจูู ูู ุชุญุฏูุซ (ุงูุชุฑุงุถู: 10)
  
  // ุญููู ุงูุชุนุฏูู ุงููุฎุตุต
  originalDescription: string,       // ุงููุตู ุงูุฃุตูู ูุจู ุงูุชุนุฏูู
  customDescription: string,         // ุงููุตู ุงููุฎุตุต ูู ุงููุณูุท
  priceOverride: float,             // ุงูุณุนุฑ ุงููุฎุตุต (ูุชุฌุงูุฒ ุงูุญุณุงุจ ุงูุชููุงุฆู)
}
```

### ููููุฉ ุชุทุจูู ุงูุชุญุฏูุซุงุช:

```bash
# ุชุดุบูู ุณูุฑูุจุช ุฅุถุงูุฉ ุงูุญููู
node scripts/add-sync-fields.mjs
```

---

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ

### 1. **client/lib/auto-sync-worker.ts**
Worker ูุชุดุบูู ุงูุชุญุฏูุซุงุช ุงูุชููุงุฆูุฉ ูู ุงูุฎูููุฉ.

**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
- `startAutoSyncWorker()` - ุจุฏุก ุชุดุบูู Worker
- `stopAutoSyncWorker()` - ุฅููุงู Worker
- `manualSync()` - ุชุญุฏูุซ ูุฏูู ููุฑู

```typescript
import { startAutoSyncWorker } from '@/lib/auto-sync-worker';

// ุจุฏุก ุงูุชุดุบูู ุนูุฏ ุชุญููู ุงูุชุทุจูู
startAutoSyncWorker();
```

### 2. **client/pages/AdminUserManagement.tsx**
ุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ููุฃุฏูู.

**ุงููููุฒุงุช:**
- ุฅูุดุงุก ุญุณุงุจุงุช ุฌุฏูุฏุฉ (ุนูููุ ูุณููุ ุชุงุฌุฑุ ูุณูุทุ ูุฏูุฑ)
- ุจุญุซ ูุชูุฏู ุจุงูุงุณู/ุงูุจุฑูุฏ/ุงููุงุชู
- ุชุตููุฉ ุญุณุจ ุงูุฏูุฑ
- ุญุฐู ุงููุณุชุฎุฏููู
- ุนุฑุถ ุงูุฃููุงุฏ ุงูุฎุงุตุฉ (AFF/INT)

**ุงูุฑุงุจุท:**
```
/admin/user-management
```

### 3. **scripts/add-sync-fields.mjs**
ุณูุฑูุจุช ูุฅุถุงูุฉ ุญููู ุงูุชุญุฏูุซ ุงูุชููุงุฆู ููููุชุฌุงุช.

---

## ๐ง API Functions ุงูุฌุฏูุฏุฉ

### ูู `client/lib/intermediary-api.ts`:

#### 1. ุชุนุฏูู ุงูุณุนุฑ
```typescript
updateProductPrice(productId: string, newPrice: number)
```

#### 2. ุชุนุฏูู ุงููุตู
```typescript
updateProductDescription(productId: string, customDescription: string)
```

#### 3. ุงุณุชุนุงุฏุฉ ุงููุตู ุงูุฃุตูู
```typescript
restoreOriginalDescription(productId: string)
```

#### 4. ูุฒุงููุฉ ููุชุฌ ูู ุงููุตุฏุฑ
```typescript
syncProductFromSource(productId: string)
// ููุฑุฌุน: { success, changes: { priceChanged, descriptionUpdated, nameUpdated } }
```

#### 5. ุชูุนูู/ุชุนุทูู ุงูุชุญุฏูุซ ุงูุชููุงุฆู
```typescript
toggleProductAutoSync(productId: string, enabled: boolean, intervalMinutes?: number)
```

#### 6. ุฌูุจ ุงูููุชุฌุงุช ุงูุชู ุชุญุชุงุฌ ุชุญุฏูุซ
```typescript
getProductsNeedingSync(intermediaryId?: string)
```

#### 7. ูุฒุงููุฉ ุฌูุงุนูุฉ
```typescript
bulkSyncProducts(intermediaryId: string)
// ููุฑุฌุน: { total, synced, failed, errors }
```

---

## ๐จ ูุงุฌูุฉ Intermediary Dashboard ุงููุญุฏุซุฉ

### ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:

#### 1. **ุฃุนูุฏุฉ ุงูุฌุฏูู ุงูุฅุถุงููุฉ:**
- ุนููุฏ "ุชุญุฏูุซ ุชููุงุฆู" ูุน Switch ููุชูุนูู/ุงูุชุนุทูู
- ุนููุฏ "ุขุฎุฑ ุชุญุฏูุซ" ูุนุฑุถ ุชุงุฑูุฎ ูููุช ุขุฎุฑ ูุฒุงููุฉ
- ุนููุฏ "ุฅุฌุฑุงุกุงุช" ูุน ุฃุฒุฑุงุฑ:
  - โ๏ธ ุชุนุฏูู (ุงูุณุนุฑ ูุงููุตู)
  - ๐ ูุฒุงููุฉ ูุฏููุฉ
  - ๐ ูุชุญ ุงูุฑุงุจุท ุงูุฃุตูู

#### 2. **ูุคุดุฑุงุช ุงููุญุชูู ุงููุนุฏูู:**
- ุนุฑุถ "(ูุตู ูุนุฏูู)" ุชุญุช ุงุณู ุงูููุชุฌ
- ุนุฑุถ "(ุณุนุฑ ูุฎุตุต)" ุชุญุช ุงูุณุนุฑ ุงูููุงุฆู

#### 3. **ุฒุฑ ุงููุฒุงููุฉ ุงูุฌูุงุนูุฉ:**
```tsx
<Button onClick={handleBulkSync}>
  ูุฒุงููุฉ ุงููู
</Button>
```

#### 4. **Dialog ุชุนุฏูู ุงูููุชุฌ:**
- ุญูู ุชุนุฏูู ุงูุณุนุฑ ุงูููุงุฆู
- ุนุฑุถ ุงูุณุนุฑ ุงูุฃุตูู ููููุงุฑูุฉ
- Textarea ูุชุนุฏูู ุงููุตู
- ุฒุฑ ุงุณุชุนุงุฏุฉ ุงููุตู ุงูุฃุตูู

---

## โ๏ธ ููููุฉ ุนูู ุงููุธุงู

### 1. **ุงูุชุญุฏูุซ ุงูุชููุงุฆู:**

```
1. Worker ูุจุฏุฃ ูุน ุงูุชุทุจูู
2. ูู 10 ุฏูุงุฆู ูุจุญุซ ุนู ููุชุฌุงุช:
   - autoSyncEnabled = true
   - ูุฑ ุนูู ุขุฎุฑ ุชุญุฏูุซ ุฃูุซุฑ ูู syncIntervalMinutes
3. ูููู ุจู:
   - ุฌูุจ ุงูุจูุงูุงุช ูู ุงูุฑุงุจุท ุงูุฃุตูู
   - ุชุญุฏูุซ originalPrice ุฅุฐุง ุชุบูุฑ
   - ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุณุนุฑ ุงูููุงุฆู (ุฅูุง ุฅุฐุง ูุงู ููุงู priceOverride)
   - ุชุญุฏูุซ originalDescription (ูุน ุงูุญูุงุธ ุนูู customDescription)
   - ุชุญุฏูุซ lastSyncedAt
```

### 2. **ุชุนุฏูู ุงูููุชุฌ:**

```
1. ุงููุณูุท ูุถุบุท ุฒุฑ "ุชุนุฏูู"
2. ููุชุญ Dialog ุจุงูุจูุงูุงุช ุงูุญุงููุฉ
3. ูุนุฏูู ุงูุณุนุฑ ุฃู ุงููุตู
4. ุนูุฏ ุงูุญูุธ:
   - ูุญูุธ originalDescription ุฅุฐุง ูู ููู ูุญููุธุงู
   - ูุญุฏุซ customDescription ู description
   - ูุญุฏุซ priceOverride ู price
5. ุชุธูุฑ ูุคุดุฑุงุช ุงูุชุนุฏูู ูู ุงูุฌุฏูู
```

### 3. **ุงููุฒุงููุฉ ุงููุฏููุฉ:**

```
1. ุงููุณูุท ูุถุบุท ุฒุฑ ๐ ุจุฌูุงุฑ ุงูููุชุฌ
2. ุงููุธุงู ูุฌูุจ ุงูุจูุงูุงุช ูู ุงูุฑุงุจุท
3. ูุญุฏุซ:
   - ุงูุณุนุฑ ุงูุฃุตูู (ูุน ุฅุนุงุฏุฉ ุงูุญุณุงุจ ุฅุฐุง ูุฒู)
   - ุงููุตู ุงูุฃุตูู (ุฏูู ุงููุณุงุณ ุจุงููุฎุตุต)
   - ุงูุงุณู ุฅุฐุง ุชุบูุฑ
4. ุชุธูุฑ Toast ุจุงูุชุบููุฑุงุช ุงูุชู ุญุฏุซุช
```

---

## ๐ ุงุณุชุฎุฏุงู ุงููุธุงู

### ูููุณูุท:

1. **ุงุณุชูุฑุงุฏ ููุชุฌ:**
   - ุฃุฏุฎู ุฑุงุจุท ุงูููุชุฌ
   - ุญุฏุฏ ูุณุจุฉ ุงูุชุฑููุฒ
   - ุงุถุบุท "ุงุณุชูุฑุงุฏ ุงูููุชุฌ"

2. **ุชูุนูู ุงูุชุญุฏูุซ ุงูุชููุงุฆู:**
   - ุงููุฑ ุนูู Switch ูู ุนููุฏ "ุชุญุฏูุซ ุชููุงุฆู"
   - ุณูุชู ุชุญุฏูุซ ุงูููุชุฌ ุชููุงุฆูุงู ูู 10 ุฏูุงุฆู

3. **ุชุนุฏูู ุงูููุชุฌ:**
   - ุงุถุบุท ุฒุฑ โ๏ธ ูู ุนููุฏ ุงูุฅุฌุฑุงุกุงุช
   - ุนุฏูู ุงูุณุนุฑ ุฃู ุงููุตู
   - ุงุญูุธ ุงูุชุบููุฑุงุช

4. **ูุฒุงููุฉ ูุฏููุฉ:**
   - ุงุถุบุท ุฒุฑ ๐ ูุชุญุฏูุซ ููุชุฌ ูุงุญุฏ
   - ุฃู ุงุถุบุท "ูุฒุงููุฉ ุงููู" ูุชุญุฏูุซ ุฌููุน ุงูููุชุฌุงุช

### ููุฃุฏูู:

1. **ุฅูุดุงุก ุญุณุงุจ ูุณูุท:**
   - ุงูุชุญ `/admin/user-management`
   - ุงุถุบุท "ุฅุถุงูุฉ ูุณุชุฎุฏู"
   - ุงุฎุชุฑ ุงูุฏูุฑ "ูุณูุท"
   - ุญุฏุฏ ูุณุจุฉ ุงูุชุฑููุฒ ุงูุงูุชุฑุงุถูุฉ
   - ุงุญูุธ

2. **ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู:**
   - ุงุจุญุซ ุจุงูุงุณู/ุงูุจุฑูุฏ/ุงููุงุชู
   - ุตููู ุญุณุจ ุงูุฏูุฑ
   - ุงุญุฐู ูุณุชุฎุฏููู ุนูุฏ ุงูุญุงุฌุฉ

---

## ๐ ุงูุฃูุงู

### ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:
- ุฌููุน API calls ูุญููุฉ ุจู try-catch
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู
- Logging ููุฃุฎุทุงุก ูู Console

### ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:
- ููุท ุงูุฃุฏูู ููููู ุฅูุดุงุก ุญุณุงุจุงุช ูุณุทุงุก
- ุงููุณูุท ููููู ุชุนุฏูู ููุชุฌุงุชู ููุท
- ุฌููุน ุงูุนูููุงุช ุชุชุทูุจ authentication

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

### ุชุญุณููุงุช ููุชุฑุญุฉ:

1. **Server-Side Scraping:**
   - ููู ุนูููุฉ ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ููุณูุฑูุฑ ูุฃูุงู ุฃูุถู
   - ุงุณุชุฎุฏุงู Puppeteer ุฃู Cheerio

2. **ุตูุญุฉ ุทูุจุงุช ุงููุณูุท:**
   - ุนุฑุถ ุงูุทูุจุงุช ุงูุชู ุชุญุชูู ุนูู ููุชุฌุงุช ุงููุณูุท
   - ุญุณุงุจ ุนูููุงุช ุงููุณูุท

3. **ุฅุญุตุงุฆูุงุช ูุชูุฏูุฉ:**
   - ุนุฏุฏ ุงูุชุญุฏูุซุงุช ุงููุงุฌุญุฉ/ุงููุงุดูุฉ
   - ูุชูุณุท ุงูุชุฑููุฒ
   - ุงูููุชุฌุงุช ุงูุฃูุซุฑ ูุจูุนุงู

4. **ุชูุจููุงุช:**
   - ุฅุดุนุงุฑ ุนูุฏ ูุดู ุชุญุฏูุซ ููุชุฌ
   - ุชูุจูู ุนูุฏ ุชุบููุฑ ุงูุณุนุฑ ุจูุณุจุฉ ูุจูุฑุฉ

---

## ๐ ููุงุญุธุงุช ูููุฉ

### 1. CORS Proxy:
- ุญุงููุงู ูุณุชุฎุฏู `allorigins.win` ููู client-side scraping
- ูู ุงูุฅูุชุงุฌุ ูููุถู ุงุณุชุฎุฏุงู server-side API

### 2. Rate Limiting:
- Worker ูุถุน ุชุฃุฎูุฑ 1 ุซุงููุฉ ุจูู ูู ููุชุฌ
- ูุชุฌูุจ ุญุธุฑ ุงูู IP ูู ุงูููุงูุน ุงููุตุฏุฑ

### 3. ุงูุจูุงูุงุช ุงููุณุชุฎุฑุฌุฉ:
- ุงููุธุงู ูุจุญุซ ุนู Open Graph tags ุฃููุงู
- ุซู ูุญุงูู ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู HTML structure
- ูุฏ ุชุญุชุงุฌ ุจุนุถ ุงูููุงูุน ูู custom parsers

---

## ๐ ุงูุจุฏุก ุงูุณุฑูุน

```bash
# 1. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
node scripts/add-sync-fields.mjs

# 2. ุชุดุบูู ุงูุชุทุจูู
pnpm dev

# 3. ุณูุจุฏุฃ Auto-Sync Worker ุชููุงุฆูุงู
```

---

## ๐ ุงูุฏุนู

ูููุดุงูู ุฃู ุงูุงุณุชูุณุงุฑุงุช:
- ุฑุงุฌุน ููู `INTERMEDIARY_SYSTEM_GUIDE.md`
- ุฑุงุฌุน ููู `QUICK_START_INTERMEDIARY.md`
- ุชุญูู ูู Console ููุฃุฎุทุงุก

---

**ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ:** 2025-01-04  
**ุงูุฅุตุฏุงุฑ:** 2.0 - Advanced Intermediary System
