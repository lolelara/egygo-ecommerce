import{r as j,j as e,B as g,C as l,e as r,f as n,ab as P,g as i,az as A,aa as I,aw as U,aE as q,I as M,ap as X,aq as J,ar as K,as as Q,at as u,a as p,X as R}from"./index-Ce-RwxJS.js";import{A as W}from"./AdminLayout-DRAN_nM7.js";import{T as Y,a as Z,b as T,c,d as _,e as d}from"./table-DhT4s9qg.js";import{e as G}from"./admin-api-DJKkOHRe.js";import{C as E}from"./credit-card-Diutn1QU.js";import{C as V}from"./clock-D_TAAEO_.js";import"./tag-BB9opunb.js";import"./settings-DdUeHZqS.js";const $=({status:a})=>{const x={PENDING:{label:"في الانتظار",variant:"secondary",icon:V},APPROVED:{label:"موافق عليها",variant:"default",icon:A},PAID:{label:"مدفوعة",variant:"secondary",icon:E},CANCELLED:{label:"ملغية",variant:"destructive",icon:R}},f=x[a]||x.PENDING,N=f.icon;return e.jsxs(p,{variant:f.variant,className:"flex items-center gap-1",children:[e.jsx(N,{className:"h-3 w-3"}),f.label]})};function ce(){const[a,x]=j.useState([]),[f,N]=j.useState(!0),[o,k]=j.useState(""),[C,O]=j.useState("all");j.useEffect(()=>{(async()=>{N(!0);try{const t=await G.getAll();x(t)}catch(t){console.error("Error fetching commissions:",t),x([])}finally{N(!1)}})()},[]);const S=a.filter(s=>{const t=s.affiliate.name.toLowerCase().includes(o.toLowerCase())||s.affiliate.email.toLowerCase().includes(o.toLowerCase())||s.affiliate.affiliateCode.toLowerCase().includes(o.toLowerCase())||s.order.orderNumber.toLowerCase().includes(o.toLowerCase()),h=C==="all"||s.status===C;return t&&h}),v=async(s,t)=>{try{await G.updateStatus(s,t),x(h=>h.map(y=>y.id===s?{...y,status:t,updatedAt:new Date().toISOString()}:y))}catch(h){console.error("Error updating commission status:",h)}},m=a.length,D=a.filter(s=>s.status==="PENDING"),w=a.filter(s=>s.status==="APPROVED"),b=a.filter(s=>s.status==="PAID"),L=a.reduce((s,t)=>s+t.amount,0),z=D.reduce((s,t)=>s+t.amount,0),B=w.reduce((s,t)=>s+t.amount,0),F=b.reduce((s,t)=>s+t.amount,0),H=new Set(a.map(s=>s.affiliateId)).size;return e.jsx(W,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"إدارة العمولات"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(g,{variant:"outline",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"دفع العمولات المعتمدة"]})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"إجمالي العمولات"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[L.toLocaleString()," ج.م إجمالي"]})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"في الانتظار"}),e.jsx(V,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:D.length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[z.toLocaleString()," ج.م"]})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"معتمدة"}),e.jsx(A,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[B.toLocaleString()," ج.م جاهزة للدفع"]})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"مدفوعة"}),e.jsx(I,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b.length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[F.toLocaleString()," ج.م مدفوعة"]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"الشركاء النشطين"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:H}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"لديهم عمولات هذا الشهر"})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"متوسط العمولة"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(i,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[m>0?(L/m).toFixed(2):"0"," ","ج.م"]})})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"معدل الموافقة"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(i,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[m>0?Math.round((w.length+b.length)/m*100):0,"%"]})})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(M,{placeholder:"البحث في العمولات...",value:o,onChange:s=>k(s.target.value),className:"pl-10"})]})}),e.jsxs(X,{value:C,onValueChange:O,children:[e.jsx(J,{className:"w-48",children:e.jsx(K,{placeholder:"حالة العمولة"})}),e.jsxs(Q,{children:[e.jsx(u,{value:"all",children:"جميع الحالات"}),e.jsx(u,{value:"PENDING",children:"في الانتظار"}),e.jsx(u,{value:"APPROVED",children:"معتمدة"}),e.jsx(u,{value:"PAID",children:"مدفوعة"}),e.jsx(u,{value:"CANCELLED",children:"ملغية"})]})]})]}),e.jsxs(l,{children:[e.jsx(r,{children:e.jsxs(n,{children:["العمولات (",S.length,")"]})}),e.jsx(i,{children:e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(T,{children:[e.jsx(c,{children:"الشريك"}),e.jsx(c,{children:"الطلب"}),e.jsx(c,{children:"المنتج"}),e.jsx(c,{children:"المبلغ"}),e.jsx(c,{children:"النسبة"}),e.jsx(c,{children:"الحالة"}),e.jsx(c,{children:"التاريخ"}),e.jsx(c,{className:"text-center",children:"الإجراءات"})]})}),e.jsx(_,{children:S.map(s=>e.jsxs(T,{children:[e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.affiliate.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.affiliate.affiliateCode})]})}),e.jsx(d,{children:e.jsx(p,{variant:"outline",children:s.order.orderNumber})}),e.jsx(d,{children:e.jsx("div",{className:"text-sm",children:s.product?.name||"غير محدد"})}),e.jsx(d,{children:e.jsxs("div",{className:"font-medium",children:[s.amount.toFixed(2)," ج.م"]})}),e.jsxs(d,{children:[s.percentage,"%"]}),e.jsx(d,{children:e.jsx($,{status:s.status})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-sm",children:new Date(s.createdAt).toLocaleDateString("ar-EG")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>v(s.id,"APPROVED"),children:e.jsx(A,{className:"h-4 w-4 text-green-600"})}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>v(s.id,"CANCELLED"),children:e.jsx(R,{className:"h-4 w-4 text-red-600"})})]}),s.status==="APPROVED"&&e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>v(s.id,"PAID"),children:[e.jsx(E,{className:"h-4 w-4"}),"دفع"]}),s.status==="PAID"&&e.jsx(p,{variant:"secondary",children:"تم الدفع"}),s.status==="CANCELLED"&&e.jsx(p,{variant:"destructive",children:"ملغية"})]})})]},s.id))})]})})]})]})})}export{ce as default};
