import{r as i,j as e,U as ue,cf as He,p as Ke,a8 as Je,k as Ge,ax as Ve,c2 as Qe,aZ as Ye,s as Ze,ar as We,_ as Z,X as es,bv as pe,ck as ss}from"./vendor-react-CCFRLLzk.js";import{A as ts}from"./AdminLayout-Br9nuQvC.js";import{c as as,u as rs,d as m,C as v,x as z,y as L,h as B,I as F,f as d,S as fe,i as ge,j as je,k as be,l as A,s as Ne,L as M,B as W,e as q}from"./index-D7NOjX7I.js";import{Q as h,I as ve}from"./vendor-appwrite-CuqfvTq9.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-other-CzBBjgu5.js";import"./vendor-animations-CPHPqPXb.js";import"./avatar-CwtoJR-j.js";import"./appwrite-client-DFce-dPK.js";const x=void 0,H="https://fra.cloud.appwrite.io/v1",K="",J="",G={async updateUserName(y,n){const o=await fetch(`${H}/users/${y}/name`,{method:"PATCH",headers:{"Content-Type":"application/json","X-Appwrite-Project":K,"X-Appwrite-Key":J},body:JSON.stringify({name:n})});if(!o.ok)throw new Error(await o.text());return o.json()},async updateUserEmail(y,n){const o=await fetch(`${H}/users/${y}/email`,{method:"PATCH",headers:{"Content-Type":"application/json","X-Appwrite-Project":K,"X-Appwrite-Key":J},body:JSON.stringify({email:n})});if(!o.ok)throw new Error(await o.text());return o.json()},async updateUserPhone(y,n){const o=await fetch(`${H}/users/${y}/phone`,{method:"PATCH",headers:{"Content-Type":"application/json","X-Appwrite-Project":K,"X-Appwrite-Key":J},body:JSON.stringify({number:n})});if(!o.ok)throw new Error(await o.text());return o.json()},async deleteUser(y){const n=await fetch(`${H}/users/${y}`,{method:"DELETE",headers:{"X-Appwrite-Project":K,"X-Appwrite-Key":J}});if(!n.ok)throw new Error(await n.text());return n.status===204}};function ps(){const{user:y}=as(),{toast:n}=rs(),[o,ye]=i.useState([]),[we,ee]=i.useState(!1),[V,Ce]=i.useState(""),[E,Se]=i.useState(""),[k,Ae]=i.useState("all"),[f,X]=i.useState(1),[U,Ee]=i.useState(0),R=25,[g,I]=i.useState(new Set),[P,se]=i.useState(""),[ke,Q]=i.useState(!1),[_,Ie]=i.useState("customer"),[$e,te]=i.useState(!1),[u,ae]=i.useState(null),[r,$]=i.useState({name:"",email:"",phone:"",role:"customer"}),[De,re]=i.useState(!1),[b,le]=i.useState(null),[Y,ie]=i.useState("20"),[Me,ne]=i.useState(!1),[D,ce]=i.useState(null),[N,oe]=i.useState({commissions:[],orders:[]}),[Ue,de]=i.useState(!1);i.useEffect(()=>{const s=setTimeout(()=>{Se(V),X(1)},300);return()=>clearTimeout(s)},[V]),i.useEffect(()=>{C()},[f,E,k]);const C=i.useCallback(async()=>{ee(!0);try{const s=[h.limit(R),h.offset((f-1)*R),h.orderDesc("$createdAt")],t=await m.listDocuments(x,"userPreferences",s);console.log("âœ… Loaded users:",t.documents.length),ye(t.documents),Ee(t.total)}catch(s){console.error("Error loading users:",s),n({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†",variant:"destructive"})}finally{ee(!1)}},[f,E,k]),Re=s=>{console.log("Opening edit modal for:",s.name),ae(s),$({name:s.name||"",email:s.email||"",phone:s.phone||"",role:s.role||"customer"}),te(!0)},me=()=>{te(!1),ae(null),$({name:"",email:"",phone:"",role:"customer"})},Pe=async()=>{if(u)try{if(u.userId)try{let t=!1;r.name!==u.name&&(await G.updateUserName(u.userId,r.name),console.log("âœ… Updated name in Auth"),t=!0),r.email!==u.email&&(await G.updateUserEmail(u.userId,r.email),console.log("âœ… Updated email in Auth"),t=!0),r.phone&&r.phone!==u.phone&&(await G.updateUserPhone(u.userId,r.phone),console.log("âœ… Updated phone in Auth"),t=!0),t&&console.log("âœ… Auth updated successfully!")}catch(t){console.error("âŒ Error updating Auth:",t),n({title:"ØªØ­Ø°ÙŠØ±",description:`ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙƒÙ† ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙŠ Auth: ${t.message}`,variant:"destructive"})}const s={name:r.name,email:r.email,phone:r.phone||"",role:r.role};if(s.isAffiliate=r.role==="affiliate",s.isMerchant=r.role==="merchant",s.isIntermediary=r.role==="intermediary",s.isAdmin=r.role==="admin",await m.updateDocument(x,"userPreferences",u.$id,s),r.role!==u.role){const t={customer:"Ø¹Ù…ÙŠÙ„",merchant:"ØªØ§Ø¬Ø±",affiliate:"Ù…Ø³ÙˆÙ‚",intermediary:"ÙˆØ³ÙŠØ·",admin:"Ù…Ø¯ÙŠØ±"},a=t[u.role]||u.role,c=t[r.role]||r.role;try{await m.createDocument(q.databaseId,q.collections.notifications,ve.unique(),{userId:u.userId,title:"ðŸŽ‰ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±Ùƒ Ø¨Ù†Ø¬Ø§Ø­",message:`ØªÙ… ØªØºÙŠÙŠØ± Ø¯ÙˆØ±Ùƒ Ù…Ù† ${a} Ø¥Ù„Ù‰ ${c}. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©!`,type:"success",isRead:!1,link:r.role==="merchant"?"/merchant/dashboard":r.role==="affiliate"?"/affiliate/dashboard":r.role==="intermediary"?"/intermediary/dashboard":r.role==="admin"?"/admin/dashboard":"/"}),console.log("âœ… Role change notification sent")}catch(l){console.error("Error sending notification:",l)}}n({title:"Ù†Ø¬Ø­",description:"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­"}),me(),C()}catch(s){console.error("Error updating user:",s),n({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",variant:"destructive"})}},Te=s=>{console.log("Opening intermediary modal for:",s.name),le(s),re(!0)},he=()=>{re(!1),le(null),ie("20")},ze=async()=>{if(b)try{const s=`INT${Date.now()}`;await m.updateDocument(x,"users",b.$id,{isIntermediary:!0,affiliateCode:s,commissionRate:parseFloat(Y)/100}),console.log("âœ… Intermediary activated");try{await m.createDocument(q.databaseId,q.collections.notifications,ve.unique(),{userId:b.userId,title:"ðŸŽ‰ Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ… ØªÙØ¹ÙŠÙ„Ùƒ ÙƒÙˆØ³ÙŠØ·",message:`ØªÙ… ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ ÙƒÙˆØ³ÙŠØ· Ø¨Ù†Ø¬Ø§Ø­! ÙƒÙˆØ¯ Ø§Ù„ÙˆØ³ÙŠØ· Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ: ${s}. Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: ${Y}%. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ù†Ø´Ø§Ø¡ Ø±ÙˆØ§Ø¨Ø· Ø®Ø§ØµØ© Ø¨Ùƒ ÙˆØ¥Ø¶Ø§ÙØ© Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.`,type:"success",isRead:!1,link:"/intermediary/dashboard"}),console.log("âœ… Intermediary activation notification sent")}catch(t){console.error("Error sending notification:",t)}n({title:"Ù†Ø¬Ø­",description:`ØªÙ… ØªÙØ¹ÙŠÙ„ ${b.name} ÙƒÙˆØ³ÙŠØ· Ø¨Ù†Ø¬Ø§Ø­`}),he(),C()}catch(s){console.error("Error activating intermediary:",s),n({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ³ÙŠØ·",variant:"destructive"})}},Le=async(s,t)=>{if(confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${t}ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ù…ØµØ§Ø¯Ù‚Ø©.`))try{const c=(await m.getDocument(x,"userPreferences",s)).userId;try{const l=await m.listDocuments(x,"notifications",[h.equal("userId",c),h.limit(100)]);for(const p of l.documents)await m.deleteDocument(x,"notifications",p.$id);console.log(`âœ… Deleted ${l.documents.length} notifications`)}catch(l){console.error("Error deleting notifications:",l)}try{const l=await m.listDocuments(x,"referrals",[h.equal("referredUserId",c),h.limit(100)]);for(const p of l.documents)await m.deleteDocument(x,"referrals",p.$id);console.log(`âœ… Deleted ${l.documents.length} referrals`)}catch(l){console.error("Error deleting referrals:",l)}await m.deleteDocument(x,"userPreferences",s),console.log("âœ… Deleted from userPreferences");try{await G.deleteUser(c),console.log("âœ… Deleted from Auth"),n({title:"Ù†Ø¬Ø­",description:"ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (Auth)"})}catch(l){console.error("âŒ Error deleting from Auth:",l),n({title:"ØªØ­Ø°ÙŠØ±",description:`ØªÙ… Ø§Ù„Ø­Ø°Ù Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙƒÙ† ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù Ù…Ù† Auth: ${l.message}`,variant:"destructive"})}C()}catch(a){console.error("Error deleting user:",a),n({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",variant:"destructive"})}},Be=s=>{const t=new Set(g);t.has(s)?t.delete(s):t.add(s),I(t)},Fe=()=>{g.size===T.length?I(new Set):I(new Set(T.map(s=>s.$id)))},Xe=async()=>{if(g.size===0){n({title:"ØªÙ†Ø¨ÙŠÙ‡",description:"Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„",variant:"destructive"});return}if(!P){n({title:"ØªÙ†Ø¨ÙŠÙ‡",description:"Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø±Ø§Ø¡",variant:"destructive"});return}if(P==="delete"){if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${g.size} Ù…Ø³ØªØ®Ø¯Ù…ØŸ`))return;let s=0,t=0;for(const a of g)try{await m.deleteDocument(x,"users",a),s++}catch(c){console.error("Error deleting user:",a,c),t++}n({title:"ØªÙ…",description:`ØªÙ… Ø­Ø°Ù ${s} Ù…Ø³ØªØ®Ø¯Ù…ØŒ ÙØ´Ù„ ${t}`}),I(new Set),C()}else P==="change_role"&&Q(!0)},_e=async()=>{let s=0,t=0;for(const a of g)try{const c={isAffiliate:_==="affiliate",isMerchant:_==="merchant",isIntermediary:_==="intermediary"};await m.updateDocument(x,"users",a,c),s++}catch(c){console.error("Error updating user role:",a,c),t++}n({title:"ØªÙ…",description:`ØªÙ… ØªØ­Ø¯ÙŠØ« ${s} Ù…Ø³ØªØ®Ø¯Ù…ØŒ ÙØ´Ù„ ${t}`}),I(new Set),Q(!1),se(""),C()},Oe=async s=>{ce(s),ne(!0),de(!0);let t=[],a=[];try{try{t=(await m.listDocuments(x,"commissions",[h.equal("affiliateId",s.userId||s.$id),h.orderDesc("$createdAt"),h.limit(50)])).documents}catch(c){console.log("Commissions error:",c.message);try{t=(await m.listDocuments(x,"commissions",[h.orderDesc("$createdAt"),h.limit(50)])).documents.filter(p=>p.affiliateId===s.userId||p.affiliateId===s.$id||p.userId===s.userId||p.userId===s.$id)}catch{console.log("Could not load commissions")}}try{a=(await m.listDocuments(x,"orders",[h.orderDesc("$createdAt"),h.limit(100)])).documents.filter(l=>l.userEmail===s.email||l.userId===s.userId||l.userId===s.$id||l.customerEmail===s.email)}catch(c){console.log("Orders error:",c)}oe({commissions:t,orders:a}),t.length===0&&a.length===0&&n({title:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª",description:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…ÙˆÙ„Ø§Øª Ø£Ùˆ Ø·Ù„Ø¨Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"})}catch(c){console.error("Error loading financial history:",c),n({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ",variant:"destructive"})}finally{de(!1)}},xe=()=>{ne(!1),ce(null),oe({commissions:[],orders:[]})},qe=s=>{let t="Ø¹Ù…ÙŠÙ„",a="bg-gray-100 text-gray-800";return s.isAffiliate&&(t="Ù…Ø³ÙˆÙ‚",a="bg-green-100 text-green-800"),s.isMerchant&&(t="ØªØ§Ø¬Ø±",a="bg-blue-100 text-blue-800"),s.isIntermediary&&(t="ÙˆØ³ÙŠØ·",a="bg-purple-100 text-purple-800"),(s.email==="admin@egygo.com"||s.role==="admin")&&(t="Ù…Ø¯ÙŠØ±",a="bg-red-100 text-red-800"),e.jsx(W,{className:a,children:t})},T=i.useMemo(()=>o.filter(s=>{var l,p,O;const t=((l=s.name)==null?void 0:l.toLowerCase().includes(E.toLowerCase()))||((p=s.email)==null?void 0:p.toLowerCase().includes(E.toLowerCase()))||((O=s.phone)==null?void 0:O.includes(E));let a="customer";return s.isAffiliate&&(a="affiliate"),s.isMerchant&&(a="merchant"),s.isIntermediary&&(a="intermediary"),s.email==="admin@egygo.com"&&(a="admin"),t&&(k==="all"||a===k)}),[o,E,k]),S=Math.ceil(U/R),w=i.useMemo(()=>{const s=U,t=o.filter(j=>j.role==="customer").length,a=o.filter(j=>j.isAffiliate).length,c=o.filter(j=>j.isMerchant).length,l=o.filter(j=>j.role==="admin").length,p=o.filter(j=>j.accountStatus==="pending").length,O=o.filter(j=>j.accountStatus==="approved").length;return{total:s,customer:t,affiliate:a,merchant:c,admin:l,pending:p,approved:O}},[o,U]);return e.jsxs(ts,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[e.jsxs(v,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"}),e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(B,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.total.toLocaleString()}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[w.approved," Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡ØŒ ",w.pending," Ù…Ø¹Ù„Ù‚"]})]})]}),e.jsxs(v,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡"}),e.jsx(He,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(B,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:w.customer}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†"})]})]}),e.jsxs(v,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Ø§Ù„Ù…Ø³ÙˆÙ‚ÙŠÙ†"}),e.jsx(Ke,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(B,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:w.affiliate}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ Ø§Ù„Ù…Ø³ÙˆÙ‚ÙŠÙ†"})]})]}),e.jsxs(v,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Ø§Ù„ØªØ¬Ø§Ø±"}),e.jsx(Je,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(B,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:w.merchant}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:w.admin>0&&`+ ${w.admin} Ù…Ø¯ÙŠØ±`})]})]})]}),e.jsxs(v,{children:[e.jsx(z,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-6 w-6"}),"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø´Ø±ÙƒØ§Ø¡"]})}),e.jsxs(B,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(F,{placeholder:"Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ...",value:V,onChange:s=>Ce(s.target.value),className:"pl-10"})]}),e.jsx("div",{children:e.jsxs("select",{className:"w-full p-2 border rounded-md",value:k,onChange:s=>Ae(s.target.value),children:[e.jsx("option",{value:"all",children:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±"}),e.jsx("option",{value:"customer",children:"Ø¹Ù…Ù„Ø§Ø¡"}),e.jsx("option",{value:"merchant",children:"ØªØ¬Ø§Ø±"}),e.jsx("option",{value:"affiliate",children:"Ù…Ø³ÙˆÙ‚ÙŠÙ†"}),e.jsx("option",{value:"intermediary",children:"ÙˆØ³Ø·Ø§Ø¡"}),e.jsx("option",{value:"admin",children:"Ù…Ø¯Ø±Ø§Ø¡"})]})}),e.jsx(d,{onClick:()=>C(),variant:"outline",children:"ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©"})]}),g.size>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold text-blue-900",children:["ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ",g.size," Ù…Ø³ØªØ®Ø¯Ù…"]}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>I(new Set),children:"Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(fe,{value:P,onValueChange:se,children:[e.jsx(ge,{className:"w-[200px]",children:e.jsx(je,{placeholder:"Ø§Ø®ØªØ± Ø¥Ø¬Ø±Ø§Ø¡..."})}),e.jsxs(be,{children:[e.jsx(A,{value:"change_role",children:"ØªØºÙŠÙŠØ± Ø§Ù„Ø¯ÙˆØ±"}),e.jsx(A,{value:"delete",children:"Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"})]})]}),e.jsx(d,{onClick:Xe,disabled:!P,className:"bg-blue-600 hover:bg-blue-700",children:"ØªØ·Ø¨ÙŠÙ‚"})]})]})}),we?e.jsx("div",{className:"text-center py-8",children:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..."}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-center p-2 w-12",children:e.jsx(Ne,{checked:g.size===T.length&&T.length>0,onCheckedChange:Fe})}),e.jsx("th",{className:"text-right p-2",children:"Ø§Ù„Ø§Ø³Ù…"}),e.jsx("th",{className:"text-right p-2",children:"Ø§Ù„Ø¨Ø±ÙŠØ¯"}),e.jsx("th",{className:"text-right p-2",children:"Ø§Ù„Ù‡Ø§ØªÙ"}),e.jsx("th",{className:"text-right p-2",children:"Ø§Ù„Ø¯ÙˆØ±"}),e.jsx("th",{className:"text-right p-2",children:"Ø§Ù„ÙƒÙˆØ¯"}),e.jsx("th",{className:"text-right p-2",children:"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª"})]})}),e.jsx("tbody",{children:T.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 text-center",children:e.jsx(Ne,{checked:g.has(s.$id),onCheckedChange:()=>Be(s.$id)})}),e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2",children:s.email}),e.jsx("td",{className:"p-2",children:s.phone||"-"}),e.jsx("td",{className:"p-2",children:qe(s)}),e.jsx("td",{className:"p-2",children:e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:s.affiliateCode||"-"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(d,{size:"sm",variant:"outline",className:"bg-blue-50 hover:bg-blue-100 text-blue-700 border-blue-200",onClick:()=>Oe(s),title:"Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª",children:[e.jsx(Ve,{className:"h-4 w-4 ml-1"}),"Ø§Ù„Ø³Ø¬Ù„"]}),!s.isIntermediary&&!s.isMerchant&&!s.isAffiliate&&e.jsx(d,{size:"sm",className:"bg-purple-600 hover:bg-purple-700 text-white",onClick:()=>Te(s),children:"ØªÙØ¹ÙŠÙ„ ÙˆØ³ÙŠØ·"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Re(s),children:e.jsx(Qe,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"destructive",onClick:()=>Le(s.$id,s.name),children:e.jsx(Ye,{className:"h-4 w-4"})})]})})]},s.$id))})]}),S>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Ø¹Ø±Ø¶ ",(f-1)*R+1," Ø¥Ù„Ù‰ ",Math.min(f*R,U)," Ù…Ù† ",U," Ù…Ø³ØªØ®Ø¯Ù…"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>X(s=>Math.max(1,s-1)),disabled:f===1,children:[e.jsx(Ze,{className:"h-4 w-4"}),"Ø§Ù„Ø³Ø§Ø¨Ù‚"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,S)},(s,t)=>{let a;return S<=5||f<=3?a=t+1:f>=S-2?a=S-4+t:a=f-2+t,e.jsx(d,{variant:f===a?"default":"outline",size:"sm",onClick:()=>X(a),className:"w-8 h-8 p-0",children:a},a)})}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>X(s=>Math.min(S,s+1)),disabled:f===S,children:["Ø§Ù„ØªØ§Ù„ÙŠ",e.jsx(We,{className:"h-4 w-4"})]})]})]})]})]})]}),$e&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Ø§Ù„Ø§Ø³Ù…"}),e.jsx(F,{value:r.name,onChange:s=>$({...r,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"}),e.jsx(F,{type:"email",value:r.email,onChange:s=>$({...r,email:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"}),e.jsx(F,{value:r.phone,onChange:s=>$({...r,phone:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Ø§Ù„Ø¯ÙˆØ±"}),e.jsxs("select",{className:"w-full p-2 border rounded-md",value:r.role,onChange:s=>$({...r,role:s.target.value}),children:[e.jsx("option",{value:"customer",children:"Ø¹Ù…ÙŠÙ„"}),e.jsx("option",{value:"merchant",children:"ØªØ§Ø¬Ø±"}),e.jsx("option",{value:"affiliate",children:"Ù…Ø³ÙˆÙ‚"}),e.jsx("option",{value:"intermediary",children:"ÙˆØ³ÙŠØ·"}),e.jsx("option",{value:"admin",children:"Ù…Ø¯ÙŠØ±"})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(d,{onClick:me,variant:"outline",children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(d,{onClick:Pe,children:"Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª"})]})]})}),De&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"ØªÙØ¹ÙŠÙ„ Ø¯ÙˆØ± Ø§Ù„ÙˆØ³ÙŠØ·"}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Ø§Ù„Ø¹Ù…ÙŠÙ„:"})," ",b==null?void 0:b.name]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Ø§Ù„Ø¨Ø±ÙŠØ¯:"})," ",b==null?void 0:b.email]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(M,{children:"Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (%)"}),e.jsx(F,{type:"number",min:"0",max:"100",value:Y,onChange:s=>ie(s.target.value),placeholder:"20"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¹Ù„Ù‰ Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ØµÙ„ÙŠ"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{onClick:he,variant:"outline",children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(d,{onClick:ze,className:"bg-purple-600 hover:bg-purple-700",children:"ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ³ÙŠØ·"})]})]})}),Me&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Z,{className:"h-6 w-6 text-green-600"}),"Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[D==null?void 0:D.name," - ",D==null?void 0:D.email]})]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:xe,children:e.jsx(es,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:Ue?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..."})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Z,{className:"h-5 w-5 text-green-600"}),e.jsxs("h3",{className:"text-lg font-bold",children:["Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª (",N.commissions.length,")"]})]}),N.commissions.length===0?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[e.jsx(Z,{className:"h-12 w-12 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…ÙˆÙ„Ø§Øª"})]}):e.jsx("div",{className:"space-y-3",children:N.commissions.map(s=>{var t;return e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-green-600",children:[(t=s.amount)==null?void 0:t.toFixed(2)," Ø¬.Ù…"]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.$createdAt).toLocaleDateString("ar-EG")})]}),e.jsx(W,{className:s.status==="paid"?"bg-green-100 text-green-800":s.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800",children:s.status==="paid"?"Ù…Ø¯ÙÙˆØ¹":s.status==="pending"?"Ù…Ø¹Ù„Ù‚":"Ù…Ù„ØºÙŠ"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Ø·Ù„Ø¨: ",s.orderId||"-"]}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.description})]},s.$id)})}),N.commissions.length>0&&e.jsx(v,{className:"mt-4 p-4 bg-green-50 border-green-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª:"}),e.jsxs("span",{className:"text-xl font-bold text-green-600",children:[N.commissions.reduce((s,t)=>s+(t.amount||0),0).toFixed(2)," Ø¬.Ù…"]})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(pe,{className:"h-5 w-5 text-blue-600"}),e.jsxs("h3",{className:"text-lg font-bold",children:["Ø§Ù„Ø·Ù„Ø¨Ø§Øª (",N.orders.length,")"]})]}),N.orders.length===0?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[e.jsx(pe,{className:"h-12 w-12 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª"})]}):e.jsx("div",{className:"space-y-3",children:N.orders.map(s=>{var t,a;return e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["Ø·Ù„Ø¨ #",s.orderNumber||s.$id.slice(0,8)]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.$createdAt).toLocaleDateString("ar-EG")})]}),e.jsx(W,{className:s.status==="delivered"?"bg-green-100 text-green-800":s.status==="shipped"?"bg-blue-100 text-blue-800":s.status==="processing"?"bg-yellow-100 text-yellow-800":s.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800",children:s.status==="delivered"?"ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„":s.status==="shipped"?"Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†":s.status==="processing"?"Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©":s.status==="cancelled"?"Ù…Ù„ØºÙŠ":"Ø¬Ø¯ÙŠØ¯"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Ø§Ù„Ù…Ø¨Ù„Øº:"})," ",e.jsxs("span",{className:"font-semibold text-blue-600",children:[((t=s.totalAmount)==null?void 0:t.toFixed(2))||"0.00"," Ø¬.Ù…"]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ",((a=s.items)==null?void 0:a.length)||0]}),s.paymentMethod&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Ø§Ù„Ø¯ÙØ¹: ",s.paymentMethod]})]})]},s.$id)})}),N.orders.length>0&&e.jsx(v,{className:"mt-4 p-4 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª:"}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:[N.orders.reduce((s,t)=>s+(t.totalAmount||0),0).toFixed(2)," Ø¬.Ù…"]})]})})]})]})}),e.jsx("div",{className:"p-6 border-t bg-gray-50",children:e.jsx(d,{onClick:xe,className:"w-full",children:"Ø¥ØºÙ„Ø§Ù‚"})})]})}),ke&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(ss,{className:"h-6 w-6"}),"ØªØºÙŠÙŠØ± Ø§Ù„Ø¯ÙˆØ± Ù„Ù€ ",g.size," Ù…Ø³ØªØ®Ø¯Ù…"]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:e.jsx("p",{className:"text-sm text-blue-900",children:"Ø³ÙŠØªÙ… ØªØºÙŠÙŠØ± Ø¯ÙˆØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯"})}),e.jsxs("div",{className:"mb-4",children:[e.jsx(M,{children:"Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯"}),e.jsxs(fe,{value:_,onValueChange:Ie,children:[e.jsx(ge,{children:e.jsx(je,{})}),e.jsxs(be,{children:[e.jsx(A,{value:"customer",children:"Ø¹Ù…ÙŠÙ„"}),e.jsx(A,{value:"merchant",children:"ØªØ§Ø¬Ø±"}),e.jsx(A,{value:"affiliate",children:"Ù…Ø³ÙˆÙ‚"}),e.jsx(A,{value:"intermediary",children:"ÙˆØ³ÙŠØ·"}),e.jsx(A,{value:"admin",children:"Ù…Ø¯ÙŠØ±"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{onClick:()=>Q(!1),variant:"outline",children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(d,{onClick:_e,className:"bg-blue-600 hover:bg-blue-700",children:"ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±"})]})]})})]})}export{ps as default};
