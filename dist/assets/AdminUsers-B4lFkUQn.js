import{r as i,j as e,U as ue,cf as He,p as Ke,a8 as Je,k as Ge,ax as Ve,c2 as Qe,aZ as Ye,s as Ze,ar as We,_ as Z,X as es,bv as pe,ck as ss}from"./vendor-react-CCFRLLzk.js";import{A as ts}from"./AdminLayout-Br9nuQvC.js";import{c as as,u as rs,d as m,C as v,x as z,y as L,h as B,I as F,f as d,S as fe,i as ge,j as je,k as be,l as A,s as Ne,L as M,B as W,e as q}from"./index-D7NOjX7I.js";import{Q as h,I as ve}from"./vendor-appwrite-CuqfvTq9.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-other-CzBBjgu5.js";import"./vendor-animations-CPHPqPXb.js";import"./avatar-CwtoJR-j.js";import"./appwrite-client-DFce-dPK.js";const x=void 0,H="https://fra.cloud.appwrite.io/v1",K="",J="",G={async updateUserName(y,n){const o=await fetch(`${H}/users/${y}/name`,{method:"PATCH",headers:{"Content-Type":"application/json","X-Appwrite-Project":K,"X-Appwrite-Key":J},body:JSON.stringify({name:n})});if(!o.ok)throw new Error(await o.text());return o.json()},async updateUserEmail(y,n){const o=await fetch(`${H}/users/${y}/email`,{method:"PATCH",headers:{"Content-Type":"application/json","X-Appwrite-Project":K,"X-Appwrite-Key":J},body:JSON.stringify({email:n})});if(!o.ok)throw new Error(await o.text());return o.json()},async updateUserPhone(y,n){const o=await fetch(`${H}/users/${y}/phone`,{method:"PATCH",headers:{"Content-Type":"application/json","X-Appwrite-Project":K,"X-Appwrite-Key":J},body:JSON.stringify({number:n})});if(!o.ok)throw new Error(await o.text());return o.json()},async deleteUser(y){const n=await fetch(`${H}/users/${y}`,{method:"DELETE",headers:{"X-Appwrite-Project":K,"X-Appwrite-Key":J}});if(!n.ok)throw new Error(await n.text());return n.status===204}};function ps(){const{user:y}=as(),{toast:n}=rs(),[o,ye]=i.useState([]),[we,ee]=i.useState(!1),[V,Ce]=i.useState(""),[E,Se]=i.useState(""),[k,Ae]=i.useState("all"),[f,X]=i.useState(1),[U,Ee]=i.useState(0),R=25,[g,I]=i.useState(new Set),[P,se]=i.useState(""),[ke,Q]=i.useState(!1),[_,Ie]=i.useState("customer"),[$e,te]=i.useState(!1),[u,ae]=i.useState(null),[r,$]=i.useState({name:"",email:"",phone:"",role:"customer"}),[De,re]=i.useState(!1),[b,le]=i.useState(null),[Y,ie]=i.useState("20"),[Me,ne]=i.useState(!1),[D,ce]=i.useState(null),[N,oe]=i.useState({commissions:[],orders:[]}),[Ue,de]=i.useState(!1);i.useEffect(()=>{const s=setTimeout(()=>{Se(V),X(1)},300);return()=>clearTimeout(s)},[V]),i.useEffect(()=>{C()},[f,E,k]);const C=i.useCallback(async()=>{ee(!0);try{const s=[h.limit(R),h.offset((f-1)*R),h.orderDesc("$createdAt")],t=await m.listDocuments(x,"userPreferences",s);console.log("✅ Loaded users:",t.documents.length),ye(t.documents),Ee(t.total)}catch(s){console.error("Error loading users:",s),n({title:"خطأ",description:"فشل تحميل المستخدمين",variant:"destructive"})}finally{ee(!1)}},[f,E,k]),Re=s=>{console.log("Opening edit modal for:",s.name),ae(s),$({name:s.name||"",email:s.email||"",phone:s.phone||"",role:s.role||"customer"}),te(!0)},me=()=>{te(!1),ae(null),$({name:"",email:"",phone:"",role:"customer"})},Pe=async()=>{if(u)try{if(u.userId)try{let t=!1;r.name!==u.name&&(await G.updateUserName(u.userId,r.name),console.log("✅ Updated name in Auth"),t=!0),r.email!==u.email&&(await G.updateUserEmail(u.userId,r.email),console.log("✅ Updated email in Auth"),t=!0),r.phone&&r.phone!==u.phone&&(await G.updateUserPhone(u.userId,r.phone),console.log("✅ Updated phone in Auth"),t=!0),t&&console.log("✅ Auth updated successfully!")}catch(t){console.error("❌ Error updating Auth:",t),n({title:"تحذير",description:`تم التحديث في قاعدة البيانات لكن فشل التحديث في Auth: ${t.message}`,variant:"destructive"})}const s={name:r.name,email:r.email,phone:r.phone||"",role:r.role};if(s.isAffiliate=r.role==="affiliate",s.isMerchant=r.role==="merchant",s.isIntermediary=r.role==="intermediary",s.isAdmin=r.role==="admin",await m.updateDocument(x,"userPreferences",u.$id,s),r.role!==u.role){const t={customer:"عميل",merchant:"تاجر",affiliate:"مسوق",intermediary:"وسيط",admin:"مدير"},a=t[u.role]||u.role,c=t[r.role]||r.role;try{await m.createDocument(q.databaseId,q.collections.notifications,ve.unique(),{userId:u.userId,title:"🎉 تم تحديث دورك بنجاح",message:`تم تغيير دورك من ${a} إلى ${c}. يمكنك الآن الوصول إلى المميزات الجديدة!`,type:"success",isRead:!1,link:r.role==="merchant"?"/merchant/dashboard":r.role==="affiliate"?"/affiliate/dashboard":r.role==="intermediary"?"/intermediary/dashboard":r.role==="admin"?"/admin/dashboard":"/"}),console.log("✅ Role change notification sent")}catch(l){console.error("Error sending notification:",l)}}n({title:"نجح",description:"تم تحديث بيانات المستخدم بنجاح"}),me(),C()}catch(s){console.error("Error updating user:",s),n({title:"خطأ",description:"فشل تحديث بيانات المستخدم",variant:"destructive"})}},Te=s=>{console.log("Opening intermediary modal for:",s.name),le(s),re(!0)},he=()=>{re(!1),le(null),ie("20")},ze=async()=>{if(b)try{const s=`INT${Date.now()}`;await m.updateDocument(x,"users",b.$id,{isIntermediary:!0,affiliateCode:s,commissionRate:parseFloat(Y)/100}),console.log("✅ Intermediary activated");try{await m.createDocument(q.databaseId,q.collections.notifications,ve.unique(),{userId:b.userId,title:"🎉 مبروك! تم تفعيلك كوسيط",message:`تم تفعيل حسابك كوسيط بنجاح! كود الوسيط الخاص بك: ${s}. نسبة الهامش الافتراضية: ${Y}%. يمكنك الآن إنشاء روابط خاصة بك وإضافة هامش ربح على المنتجات.`,type:"success",isRead:!1,link:"/intermediary/dashboard"}),console.log("✅ Intermediary activation notification sent")}catch(t){console.error("Error sending notification:",t)}n({title:"نجح",description:`تم تفعيل ${b.name} كوسيط بنجاح`}),he(),C()}catch(s){console.error("Error activating intermediary:",s),n({title:"خطأ",description:"فشل تفعيل الوسيط",variant:"destructive"})}},Le=async(s,t)=>{if(confirm(`هل أنت متأكد من حذف ${t}؟ سيتم حذف جميع بياناته بشكل نهائي من النظام والمصادقة.`))try{const c=(await m.getDocument(x,"userPreferences",s)).userId;try{const l=await m.listDocuments(x,"notifications",[h.equal("userId",c),h.limit(100)]);for(const p of l.documents)await m.deleteDocument(x,"notifications",p.$id);console.log(`✅ Deleted ${l.documents.length} notifications`)}catch(l){console.error("Error deleting notifications:",l)}try{const l=await m.listDocuments(x,"referrals",[h.equal("referredUserId",c),h.limit(100)]);for(const p of l.documents)await m.deleteDocument(x,"referrals",p.$id);console.log(`✅ Deleted ${l.documents.length} referrals`)}catch(l){console.error("Error deleting referrals:",l)}await m.deleteDocument(x,"userPreferences",s),console.log("✅ Deleted from userPreferences");try{await G.deleteUser(c),console.log("✅ Deleted from Auth"),n({title:"نجح",description:"تم حذف المستخدم بالكامل من النظام والمصادقة (Auth)"})}catch(l){console.error("❌ Error deleting from Auth:",l),n({title:"تحذير",description:`تم الحذف من قاعدة البيانات لكن فشل الحذف من Auth: ${l.message}`,variant:"destructive"})}C()}catch(a){console.error("Error deleting user:",a),n({title:"خطأ",description:"فشل حذف المستخدم",variant:"destructive"})}},Be=s=>{const t=new Set(g);t.has(s)?t.delete(s):t.add(s),I(t)},Fe=()=>{g.size===T.length?I(new Set):I(new Set(T.map(s=>s.$id)))},Xe=async()=>{if(g.size===0){n({title:"تنبيه",description:"الرجاء اختيار مستخدم واحد على الأقل",variant:"destructive"});return}if(!P){n({title:"تنبيه",description:"الرجاء اختيار إجراء",variant:"destructive"});return}if(P==="delete"){if(!confirm(`هل أنت متأكد من حذف ${g.size} مستخدم؟`))return;let s=0,t=0;for(const a of g)try{await m.deleteDocument(x,"users",a),s++}catch(c){console.error("Error deleting user:",a,c),t++}n({title:"تم",description:`تم حذف ${s} مستخدم، فشل ${t}`}),I(new Set),C()}else P==="change_role"&&Q(!0)},_e=async()=>{let s=0,t=0;for(const a of g)try{const c={isAffiliate:_==="affiliate",isMerchant:_==="merchant",isIntermediary:_==="intermediary"};await m.updateDocument(x,"users",a,c),s++}catch(c){console.error("Error updating user role:",a,c),t++}n({title:"تم",description:`تم تحديث ${s} مستخدم، فشل ${t}`}),I(new Set),Q(!1),se(""),C()},Oe=async s=>{ce(s),ne(!0),de(!0);let t=[],a=[];try{try{t=(await m.listDocuments(x,"commissions",[h.equal("affiliateId",s.userId||s.$id),h.orderDesc("$createdAt"),h.limit(50)])).documents}catch(c){console.log("Commissions error:",c.message);try{t=(await m.listDocuments(x,"commissions",[h.orderDesc("$createdAt"),h.limit(50)])).documents.filter(p=>p.affiliateId===s.userId||p.affiliateId===s.$id||p.userId===s.userId||p.userId===s.$id)}catch{console.log("Could not load commissions")}}try{a=(await m.listDocuments(x,"orders",[h.orderDesc("$createdAt"),h.limit(100)])).documents.filter(l=>l.userEmail===s.email||l.userId===s.userId||l.userId===s.$id||l.customerEmail===s.email)}catch(c){console.log("Orders error:",c)}oe({commissions:t,orders:a}),t.length===0&&a.length===0&&n({title:"لا توجد بيانات",description:"لا توجد عمولات أو طلبات لهذا المستخدم"})}catch(c){console.error("Error loading financial history:",c),n({title:"خطأ",description:"فشل تحميل السجل المالي",variant:"destructive"})}finally{de(!1)}},xe=()=>{ne(!1),ce(null),oe({commissions:[],orders:[]})},qe=s=>{let t="عميل",a="bg-gray-100 text-gray-800";return s.isAffiliate&&(t="مسوق",a="bg-green-100 text-green-800"),s.isMerchant&&(t="تاجر",a="bg-blue-100 text-blue-800"),s.isIntermediary&&(t="وسيط",a="bg-purple-100 text-purple-800"),(s.email==="admin@egygo.com"||s.role==="admin")&&(t="مدير",a="bg-red-100 text-red-800"),e.jsx(W,{className:a,children:t})},T=i.useMemo(()=>o.filter(s=>{var l,p,O;const t=((l=s.name)==null?void 0:l.toLowerCase().includes(E.toLowerCase()))||((p=s.email)==null?void 0:p.toLowerCase().includes(E.toLowerCase()))||((O=s.phone)==null?void 0:O.includes(E));let a="customer";return s.isAffiliate&&(a="affiliate"),s.isMerchant&&(a="merchant"),s.isIntermediary&&(a="intermediary"),s.email==="admin@egygo.com"&&(a="admin"),t&&(k==="all"||a===k)}),[o,E,k]),S=Math.ceil(U/R),w=i.useMemo(()=>{const s=U,t=o.filter(j=>j.role==="customer").length,a=o.filter(j=>j.isAffiliate).length,c=o.filter(j=>j.isMerchant).length,l=o.filter(j=>j.role==="admin").length,p=o.filter(j=>j.accountStatus==="pending").length,O=o.filter(j=>j.accountStatus==="approved").length;return{total:s,customer:t,affiliate:a,merchant:c,admin:l,pending:p,approved:O}},[o,U]);return e.jsxs(ts,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[e.jsxs(v,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"إجمالي المستخدمين"}),e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(B,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.total.toLocaleString()}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[w.approved," موافق عليه، ",w.pending," معلق"]})]})]}),e.jsxs(v,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"العملاء"}),e.jsx(He,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(B,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:w.customer}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"المستخدمين العاديين"})]})]}),e.jsxs(v,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"المسوقين"}),e.jsx(Ke,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(B,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:w.affiliate}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"الشركاء المسوقين"})]})]}),e.jsxs(v,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"التجار"}),e.jsx(Je,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(B,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:w.merchant}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:w.admin>0&&`+ ${w.admin} مدير`})]})]})]}),e.jsxs(v,{children:[e.jsx(z,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-6 w-6"}),"إدارة المستخدمين والشركاء"]})}),e.jsxs(B,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(F,{placeholder:"بحث بالاسم أو البريد أو الهاتف...",value:V,onChange:s=>Ce(s.target.value),className:"pl-10"})]}),e.jsx("div",{children:e.jsxs("select",{className:"w-full p-2 border rounded-md",value:k,onChange:s=>Ae(s.target.value),children:[e.jsx("option",{value:"all",children:"جميع الأدوار"}),e.jsx("option",{value:"customer",children:"عملاء"}),e.jsx("option",{value:"merchant",children:"تجار"}),e.jsx("option",{value:"affiliate",children:"مسوقين"}),e.jsx("option",{value:"intermediary",children:"وسطاء"}),e.jsx("option",{value:"admin",children:"مدراء"})]})}),e.jsx(d,{onClick:()=>C(),variant:"outline",children:"تحديث القائمة"})]}),g.size>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold text-blue-900",children:["تم اختيار ",g.size," مستخدم"]}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>I(new Set),children:"إلغاء الاختيار"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(fe,{value:P,onValueChange:se,children:[e.jsx(ge,{className:"w-[200px]",children:e.jsx(je,{placeholder:"اختر إجراء..."})}),e.jsxs(be,{children:[e.jsx(A,{value:"change_role",children:"تغيير الدور"}),e.jsx(A,{value:"delete",children:"حذف المستخدمين"})]})]}),e.jsx(d,{onClick:Xe,disabled:!P,className:"bg-blue-600 hover:bg-blue-700",children:"تطبيق"})]})]})}),we?e.jsx("div",{className:"text-center py-8",children:"جاري التحميل..."}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-center p-2 w-12",children:e.jsx(Ne,{checked:g.size===T.length&&T.length>0,onCheckedChange:Fe})}),e.jsx("th",{className:"text-right p-2",children:"الاسم"}),e.jsx("th",{className:"text-right p-2",children:"البريد"}),e.jsx("th",{className:"text-right p-2",children:"الهاتف"}),e.jsx("th",{className:"text-right p-2",children:"الدور"}),e.jsx("th",{className:"text-right p-2",children:"الكود"}),e.jsx("th",{className:"text-right p-2",children:"الإجراءات"})]})}),e.jsx("tbody",{children:T.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 text-center",children:e.jsx(Ne,{checked:g.has(s.$id),onCheckedChange:()=>Be(s.$id)})}),e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2",children:s.email}),e.jsx("td",{className:"p-2",children:s.phone||"-"}),e.jsx("td",{className:"p-2",children:qe(s)}),e.jsx("td",{className:"p-2",children:e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:s.affiliateCode||"-"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(d,{size:"sm",variant:"outline",className:"bg-blue-50 hover:bg-blue-100 text-blue-700 border-blue-200",onClick:()=>Oe(s),title:"عرض السجل المالي والطلبات",children:[e.jsx(Ve,{className:"h-4 w-4 ml-1"}),"السجل"]}),!s.isIntermediary&&!s.isMerchant&&!s.isAffiliate&&e.jsx(d,{size:"sm",className:"bg-purple-600 hover:bg-purple-700 text-white",onClick:()=>Te(s),children:"تفعيل وسيط"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Re(s),children:e.jsx(Qe,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"destructive",onClick:()=>Le(s.$id,s.name),children:e.jsx(Ye,{className:"h-4 w-4"})})]})})]},s.$id))})]}),S>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["عرض ",(f-1)*R+1," إلى ",Math.min(f*R,U)," من ",U," مستخدم"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>X(s=>Math.max(1,s-1)),disabled:f===1,children:[e.jsx(Ze,{className:"h-4 w-4"}),"السابق"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,S)},(s,t)=>{let a;return S<=5||f<=3?a=t+1:f>=S-2?a=S-4+t:a=f-2+t,e.jsx(d,{variant:f===a?"default":"outline",size:"sm",onClick:()=>X(a),className:"w-8 h-8 p-0",children:a},a)})}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>X(s=>Math.min(S,s+1)),disabled:f===S,children:["التالي",e.jsx(We,{className:"h-4 w-4"})]})]})]})]})]})]}),$e&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"تعديل بيانات المستخدم"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"الاسم"}),e.jsx(F,{value:r.name,onChange:s=>$({...r,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"البريد الإلكتروني"}),e.jsx(F,{type:"email",value:r.email,onChange:s=>$({...r,email:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"رقم الهاتف"}),e.jsx(F,{value:r.phone,onChange:s=>$({...r,phone:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"الدور"}),e.jsxs("select",{className:"w-full p-2 border rounded-md",value:r.role,onChange:s=>$({...r,role:s.target.value}),children:[e.jsx("option",{value:"customer",children:"عميل"}),e.jsx("option",{value:"merchant",children:"تاجر"}),e.jsx("option",{value:"affiliate",children:"مسوق"}),e.jsx("option",{value:"intermediary",children:"وسيط"}),e.jsx("option",{value:"admin",children:"مدير"})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(d,{onClick:me,variant:"outline",children:"إلغاء"}),e.jsx(d,{onClick:Pe,children:"حفظ التغييرات"})]})]})}),De&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"تفعيل دور الوسيط"}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"العميل:"})," ",b==null?void 0:b.name]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"البريد:"})," ",b==null?void 0:b.email]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(M,{children:"نسبة الهامش الافتراضية (%)"}),e.jsx(F,{type:"number",min:"0",max:"100",value:Y,onChange:s=>ie(s.target.value),placeholder:"20"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"النسبة التي سيتم إضافتها على سعر المنتج الأصلي"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{onClick:he,variant:"outline",children:"إلغاء"}),e.jsx(d,{onClick:ze,className:"bg-purple-600 hover:bg-purple-700",children:"تفعيل الوسيط"})]})]})}),Me&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Z,{className:"h-6 w-6 text-green-600"}),"السجل المالي والطلبات"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[D==null?void 0:D.name," - ",D==null?void 0:D.email]})]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:xe,children:e.jsx(es,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:Ue?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"جاري التحميل..."})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Z,{className:"h-5 w-5 text-green-600"}),e.jsxs("h3",{className:"text-lg font-bold",children:["العمولات (",N.commissions.length,")"]})]}),N.commissions.length===0?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[e.jsx(Z,{className:"h-12 w-12 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"لا توجد عمولات"})]}):e.jsx("div",{className:"space-y-3",children:N.commissions.map(s=>{var t;return e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-green-600",children:[(t=s.amount)==null?void 0:t.toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.$createdAt).toLocaleDateString("ar-EG")})]}),e.jsx(W,{className:s.status==="paid"?"bg-green-100 text-green-800":s.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800",children:s.status==="paid"?"مدفوع":s.status==="pending"?"معلق":"ملغي"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["طلب: ",s.orderId||"-"]}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.description})]},s.$id)})}),N.commissions.length>0&&e.jsx(v,{className:"mt-4 p-4 bg-green-50 border-green-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"إجمالي العمولات:"}),e.jsxs("span",{className:"text-xl font-bold text-green-600",children:[N.commissions.reduce((s,t)=>s+(t.amount||0),0).toFixed(2)," ج.م"]})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(pe,{className:"h-5 w-5 text-blue-600"}),e.jsxs("h3",{className:"text-lg font-bold",children:["الطلبات (",N.orders.length,")"]})]}),N.orders.length===0?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[e.jsx(pe,{className:"h-12 w-12 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"لا توجد طلبات"})]}):e.jsx("div",{className:"space-y-3",children:N.orders.map(s=>{var t,a;return e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["طلب #",s.orderNumber||s.$id.slice(0,8)]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.$createdAt).toLocaleDateString("ar-EG")})]}),e.jsx(W,{className:s.status==="delivered"?"bg-green-100 text-green-800":s.status==="shipped"?"bg-blue-100 text-blue-800":s.status==="processing"?"bg-yellow-100 text-yellow-800":s.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800",children:s.status==="delivered"?"تم التوصيل":s.status==="shipped"?"قيد الشحن":s.status==="processing"?"قيد المعالجة":s.status==="cancelled"?"ملغي":"جديد"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"المبلغ:"})," ",e.jsxs("span",{className:"font-semibold text-blue-600",children:[((t=s.totalAmount)==null?void 0:t.toFixed(2))||"0.00"," ج.م"]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["المنتجات: ",((a=s.items)==null?void 0:a.length)||0]}),s.paymentMethod&&e.jsxs("p",{className:"text-xs text-gray-500",children:["الدفع: ",s.paymentMethod]})]})]},s.$id)})}),N.orders.length>0&&e.jsx(v,{className:"mt-4 p-4 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"إجمالي المشتريات:"}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:[N.orders.reduce((s,t)=>s+(t.totalAmount||0),0).toFixed(2)," ج.م"]})]})})]})]})}),e.jsx("div",{className:"p-6 border-t bg-gray-50",children:e.jsx(d,{onClick:xe,className:"w-full",children:"إغلاق"})})]})}),ke&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(ss,{className:"h-6 w-6"}),"تغيير الدور لـ ",g.size," مستخدم"]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:e.jsx("p",{className:"text-sm text-blue-900",children:"سيتم تغيير دور جميع المستخدمين المحددين إلى الدور الجديد"})}),e.jsxs("div",{className:"mb-4",children:[e.jsx(M,{children:"الدور الجديد"}),e.jsxs(fe,{value:_,onValueChange:Ie,children:[e.jsx(ge,{children:e.jsx(je,{})}),e.jsxs(be,{children:[e.jsx(A,{value:"customer",children:"عميل"}),e.jsx(A,{value:"merchant",children:"تاجر"}),e.jsx(A,{value:"affiliate",children:"مسوق"}),e.jsx(A,{value:"intermediary",children:"وسيط"}),e.jsx(A,{value:"admin",children:"مدير"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{onClick:()=>Q(!1),variant:"outline",children:"إلغاء"}),e.jsx(d,{onClick:_e,className:"bg-blue-600 hover:bg-blue-700",children:"تطبيق التغيير"})]})]})})]})}export{ps as default};
