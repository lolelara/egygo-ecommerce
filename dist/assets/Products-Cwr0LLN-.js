import{r as c,j as e,a7 as H,ac as _,bl as K,ax as G,ay as U,o as J,bm as W,m as Q,aa as X,k as Y,bn as Z,bo as ee,n as se,s as ae,ar as te}from"./vendor-react-CCFRLLzk.js";import{u as ie,a as re,b as le,c as ne,d as z,e as N,C as T,g as oe,B as M,f as d,h as R,I as q,S as ce,i as de,j as me,k as xe,l as F,m as he,n as ge,o as ue,p as fe,q as pe,r as je,s as B,L,t as ve,v as E,w as O}from"./index-CtsYZAzS.js";import{P as Ne}from"./LoadingSkeletons-CR-zcJD3.js";import{Q as D}from"./vendor-appwrite-CuqfvTq9.js";import{S as be}from"./SEOHead-vAugBEQv.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-other-CzBBjgu5.js";import"./vendor-animations-CPHPqPXb.js";import"./skeleton-CNtgH3zu.js";function we({product:s}){var S;const{toast:m}=ie(),{addItem:k}=re(),{addFavorite:P,removeFavorite:A,isFavorite:x}=le(),{user:f}=ne(),[o,b]=c.useState(!1),[y,p]=c.useState(0),[h,r]=c.useState(!0),j=f==null?void 0:f.isAffiliate;c.useEffect(()=>{$()},[s.id]);const l=x(s.id),C=t=>{var i,w,a;t.preventDefault(),t.stopPropagation(),b(!0);try{const g=typeof((i=s.images)==null?void 0:i[0])=="string"?s.images[0]:((a=(w=s.images)==null?void 0:w[0])==null?void 0:a.url)||"";k({productId:s.id,name:s.name,image:g,quantity:1,price:s.price,inStock:!0,stockQuantity:s.stockQuantity||999})}catch{m({title:"خطأ",description:"فشل في إضافة المنتج للسلة",variant:"destructive"})}finally{b(!1)}},v=async t=>{t.preventDefault(),t.stopPropagation();try{l?(await A(s.id),m({title:"✅ تمت الإزالة من المفضلة",description:`تم إزالة ${s.name} من المفضلة`})):(await P(s.id),m({title:"✅ تمت الإضافة للمفضلة",description:`تم إضافة ${s.name} إلى المفضلة`}))}catch(i){console.error("Favorite error:",i),m({title:"❌ خطأ",description:"فشل في تحديث المفضلة. تحقق من تسجيل الدخول.",variant:"destructive"})}},V=async t=>{t.preventDefault(),t.stopPropagation();const i={title:s.name,text:`تحقق من ${s.name} على إيجي جو!`,url:`${window.location.origin}/#/product/${s.id}`};try{navigator.share?await navigator.share(i):(await navigator.clipboard.writeText(i.url),m({title:"✅ تم النسخ",description:"تم نسخ رابط المنتج"}))}catch(w){console.error("Error sharing:",w)}},$=async()=>{try{const t=await z.listDocuments(N.databaseId,N.collections.productViews,[D.equal("productId",s.id)]);if(t.documents.length>0){const i=t.documents[0];p(i.viewCount||0)}}catch(t){console.error("Error loading view count:",t)}finally{r(!1)}},n=async()=>{try{const t=await z.listDocuments(N.databaseId,N.collections.productViews,[D.equal("productId",s.id)]);if(t.documents.length>0){const i=t.documents[0];await z.updateDocument(N.databaseId,N.collections.productViews,i.$id,{viewCount:(i.viewCount||0)+1,lastViewedAt:new Date().toISOString()}),p((i.viewCount||0)+1)}else{const i=await z.createDocument(N.databaseId,N.collections.productViews,"unique()",{productId:s.id,viewCount:1,lastViewedAt:new Date().toISOString(),createdAt:new Date().toISOString()});p(1)}}catch(t){console.error("Error updating view count:",t),p(i=>i+1)}},I=s.originalPrice&&s.originalPrice>s.price?Math.round((s.originalPrice-s.price)/s.originalPrice*100):0;return e.jsxs(T,{className:"card-hover group overflow-hidden h-full border-2 relative",children:[e.jsx(H,{to:`/product/${s.id}`,className:"block absolute inset-0 z-0",onClick:n}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("img",{src:oe((S=s.images)==null?void 0:S[0]),alt:s.name,className:"w-full h-56 object-cover group-hover:scale-110 transition-transform duration-500",loading:"lazy"}),e.jsxs("div",{className:"absolute top-3 left-3 flex flex-col gap-2",children:[I>0&&e.jsxs(M,{className:"bg-red-500 text-white shadow-lg",children:["خصم ",I,"%"]}),s.affiliateCommission&&s.affiliateCommission>0&&e.jsxs(M,{className:"bg-gradient-to-r from-orange-500 to-yellow-500 text-white shadow-lg",children:[s.affiliateCommission,"% عمولة"]})]}),e.jsxs("div",{className:"absolute top-3 right-3 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-10",children:[e.jsx(d,{size:"icon",variant:"secondary",className:"rounded-full shadow-lg hover:scale-110 transition-transform relative z-10",onClick:v,type:"button",children:e.jsx(_,{className:`h-4 w-4 ${l?"fill-red-500 text-red-500":""}`})}),e.jsx(d,{size:"icon",variant:"secondary",className:"rounded-full shadow-lg hover:scale-110 transition-transform relative z-10",onClick:V,type:"button",children:e.jsx(K,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"absolute bottom-3 left-3 bg-black/60 backdrop-blur-sm text-white text-xs px-3 py-1.5 rounded-full flex items-center gap-1",children:[e.jsx(G,{className:"h-3 w-3"}),y]})]}),e.jsxs(R,{className:"p-4 space-y-3 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((t,i)=>e.jsx(U,{className:`h-4 w-4 ${i<Math.floor(s.rating)?"text-yellow-400 fill-current":"text-gray-300"}`},i))}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",s.reviewCount||0,")"]})]}),e.jsx("h3",{className:"font-bold text-lg line-clamp-2 group-hover:text-primary transition-colors",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-2xl font-bold text-primary",children:[s.price.toFixed(2)," ج.م"]}),s.originalPrice&&s.originalPrice>s.price&&e.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:[s.originalPrice.toFixed(2)," ج.م"]})]}),j&&s.affiliateCommission&&s.affiliateCommission>0&&e.jsxs("div",{className:"flex items-center gap-2 bg-gradient-to-r from-orange-500/10 to-yellow-500/10 rounded-md px-2 py-1 border border-orange-200 dark:border-orange-800",children:[e.jsx("span",{className:"text-xs font-bold text-orange-600 dark:text-orange-400",children:"عمولتك:"}),e.jsxs("span",{className:"text-sm font-bold text-orange-700 dark:text-orange-300",children:[(s.price*s.affiliateCommission/100).toFixed(2)," ج.م"]}),e.jsxs("span",{className:"text-xs text-orange-500",children:["(",s.affiliateCommission,"%)"]})]})]}),e.jsx(d,{size:"sm",onClick:C,disabled:o,className:"btn-hover-lift relative z-10",type:"button",children:o?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 ml-1 rtl:ml-0 rtl:mr-1"}),"أضف"]})})]})]})]})}function $e(){const{slug:s}=W(),[m,k]=c.useState(""),[P,A]=c.useState("featured"),[x,f]=c.useState([]),[o,b]=c.useState({min:0,max:1e3}),[y,p]=c.useState(!1),[h,r]=c.useState(1),j=12,{data:l}=Q({queryKey:E.categories,queryFn:ve.getAll}),C=c.useMemo(()=>{const a={page:h,limit:j,sortBy:P};if(m&&(a.searchQuery=m),!s&&x.length>0&&x[0]){const g=l==null?void 0:l.categories.find(u=>u.id===x[0]);g&&(a.categoryId=g.id)}return o.min>0&&(a.minPrice=o.min),o.max<1e3&&(a.maxPrice=o.max),a},[s,m,P,x,o,y,h,l]),{data:v,isLoading:V,error:$}=Q({queryKey:s?[...E.categoryProducts(s),C]:[...E.products,C],queryFn:()=>s?O.getByCategory(s,C):O.getAll(C)}),n=s?l==null?void 0:l.categories.find(a=>a.slug===s):null,I=(l==null?void 0:l.categories)||[],S=(v==null?void 0:v.products)||[],t=(v==null?void 0:v.total)||0,i=c.useMemo(()=>y?S.filter(a=>a.originalPrice&&a.originalPrice>a.price):S,[S,y]),w=()=>e.jsxs("div",{className:"space-y-6",children:[!s&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"الفئات"}),e.jsx("div",{className:"space-y-2",children:I.map(a=>e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(B,{id:a.id,checked:x.includes(a.id),onCheckedChange:g=>{f(g?[...x,a.id]:x.filter(u=>u!==a.id)),r(1)}}),e.jsxs(L,{htmlFor:a.id,className:"text-sm cursor-pointer",children:[a.name," (",a.productCount,")"]})]},a.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"نطاق السعر"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{type:"number",placeholder:"الحد الأدنى",value:o.min,onChange:a=>{b({...o,min:Number(a.target.value)||0}),r(1)},className:"w-24"}),e.jsx("span",{className:"self-center",children:"-"}),e.jsx(q,{type:"number",placeholder:"الحد الأقصى",value:o.max,onChange:a=>{b({...o,max:Number(a.target.value)||1e3}),r(1)},className:"w-24"})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"العروض الخاصة"}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(B,{id:"on-sale",checked:y,onCheckedChange:a=>{p(!!a),r(1)}}),e.jsx(L,{htmlFor:"on-sale",className:"text-sm cursor-pointer",children:"المنتجات المخفضة فقط"})]})]}),e.jsx(d,{variant:"outline",className:"btn-hover-lift w-full",onClick:()=>{f([]),b({min:0,max:1e3}),p(!1),k(""),r(1)},children:"مسح جميع المرشحات"})]});return V?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(Ne,{count:j})}):$?e.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"حدث خطأ"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"فشل في تحميل المنتجات"}),e.jsx(d,{variant:"outline",className:"btn-hover-lift",onClick:()=>window.location.reload(),children:"إعادة المحاولة"})]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{title:n?n.name:"جميع المنتجات",description:n?`تصفح منتجات ${n.name} عالية الجودة`:"اكتشف مجموعتنا الكاملة من المنتجات",keywords:["منتجات","تسوق","مصر",(n==null?void 0:n.name)||""]}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"bg-gradient-to-br from-primary/10 via-purple-50 to-orange-50 dark:from-primary/5 dark:via-purple-950/20 dark:to-orange-950/20 py-12",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto text-center space-y-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center h-14 w-14 rounded-full bg-gradient-to-r from-primary to-purple-600 mb-2",children:e.jsx(X,{className:"h-7 w-7 text-white"})}),e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold",children:n?n.name:"جميع المنتجات"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:n?`اكتشف منتجات ${n.name} المذهلة 🌟`:"اكتشف مجموعتنا الكاملة من المنتجات عالية الجودة 🛒"}),t>0&&e.jsxs(M,{className:"bg-gradient-to-r from-primary to-purple-600 text-white text-base px-4 py-2",children:[t," منتج متاح"]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 mb-8",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Y,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4 rtl:right-3 rtl:left-auto"}),e.jsx(q,{type:"search",placeholder:"البحث عن المنتجات...",className:"pr-10 rtl:pr-10 rtl:pl-4",value:m,onChange:a=>{k(a.target.value),r(1)}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ce,{value:P,onValueChange:a=>{A(a),r(1)},children:[e.jsx(de,{className:"w-48",children:e.jsx(me,{placeholder:"ترتيب حسب"})}),e.jsxs(xe,{children:[e.jsx(F,{value:"featured",children:"مميز"}),e.jsx(F,{value:"price_asc",children:"السعر: من الأقل إلى الأعلى"}),e.jsx(F,{value:"price_desc",children:"السعر: من الأعلى إلى الأقل"}),e.jsx(F,{value:"rating",children:"الأعلى تقييمًا"}),e.jsx(F,{value:"newest",children:"الأحدث"})]})]}),e.jsxs(he,{children:[e.jsx(ge,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:"btn-hover-lift lg:hidden",children:[e.jsx(Z,{className:"h-4 w-4 ml-2 rtl:ml-0 rtl:mr-2"}),"المرشحات"]})}),e.jsxs(ue,{side:"right",className:"w-80",children:[e.jsx(fe,{children:e.jsx(pe,{children:"المرشحات"})}),e.jsx("div",{className:"mt-6",children:e.jsx(w,{})})]})]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-4 gap-8",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsxs(T,{className:"p-6 sticky top-24",children:[e.jsxs("h2",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"المرشحات"]}),e.jsx(je,{className:"mb-4"}),e.jsx(w,{})]})}),e.jsxs("div",{className:"lg:col-span-3",children:[e.jsx("div",{className:"mb-4 flex justify-between items-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["عرض ",i.length," من ",t," منتج"]})}),i.length===0?e.jsx(T,{className:"border-2 border-dashed",children:e.jsx(R,{className:"py-20",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-gradient-to-br from-primary/10 to-purple-500/10 mx-auto flex items-center justify-center",children:e.jsx(se,{className:"h-12 w-12 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"لا توجد منتجات 🔍"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"جرّب تعديل معايير البحث أو التصفية"})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(d,{size:"lg",className:"bg-gradient-to-r from-primary to-purple-600",onClick:()=>{f([]),b({min:0,max:1e3}),p(!1),k(""),r(1)},children:"مسح المرشحات"}),e.jsx(d,{size:"lg",variant:"outline",asChild:!0,children:e.jsx(H,{to:"/categories",children:"عرض الفئات"})})]})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:i.map(a=>e.jsx(we,{product:a},a.id))}),t>j&&e.jsxs("div",{className:"flex justify-center items-center gap-3 mt-8",children:[e.jsxs(d,{variant:"outline",size:"lg",disabled:h===1,onClick:()=>r(h-1),className:"gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"السابق"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Array.from({length:Math.min(5,Math.ceil(t/j))},(a,g)=>{const u=g+1;return e.jsx(d,{variant:h===u?"default":"outline",size:"icon",onClick:()=>r(u),className:h===u?"bg-gradient-to-r from-primary to-purple-600":"",children:u},u)}),Math.ceil(t/j)>5&&e.jsx("span",{className:"text-muted-foreground",children:"..."})]}),e.jsxs(d,{variant:"outline",size:"lg",disabled:h>=Math.ceil(t/j),onClick:()=>r(h+1),className:"gap-2",children:["التالي",e.jsx(te,{className:"h-4 w-4"})]})]})]})]})]})]})]})]})}export{$e as default};
