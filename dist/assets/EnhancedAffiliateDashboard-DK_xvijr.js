import{j as s,ag as Y,r as o,af as Z,a7 as h,bL as P,aF as I,aq as L,_ as v,aA as ss,p as B,bF as es,a_ as R,bC as as,bl as w,ax as ts,o as M,ba as z,bz as ls,bd as G}from"./vendor-react-CCFRLLzk.js";import{u as rs,c as is,d as Q,C as t,x as i,y as n,P as x,h as l,f as d,B as j,I as ns}from"./index-CtsYZAzS.js";import{P as cs}from"./PendingApprovalScreen-Ce1_X_Se.js";import{a as ds}from"./affiliate-api-BMy8PTXd.js";import{Q as b}from"./vendor-appwrite-CuqfvTq9.js";import{P as f}from"./progress-CYuOOZOb.js";import{T as xs,a as ms,b as N,c as p}from"./tabs-Boky9FfO.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-other-CzBBjgu5.js";import"./vendor-animations-CPHPqPXb.js";const _="68de037e003bd03c4d45";function Cs(){var T,D;const{toast:y}=rs(),{user:e}=is();if(e!=null&&e.isAffiliate&&(e==null?void 0:e.accountStatus)==="pending")return s.jsx(cs,{});if(!(e!=null&&e.isAffiliate))return s.jsx(Y,{to:"/affiliate",replace:!0});const[q,C]=o.useState(!1),[H,S]=o.useState(!0),[r,O]=o.useState(null),[U,V]=o.useState([]),[J,os]=o.useState([]);o.useEffect(()=>{e!=null&&e.$id&&$()},[e]);const $=async()=>{try{S(!0);const a=await ds.getStats(e.$id);O(a);const g=await Q.listDocuments(_,"commissions",[b.equal("affiliateId",e.$id),b.orderDesc("$createdAt"),b.limit(10)]),X=await Promise.all(g.documents.slice(0,3).map(async c=>{var E,F,k;try{const u=await Q.getDocument(_,"orders",c.orderId);return{id:u.orderNumber||c.$id,product:((F=(E=u.items)==null?void 0:E[0])==null?void 0:F.name)||"منتج",customer:`عميل ${(k=u.userId)==null?void 0:k.substring(0,4)}`,amount:c.orderAmount||0,commission:c.amount||0,date:new Date(c.$createdAt).toLocaleDateString("ar-EG"),status:c.status==="PAID"?"completed":"pending"}}catch{return{id:c.$id,product:"منتج",customer:"عميل",amount:c.orderAmount||0,commission:c.amount||0,date:new Date(c.$createdAt).toLocaleDateString("ar-EG"),status:c.status==="PAID"?"completed":"pending"}}}));V(X)}catch(a){console.error("Error fetching affiliate data:",a),y({variant:"destructive",title:"خطأ",description:"فشل في تحميل بيانات المسوق"})}finally{S(!1)}},K=((T=e==null?void 0:e.prefs)==null?void 0:T.affiliateCode)||((D=e==null?void 0:e.$id)==null?void 0:D.substring(0,8))||"AFFILIATE",A=`${window.location.origin}/#/ref/${K}`,W=a=>{navigator.clipboard.writeText(a),C(!0),y({title:"تم النسخ!",description:"تم نسخ الرابط إلى الحافظة"}),setTimeout(()=>C(!1),2e3)};if(H)return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx(Z,{className:"h-8 w-8 animate-spin text-primary"}),s.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل بيانات المسوق..."})]})});if(!r)return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs(t,{className:"w-full max-w-md",children:[s.jsxs(i,{children:[s.jsx(n,{children:"خطأ"}),s.jsx(x,{children:"فشل في تحميل بيانات المسوق"})]}),s.jsx(l,{children:s.jsx(d,{onClick:$,children:"إعادة المحاولة"})})]})});const m={current:"Bronze",next:"Silver",salesNeeded:50,currentSales:r.conversions||0,percentage:(r.conversions||0)/50*100};return s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[s.jsx(h,{to:"/affiliate/links",children:s.jsx(t,{className:"hover:shadow-lg transition-shadow cursor-pointer border-primary/20",children:s.jsxs(l,{className:"p-4 text-center",children:[s.jsx(P,{className:"h-8 w-8 mx-auto mb-2 text-primary"}),s.jsx("h3",{className:"font-semibold text-sm",children:"إدارة الروابط"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"أنشئ وتتبع روابطك"})]})})}),s.jsx(h,{to:"/affiliate/analytics",children:s.jsx(t,{className:"hover:shadow-lg transition-shadow cursor-pointer border-orange-500/20",children:s.jsxs(l,{className:"p-4 text-center",children:[s.jsx(I,{className:"h-8 w-8 mx-auto mb-2 text-orange-500"}),s.jsx("h3",{className:"font-semibold text-sm",children:"التحليلات"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"رسوم بيانية وإحصائيات"})]})})}),s.jsx(h,{to:"/affiliate/creatives",children:s.jsx(t,{className:"hover:shadow-lg transition-shadow cursor-pointer border-green-500/20",children:s.jsxs(l,{className:"p-4 text-center",children:[s.jsx(L,{className:"h-8 w-8 mx-auto mb-2 text-green-500"}),s.jsx("h3",{className:"font-semibold text-sm",children:"أدوات تسويقية"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"بانرات ورموز QR"})]})})}),s.jsx(h,{to:"/affiliate/withdraw",children:s.jsx(t,{className:"hover:shadow-lg transition-shadow cursor-pointer border-purple-500/20",children:s.jsxs(l,{className:"p-4 text-center",children:[s.jsx(v,{className:"h-8 w-8 mx-auto mb-2 text-purple-500"}),s.jsx("h3",{className:"font-semibold text-sm",children:"سحب الأرباح"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"اسحب عمولاتك"})]})})})]}),s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex justify-between items-start mb-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"لوحة تحكم المسوق"}),s.jsx("p",{className:"text-muted-foreground",children:"تتبع أرباحك وإحصائياتك التسويقية"})]}),s.jsxs(j,{variant:"default",className:"text-lg px-4 py-2",children:[s.jsx(ss,{className:"h-5 w-5 ml-2"}),m.current," Tier"]})]}),s.jsx(t,{children:s.jsxs(l,{className:"pt-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsxs("p",{className:"text-sm font-medium",children:["تقدمك نحو ",m.next," Tier"]}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[m.currentSales," / ",m.salesNeeded," مبيعة"]})]}),s.jsx(f,{value:m.percentage,className:"h-3"}),s.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[m.salesNeeded-m.currentSales," مبيعة متبقية للوصول إلى المستوى الذهبي وزيادة نسبة العمولة!"]})]})})]}),s.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-8",children:[s.jsxs(t,{children:[s.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(n,{className:"text-sm font-medium",children:"إجمالي الأرباح"}),s.jsx(v,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(l,{children:[s.jsxs("div",{className:"text-2xl font-bold",children:["$",(r.totalEarnings||0).toFixed(2)]}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"منذ الانضمام"})]})]}),s.jsxs(t,{children:[s.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(n,{className:"text-sm font-medium",children:"هذا الشهر"}),s.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(l,{children:[s.jsxs("div",{className:"text-2xl font-bold",children:["$",(r.thisMonthEarnings||0).toFixed(2)]}),s.jsxs("div",{className:"flex items-center text-xs mt-1",children:[s.jsx(B,{className:"h-3 w-3 text-green-500 ml-1"}),s.jsxs("span",{className:"text-green-500",children:[r.thisMonthEarnings>0?"+":"",(r.thisMonthEarnings/Math.max(r.totalEarnings,1)*100).toFixed(1),"%"]})]})]})]}),s.jsxs(t,{children:[s.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(n,{className:"text-sm font-medium",children:"معدل التحويل"}),s.jsx(es,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(l,{children:[s.jsxs("div",{className:"text-2xl font-bold",children:[(r.conversionRate||0).toFixed(1),"%"]}),s.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[r.conversions||0," مبيعة من ",r.referralCount||0," إحالة"]})]})]}),s.jsxs(t,{children:[s.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(n,{className:"text-sm font-medium",children:"جاهز للسحب"}),s.jsx(R,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(l,{children:[s.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",((r.totalEarnings||0)-(r.pendingEarnings||0)).toFixed(2)]}),s.jsx(h,{to:"/affiliate/withdraw",children:s.jsx(d,{size:"sm",className:"mt-2 w-full",children:"سحب الآن"})})]})]})]}),s.jsxs(t,{className:"mb-8",children:[s.jsxs(i,{children:[s.jsx(n,{children:"رابط الإحالة الخاص بك"}),s.jsx(x,{children:"شارك هذا الرابط لكسب عمولة على كل عملية بيع"})]}),s.jsxs(l,{className:"space-y-4",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx(ns,{value:A,readOnly:!0,className:"font-mono"}),s.jsxs(d,{onClick:()=>W(A),variant:"outline",children:[s.jsx(as,{className:"h-4 w-4 ml-2"}),q?"تم النسخ!":"نسخ"]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[s.jsxs(d,{variant:"outline",className:"w-full",children:[s.jsx(w,{className:"h-4 w-4 ml-2"}),"فيسبوك"]}),s.jsxs(d,{variant:"outline",className:"w-full",children:[s.jsx(w,{className:"h-4 w-4 ml-2"}),"تويتر"]}),s.jsxs(d,{variant:"outline",className:"w-full",children:[s.jsx(w,{className:"h-4 w-4 ml-2"}),"واتساب"]})]}),s.jsxs("div",{className:"flex gap-4 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ts,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[r.totalClicks," زيارة"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[r.totalSales," مبيعة"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(v,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:"نسبة العمولة: 15%"})]})]})]})]}),s.jsxs(xs,{defaultValue:"sales",className:"space-y-4",children:[s.jsxs(ms,{className:"grid w-full grid-cols-4",children:[s.jsxs(N,{value:"sales",children:[s.jsx(M,{className:"h-4 w-4 ml-2"}),"المبيعات"]}),s.jsxs(N,{value:"products",children:[s.jsx(I,{className:"h-4 w-4 ml-2"}),"أفضل المنتجات"]}),s.jsxs(N,{value:"tools",children:[s.jsx(L,{className:"h-4 w-4 ml-2"}),"أدوات التسويق"]}),s.jsxs(N,{value:"rewards",children:[s.jsx(z,{className:"h-4 w-4 ml-2"}),"المكافآت"]})]}),s.jsx(p,{value:"sales",children:s.jsxs(t,{children:[s.jsxs(i,{children:[s.jsx(n,{children:"المبيعات الأخيرة"}),s.jsx(x,{children:"تفاصيل العمولات من مبيعاتك"})]}),s.jsx(l,{children:s.jsx("div",{className:"space-y-3",children:U.map(a=>s.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-medium",children:a.id}),s.jsx(j,{variant:a.status==="completed"?"default":"secondary",children:a.status==="completed"?s.jsxs(s.Fragment,{children:[s.jsx(R,{className:"h-3 w-3 ml-1"}),"مكتمل"]}):s.jsxs(s.Fragment,{children:[s.jsx(ls,{className:"h-3 w-3 ml-1"}),"قيد المعالجة"]})})]}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.product," - $",a.amount]}),s.jsx("p",{className:"text-xs text-muted-foreground",children:a.date})]}),s.jsxs("div",{className:"text-left",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"عمولتك"}),s.jsxs("p",{className:"text-lg font-bold text-green-600",children:["$",a.commission.toFixed(2)]})]})]},a.id))})})]})}),s.jsx(p,{value:"products",children:s.jsxs(t,{children:[s.jsxs(i,{children:[s.jsx(n,{children:"أفضل منتجاتك أداءً"}),s.jsx(x,{children:"المنتجات التي تحقق أعلى عمولات"})]}),s.jsx(l,{children:s.jsx("div",{className:"space-y-4",children:J.map((a,g)=>s.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-semibold",children:a.name}),s.jsxs("div",{className:"flex gap-4 mt-2 text-sm text-muted-foreground",children:[s.jsxs("span",{children:[a.sales," مبيعة"]}),s.jsxs("span",{children:[a.clicks," نقرة"]}),s.jsxs("span",{children:["معدل التحويل:"," ",(a.sales/a.clicks*100).toFixed(1),"%"]})]})]}),s.jsxs("div",{className:"text-left",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي العمولات"}),s.jsxs("p",{className:"text-xl font-bold text-green-600",children:["$",a.commission.toFixed(2)]})]})]},g))})})]})}),s.jsx(p,{value:"tools",children:s.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[s.jsxs(t,{children:[s.jsxs(i,{children:[s.jsx(n,{children:"روابط مخصصة للمنتجات"}),s.jsx(x,{children:"أنشئ روابط خاصة لمنتجات محددة"})]}),s.jsx(l,{children:s.jsxs(d,{className:"w-full",children:[s.jsx(P,{className:"h-4 w-4 ml-2"}),"إنشاء رابط جديد"]})})]}),s.jsxs(t,{children:[s.jsxs(i,{children:[s.jsx(n,{children:"بانرات إعلانية"}),s.jsx(x,{children:"تحميل صور جاهزة للترويج"})]}),s.jsx(l,{children:s.jsxs(d,{variant:"outline",className:"w-full",children:[s.jsx(G,{className:"h-4 w-4 ml-2"}),"تحميل البانرات"]})})]}),s.jsxs(t,{children:[s.jsxs(i,{children:[s.jsx(n,{children:"كوبونات خصم"}),s.jsx(x,{children:"أنشئ كوبونات خاصة لعملائك"})]}),s.jsx(l,{children:s.jsxs(d,{className:"w-full",children:[s.jsx(z,{className:"h-4 w-4 ml-2"}),"إنشاء كوبون"]})})]}),s.jsxs(t,{children:[s.jsxs(i,{children:[s.jsx(n,{children:"تقارير مفصلة"}),s.jsx(x,{children:"تصدير تقارير الأداء"})]}),s.jsx(l,{children:s.jsxs(d,{variant:"outline",className:"w-full",children:[s.jsx(G,{className:"h-4 w-4 ml-2"}),"تصدير التقرير"]})})]})]})}),s.jsx(p,{value:"rewards",children:s.jsxs(t,{children:[s.jsxs(i,{children:[s.jsx(n,{children:"برنامج المكافآت"}),s.jsx(x,{children:"احصل على مكافآت إضافية عند تحقيق أهداف محددة"})]}),s.jsx(l,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"p-4 rounded-lg border border-green-200 bg-green-50",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"مكافأة 100 مبيعة"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"احصل على $50 إضافية"})]}),s.jsx(j,{variant:"default",children:"89%"})]}),s.jsx(f,{value:89,className:"mt-2"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"11 مبيعة فقط للوصول للهدف!"})]}),s.jsxs("div",{className:"p-4 rounded-lg border",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"مكافأة 200 مبيعة"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"احصل على $150 إضافية"})]}),s.jsx(j,{variant:"secondary",children:"44.5%"})]}),s.jsx(f,{value:44.5,className:"mt-2"})]}),s.jsxs("div",{className:"p-4 rounded-lg border",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"مكافأة 500 مبيعة"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"احصل على $500 إضافية"})]}),s.jsx(j,{variant:"secondary",children:"17.8%"})]}),s.jsx(f,{value:17.8,className:"mt-2"})]})]})})]})})]})]})})}export{Cs as default};
