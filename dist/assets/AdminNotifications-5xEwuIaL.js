import{r as h,j as e,Z as ae,au as re,U as Be,p as Pe,a0 as ge,b8 as He,b3 as Je,cm as je,ao as fe,aO as Ye,bz as ze,be as Ve,a$ as Qe,b7 as We}from"./vendor-react-wP-gPk8e.js";import{A as Ze}from"./AdminLayout-Bi0XjebE.js";import{d,c as Ae,R as ce,u as Ke,B as I,C as w,r as v,s as S,f as A,H as V,L as g,I as ie,m as Ne,e as k,D as Xe,t as es,v as ss,w as ts,x as as}from"./index-BjwBfcA6.js";import{T as ye}from"./textarea-DqtwzpPR.js";import{T as rs,a as is,b as Q,c as W}from"./tabs-W766L0g2.js";import{R as cs,a as Z}from"./radio-group-CBhLECa9.js";import{S as ns,a as ls,b as os,c as ds,d as M}from"./select--uXl0eT9.js";import{T as we,a as ve,b as K,c as x,d as Se,e as p}from"./table-DjZxPEeY.js";import{Q as l,I as Ce}from"./vendor-appwrite-BGb_FC-V.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-GexG3wnZ.js";import"./vendor-other-DcnDEVts.js";import"./vendor-animations-W1Z2cmit.js";import"./avatar-DWfEzynm.js";const u=Ae.databaseId,j="notifications",us="notification_templates",ne="scheduled_notifications";async function ms(t=100){try{return(await d.listDocuments(u,j,[l.orderDesc("$createdAt"),l.limit(t)])).documents}catch(a){return console.error("Error fetching all notifications:",a),[]}}async function hs(t=50){try{const a=await ce.get();return(await d.listDocuments(u,j,[l.equal("userId",a.$id),l.orderDesc("$createdAt"),l.limit(t)])).documents}catch(a){return console.error("Error fetching notifications:",a),[]}}async function xs(){try{const t=await ce.get();return(await d.listDocuments(u,j,[l.equal("userId",t.$id),l.equal("isRead",!1),l.limit(1e3)])).total}catch(t){return console.error("Error fetching unread count:",t),0}}async function be(t){try{await d.updateDocument(u,j,t,{isRead:!0})}catch(a){throw console.error("Error marking notification as read:",a),a}}async function ps(){try{const t=await ce.get(),a=await d.listDocuments(u,j,[l.equal("userId",t.$id),l.equal("isRead",!1),l.limit(100)]);await Promise.all(a.documents.map(r=>d.updateDocument(u,j,r.$id,{isRead:!0})))}catch(t){throw console.error("Error marking all as read:",t),t}}async function gs(t){try{await d.deleteDocument(u,j,t)}catch(a){throw console.error("Error deleting notification:",a),a}}async function le(t,a,r,i="info",n){try{return await d.createDocument(u,j,Ce.unique(),{userId:t,title:a,message:r,type:i,isRead:!1,link:n||null})}catch(m){throw console.error("Error creating notification:",m),m}}async function De(t,a,r="info"){try{const i=await d.listDocuments(u,Ae.collections.users,[l.limit(1e3)]);let n=0,m=0;return await Promise.all(i.documents.map(async N=>{try{await le(N.$id,t,a,r),n++}catch{m++}})),{success:n,failed:m}}catch(i){throw console.error("Error broadcasting notification:",i),i}}async function Te(){try{return(await d.listDocuments(u,us,[l.orderDesc("$createdAt"),l.limit(100)])).documents}catch(t){return console.error("Error fetching templates:",t),Ee()}}function Ee(){return[{$id:"welcome",name:"ترحيب بمستخدم جديد",title:"مرحباً بك في إيجي جو! 🎉",message:"مرحباً {userName}، نحن سعداء بانضمامك إلينا. استكشف منتجاتنا واستمتع بالتسوق!",type:"success",targetAudience:"customers",channels:["inApp","email"],variables:["userName"],isActive:!0,usageCount:0,$createdAt:new Date().toISOString()},{$id:"order_confirmed",name:"تأكيد طلب",title:"تم تأكيد طلبك ✅",message:"طلبك رقم {orderNumber} تم تأكيده بنجاح. سيتم شحنه قريباً.",type:"success",targetAudience:"customers",channels:["inApp","email","sms"],variables:["orderNumber"],isActive:!0,usageCount:0,$createdAt:new Date().toISOString()},{$id:"order_shipped",name:"تم شحن الطلب",title:"طلبك في الطريق 🚚",message:"طلبك رقم {orderNumber} تم شحنه. رقم التتبع: {trackingNumber}",type:"info",targetAudience:"customers",channels:["inApp","email","sms","push"],variables:["orderNumber","trackingNumber"],isActive:!0,usageCount:0,$createdAt:new Date().toISOString()},{$id:"commission_earned",name:"عمولة جديدة",title:"تهانينا! حصلت على عمولة جديدة 💰",message:"لقد حصلت على عمولة {amount} ج.م من طلب رقم {orderNumber}",type:"success",targetAudience:"affiliates",channels:["inApp","email","push"],variables:["amount","orderNumber"],isActive:!0,usageCount:0,$createdAt:new Date().toISOString()},{$id:"commission_paid",name:"تم دفع العمولة",title:"تم تحويل العمولة إلى حسابك 💸",message:"تم تحويل مبلغ {amount} ج.م إلى حسابك. رقم العملية: {transactionId}",type:"success",targetAudience:"affiliates",channels:["inApp","email"],variables:["amount","transactionId"],isActive:!0,usageCount:0,$createdAt:new Date().toISOString()},{$id:"promotion",name:"عرض ترويجي",title:"عرض خاص لفترة محدودة! 🎁",message:"احصل على خصم {discount}% على جميع المنتجات. استخدم كود: {couponCode}",type:"promotion",targetAudience:"all",channels:["inApp","email","push"],variables:["discount","couponCode"],isActive:!0,usageCount:0,$createdAt:new Date().toISOString()},{$id:"product_back_in_stock",name:"المنتج متوفر الآن",title:"المنتج الذي تنتظره متوفر الآن! 🎉",message:"{productName} عاد للمخزون. اطلبه الآن قبل نفاذ الكمية!",type:"info",targetAudience:"customers",channels:["inApp","email","push"],variables:["productName"],isActive:!0,usageCount:0,$createdAt:new Date().toISOString()},{$id:"password_reset",name:"إعادة تعيين كلمة المرور",title:"طلب إعادة تعيين كلمة المرور",message:"تم إرسال رابط إعادة تعيين كلمة المرور إلى بريدك الإلكتروني.",type:"info",targetAudience:"all",channels:["inApp","email"],variables:[],isActive:!0,usageCount:0,$createdAt:new Date().toISOString()}]}async function F(t,a,r){try{const n=(await Te()).find(y=>y.$id===t);if(!n)throw new Error("Template not found");let m=n.title,N=n.message;if(Object.entries(a).forEach(([y,T])=>{m=m.replace(`{${y}}`,T),N=N.replace(`{${y}}`,T)}),r&&r.length>0){let y=0,T=0;return await Promise.all(r.map(async C=>{try{await le(C,m,N,n.type),y++}catch{T++}})),{success:y,failed:T}}return await De(m,N,n.type)}catch(i){throw console.error("Error creating notification from template:",i),i}}async function js(t,a){try{return await d.createDocument(u,ne,Ce.unique(),{...t,status:"scheduled",scheduledFor:a.toISOString(),readCount:0,clickCount:0,totalRecipients:0})}catch(r){console.error("Error scheduling notification:",r);const i=JSON.parse(localStorage.getItem("scheduled_notifications")||"[]"),n={id:Date.now().toString(),...t,status:"scheduled",scheduledFor:a.toISOString(),readCount:0,clickCount:0};return i.push(n),localStorage.setItem("scheduled_notifications",JSON.stringify(i)),n}}async function fs(){try{return(await d.listDocuments(u,ne,[l.equal("status","scheduled"),l.orderAsc("scheduledFor"),l.limit(100)])).documents}catch(t){return console.error("Error fetching scheduled notifications:",t),JSON.parse(localStorage.getItem("scheduled_notifications")||"[]")}}async function Ns(t){try{await d.updateDocument(u,ne,t,{status:"cancelled"})}catch(a){console.error("Error cancelling scheduled notification:",a);const i=JSON.parse(localStorage.getItem("scheduled_notifications")||"[]").filter(n=>n.id!==t);localStorage.setItem("scheduled_notifications",JSON.stringify(i))}}async function ys(t){try{await be(t);try{const a=await d.getDocument(u,j,t);await d.updateDocument(u,j,t,{readCount:(a.readCount||0)+1,readAt:new Date().toISOString()})}catch(a){console.log("Could not update read count:",a)}}catch(a){console.error("Error tracking notification read:",a)}}async function ws(t){try{const a=await d.getDocument(u,j,t);await d.updateDocument(u,j,t,{clickCount:(a.clickCount||0)+1})}catch(a){console.error("Error tracking notification click:",a)}}async function vs(){try{const a=(await d.listDocuments(u,j,[l.equal("status","sent"),l.limit(1e3)])).documents,r=a.length,i=a.filter(m=>m.isRead).length,n=a.reduce((m,N)=>m+(N.clickCount||0),0);return{totalSent:r,totalRead:i,totalClicks:n,readRate:r>0?i/r*100:0,clickRate:r>0?n/r*100:0}}catch(t){return console.error("Error getting notification analytics:",t),{totalSent:0,totalRead:0,totalClicks:0,readRate:0,clickRate:0}}}async function Ss(t,a,r){try{await F("order_confirmed",{orderNumber:a,orderTotal:r.toFixed(2)},[t])}catch(i){console.error("Error sending order confirmation:",i)}}async function As(t,a,r){try{await F("commission_earned",{amount:a.toFixed(2),orderNumber:r},[t])}catch(i){console.error("Error sending commission notification:",i)}}async function Cs(t,a,r){try{await F("commission_paid",{amount:a.toFixed(2),transactionId:r},[t])}catch(i){console.error("Error sending commission paid notification:",i)}}async function bs(t,a,r){try{await F("order_shipped",{orderNumber:a,trackingNumber:r},[t])}catch(i){console.error("Error sending order shipped notification:",i)}}async function Ds(t,a){try{await F("welcome",{userName:a},[t])}catch(r){console.error("Error sending welcome notification:",r)}}const U={getUserNotifications:hs,getUnreadCount:xs,markAsRead:be,markAllAsRead:ps,deleteNotification:gs,getAllNotifications:ms,createNotification:le,broadcastNotification:De,getNotificationTemplates:Te,getDefaultTemplates:Ee,createFromTemplate:F,scheduleNotification:js,getScheduledNotifications:fs,cancelScheduledNotification:Ns,trackNotificationRead:ys,trackNotificationClick:ws,getNotificationAnalytics:vs,sendOrderConfirmationNotification:Ss,sendCommissionEarnedNotification:As,sendCommissionPaidNotification:Cs,sendOrderShippedNotification:bs,sendWelcomeNotification:Ds};function Bs(){const{toast:t}=Ke(),[a,r]=h.useState(!0),[i,n]=h.useState([]),[m,N]=h.useState([]),[y,T]=h.useState([]),[C,G]=h.useState(""),[E,q]=h.useState(""),[B,P]=h.useState("info"),[R,H]=h.useState("all"),[b,$]=h.useState(["inApp"]),[X,ee]=h.useState(""),[Re,oe]=h.useState(!1),[_,de]=h.useState(""),[L,ue]=h.useState(""),[O,me]=h.useState({totalNotifications:0,readRate:0,activeUsersToday:0,engagementRate:0,monthlyGrowth:0});h.useEffect(()=>{$e()},[]);const $e=async()=>{r(!0);try{await Promise.all([Ie(),Oe(),se()])}catch(s){console.error("Error loading data:",s)}finally{r(!1)}},Ie=async()=>{try{const o=(await U.getAllNotifications()).map(c=>({id:c.$id,title:c.title,message:c.message,type:c.type,targetAudience:c.targetAudience,specificUsers:c.specificUsers,channels:c.channels,status:c.status,sentAt:c.sentAt,readCount:c.readCount,totalRecipients:c.totalRecipients,createdAt:c.$createdAt,clickCount:c.clickCount}));n(o),ke(o)}catch(s){console.error("Error loading notifications:",s),n([]),me({totalNotifications:0,readRate:0,activeUsersToday:0,engagementRate:0,monthlyGrowth:0})}},ke=s=>{const o=s.length,c=s.reduce((D,f)=>D+f.totalRecipients,0),xe=s.reduce((D,f)=>D+f.readCount,0),_e=c>0?xe/c*100:0,Y=new Date,z=Y.getMonth(),Le=z===0?11:z-1,pe=s.filter(D=>{const f=new Date(D.createdAt);return f.getMonth()===z&&f.getFullYear()===Y.getFullYear()}).length,te=s.filter(D=>{const f=new Date(D.createdAt),qe=z===0?Y.getFullYear()-1:Y.getFullYear();return f.getMonth()===Le&&f.getFullYear()===qe}).length,Me=te>0?(pe-te)/te*100:pe>0?100:0,Ue=s.reduce((D,f)=>f.clickCount||0,0),Ge=c>0?(xe+Ue)/c*100:0;me({totalNotifications:o,readRate:Math.round(_e*10)/10,activeUsersToday:c,engagementRate:Math.round(Ge*10)/10,monthlyGrowth:Math.round(Me*10)/10})},Oe=async()=>{try{const s=await U.getNotificationTemplates();N(s)}catch(s){console.error("Error loading templates:",s)}},se=async()=>{try{const s=await U.getScheduledNotifications();T(s)}catch(s){console.error("Error loading scheduled notifications:",s)}},he=async(s=!1)=>{if(!C||!E){t({variant:"destructive",title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة"});return}if(s&&(!_||!L)){t({variant:"destructive",title:"خطأ",description:"يرجى تحديد تاريخ ووقت الإرسال"});return}r(!0);try{if(s){const o=new Date(`${_}T${L}`);await U.scheduleNotification({title:C,message:E,type:B,targetAudience:R,specificUsers:R==="specific"?X.split(",").map(c=>c.trim()):void 0,channels:b,isRead:!1,totalRecipients:0},o),t({title:"تم الجدولة بنجاح",description:`سيتم إرسال الإشعار في ${o.toLocaleString("ar-EG")}`}),se()}else{await new Promise(c=>setTimeout(c,1500));const o={id:Date.now().toString(),title:C,message:E,type:B,targetAudience:R,specificUsers:R==="specific"?X.split(",").map(c=>c.trim()):void 0,channels:b,status:"sent",sentAt:new Date().toISOString(),readCount:0,totalRecipients:R==="all"?1200:120,createdAt:new Date().toISOString()};n([o,...i]),t({title:"تم الإرسال بنجاح",description:`تم إرسال الإشعار إلى ${o.totalRecipients} مستخدم`})}G(""),q(""),P("info"),H("all"),$(["inApp"]),ee(""),de(""),ue("")}catch{t({variant:"destructive",title:"خطأ",description:"فشل في إرسال الإشعار"})}finally{r(!1)}},Fe=s=>{G(s.title),q(s.message),P(s.type),H(s.targetAudience),$(s.channels),t({title:"تم تطبيق القالب",description:`تم تطبيق قالب "${s.name}"`})},J=s=>{switch(s){case"info":return"bg-blue-500";case"success":return"bg-green-500";case"warning":return"bg-yellow-500";case"error":return"bg-red-500";case"promotion":return"bg-purple-500";default:return"bg-gray-500"}};return e.jsx(Ze,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"إدارة الإشعارات"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"أرسل إشعارات للمستخدمين وتابع حالة الإشعارات المرسلة"})]}),e.jsxs(I,{variant:"outline",className:"gap-1",children:[e.jsx(ae,{className:"h-4 w-4"}),i.length," إشعار"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(w,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"إجمالي الإشعارات"}),e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"text-2xl font-bold",children:O.totalNotifications}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[O.monthlyGrowth>0?"+":"",O.monthlyGrowth,"% من الشهر الماضي"]})]})]}),e.jsxs(w,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"معدل القراءة"}),e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[O.readRate,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"من إجمالي المرسل"})]})]}),e.jsxs(w,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"إجمالي المستلمين"}),e.jsx(Be,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"text-2xl font-bold",children:O.activeUsersToday.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"مستخدم"})]})]}),e.jsxs(w,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"معدل التفاعل"}),e.jsx(Pe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[O.engagementRate,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"قراءة + نقر"})]})]})]}),e.jsxs(rs,{defaultValue:"send",className:"space-y-4",children:[e.jsxs(is,{children:[e.jsx(Q,{value:"send",children:"إرسال إشعار جديد"}),e.jsx(Q,{value:"templates",children:"القوالب"}),e.jsx(Q,{value:"scheduled",children:"المجدولة"}),e.jsx(Q,{value:"history",children:"سجل الإشعارات"})]}),e.jsx(W,{value:"send",className:"space-y-4",children:e.jsxs(w,{children:[e.jsxs(v,{children:[e.jsx(S,{children:"إرسال إشعار جديد"}),e.jsx(V,{children:"أرسل إشعارات مخصصة للمستخدمين عبر قنوات متعددة"})]}),e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"title",children:"عنوان الإشعار *"}),e.jsx(ie,{id:"title",placeholder:"أدخل عنوان الإشعار",value:C,onChange:s=>G(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"message",children:"نص الرسالة *"}),e.jsx(ye,{id:"message",placeholder:"أدخل نص الرسالة...",rows:4,value:E,onChange:s=>q(s.target.value)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[E.length,"/500 حرف"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"نوع الإشعار"}),e.jsxs(cs,{value:B,onValueChange:s=>P(s),children:[e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(Z,{value:"info",id:"info"}),e.jsxs(g,{htmlFor:"info",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(ge,{className:"h-4 w-4 text-blue-500"}),"معلومات"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(Z,{value:"success",id:"success"}),e.jsxs(g,{htmlFor:"success",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(He,{className:"h-4 w-4 text-green-500"}),"نجاح"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(Z,{value:"warning",id:"warning"}),e.jsxs(g,{htmlFor:"warning",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(ge,{className:"h-4 w-4 text-yellow-500"}),"تحذير"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(Z,{value:"promotion",id:"promotion"}),e.jsxs(g,{htmlFor:"promotion",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(Je,{className:"h-4 w-4 text-purple-500"}),"عرض ترويجي"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"الجمهور المستهدف"}),e.jsxs(ns,{value:R,onValueChange:s=>H(s),children:[e.jsx(ls,{children:e.jsx(os,{placeholder:"اختر الجمهور المستهدف"})}),e.jsxs(ds,{children:[e.jsx(M,{value:"all",children:"جميع المستخدمين"}),e.jsx(M,{value:"customers",children:"العملاء فقط"}),e.jsx(M,{value:"affiliates",children:"المسوقين بالعمولة"}),e.jsx(M,{value:"merchants",children:"التجار"}),e.jsx(M,{value:"specific",children:"مستخدمين محددين"})]})]})]}),R==="specific"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"emails",children:"البريد الإلكتروني للمستخدمين"}),e.jsx(ye,{id:"emails",placeholder:"أدخل البريد الإلكتروني مفصولاً بفاصلة...",rows:3,value:X,onChange:s=>ee(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"قنوات الإرسال"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(Ne,{id:"inApp",checked:b.includes("inApp"),onCheckedChange:s=>{$(s?[...b,"inApp"]:b.filter(o=>o!=="inApp"))}}),e.jsxs(g,{htmlFor:"inApp",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(je,{className:"h-4 w-4"}),"داخل التطبيق"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(Ne,{id:"email",checked:b.includes("email"),onCheckedChange:s=>{$(s?[...b,"email"]:b.filter(o=>o!=="email"))}}),e.jsxs(g,{htmlFor:"email",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(fe,{className:"h-4 w-4"}),"البريد الإلكتروني"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"جدولة الإرسال (اختياري)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(ie,{type:"date",value:_,onChange:s=>de(s.target.value),min:new Date().toISOString().split("T")[0]})}),e.jsx("div",{children:e.jsx(ie,{type:"time",value:L,onChange:s=>ue(s.target.value)})})]}),_&&L&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["سيتم الإرسال في: ",new Date(`${_}T${L}`).toLocaleString("ar-EG")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(k,{variant:"outline",onClick:()=>oe(!0),disabled:!C||!E,children:[e.jsx(re,{className:"h-4 w-4 ml-2"}),"معاينة"]}),e.jsxs("div",{className:"space-x-2 rtl:space-x-reverse",children:[e.jsx(k,{variant:"outline",onClick:()=>{G(""),q(""),P("info"),H("all"),$(["inApp"]),ee("")},children:"إلغاء"}),e.jsx(k,{onClick:()=>he(!1),disabled:a,children:a?e.jsx(e.Fragment,{children:"جاري الإرسال..."}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"h-4 w-4 ml-2"}),"إرسال فوراً"]})}),e.jsx(k,{variant:"secondary",onClick:()=>he(!0),disabled:a,children:a?e.jsx(e.Fragment,{children:"جاري الجدولة..."}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"h-4 w-4 ml-2"}),"جدولة للإرسال"]})})]})]})]})]})}),e.jsx(W,{value:"history",className:"space-y-4",children:e.jsxs(w,{children:[e.jsxs(v,{children:[e.jsx(S,{children:"سجل الإشعارات المرسلة"}),e.jsx(V,{children:"عرض جميع الإشعارات المرسلة سابقاً"})]}),e.jsx(A,{children:e.jsxs(we,{children:[e.jsx(ve,{children:e.jsxs(K,{children:[e.jsx(x,{children:"النوع"}),e.jsx(x,{children:"العنوان"}),e.jsx(x,{children:"الجمهور"}),e.jsx(x,{children:"القنوات"}),e.jsx(x,{children:"المستلمين"}),e.jsx(x,{children:"معدل القراءة"}),e.jsx(x,{children:"التاريخ"}),e.jsx(x,{children:"الإجراءات"})]})}),e.jsx(Se,{children:i.map(s=>e.jsxs(K,{children:[e.jsx(p,{children:e.jsx(I,{className:`${J(s.type)} text-white`,children:s.type})}),e.jsx(p,{className:"font-medium",children:s.title}),e.jsxs(p,{children:[s.targetAudience==="all"&&"الجميع",s.targetAudience==="customers"&&"العملاء",s.targetAudience==="affiliates"&&"المسوقين",s.targetAudience==="merchants"&&"التجار",s.targetAudience==="specific"&&"محدد"]}),e.jsx(p,{children:e.jsxs("div",{className:"flex gap-1",children:[s.channels.includes("inApp")&&e.jsx(je,{className:"h-4 w-4"}),s.channels.includes("email")&&e.jsx(fe,{className:"h-4 w-4"})]})}),e.jsx(p,{children:s.totalRecipients}),e.jsxs(p,{children:[Math.round(s.readCount/s.totalRecipients*100),"%"]}),e.jsx(p,{className:"text-sm",children:new Date(s.sentAt||s.createdAt).toLocaleDateString("ar-EG")}),e.jsx(p,{children:e.jsx(k,{variant:"ghost",size:"icon",children:e.jsx(re,{className:"h-4 w-4"})})})]},s.id))})]})})]})}),e.jsx(W,{value:"templates",className:"space-y-4",children:e.jsxs(w,{children:[e.jsxs(v,{children:[e.jsx(S,{children:"قوالب الإشعارات الجاهزة"}),e.jsx(V,{children:"استخدم القوالب الجاهزة للإشعارات الشائعة"})]}),e.jsx(A,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(s=>e.jsxs(w,{className:"cursor-pointer hover:shadow-lg transition-shadow",children:[e.jsx(v,{children:e.jsxs(S,{className:"text-lg flex items-center gap-2",children:[e.jsx(I,{className:`${J(s.type)} text-white`,children:s.type}),s.name]})}),e.jsxs(A,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.message})]}),s.variables&&s.variables.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"المتغيرات:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.variables.map(o=>e.jsx(I,{variant:"outline",className:"text-xs",children:`{${o}}`},o))})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx(I,{variant:"secondary",children:s.targetAudience}),e.jsxs(k,{size:"sm",onClick:()=>Fe(s),children:[e.jsx(Ve,{className:"h-4 w-4 ml-2"}),"استخدام"]})]})]})]},s.$id))})})]})}),e.jsx(W,{value:"scheduled",className:"space-y-4",children:e.jsxs(w,{children:[e.jsxs(v,{children:[e.jsx(S,{children:"الإشعارات المجدولة"}),e.jsx(V,{children:"الإشعارات المقرر إرسالها لاحقاً"})]}),e.jsx(A,{children:y.length>0?e.jsxs(we,{children:[e.jsx(ve,{children:e.jsxs(K,{children:[e.jsx(x,{children:"العنوان"}),e.jsx(x,{children:"النوع"}),e.jsx(x,{children:"الجمهور"}),e.jsx(x,{children:"موعد الإرسال"}),e.jsx(x,{children:"الحالة"}),e.jsx(x,{children:"الإجراءات"})]})}),e.jsx(Se,{children:y.map(s=>e.jsxs(K,{children:[e.jsx(p,{className:"font-medium",children:s.title}),e.jsx(p,{children:e.jsx(I,{className:`${J(s.type)} text-white`,children:s.type})}),e.jsx(p,{children:s.targetAudience}),e.jsx(p,{className:"text-sm",children:new Date(s.scheduledFor).toLocaleString("ar-EG")}),e.jsx(p,{children:e.jsx(I,{variant:"outline",children:"مجدول"})}),e.jsx(p,{children:e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>{confirm("هل تريد إلغاء هذا الإشعار المجدول?")&&(U.cancelScheduledNotification(s.id||s.$id),se(),t({title:"تم الإلغاء",description:"تم إلغاء الإشعار المجدول"}))},children:e.jsx(Qe,{className:"h-4 w-4"})})})]},s.id||s.$id))})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(We,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد إشعارات مجدولة حالياً"})]})})]})})]}),e.jsx(Xe,{open:Re,onOpenChange:oe,children:e.jsxs(es,{children:[e.jsxs(ss,{children:[e.jsx(ts,{children:"معاينة الإشعار"}),e.jsx(as,{children:"هكذا سيظهر الإشعار للمستخدمين"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"p-4 border rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${J(B)} text-white`,children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:C||"عنوان الإشعار"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:E||"نص الرسالة"})]})]})})})]})})]})})}export{Bs as default};
