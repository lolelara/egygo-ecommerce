import{r as j,j as e,aa as Te,M as O,b9 as Q,ba as Oe,h as ge,i as M,bb as J,bc as Me,bd as ae,be as ne,bf as le,bg as Y,bh as ie,bi as Ne,bj as qe,bk as ve,bl as Ue,bm as Be,bn as We,bo as ze,bp as _e,aJ as Ke,ag as Ve,ah as He,aL as Ge,ak as Qe,bq as je,Q as H,br as Je,bs as _,a2 as R,bt as $e,aT as Ee,bu as De,bv as Ae,bw as Ye,bx as we,aq as ee,by as Pe,b8 as Xe,au as pe,b4 as V,bz as ce,bA as ye,K as oe,bB as Ze,bC as ke,bD as ue,bE as de,aH as es,U as Ce,az as ss}from"./vendor-react-BTCGZZAN.js";import{D as ts}from"./LoadingSkeletons-Bxazgn_3.js";import{d as P,c as D,C as v,r as w,s as y,f as C,G as z,u as se,e as E,o as K,H as fe,J as be,L as F,I as W,l as G,B as I,g as Ie}from"./index-DAwEpow4.js";import{T as Le,a as Re,b as B,c as X}from"./tabs-43GTZMZA.js";import{Q as f,I as rs}from"./vendor-appwrite-BQhTxLk4.js";import{bg as as,bh as ns}from"./vendor-other-ws_0vYaO.js";import{P as ls}from"./progress-BIiDjHv8.js";import{T as is,a as cs,b as q,c as Se,d as os,e as T}from"./table-C5DXC0ob.js";import{S as ds,a as xs,b as ms,c as hs,d as Z}from"./select-DcBOtlUf.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-GexG3wnZ.js";import"./vendor-animations-W1Z2cmit.js";import"./skeleton-DOUS7_WT.js";async function us(s){try{const r=await P.listDocuments(D.databaseId,D.collections.affiliateStats,[f.equal("affiliateId",s),f.limit(1)]);if(r.documents.length>0){const l=r.documents[0];return{totalClicks:l.totalClicks||0,totalOrders:l.totalOrders||0,totalEarnings:l.totalEarnings||0,pendingEarnings:l.pendingEarnings||0,thisMonthEarnings:l.thisMonthEarnings||0,conversionRate:l.conversionRate||0,clicks:l.totalClicks||0,conversions:l.totalOrders||0,referralCount:l.totalOrders||0,commissionRate:15,affiliateCode:`AFF${s.slice(0,6).toUpperCase()}`,rank:l.rank||null}}const a={affiliateId:s,totalClicks:0,totalOrders:0,totalEarnings:0,pendingEarnings:0,thisMonthEarnings:0,conversionRate:0,updatedAt:new Date().toISOString()};try{await P.createDocument(D.databaseId,D.collections.affiliateStats,"unique()",a)}catch(l){console.error("Error creating stats:",l)}return{...a,clicks:0,conversions:0,referralCount:0,commissionRate:15,affiliateCode:`AFF${s.slice(0,6).toUpperCase()}`,rank:null}}catch(r){throw console.error("Error getting affiliate stats:",r),r}}async function gs(s,r=10){try{return(await P.listDocuments(D.databaseId,D.collections.affiliateActivities,[f.equal("affiliateId",s),f.orderDesc("createdAt"),f.limit(r)])).documents.map(l=>({id:l.$id,type:l.type,title:l.title,description:l.description,amount:l.amount,time:new Date(l.createdAt),productName:l.productName}))}catch(a){return console.error("Error getting activities:",a),[]}}async function js(s,r=5){try{return(await P.listDocuments(D.databaseId,D.collections.notifications,[f.equal("userId",s),f.orderDesc("createdAt"),f.limit(r)])).documents.map(l=>({id:l.$id,type:l.type,title:l.title,message:l.message,actionLabel:l.actionLabel,actionLink:l.actionLink,isRead:l.isRead,isNew:l.isNew}))}catch(a){return console.error("Error getting notifications:",a),[]}}async function ps(s){try{return(await P.listDocuments(D.databaseId,D.collections.withdrawalRequests,[f.equal("affiliateId",s),f.orderDesc("createdAt"),f.limit(10)])).documents.map(a=>({id:a.$id,amount:a.amount,fee:a.fee,netAmount:a.netAmount,paymentMethod:a.paymentMethod,status:a.status,createdAt:a.createdAt,processedAt:a.processedAt}))}catch(r){return console.error("Error getting withdrawal requests:",r),[]}}async function fs(s=10){try{return(await P.listDocuments(D.databaseId,D.collections.products,[f.equal("isActive",!0),f.orderDesc("$createdAt"),f.limit(s)])).documents}catch(r){return console.error("Error getting products:",r),[]}}async function bs(s=10){try{return(await P.listDocuments(D.databaseId,D.collections.affiliateStats,[f.orderDesc("totalEarnings"),f.limit(s)])).documents.map((a,l)=>({rank:l+1,affiliateId:a.affiliateId,earnings:a.totalEarnings||0,clicks:a.totalClicks||0,orders:a.totalOrders||0}))}catch(r){return console.error("Error getting leaderboard:",r),[]}}const U=D.databaseId,xe="affiliate_conversions",me="affiliate_clicks",Ns="affiliate_withdrawals";class vs{async getStats(r){try{const l=(await P.listDocuments(U,xe,[f.equal("affiliateId",r)])).documents,g=l.filter(k=>k.status==="paid"||k.status==="approved").reduce((k,L)=>k+(L.commission||0),0),d=l.filter(k=>k.status==="pending").reduce((k,L)=>k+(L.commission||0),0),u=(await P.listDocuments(U,me,[f.equal("affiliateId",r),f.limit(1)])).total,o=l.length,i=u>0?o/u*100:0,h=new Date,t=new Date(h.getFullYear(),h.getMonth(),1),c=l.filter(k=>new Date(k.convertedAt)>=t),p=c.filter(k=>k.status==="paid"||k.status==="approved").reduce((k,L)=>k+(L.commission||0),0),S=c.length,x=(await P.listDocuments(U,me,[f.equal("affiliateId",r),f.greaterThanEqual("clickedAt",t.toISOString()),f.limit(1)])).total,m=(await P.listDocuments(U,Ns,[f.equal("affiliateId",r),f.equal("status","completed")])).documents.reduce((k,L)=>k+(L.amount||0),0),N=g-m;return{totalEarnings:g,totalClicks:u,totalSales:o,conversionRate:i,pendingEarnings:d,availableBalance:N,thisMonthEarnings:p,thisMonthClicks:x,thisMonthSales:S}}catch(a){return console.error("Error fetching affiliate stats:",a),{totalEarnings:0,totalClicks:0,totalSales:0,conversionRate:0,pendingEarnings:0,availableBalance:0,thisMonthEarnings:0,thisMonthClicks:0,thisMonthSales:0}}}async getEarningsData(r,a=7){try{const l=[],g=new Date;for(let d=a-1;d>=0;d--){const n=new Date(g);n.setDate(n.getDate()-d);const u=n.toISOString().split("T")[0],o=new Date(n);o.setDate(o.getDate()+1);const i=await P.listDocuments(U,xe,[f.equal("affiliateId",r),f.greaterThanEqual("convertedAt",n.toISOString()),f.lessThan("convertedAt",o.toISOString())]),h=i.documents.filter(S=>S.status==="paid"||S.status==="approved").reduce((S,A)=>S+(A.commission||0),0),t=i.documents.length,p=(await P.listDocuments(U,me,[f.equal("affiliateId",r),f.greaterThanEqual("clickedAt",n.toISOString()),f.lessThan("clickedAt",o.toISOString()),f.limit(1)])).total;l.push({date:u,earnings:h,clicks:p,sales:t})}return l}catch(l){return console.error("Error fetching earnings data:",l),[]}}async getProductPerformance(r){try{const a=await P.listDocuments(U,xe,[f.equal("affiliateId",r)]),l=new Map;a.documents.forEach(d=>{const n=d.productId||"unknown",u=l.get(n)||{sales:0,earnings:0};l.set(n,{sales:u.sales+1,earnings:u.earnings+(d.commission||0)})});const g=[];for(const[d,n]of l.entries())g.push({name:`منتج ${d.substring(0,8)}`,sales:n.sales,earnings:n.earnings});return g.sort((d,n)=>n.earnings-d.earnings).slice(0,5)}catch(a){return console.error("Error fetching product performance:",a),[]}}}const he=new vs;function ws({affiliateId:s}){const[r,a]=j.useState("month"),[l,g]=j.useState(!0),[d,n]=j.useState({totalEarnings:0,totalClicks:0,totalSales:0,conversionRate:0,pendingEarnings:0,availableBalance:0}),[u,o]=j.useState([]),[i,h]=j.useState([]);j.useEffect(()=>{t()},[s,r]);const t=async()=>{if(s){g(!0);try{const p=await he.getStats(s);n(p);const S=r==="week"?7:r==="month"?30:365,A=await he.getEarningsData(s,S);o(A);const x=await he.getProductPerformance(s);h(x)}catch(p){console.error("Error loading affiliate data:",p)}finally{g(!1)}}},c=[{stage:"زيارات",value:d.totalClicks*4,color:"#8b5cf6"},{stage:"نقرات",value:d.totalClicks,color:"#ec4899"},{stage:"إضافة للسلة",value:Math.floor(d.totalClicks*.3),color:"#3b82f6"},{stage:"مبيعات",value:d.totalSales,color:"#10b981"}];return l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Te,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(v,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-purple-900",children:"إجمالي الأرباح"}),e.jsx(O,{className:"h-5 w-5 text-purple-600"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-900",children:["$",d.totalEarnings.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-purple-700 flex items-center mt-1",children:[e.jsx(Q,{className:"h-3 w-3 ml-1"}),"+12.5% من الشهر الماضي"]})]})]}),e.jsxs(v,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-blue-900",children:"إجمالي النقرات"}),e.jsx(Oe,{className:"h-5 w-5 text-blue-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:d.totalClicks.toLocaleString()}),e.jsxs("p",{className:"text-xs text-blue-700 flex items-center mt-1",children:[e.jsx(Q,{className:"h-3 w-3 ml-1"}),"+8.2% من الشهر الماضي"]})]})]}),e.jsxs(v,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-green-900",children:"إجمالي المبيعات"}),e.jsx(ge,{className:"h-5 w-5 text-green-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-900",children:d.totalSales}),e.jsxs("p",{className:"text-xs text-green-700 flex items-center mt-1",children:[e.jsx(Q,{className:"h-3 w-3 ml-1"}),"+15.3% من الشهر الماضي"]})]})]}),e.jsxs(v,{className:"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-orange-900",children:"معدل التحويل"}),e.jsx(M,{className:"h-5 w-5 text-orange-600"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[d.conversionRate,"%"]}),e.jsxs("p",{className:"text-xs text-orange-700 flex items-center mt-1",children:[e.jsx(Q,{className:"h-3 w-3 ml-1"}),"+2.1% من الشهر الماضي"]})]})]})]}),e.jsxs(Le,{value:r,onValueChange:p=>a(p),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"تحليلات الأداء"}),e.jsxs(Re,{children:[e.jsx(B,{value:"week",children:"أسبوع"}),e.jsx(B,{value:"month",children:"شهر"}),e.jsx(B,{value:"year",children:"سنة"})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"الأرباح والمبيعات"}),e.jsx(z,{children:"تتبع أرباحك ومبيعاتك بمرور الوقت"})]}),e.jsx(C,{children:e.jsx(J,{width:"100%",height:300,children:e.jsxs(Me,{data:u,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorEarnings",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorSales",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})]}),e.jsx(ae,{strokeDasharray:"3 3"}),e.jsx(ne,{dataKey:"date"}),e.jsx(le,{}),e.jsx(Y,{}),e.jsx(ie,{}),e.jsx(Ne,{type:"monotone",dataKey:"earnings",stroke:"#8b5cf6",fillOpacity:1,fill:"url(#colorEarnings)",name:"الأرباح ($)"}),e.jsx(Ne,{type:"monotone",dataKey:"sales",stroke:"#10b981",fillOpacity:1,fill:"url(#colorSales)",name:"المبيعات"})]})})})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"أداء المنتجات"}),e.jsx(z,{children:"أفضل الفئات مبيعاً"})]}),e.jsx(C,{children:e.jsx(J,{width:"100%",height:300,children:e.jsxs(qe,{data:i,children:[e.jsx(ae,{strokeDasharray:"3 3"}),e.jsx(ne,{dataKey:"name"}),e.jsx(le,{}),e.jsx(Y,{}),e.jsx(ie,{}),e.jsx(ve,{dataKey:"sales",fill:"#8b5cf6",name:"المبيعات"}),e.jsx(ve,{dataKey:"earnings",fill:"#ec4899",name:"الأرباح ($)"})]})})})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"اتجاه النقرات"}),e.jsx(z,{children:"عدد النقرات على روابطك"})]}),e.jsx(C,{children:e.jsx(J,{width:"100%",height:300,children:e.jsxs(Ue,{data:u,children:[e.jsx(ae,{strokeDasharray:"3 3"}),e.jsx(ne,{dataKey:"date"}),e.jsx(le,{}),e.jsx(Y,{}),e.jsx(ie,{}),e.jsx(Be,{type:"monotone",dataKey:"clicks",stroke:"#3b82f6",strokeWidth:3,name:"النقرات",dot:{fill:"#3b82f6",r:5}})]})})})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"قمع التحويل"}),e.jsx(z,{children:"رحلة العميل من الزيارة للشراء"})]}),e.jsx(C,{children:e.jsx(J,{width:"100%",height:300,children:e.jsxs(We,{children:[e.jsx(ze,{data:c,cx:"50%",cy:"50%",labelLine:!1,label:({stage:p,value:S})=>`${p}: ${S}`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:c.map((p,S)=>e.jsx(_e,{fill:p.color},`cell-${S}`))}),e.jsx(Y,{})]})})})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(v,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 border-yellow-200",children:[e.jsxs(w,{children:[e.jsx(y,{className:"text-yellow-900",children:"الأرباح المعلقة"}),e.jsx(z,{className:"text-yellow-700",children:"في انتظار تأكيد الطلبات"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-3xl font-bold text-yellow-900",children:["$",d.pendingEarnings.toLocaleString()]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-2",children:"سيتم إضافتها للرصيد المتاح بعد 7 أيام"})]})]}),e.jsxs(v,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsxs(w,{children:[e.jsx(y,{className:"text-green-900",children:"الرصيد المتاح"}),e.jsx(z,{className:"text-green-700",children:"جاهز للسحب"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-3xl font-bold text-green-900",children:["$",d.availableBalance.toLocaleString()]}),e.jsx("p",{className:"text-sm text-green-700 mt-2",children:"الحد الأدنى للسحب: $50"})]})]})]})]})}function ys({link:s,productName:r="منتج رائع"}){const{toast:a}=se(),l=()=>{const i=`🛍️ ${r}

تسوق الآن واحصل على أفضل الأسعار!
${s}`;window.open(`https://wa.me/?text=${encodeURIComponent(i)}`,"_blank")},g=()=>{window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(s)}`,"_blank")},d=()=>{const i=`🛍️ ${r} - تسوق الآن!`;window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(i)}&url=${encodeURIComponent(s)}`,"_blank")},n=()=>{const i=`🛍️ ${r}

تسوق الآن واحصل على أفضل الأسعار!`;window.open(`https://t.me/share/url?url=${encodeURIComponent(s)}&text=${encodeURIComponent(i)}`,"_blank")},u=()=>{const i=`تسوق الآن: ${r}`,h=`مرحباً،

أود أن أشارك معك هذا المنتج الرائع:

${r}

رابط المنتج: ${s}

تسوق سعيد!`;window.open(`mailto:?subject=${encodeURIComponent(i)}&body=${encodeURIComponent(h)}`)},o=()=>{navigator.clipboard.writeText(s),a({title:"✅ تم النسخ",description:"تم نسخ الرابط بنجاح"})};return e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(E,{size:"sm",variant:"outline",onClick:l,className:"hover:bg-green-50 hover:border-green-500 transition-all",title:"مشاركة على واتساب",children:e.jsx(Ke,{className:"h-4 w-4 text-green-600"})}),e.jsx(E,{size:"sm",variant:"outline",onClick:g,className:"hover:bg-blue-50 hover:border-blue-500 transition-all",title:"مشاركة على فيسبوك",children:e.jsx(Ve,{className:"h-4 w-4 text-blue-600"})}),e.jsx(E,{size:"sm",variant:"outline",onClick:d,className:"hover:bg-sky-50 hover:border-sky-500 transition-all",title:"مشاركة على تويتر",children:e.jsx(He,{className:"h-4 w-4 text-sky-500"})}),e.jsx(E,{size:"sm",variant:"outline",onClick:n,className:"hover:bg-blue-50 hover:border-blue-400 transition-all",title:"مشاركة على تيليجرام",children:e.jsx(Ge,{className:"h-4 w-4 text-blue-500"})}),e.jsx(E,{size:"sm",variant:"outline",onClick:u,className:"hover:bg-gray-50 hover:border-gray-500 transition-all",title:"مشاركة عبر البريد",children:e.jsx(Qe,{className:"h-4 w-4 text-gray-600"})}),e.jsx(E,{size:"sm",variant:"outline",onClick:o,className:"hover:bg-purple-50 hover:border-purple-500 transition-all",title:"نسخ الرابط",children:e.jsx(je,{className:"h-4 w-4 text-purple-600"})})]})}function ks(){const{user:s}=K(),{toast:r}=se(),[a,l]=j.useState([]),[g,d]=j.useState(!0),[n,u]=j.useState({}),[o,i]=j.useState(null);j.useEffect(()=>{s&&h()},[s]);const h=async()=>{try{d(!0);const b=(await P.listDocuments(D.databaseId,D.collections.products,[f.equal("isActive",!0),f.orderDesc("$createdAt"),f.limit(50)])).documents.map(N=>({$id:N.$id,name:N.name,basePrice:N.basePrice||N.price||0,minCommissionPrice:N.minCommissionPrice||N.price||0,images:N.images||[],merchantId:N.merchantId,isActive:N.isActive}));l(b);const m={};b.forEach(N=>{m[N.$id]=N.minCommissionPrice}),u(m)}catch(x){console.error("Error loading products:",x),r({title:"خطأ",description:"فشل في تحميل المنتجات",variant:"destructive"})}finally{d(!1)}},t=(x,b)=>{const m=b-x.basePrice,N=(m/x.basePrice*100).toFixed(1);return{commission:m,commissionPercentage:N}},c=x=>{const b=(s==null?void 0:s.affiliateCode)||`AFF${s==null?void 0:s.$id.slice(0,6).toUpperCase()}`,m=n[x]||0;return`${window.location.origin}/#/product/${x}?ref=${b}&price=${m}`},p=async(x,b)=>{try{await navigator.clipboard.writeText(x),i(b),r({title:"تم النسخ!",description:"تم نسخ رابط الشراكة إلى الحافظة"}),setTimeout(()=>i(null),2e3)}catch{r({title:"خطأ",description:"فشل في نسخ الرابط",variant:"destructive"})}},S=(x,b)=>{const m=parseFloat(b)||0;u(N=>({...N,[x]:m}))},A=(x,b)=>b>=x.minCommissionPrice;return g?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري التحميل..."})]})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"إنشاء روابط الشراكة"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"قم بإنشاء روابط شراكة مخصصة مع تحديد سعرك الخاص (يجب أن يكون أعلى من الحد الأدنى)"})]}),e.jsxs(C,{children:[e.jsxs(fe,{className:"mb-6",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsxs(be,{children:[e.jsx("strong",{children:"كيف يعمل النظام:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"السعر الأساسي: سعر المنتج قبل العمولة (يحدده التاجر)"}),e.jsx("li",{children:"الحد الأدنى للسعر: أقل سعر يمكنك بيع المنتج به (يحدده التاجر)"}),e.jsx("li",{children:"سعرك المخصص: يمكنك إضافة أي قيمة أعلى من الحد الأدنى"}),e.jsx("li",{children:"عمولتك = سعرك المخصص - السعر الأساسي"})]})]})]}),e.jsx("div",{className:"space-y-4",children:a.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"لا توجد منتجات متاحة حالياً"})}):a.map(x=>{const b=n[x.$id]||x.minCommissionPrice,{commission:m,commissionPercentage:N}=t(x,b),k=A(x,b);return e.jsxs("div",{className:`p-4 border rounded-lg ${k?"":"border-destructive"}`,children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("img",{src:x.images[0]||"/placeholder.svg",alt:x.name,className:"w-16 h-16 object-cover rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium mb-2",children:x.name}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"السعر الأساسي:"}),e.jsxs("p",{className:"font-semibold",children:["$",x.basePrice.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحد الأدنى:"}),e.jsxs("p",{className:"font-semibold text-orange-600",children:["$",x.minCommissionPrice.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"عمولتك:"}),e.jsxs("p",{className:"font-semibold text-green-600",children:["$",m.toFixed(2)," (",N,"%)"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"سعرك النهائي:"}),e.jsxs("p",{className:"font-semibold text-blue-600",children:["$",b.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(F,{htmlFor:`price-${x.$id}`,children:["سعرك المخصص (الحد الأدنى: $",x.minCommissionPrice.toFixed(2),")"]}),e.jsx(W,{id:`price-${x.$id}`,type:"number",step:"0.01",min:x.minCommissionPrice,value:b,onChange:L=>S(x.$id,L.target.value),className:k?"":"border-destructive"}),!k&&e.jsxs("p",{className:"text-xs text-destructive mt-1",children:["السعر يجب أن يكون أعلى من أو يساوي $",x.minCommissionPrice.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:`link-${x.$id}`,children:"رابط الشراكة"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{id:`link-${x.$id}`,value:c(x.$id),readOnly:!0,className:"flex-1"}),e.jsx(E,{variant:"outline",size:"icon",onClick:()=>p(c(x.$id),x.$id),disabled:!k,children:o===x.$id?e.jsx("span",{className:"text-xs",children:"✓"}):e.jsx(je,{className:"h-4 w-4"})}),e.jsx(E,{variant:"outline",size:"icon",asChild:!0,disabled:!k,children:e.jsx("a",{href:c(x.$id),target:"_blank",rel:"noopener noreferrer",children:e.jsx(Je,{className:"h-4 w-4"})})})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx(F,{className:"mb-2 block",children:"مشاركة سريعة"}),e.jsx(ys,{link:c(x.$id),productName:x.name})]})]},x.$id)})})]})]})})}function Cs({onCalculatorClick:s}){return e.jsxs(v,{className:"border-primary/20 shadow-lg",children:[e.jsx(w,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5 text-primary"}),"إجراءات سريعة"]})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:[e.jsx(E,{variant:"outline",className:"flex-col h-24 hover:bg-primary/10 hover:border-primary transition-all",asChild:!0,children:e.jsxs(R,{to:"#links",children:[e.jsx($e,{className:"h-6 w-6 mb-2 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:"إنشاء رابط"})]})}),e.jsxs(E,{variant:"outline",className:"flex-col h-24 hover:bg-green-50 hover:border-green-500 transition-all",onClick:()=>{const r=`تسوق الآن من إيجي جو واحصل على أفضل العروض! 🛍️
${window.location.origin}`;navigator.share?navigator.share({text:r}):navigator.clipboard.writeText(r)},children:[e.jsx(Ee,{className:"h-6 w-6 mb-2 text-green-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"مشاركة سريعة"})]}),e.jsx(E,{variant:"outline",className:"flex-col h-24 hover:bg-blue-50 hover:border-blue-500 transition-all",asChild:!0,children:e.jsxs(R,{to:"/affiliate/banners",children:[e.jsx(De,{className:"h-6 w-6 mb-2 text-blue-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"تحميل بانر"})]})}),e.jsxs(E,{variant:"outline",className:"flex-col h-24 hover:bg-purple-50 hover:border-purple-500 transition-all",onClick:s,children:[e.jsx(Ae,{className:"h-6 w-6 mb-2 text-purple-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"حاسبة الأرباح"})]}),e.jsx(E,{variant:"outline",className:"flex-col h-24 hover:bg-orange-50 hover:border-orange-500 transition-all",asChild:!0,children:e.jsxs(R,{to:"/affiliate/marketing-tips",children:[e.jsx(Ye,{className:"h-6 w-6 mb-2 text-orange-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"نصائح التسويق"})]})}),e.jsx(E,{variant:"outline",className:"flex-col h-24 hover:bg-pink-50 hover:border-pink-500 transition-all",asChild:!0,children:e.jsxs(R,{to:"/affiliate/courses",children:[e.jsx(_,{className:"h-6 w-6 mb-2 text-pink-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"الكورسات"})]})})]})})]})}function Ss(){const[s,r]=j.useState(10),[a,l]=j.useState(50),[g,d]=j.useState(2),n=()=>{const h=s*a,t=h*7,c=h*30,p=h*365;return{daily:h,weekly:t,monthly:c,yearly:p}},u=()=>Math.ceil(s/(g/100)),o=n(),i=u();return e.jsxs(v,{className:"border-green-200 shadow-lg bg-gradient-to-br from-white to-green-50/30 dark:from-neutral-800 dark:to-neutral-800",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5 text-green-600"}),"حاسبة الأرباح المتوقعة"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"احسب أرباحك المتوقعة بناءً على أهدافك"})]}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"sales",className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"المبيعات اليومية"]}),e.jsx(W,{id:"sales",type:"number",min:"1",value:s,onChange:h=>r(Number(h.target.value)),className:"text-lg font-semibold"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"commission",className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"متوسط العمولة (ج.م)"]}),e.jsx(W,{id:"commission",type:"number",min:"1",value:a,onChange:h=>l(Number(h.target.value)),className:"text-lg font-semibold"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"conversion",className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"معدل التحويل (%)"]}),e.jsx(W,{id:"conversion",type:"number",min:"0.1",step:"0.1",value:g,onChange:h=>d(Number(h.target.value)),className:"text-lg font-semibold"})]})]}),e.jsx(G,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg text-center border border-green-200",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"يومياً"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:o.daily.toFixed(0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ج.م"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-lg text-center border border-blue-200",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"أسبوعياً"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:o.weekly.toFixed(0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ج.م"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg text-center border border-purple-200",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"شهرياً"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:o.monthly.toFixed(0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ج.م"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-orange-50 to-yellow-50 dark:from-orange-900/20 dark:to-yellow-900/20 rounded-lg text-center border border-orange-200",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"سنوياً"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:o.yearly.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ج.م"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"النقرات المطلوبة يومياً"}),e.jsx(I,{variant:"secondary",className:"text-lg font-bold mt-1",children:i})]}),e.jsx(G,{orientation:"vertical",className:"h-12"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"المبيعات المطلوبة شهرياً"}),e.jsx(I,{variant:"secondary",className:"text-lg font-bold mt-1",children:s*30})]})]}),e.jsxs("div",{className:"text-center text-xs text-muted-foreground p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:["💡 ",e.jsx("strong",{children:"نصيحة:"})," لتحقيق هدفك الشهري، ركز على زيادة معدل التحويل من خلال استهداف الجمهور المناسب"]})]})]})]})}function $s(){const[s,r]=j.useState([]),[a,l]=j.useState(!0);j.useEffect(()=>{g()},[]);const g=async()=>{try{const d=await P.listDocuments(D.databaseId,D.collections.products,[f.equal("isActive",!0),f.orderDesc("$createdAt"),f.limit(5)]),n=await Promise.all(d.documents.map(async u=>{var p;const o=u.basePrice||u.price||0,i=u.minCommissionPrice||u.price||0,h=i-o;let t=0,c=0;try{const S=await P.listDocuments(D.databaseId,D.collections.affiliateClicks,[f.equal("productId",u.$id),f.limit(1e3)]);t=S.total,c=S.documents.filter(A=>A.converted).length}catch(S){console.error("Error loading product stats:",S)}return{id:u.$id,name:u.name,image:Ie((p=u.images)==null?void 0:p[0]),basePrice:o,minCommissionPrice:i,commission:h,clicks:t,sales:c}}));n.sort((u,o)=>o.commission-u.commission),r(n)}catch(d){console.error("Error loading top products:",d)}finally{l(!1)}};return a?e.jsx(v,{children:e.jsx(w,{children:e.jsx(y,{children:"جاري التحميل..."})})}):e.jsxs(v,{className:"border-yellow-200 shadow-lg",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5 text-yellow-500"}),"أفضل المنتجات للترويج"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"المنتجات الأعلى عمولة والأكثر مبيعاً"})]}),e.jsxs(C,{className:"space-y-3",children:[s.map((d,n)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 hover:bg-muted rounded-lg transition-all group",children:[e.jsx(I,{className:`w-8 h-8 flex items-center justify-center text-sm font-bold ${n===0?"bg-gradient-to-br from-yellow-400 to-yellow-600":n===1?"bg-gradient-to-br from-gray-300 to-gray-500":n===2?"bg-gradient-to-br from-orange-400 to-orange-600":"bg-gradient-to-br from-blue-400 to-blue-600"}`,children:n+1}),e.jsx("img",{src:d.image,alt:d.name,className:"w-14 h-14 rounded-lg object-cover border-2 border-muted group-hover:border-primary transition-all"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm line-clamp-1 group-hover:text-primary transition-colors",children:d.name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(O,{className:"h-3 w-3 text-green-600"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[d.commission.toFixed(0)," ج.م"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ee,{className:"h-3 w-3"}),d.clicks]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(M,{className:"h-3 w-3"}),d.sales," مبيعة"]})]})]}),e.jsx(E,{size:"sm",variant:"outline",className:"group-hover:bg-primary group-hover:text-white transition-all",asChild:!0,children:e.jsx(R,{to:`#product-${d.id}`,children:"روّج الآن"})})]},d.id)),s.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(we,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد منتجات متاحة حالياً"})]})]})]})}function Es({stats:s}){const r=(s==null?void 0:s.conversionRate)||0,a=(s==null?void 0:s.totalClicks)||0,l=(s==null?void 0:s.totalOrders)||0,g=(s==null?void 0:s.totalEarnings)||0,n=r>=5?{level:"ممتاز",color:"green",percentage:90}:r>=3?{level:"جيد جداً",color:"blue",percentage:70}:r>=2?{level:"جيد",color:"yellow",percentage:50}:{level:"يحتاج تحسين",color:"orange",percentage:30},u=[];r>=3?u.push({icon:M,color:"green",title:"أداء ممتاز!",description:`معدل التحويل ${r.toFixed(1)}% أعلى من ${n.percentage}% من المسوقين`,type:"success"}):r<2&&u.push({icon:H,color:"orange",title:"يمكنك تحسين الأداء",description:"جرب استهداف جمهور أكثر تحديداً لزيادة معدل التحويل",type:"warning"}),a>100&&u.push({icon:Pe,color:"blue",title:"نشاط رائع!",description:`حققت ${a} نقرة - استمر في المشاركة النشطة`,type:"info"}),u.push({icon:Xe,color:"purple",title:"نصيحة ذكية",description:"المنتجات في فئة 'إلكترونيات' تحقق أعلى عمولة بمتوسط 15%",type:"tip"}),g<1e3?u.push({icon:_,color:"pink",title:"هدفك القادم",description:`تحتاج ${(1e3-g).toFixed(0)} ج.م للوصول لمستوى 'المسوق الذهبي'`,type:"goal"}):u.push({icon:pe,color:"yellow",title:"إنجاز رائع!",description:"وصلت لمستوى 'المسوق الذهبي' - استمر في التميز",type:"achievement"});const o=(i,h)=>{var c;const t={green:{bg:"bg-green-50 dark:bg-green-900/20",text:"text-green-600",border:"border-green-200"},blue:{bg:"bg-blue-50 dark:bg-blue-900/20",text:"text-blue-600",border:"border-blue-200"},orange:{bg:"bg-orange-50 dark:bg-orange-900/20",text:"text-orange-600",border:"border-orange-200"},purple:{bg:"bg-purple-50 dark:bg-purple-900/20",text:"text-purple-600",border:"border-purple-200"},pink:{bg:"bg-pink-50 dark:bg-pink-900/20",text:"text-pink-600",border:"border-pink-200"},yellow:{bg:"bg-yellow-50 dark:bg-yellow-900/20",text:"text-yellow-600",border:"border-yellow-200"}};return((c=t[i])==null?void 0:c[h])||t.blue[h]};return e.jsxs(v,{className:"border-purple-200 shadow-lg",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 text-purple-600"}),"رؤى الأداء"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"تحليل ذكي لأدائك ونصائح للتحسين"})]}),e.jsxs(C,{className:"space-y-3",children:[e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg border-2 ${o(n.color,"bg")} ${o(n.color,"border")}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"مستوى الأداء"}),e.jsx("p",{className:`text-2xl font-bold ${o(n.color,"text")}`,children:n.level})]}),e.jsxs(I,{className:`${o(n.color,"bg")} ${o(n.color,"text")} text-lg px-4 py-2`,children:[r.toFixed(1),"%"]})]}),u.map((i,h)=>{const t=i.icon;return e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border ${o(i.color,"bg")} ${o(i.color,"border")} transition-all hover:shadow-md`,children:[e.jsx("div",{className:`p-2 rounded-lg ${o(i.color,"bg")}`,children:e.jsx(t,{className:`h-5 w-5 ${o(i.color,"text")}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm",children:i.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i.description})]})]},h)}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 pt-2",children:[e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"النقرات"}),e.jsx("p",{className:"text-lg font-bold",children:a})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"المبيعات"}),e.jsx("p",{className:"text-lg font-bold",children:l})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"التحويل"}),e.jsxs("p",{className:"text-lg font-bold",children:[r.toFixed(1),"%"]})]})]})]})]})}function Ds({activities:s}){const{user:r}=K(),[a,l]=j.useState(s||[]),[g,d]=j.useState(!s);j.useEffect(()=>{!s&&(r!=null&&r.$id)&&n()},[r,s]);const n=async()=>{if(r!=null&&r.$id)try{d(!0);const c=await gs(r.$id,10);l(c)}catch(c){console.error("Error loading activities:",c),l([])}finally{d(!1)}},u=[{id:"1",type:"sale",title:"مبيعة جديدة",description:"تم شراء ساعة ذكية عبر رابطك",amount:45.5,time:new Date(Date.now()-1e3*60*30),productName:"ساعة ذكية متطورة"},{id:"2",type:"earning",title:"عمولة مضافة",description:"تم إضافة عمولة إلى رصيدك",amount:45.5,time:new Date(Date.now()-1e3*60*45)},{id:"3",type:"click",title:"نقرات جديدة",description:"15 نقرة على رابط سماعات لاسلكية",time:new Date(Date.now()-1e3*60*60*2),productName:"سماعات لاسلكية Pro"},{id:"4",type:"link_created",title:"رابط جديد",description:"تم إنشاء رابط لمنتج كاميرا احترافية",time:new Date(Date.now()-1e3*60*60*5),productName:"كاميرا احترافية 4K"},{id:"5",type:"sale",title:"مبيعة جديدة",description:"تم شراء لابتوب ألعاب عبر رابطك",amount:120,time:new Date(Date.now()-1e3*60*60*24),productName:"لابتوب ألعاب متطور"},{id:"6",type:"click",title:"نقرات جديدة",description:"8 نقرات على رابط تابلت رسم",time:new Date(Date.now()-1e3*60*60*24*2),productName:"تابلت رسم رقمي"}],o=a.length>0?a:g?[]:u,i=c=>{switch(c){case"sale":return ge;case"click":return ee;case"link_created":return $e;case"earning":return O;default:return M}},h=c=>{switch(c){case"sale":return"text-green-600 bg-green-100 dark:bg-green-900/20";case"click":return"text-blue-600 bg-blue-100 dark:bg-blue-900/20";case"link_created":return"text-purple-600 bg-purple-100 dark:bg-purple-900/20";case"earning":return"text-orange-600 bg-orange-100 dark:bg-orange-900/20";default:return"text-gray-600 bg-gray-100 dark:bg-gray-900/20"}},t=c=>c==="sale"||c==="earning"?"default":"secondary";return e.jsxs(v,{className:"shadow-lg",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-primary"}),"النشاطات الأخيرة"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"تتبع آخر تحديثات حسابك"})]}),e.jsx(C,{children:g?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-4",children:[o.map((c,p)=>{const S=i(c.type),A=h(c.type);return e.jsxs("div",{className:"flex gap-3 items-start group",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${A} group-hover:scale-110 transition-transform`,children:e.jsx(S,{className:"h-5 w-5"})}),p<a.length-1&&e.jsx("div",{className:"w-0.5 h-12 bg-muted mt-2"})]}),e.jsx("div",{className:"flex-1 pb-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm group-hover:text-primary transition-colors",children:c.title}),c.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:c.description}),c.productName&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:"المنتج:"}),c.productName]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),as(c.time,{addSuffix:!0,locale:ns})]})]}),c.amount&&e.jsxs(I,{variant:t(c.type),className:"text-sm font-bold whitespace-nowrap",children:["+",c.amount.toFixed(2)," ج.م"]})]})})]},c.id)}),o.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد نشاطات حديثة"}),e.jsx("p",{className:"text-xs mt-1",children:"ابدأ بإنشاء روابط ومشاركتها"})]})]})})]})}function As({currentUserRank:s,currentUserEarnings:r}){const{user:a}=K(),[l,g]=j.useState([]),[d,n]=j.useState(!0),[u,o]=j.useState(s||0),[i,h]=j.useState(r||0);j.useEffect(()=>{t()},[]);const t=async()=>{try{n(!0);const m=await bs(10);if(g(m),a!=null&&a.$id){const N=m.findIndex(k=>k.affiliateId===a.$id);N!==-1&&(o(N+1),h(m[N].earnings))}}catch(m){console.error("Error loading leaderboard:",m),g([])}finally{n(!1)}},c=l.slice(0,5).map((m,N)=>({rank:N+1,affiliateId:m.affiliateId,name:m.affiliateId===(a==null?void 0:a.$id)?"أنت":`مسوق ${N+1}`,earnings:m.earnings||0,avatar:N===0?"👑":N===1?"🌟":N===2?"🎯":N===3?"⭐":"💎",isCurrentUser:m.affiliateId===(a==null?void 0:a.$id)})),p=c.find(m=>m.rank===u-1),S=p?p.earnings-i:0,A=p?i/p.earnings*100:100,x=m=>{switch(m){case 1:return e.jsx(ce,{className:"h-5 w-5 text-yellow-500"});case 2:return e.jsx(ye,{className:"h-5 w-5 text-gray-400"});case 3:return e.jsx(ye,{className:"h-5 w-5 text-orange-500"});default:return e.jsx(pe,{className:"h-5 w-5 text-blue-500"})}},b=m=>{switch(m){case 1:return"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white";case 2:return"bg-gradient-to-r from-gray-300 to-gray-500 text-white";case 3:return"bg-gradient-to-r from-orange-400 to-orange-600 text-white";default:return"bg-gradient-to-r from-blue-400 to-blue-600 text-white"}};return e.jsxs(v,{className:"border-yellow-200 shadow-lg bg-gradient-to-br from-white to-yellow-50/30 dark:from-neutral-800 dark:to-neutral-800",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-yellow-500"}),"لوحة المتصدرين"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"تنافس مع أفضل المسوقين هذا الشهر"})]}),e.jsx(C,{className:"space-y-4",children:d?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs(e.Fragment,{children:[u>0&&e.jsxs("div",{className:"p-4 bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-lg border-2 border-yellow-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(I,{className:`${b(u)} text-lg px-3 py-1`,children:["#",u]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-lg",children:"أنت 🎯"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"مركزك الحالي"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-2xl text-orange-600",children:i.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ج.م"})]})]}),p&&S>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-muted-foreground",children:["التقدم للمركز ",p.rank]}),e.jsxs("span",{className:"font-semibold",children:[A.toFixed(0),"%"]})]}),e.jsx(ls,{value:A,className:"h-2"}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground",children:["تحتاج ",e.jsxs("strong",{className:"text-primary",children:[S.toLocaleString()," ج.م"]})," للوصول للمركز ",p.rank]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold text-muted-foreground mb-3",children:["أفضل ",c.length," مسوقين"]}),c.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات متاحة"}),e.jsx("p",{className:"text-xs mt-1",children:"كن أول المتصدرين!"})]}):c.map(m=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg transition-all ${m.isCurrentUser?"bg-primary/10 border-2 border-primary":"bg-muted/50 hover:bg-muted"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:`${b(m.rank)} w-8 h-8 flex items-center justify-center`,children:m.rank}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:m.avatar}),e.jsxs("div",{children:[e.jsx("p",{className:`font-semibold text-sm ${m.isCurrentUser?"text-primary":""}`,children:m.name}),m.rank<=3&&e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[x(m.rank),e.jsx("span",{className:"text-xs text-muted-foreground",children:m.rank===1?"البطل":m.rank===2?"الوصيف":"الثالث"})]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-lg",children:m.earnings.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ج.م"})]})]},m.rank))]}),e.jsxs("div",{className:"text-center p-3 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg",children:[e.jsx(M,{className:"h-8 w-8 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-sm font-semibold",children:"استمر في التميز!"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"كل مبيعة تقربك من القمة 🚀"})]})]})})]})}function Ps(){const{user:s}=K(),[r,a]=j.useState([]),[l,g]=j.useState(!0);j.useEffect(()=>{s!=null&&s.$id?d():g(!1)},[s]);const d=async()=>{if(s!=null&&s.$id)try{g(!0);const i=await js(s.$id,10);a(i)}catch(i){console.error("Error loading notifications:",i),a([])}finally{g(!1)}},n=async i=>{try{await P.updateDocument(D.databaseId,D.collections.notifications,i,{isRead:!0,isNew:!1}),a(h=>h.map(t=>t.id===i?{...t,isNew:!1}:t))}catch(h){console.error("Error marking as read:",h)}},u=i=>{switch(i){case"opportunity":return Pe;case"achievement":return pe;case"tip":return _;case"warning":return H;case"promotion":return Ze;default:return oe}},o=i=>{switch(i){case"opportunity":return{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200",icon:"text-blue-600"};case"achievement":return{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200",icon:"text-green-600"};case"tip":return{bg:"bg-purple-50 dark:bg-purple-900/20",border:"border-purple-200",icon:"text-purple-600"};case"warning":return{bg:"bg-orange-50 dark:bg-orange-900/20",border:"border-orange-200",icon:"text-orange-600"};case"promotion":return{bg:"bg-pink-50 dark:bg-pink-900/20",border:"border-pink-200",icon:"text-pink-600"};default:return{bg:"bg-gray-50 dark:bg-gray-900/20",border:"border-gray-200",icon:"text-gray-600"}}};return e.jsxs(v,{className:"border-blue-200 shadow-lg",children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-blue-600"}),"تنبيهات ذكية"]}),e.jsxs(I,{variant:"destructive",className:"animate-pulse",children:[r.filter(i=>i.isNew).length," جديد"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"إشعارات مخصصة لتحسين أدائك"})]}),e.jsx(C,{className:"space-y-3",children:l?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):r.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد إشعارات جديدة"}),e.jsx("p",{className:"text-xs mt-1",children:"سنبقيك على اطلاع بكل جديد"})]}):r.map(i=>{const h=u(i.type),t=o(i.type);return e.jsxs(fe,{className:`${t.bg} ${t.border} border-2 transition-all hover:shadow-md relative`,children:[i.isNew&&e.jsx(I,{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs px-2 py-0.5",children:"جديد"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${t.bg}`,children:e.jsx(h,{className:`h-5 w-5 ${t.icon}`})}),e.jsx("div",{className:"flex-1",children:e.jsxs(be,{children:[e.jsx("p",{className:"font-semibold text-sm mb-1",children:i.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i.message}),i.actionLabel&&e.jsx(E,{size:"sm",variant:"outline",className:"mt-3 h-8 text-xs",onClick:()=>{if(i.isNew&&n(i.id),i.actionLink)if(i.actionLink.startsWith("#")){const c=document.querySelector(i.actionLink);c&&c.scrollIntoView({behavior:"smooth"})}else window.location.href=i.actionLink},children:i.actionLabel})]})})]})]},i.id)})})]})}function Is(){const[s,r]=j.useState([]),[a,l]=j.useState(!0),[g,d]=j.useState([]);j.useEffect(()=>{n()},[]);const n=async()=>{try{const t=await P.listDocuments(D.databaseId,D.collections.products,[f.equal("isActive",!0),f.orderDesc("$createdAt"),f.limit(6)]),c=await Promise.all(t.documents.map(async p=>{var N;const S=p.basePrice||p.price||0,A=p.minCommissionPrice||p.price||0,x=A-S;let b=0,m=0;try{const k=await P.listDocuments(D.databaseId,D.collections.affiliateClicks,[f.equal("productId",p.$id),f.limit(1e3)]);m=k.total;const L=k.documents.filter(te=>te.converted).length;b=m>0?parseFloat((L/m*100).toFixed(1)):0}catch(k){console.error("Error loading conversion rate:",k)}return{id:p.$id,name:p.name,image:Ie((N=p.images)==null?void 0:N[0]),basePrice:S,minCommissionPrice:A,commission:x,conversionRate:b,clicks:m}}));r(c)}catch(t){console.error("Error loading products:",t)}finally{l(!1)}},u=t=>{d(c=>c.includes(t)?c.filter(p=>p!==t):c.length>=3?c:[...c,t])},o=s.filter(t=>g.includes(t.id)),h=o.length===0?null:o.reduce((t,c)=>c.commission>t.commission?c:t);return a?e.jsx(v,{children:e.jsx(w,{children:e.jsx(y,{children:"جاري التحميل..."})})}):e.jsxs(v,{className:"shadow-lg",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5 text-primary"}),"قارن المنتجات"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"اختر حتى 3 منتجات للمقارنة واختيار الأفضل للترويج"})]}),e.jsxs(C,{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:s.map(t=>{const c=g.includes(t.id);return e.jsxs("button",{onClick:()=>u(t.id),className:`p-3 rounded-lg border-2 transition-all text-left ${c?"border-primary bg-primary/10":"border-muted hover:border-primary/50"}`,disabled:!c&&g.length>=3,children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-24 object-cover rounded-lg mb-2"}),c&&e.jsx(ue,{className:"absolute top-1 right-1 h-6 w-6 text-primary bg-white rounded-full"})]}),e.jsx("p",{className:"font-semibold text-xs line-clamp-2",children:t.name}),e.jsxs(I,{variant:"secondary",className:"mt-1 text-xs",children:[t.commission.toFixed(0)," ج.م"]})]},t.id)})}),o.length>0&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(is,{children:[e.jsx(cs,{children:e.jsxs(q,{className:"bg-muted/50",children:[e.jsx(Se,{className:"font-bold",children:"المعيار"}),o.map(t=>e.jsx(Se,{className:"text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("img",{src:t.image,alt:t.name,className:"w-12 h-12 rounded object-cover"}),e.jsx("span",{className:"text-xs line-clamp-1",children:t.name})]})},t.id))]})}),e.jsxs(os,{children:[e.jsxs(q,{children:[e.jsx(T,{className:"font-semibold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-green-600"}),"العمولة"]})}),o.map(t=>e.jsx(T,{className:"text-center",children:e.jsxs(I,{variant:t.id===(h==null?void 0:h.id)?"default":"secondary",className:"font-bold",children:[t.commission.toFixed(0)," ج.م"]})},t.id))]}),e.jsxs(q,{children:[e.jsx(T,{className:"font-semibold",children:"السعر الأساسي"}),o.map(t=>e.jsxs(T,{className:"text-center",children:[t.basePrice.toFixed(0)," ج.م"]},t.id))]}),e.jsxs(q,{children:[e.jsx(T,{className:"font-semibold",children:"الحد الأدنى للسعر"}),o.map(t=>e.jsxs(T,{className:"text-center",children:[t.minCommissionPrice.toFixed(0)," ج.م"]},t.id))]}),e.jsxs(q,{children:[e.jsx(T,{className:"font-semibold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-blue-600"}),"معدل التحويل"]})}),o.map(t=>e.jsx(T,{className:"text-center",children:e.jsxs(I,{variant:"outline",children:[t.conversionRate,"%"]})},t.id))]}),e.jsxs(q,{children:[e.jsx(T,{className:"font-semibold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4 text-purple-600"}),"النقرات"]})}),o.map(t=>e.jsx(T,{className:"text-center",children:t.clicks},t.id))]}),e.jsxs(q,{children:[e.jsx(T,{className:"font-semibold",children:"الإجراء"}),o.map(t=>e.jsx(T,{className:"text-center",children:e.jsx(E,{size:"sm",variant:t.id===(h==null?void 0:h.id)?"default":"outline",children:"روّج"})},t.id))]})]})]})}),h&&o.length>1&&e.jsx("div",{className:"p-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg border-2 border-green-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ue,{className:"h-6 w-6 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900 dark:text-green-100",children:"الأفضل للترويج"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[e.jsx("strong",{children:h.name})," يقدم أعلى عمولة بقيمة"," ",e.jsxs("strong",{className:"text-green-600",children:[h.commission.toFixed(0)," ج.م"]})]})]})]})}),o.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ke,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"اختر منتجات للمقارنة"}),e.jsx("p",{className:"text-xs mt-1",children:"يمكنك اختيار حتى 3 منتجات"})]})]})]})}function Ls({availableBalance:s=0,pendingWithdrawals:r=0}){const{user:a}=K(),{toast:l}=se(),[g,d]=j.useState(""),[n,u]=j.useState(""),[o,i]=j.useState(""),[h,t]=j.useState(!1),[c,p]=j.useState([]),[S,A]=j.useState(!0),x=100,b=s>=x;j.useEffect(()=>{a!=null&&a.$id&&m()},[a]);const m=async()=>{if(a!=null&&a.$id)try{A(!0);const $=await ps(a.$id);p($)}catch($){console.error("Error loading withdrawal history:",$)}finally{A(!1)}},N=async()=>{if(!(a!=null&&a.$id)){l({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}const $=parseFloat(g);if(!$||$<x){l({title:"خطأ",description:`الحد الأدنى للسحب هو ${x} ج.م`,variant:"destructive"});return}if($>s){l({title:"خطأ",description:"المبلغ المطلوب أكبر من الرصيد المتاح",variant:"destructive"});return}if(!n){l({title:"خطأ",description:"يرجى اختيار طريقة الدفع",variant:"destructive"});return}if(!o){l({title:"خطأ",description:"يرجى إدخال تفاصيل الحساب",variant:"destructive"});return}t(!0);try{const re=parseFloat(k($)),Fe=parseFloat(L($));await P.createDocument(D.databaseId,D.collections.withdrawalRequests,rs.unique(),{affiliateId:a.$id,amount:$,fee:re,netAmount:Fe,paymentMethod:n,accountDetails:o,status:"pending",createdAt:new Date().toISOString()}),l({title:"✅ تم إرسال الطلب",description:`تم إرسال طلب سحب ${$} ج.م بنجاح. سيتم المعالجة خلال 2-3 أيام عمل.`}),d(""),u(""),i(""),await m()}catch(re){console.error("Error submitting withdrawal:",re),l({title:"خطأ",description:"فشل في إرسال الطلب. حاول مرة أخرى.",variant:"destructive"})}finally{t(!1)}},k=$=>($*.02).toFixed(2),L=$=>($-parseFloat(k($))).toFixed(2),te=$=>{switch($){case"pending":return e.jsxs(I,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:[e.jsx(V,{className:"h-3 w-3 mr-1"})," قيد المعالجة"]});case"approved":return e.jsxs(I,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"})," تم التحويل"]});case"rejected":return e.jsxs(I,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:[e.jsx(H,{className:"h-3 w-3 mr-1"})," مرفوض"]});default:return e.jsx(I,{variant:"outline",children:$})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{className:"border-green-200 shadow-lg",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5 text-green-600"}),"طلب سحب الأرباح"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"اسحب أرباحك بسهولة وأمان"})]}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-2 border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(O,{className:"h-4 w-4 text-green-600"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"الرصيد المتاح"})]}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[s.toLocaleString()," ج.م"]})]}),e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border-2 border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(V,{className:"h-4 w-4 text-orange-600"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"قيد المعالجة"})]}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[r.toLocaleString()," ج.م"]})]})]}),!b&&e.jsxs(fe,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(H,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(be,{className:"text-yellow-800",children:["الحد الأدنى للسحب هو ",x," ج.م. رصيدك الحالي: ",s," ج.م"]})]}),e.jsx(G,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"amount",children:"المبلغ (ج.م)"}),e.jsx(W,{id:"amount",type:"number",placeholder:`الحد الأدنى ${x} ج.م`,value:g,onChange:$=>d($.target.value),disabled:!b||h,min:x,max:s})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"payment-method",children:"طريقة الدفع"}),e.jsxs(ds,{value:n,onValueChange:u,disabled:!b||h,children:[e.jsx(xs,{children:e.jsx(ms,{placeholder:"اختر طريقة الدفع"})}),e.jsxs(hs,{children:[e.jsx(Z,{value:"bank",children:"تحويل بنكي"}),e.jsx(Z,{value:"vodafone-cash",children:"فودافون كاش"}),e.jsx(Z,{value:"instapay",children:"إنستاباي"}),e.jsx(Z,{value:"paypal",children:"PayPal"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"account-details",children:"تفاصيل الحساب"}),e.jsx(W,{id:"account-details",placeholder:"رقم الحساب أو المحفظة",value:o,onChange:$=>i($.target.value),disabled:!b||h})]}),g&&parseFloat(g)>=x&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"المبلغ المطلوب:"}),e.jsxs("span",{className:"font-semibold",children:[parseFloat(g).toLocaleString()," ج.م"]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"رسوم التحويل (2%):"}),e.jsxs("span",{children:["-",k(parseFloat(g))," ج.م"]})]}),e.jsx(G,{}),e.jsxs("div",{className:"flex justify-between text-base font-bold",children:[e.jsx("span",{children:"المبلغ الصافي:"}),e.jsxs("span",{className:"text-green-600",children:[L(parseFloat(g))," ج.م"]})]})]}),e.jsx(E,{onClick:N,disabled:!b||h||!g||!n||!o,className:"w-full",size:"lg",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"جاري الإرسال..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"إرسال طلب السحب"]})})]})]})]}),e.jsxs(v,{children:[e.jsx(w,{children:e.jsx(y,{className:"text-lg",children:"سجل طلبات السحب"})}),e.jsx(C,{children:S?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):c.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(de,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد طلبات سحب سابقة"})]}):e.jsx("div",{className:"space-y-3",children:c.map($=>e.jsxs("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-semibold",children:[$.amount.toLocaleString()," ج.م"]})]}),te($.status)]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["الطريقة: ",$.paymentMethod]}),e.jsxs("p",{children:["الصافي: ",$.netAmount.toLocaleString()," ج.م"]}),e.jsxs("p",{children:["التاريخ: ",new Date($.createdAt).toLocaleDateString("ar-EG")]})]})]},$.id))})})]})]})}function Hs(){var x;const{user:s}=K(),{toast:r}=se(),[a,l]=j.useState([]),[g,d]=j.useState(null),[n,u]=j.useState(null),[o,i]=j.useState(!0),[h,t]=j.useState(null),[c,p]=j.useState(!1);j.useEffect(()=>{S()},[s]);const S=async()=>{try{if(i(!0),t(null),!s){t("يجب تسجيل الدخول أولاً");return}if(!s.isAffiliate&&s.role!=="affiliate"&&s.role!=="admin"){t("ليس لديك صلاحية الوصول لهذه الصفحة. يجب أن تكون مسوق بالعمولة.");return}const b=await fs(6);if(l(b||[]),s!=null&&s.$id)try{const m=await us(s.$id);u(m)}catch(m){console.error("Error loading stats:",m),u({totalClicks:0,totalOrders:0,totalEarnings:0,pendingEarnings:0,thisMonthEarnings:0,affiliateCode:s.affiliateCode||`AFF${s.$id.slice(0,6).toUpperCase()}`,conversionRate:0,clicks:0,conversions:0,referralCount:0,commissionRate:15})}}catch(b){console.error("Error loading data:",b),t("فشل في تحميل البيانات. حاول مرة أخرى."),r({variant:"destructive",title:"خطأ",description:"فشل في تحميل البيانات"})}finally{i(!1)}},A=async(b,m)=>{try{await navigator.clipboard.writeText(b),d(m),setTimeout(()=>d(null),2e3),r({title:"تم النسخ",description:"تم نسخ الرابط بنجاح"})}catch(N){console.error("فشل في نسخ الرابط:",N),r({variant:"destructive",title:"خطأ",description:"فشل في نسخ الرابط"})}};return e.jsx("div",{className:"container mx-auto px-4 py-8 space-y-8 bg-gradient-to-br from-orange-50/50 via-white to-yellow-50/50 dark:from-neutral-900 dark:via-neutral-900 dark:to-neutral-900 min-h-screen",children:o?e.jsx("div",{className:"py-8",children:e.jsx(ts,{count:4})}):h?e.jsx(v,{className:"border-red-200 bg-red-50 dark:bg-red-950/20",children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(es,{className:"h-12 w-12 text-red-500 mx-auto"}),e.jsx("h2",{className:"text-xl font-semibold text-red-700 dark:text-red-400",children:h}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(E,{onClick:()=>window.location.href="/login",variant:"outline",children:"تسجيل الدخول"}),e.jsx(E,{onClick:()=>window.location.href="/affiliate",children:"التسجيل كمسوق"})]})]})})}):n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-orange-600 to-yellow-500 bg-clip-text text-transparent",children:["مرحباً، ",(s==null?void 0:s.name)||"الشريك"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"إليك نظرة عامة على أداء شراكتك"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(I,{className:"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg",children:"شريك نشط"})})]}),e.jsx(Cs,{onCalculatorClick:()=>p(!c)}),c&&e.jsx(Ss,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(v,{className:"border-orange-200 dark:border-orange-900 shadow-lg hover:shadow-xl transition-shadow bg-gradient-to-br from-white to-orange-50/30 dark:from-neutral-800 dark:to-neutral-800",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"إجمالي الأرباح"}),e.jsx(O,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(n.totalEarnings||0).toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+12.5% من الشهر الماضي"})]})]}),e.jsxs(v,{className:"border-green-200 dark:border-green-900 shadow-lg hover:shadow-xl transition-shadow bg-gradient-to-br from-white to-green-50/30 dark:from-neutral-800 dark:to-neutral-800",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"أرباح هذا الشهر"}),e.jsx(M,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(n.thisMonthEarnings||0).toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+8.2% من الشهر الماضي"})]})]}),e.jsxs(v,{className:"border-blue-200 dark:border-blue-900 shadow-lg hover:shadow-xl transition-shadow bg-gradient-to-br from-white to-blue-50/30 dark:from-neutral-800 dark:to-neutral-800",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"النقرات هذا الشهر"}),e.jsx(ee,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((x=n.clicks)==null?void 0:x.toLocaleString())||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"إجمالي النقرات"})]})]}),e.jsxs(v,{className:"border-purple-200 dark:border-purple-900 shadow-lg hover:shadow-xl transition-shadow bg-gradient-to-br from-white to-purple-50/30 dark:from-neutral-800 dark:to-neutral-800",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"معدل التحويل"}),e.jsx(_,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.conversionRate,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+0.8% من الشهر الماضي"})]})]})]}),e.jsxs(Le,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(Re,{className:"grid w-full grid-cols-4",children:[e.jsx(B,{value:"overview",children:"نظرة عامة"}),e.jsx(B,{value:"links",children:"روابط الشراكة"}),e.jsx(B,{value:"performance",children:"الأداء"}),e.jsx(B,{value:"resources",children:"مصادر التسويق"})]}),e.jsxs(X,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(Ps,{}),e.jsx(Es,{stats:n})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx($s,{}),e.jsx(As,{currentUserRank:3,currentUserEarnings:(n==null?void 0:n.totalEarnings)||0})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(Ds,{}),e.jsx(Ls,{availableBalance:(n==null?void 0:n.totalEarnings)||0,pendingWithdrawals:(n==null?void 0:n.pendingEarnings)||0})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(v,{children:[e.jsx(w,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"معلومات الحساب"]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{className:"text-sm font-medium",children:"كود الشراكة"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("code",{className:"bg-muted px-2 py-1 rounded text-sm",children:n.affiliateCode}),e.jsx(E,{size:"sm",variant:"outline",onClick:()=>A(n.affiliateCode,"code"),children:e.jsx(je,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-sm font-medium",children:"معدل العمولة"}),e.jsxs("p",{className:"text-lg font-semibold text-brand-orange mt-1",children:[n.commissionRate,"%"]})]})]}),e.jsx(G,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{className:"text-sm font-medium",children:"عدد الإحالات"}),e.jsx("p",{className:"text-lg font-semibold mt-1",children:n.referralCount})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-sm font-medium",children:"تاريخ الانضمام"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:new Date().toLocaleDateString("ar")})]})]})]})]}),e.jsxs(v,{children:[e.jsx(w,{children:e.jsx(y,{children:"النشاط الأخير"})}),e.jsx(C,{children:e.jsx("div",{className:"space-y-3",children:n.recentCommissions&&n.recentCommissions.length>0?n.recentCommissions.slice(0,5).map(b=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(O,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"عمولة جديدة"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["طلب #",b.orderId.substring(0,8)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-600",children:["+",(b.amount||0).toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(b.createdAt).toLocaleDateString("ar")})]})]},b.id)):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"لا يوجد نشاط حديث"})})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{children:[e.jsx(w,{children:e.jsx(y,{children:"إجراءات سريعة"})}),e.jsxs(C,{className:"space-y-3",children:[e.jsx(E,{className:"w-full justify-start",asChild:!0,children:e.jsxs(R,{to:"/affiliate/withdraw",children:[e.jsx(O,{className:"h-4 w-4 ml-2 rtl:ml-0 rtl:mr-2"}),"سحب الأرباح"]})}),e.jsx(E,{variant:"outline",className:"w-full justify-start",asChild:!0,children:e.jsxs(R,{to:"/affiliate/resources",children:[e.jsx(De,{className:"h-4 w-4 ml-2 rtl:ml-0 rtl:mr-2"}),"مواد التسويق"]})}),e.jsx(E,{variant:"outline",className:"w-full justify-start",asChild:!0,children:e.jsxs(R,{to:"/affiliate/support",children:[e.jsx(Ce,{className:"h-4 w-4 ml-2 rtl:ml-0 rtl:mr-2"}),"الدعم الفني"]})})]})]}),e.jsxs(v,{children:[e.jsx(w,{children:e.jsx(y,{children:"الأرباح المعلقة"})}),e.jsx(C,{children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-brand-orange",children:[(n.pendingEarnings||0).toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"سيتم دفعها خلال 7 أيام"}),e.jsx(E,{size:"sm",className:"mt-3",asChild:!0,children:e.jsx(R,{to:"/affiliate/withdraw",children:"عرض التفاصيل"})})]})})]})]})]})]}),e.jsx(X,{value:"links",className:"space-y-6",children:e.jsx(ks,{})}),e.jsxs(X,{value:"performance",className:"space-y-6",children:[e.jsx(Is,{}),e.jsx(ws,{affiliateId:(s==null?void 0:s.$id)||""}),e.jsx("div",{className:"grid lg:grid-cols-2 gap-6",children:e.jsxs(v,{children:[e.jsx(w,{children:e.jsx(y,{children:"إحصائيات الأداء"})}),e.jsx(C,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold",children:n.clicks||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"إجمالي النقرات"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold",children:n.conversions||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"إجمالي التحويلات"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.conversionRate||0,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"معدل التحويل"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold",children:n.referralCount||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"عدد الإحالات"})]})]})})]})})]}),e.jsx(X,{value:"resources",className:"space-y-6",children:e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(v,{children:[e.jsx(w,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"بانرات إعلانية"]})}),e.jsxs(C,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"قم بتحميل بانرات جاهزة لاستخدامها في موقعك أو وسائل التواصل"}),e.jsx(E,{className:"w-full",asChild:!0,children:e.jsx(R,{to:"/affiliate/banners",children:"تحميل البانرات"})})]})]}),e.jsxs(v,{children:[e.jsx(w,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-5 w-5"}),"نصائح التسويق"]})}),e.jsxs(C,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"اكتشف أفضل الاستراتيجيات لزيادة مبيعاتك وأرباحك"}),e.jsx(E,{variant:"outline",className:"w-full",asChild:!0,children:e.jsx(R,{to:"/affiliate/marketing-tips",children:"عرض النصائح"})})]})]}),e.jsxs(v,{children:[e.jsx(w,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"الكورسات التسويقية"]})}),e.jsxs(C,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"تعلم استراتيجيات التسويق الاحترافية لزيادة مبيعاتك"}),e.jsx(E,{variant:"outline",className:"w-full",asChild:!0,children:e.jsx(R,{to:"/affiliate/courses",children:"عرض الكورسات"})})]})]})]})})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"لم يتم العثور على بيانات الشريك"}),e.jsx(E,{asChild:!0,children:e.jsx(R,{to:"/",children:"العودة للرئيسية"})})]})})}export{Hs as default};
