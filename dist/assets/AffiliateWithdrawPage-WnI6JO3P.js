import{w as W,b as $,r as l,j as e,ak as h,a1 as E,al as u,L as F,C as n,g as d,ab as L,e as b,f as w,a6 as B,s as y,I,B as j}from"./index-Ce-RwxJS.js";import{a as p}from"./affiliate-api-Do0vmgJQ.js";import{W as P}from"./wallet-U6e7gbWw.js";import{C as T}from"./credit-card-Diutn1QU.js";function z(){const{user:t}=W(),{toast:c}=$(),[r,f]=l.useState(""),[i,g]=l.useState("bank"),[C,A]=l.useState(null),[x,S]=l.useState([]),[k,N]=l.useState(!0);l.useEffect(()=>{t?.$id&&v()},[t]);const v=async()=>{if(t?.$id)try{N(!0);const[s,m]=await Promise.all([p.getStats(t.$id),p.getWithdrawals(t.$id)]);A(s),S(m)}catch(s){console.error("Error loading data:",s)}finally{N(!1)}},o=C?.totalEarnings||0,a=100,D=async()=>{const s=parseFloat(r);if(isNaN(s)||s<a){c({variant:"destructive",title:"خطأ",description:`الحد الأدنى للسحب ${a} ج.م`});return}if(s>o){c({variant:"destructive",title:"خطأ",description:"المبلغ أكبر من رصيدك المتاح"});return}try{await p.requestWithdrawal(t.$id,s,i,{}),c({title:"تم إرسال الطلب",description:"سيتم مراجعة طلبك والدفع خلال 7 أيام عمل"}),f(""),v()}catch(m){c({variant:"destructive",title:"خطأ",description:m.message||"فشل في إرسال طلب السحب"})}};return!t?.isAffiliate&&t?.role!=="affiliate"?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(h,{variant:"destructive",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(u,{children:"هذه الصفحة متاحة للمسوقين فقط"})]})}):k?e.jsx("div",{className:"container mx-auto px-4 py-8 flex justify-center items-center min-h-[400px]",children:e.jsx(F,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"سحب الأرباح"}),e.jsx("p",{className:"text-muted-foreground",children:"اسحب عمولاتك بسهولة وأمان"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3 mb-8",children:[e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-500/10 rounded-lg",children:e.jsx(P,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"الرصيد المتاح"}),e.jsxs("p",{className:"text-2xl font-bold",children:[o.toFixed(2)," ج.م"]})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-yellow-500/10 rounded-lg",children:e.jsx(L,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"قيد المراجعة"}),e.jsx("p",{className:"text-2xl font-bold",children:"500.00 ج.م"})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-500/10 rounded-lg",children:e.jsx(T,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي المسحوبات"}),e.jsx("p",{className:"text-2xl font-bold",children:"5,000 ج.م"})]})]})})})]}),e.jsxs(n,{className:"mb-6",children:[e.jsxs(b,{children:[e.jsx(w,{children:"طلب سحب جديد"}),e.jsxs(B,{children:["الحد الأدنى للسحب: ",a," ج.م"]})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"amount",children:"المبلغ (ج.م)"}),e.jsx(I,{id:"amount",type:"number",value:r,onChange:s=>f(s.target.value),placeholder:`أدخل المبلغ (الحد الأدنى ${a} ج.م)`,min:a,max:o})]}),e.jsxs("div",{children:[e.jsx(y,{children:"طريقة الاستلام"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[e.jsx(j,{variant:i==="bank"?"default":"outline",onClick:()=>g("bank"),className:"w-full",children:"حساب بنكي"}),e.jsx(j,{variant:i==="wallet"?"default":"outline",onClick:()=>g("wallet"),className:"w-full",children:"محفظة إلكترونية"})]})]}),i==="bank"&&e.jsx(h,{children:e.jsx(u,{children:"سيتم التحويل للحساب البنكي المسجل في ملفك الشخصي"})}),i==="wallet"&&e.jsx(h,{children:e.jsx(u,{children:"متاح قريباً: فودافون كاش، إنستاباي، فوري"})}),e.jsx(j,{onClick:D,disabled:!r||parseFloat(r)<a||parseFloat(r)>o,className:"w-full",children:"طلب السحب"})]})]}),e.jsxs(n,{children:[e.jsx(b,{children:e.jsx(w,{children:"طلبات السحب السابقة"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:x&&x.length>0?x.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.amount," ج.م"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString("ar")})]}),e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${s.status==="completed"?"bg-green-500/10 text-green-700":s.status==="rejected"?"bg-red-500/10 text-red-700":"bg-yellow-500/10 text-yellow-700"}`,children:s.status==="completed"?"مكتمل":s.status==="rejected"?"مرفوض":"قيد المراجعة"})]},s.id)):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"لا توجد طلبات سحب سابقة"})})})]})]})}export{z as default};
