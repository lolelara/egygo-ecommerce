import{r as u,j as e,ae as H,a0 as ne,n as L,b3 as ce,b6 as ie,ab as G,au as le,b5 as M,ah as de}from"./vendor-react-wP-gPk8e.js";import{o as oe,u as me,C as i,f as l,e as h,r as w,s as y,H as I,L as O,I as A,A as he,B as U}from"./index-BjwBfcA6.js";import{T as xe,a as ue,b,c as D}from"./tabs-W766L0g2.js";import{A as pe,D as je,C as ge,I as Q,Q as g}from"./vendor-appwrite-BGb_FC-V.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-GexG3wnZ.js";import"./vendor-other-DcnDEVts.js";import"./vendor-animations-W1Z2cmit.js";const W=new ge,fe="https://fra.cloud.appwrite.io/v1",Ne="68d8b9db00134c41e7c8";W.setEndpoint(fe).setProject(Ne);const ve=new pe(W),d=new je(W),o="68de037e003bd03c4d45",J="users",V="orders",$="wishlist",P="addresses",we="products",p={async getUserProfile(t){try{return(await d.listDocuments(o,J,[g.equal("email",t)])).documents[0]||null}catch(r){return console.error("Error fetching user profile:",r),null}},async updateUserProfile(t,r){try{return await d.updateDocument(o,J,t,r)}catch(a){throw console.error("Error updating user profile:",a),a}},async getUserOrders(t){try{return(await d.listDocuments(o,V,[g.equal("userId",t),g.orderDesc("$createdAt"),g.limit(20)])).documents}catch(r){return console.error("Error fetching orders:",r),[]}},async getOrderDetails(t){try{return await d.getDocument(o,V,t)}catch(r){return console.error("Error fetching order details:",r),null}},async getUserWishlist(t){try{const r=await d.listDocuments(o,$,[g.equal("userId",t),g.orderDesc("$createdAt")]);return await Promise.all(r.documents.map(async f=>{var N;try{const x=await d.getDocument(o,we,f.productId);return{...f,productName:x.name,productPrice:x.price,productImage:((N=x.images)==null?void 0:N[0])||x.image,inStock:x.stock>0}}catch{return f}}))}catch(r){return console.error("Error fetching wishlist:",r),[]}},async addToWishlist(t,r){try{return await d.createDocument(o,$,Q.unique(),{userId:t,productId:r,createdAt:new Date().toISOString()})}catch(a){throw console.error("Error adding to wishlist:",a),a}},async removeFromWishlist(t){try{return await d.deleteDocument(o,$,t),!0}catch(r){throw console.error("Error removing from wishlist:",r),r}},async getUserAddresses(t){try{return(await d.listDocuments(o,P,[g.equal("userId",t),g.orderDesc("isDefault")])).documents}catch(r){return console.error("Error fetching addresses:",r),[]}},async addAddress(t,r){try{return await d.createDocument(o,P,Q.unique(),{userId:t,...r,createdAt:new Date().toISOString()})}catch(a){throw console.error("Error adding address:",a),a}},async updateAddress(t,r){try{return await d.updateDocument(o,P,t,r)}catch(a){throw console.error("Error updating address:",a),a}},async deleteAddress(t){try{return await d.deleteDocument(o,P,t),!0}catch(r){throw console.error("Error deleting address:",r),r}},async getUserStats(t){try{const r=await this.getUserOrders(t),a=await this.getUserWishlist(t),f=r.length,N=r.filter(j=>{var n;return["pending","processing","shipped"].includes((n=j.status)==null?void 0:n.toLowerCase())}).length,x=r.filter(j=>{var n;return((n=j.status)==null?void 0:n.toLowerCase())==="delivered"}).length,C=r.reduce((j,n)=>j+(n.total||n.totalAmount||0),0);return{totalOrders:f,activeOrders:N,completedOrders:x,totalSpent:C,savedItems:a.length,reviews:0}}catch(r){return console.error("Error calculating user stats:",r),{totalOrders:0,activeOrders:0,completedOrders:0,totalSpent:0,savedItems:0,reviews:0}}}};function Ae(){const{user:t}=oe(),{toast:r}=me(),[a,f]=u.useState("profile"),[N,x]=u.useState(!0),[C,j]=u.useState(!1),[n,K]=u.useState(null),[_,X]=u.useState([]),[k,F]=u.useState([]),[R,q]=u.useState([]),[S,B]=u.useState({totalOrders:0,activeOrders:0,completedOrders:0,totalSpent:0,savedItems:0,reviews:0}),[m,E]=u.useState({name:"",phone:"",birthdate:""});u.useEffect(()=>{t&&z()},[t]);const z=async()=>{if(t){x(!0);try{const s=await p.getUserProfile(t.email);s&&(K(s),E({name:s.name||t.name||"",phone:s.phone||"",birthdate:s.birthdate||""}));const c=await p.getUserOrders(t.$id);X(c);const v=await p.getUserWishlist(t.$id);F(v);const re=await p.getUserAddresses(t.$id);q(re);const ae=await p.getUserStats(t.$id);B(ae)}catch(s){console.error("Error loading data:",s),r({title:"خطأ في التحميل",description:"حدث خطأ أثناء تحميل البيانات",variant:"destructive"})}finally{x(!1)}}},Y=async()=>{if(n!=null&&n.$id){j(!0);try{m.name!==(t==null?void 0:t.name)&&await ve.updateName(m.name),await p.updateUserProfile(n.$id,{name:m.name,phone:m.phone,birthdate:m.birthdate,updatedAt:new Date().toISOString()}),r({title:"تم التحديث",description:"تم تحديث معلوماتك بنجاح"}),await z()}catch(s){console.error("Error updating profile:",s),r({title:"خطأ",description:"حدث خطأ في تحديث المعلومات",variant:"destructive"})}finally{j(!1)}}},Z=async s=>{try{await p.removeFromWishlist(s),r({title:"تم الحذف",description:"تم إزالة المنتج من المفضلة"});const c=await p.getUserWishlist((t==null?void 0:t.$id)||"");F(c),B(v=>({...v,savedItems:c.length}))}catch{r({title:"خطأ",description:"حدث خطأ في إزالة المنتج",variant:"destructive"})}},ee=async s=>{try{await p.deleteAddress(s),r({title:"تم الحذف",description:"تم حذف العنوان بنجاح"});const c=await p.getUserAddresses((t==null?void 0:t.$id)||"");q(c)}catch{r({title:"خطأ",description:"حدث خطأ في حذف العنوان",variant:"destructive"})}},se=s=>s?new Date(s).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric"}):"",T=s=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(s||0),te=s=>{const v={pending:{label:"قيد الانتظار",variant:"secondary"},processing:{label:"قيد المعالجة",variant:"default"},shipped:{label:"تم الشحن",variant:"default"},delivered:{label:"تم التوصيل",variant:"success"},cancelled:{label:"ملغي",variant:"destructive"}}[s==null?void 0:s.toLowerCase()]||{label:s||"غير محدد",variant:"secondary"};return e.jsx(U,{variant:v.variant,children:v.label})};return N?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(H,{className:"h-8 w-8 animate-spin text-primary"})}):t?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"حسابي"}),e.jsxs("p",{className:"text-muted-foreground",children:["مرحباً ",(t==null?void 0:t.name)||(t==null?void 0:t.email)," - إدارة معلوماتك وطلباتك"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-8",children:[e.jsx(i,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي الطلبات"}),e.jsx("p",{className:"text-2xl font-bold",children:S.totalOrders})]}),e.jsx(L,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(i,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"طلبات نشطة"}),e.jsx("p",{className:"text-2xl font-bold",children:S.activeOrders})]}),e.jsx(ce,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(i,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي المشتريات"}),e.jsx("p",{className:"text-2xl font-bold",children:T(S.totalSpent)})]}),e.jsx(ie,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(i,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"المفضلة"}),e.jsx("p",{className:"text-2xl font-bold",children:S.savedItems})]}),e.jsx(G,{className:"h-8 w-8 text-muted-foreground"})]})})})]}),e.jsxs(xe,{value:a,onValueChange:f,children:[e.jsxs(ue,{className:"grid w-full grid-cols-5",children:[e.jsx(b,{value:"profile",children:"الملف الشخصي"}),e.jsx(b,{value:"orders",children:"طلباتي"}),e.jsx(b,{value:"wishlist",children:"المفضلة"}),e.jsx(b,{value:"addresses",children:"العناوين"}),e.jsx(b,{value:"settings",children:"الإعدادات"})]}),e.jsx(D,{value:"profile",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"المعلومات الشخصية"}),e.jsx(I,{children:"قم بتحديث معلوماتك الشخصية"})]}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"name",children:"الاسم الكامل"}),e.jsx(A,{id:"name",value:m.name,onChange:s=>E({...m,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"email",children:"البريد الإلكتروني"}),e.jsx(A,{id:"email",type:"email",value:(t==null?void 0:t.email)||"",disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"phone",children:"رقم الهاتف"}),e.jsx(A,{id:"phone",value:m.phone,onChange:s=>E({...m,phone:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"birthdate",children:"تاريخ الميلاد"}),e.jsx(A,{id:"birthdate",type:"date",value:m.birthdate,onChange:s=>E({...m,birthdate:s.target.value})})]})]}),e.jsxs(h,{onClick:Y,disabled:C,children:[C&&e.jsx(H,{className:"ml-2 h-4 w-4 animate-spin"}),"حفظ التغييرات"]})]})]})}),e.jsx(D,{value:"orders",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"طلباتي"}),e.jsx(I,{children:"تتبع وإدارة طلباتك"})]}),e.jsx(l,{children:_.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد طلبات حتى الآن"}),e.jsx(h,{className:"mt-4",onClick:()=>window.location.href="/products",children:"تسوق الآن"})]}):e.jsx("div",{className:"space-y-4",children:_.map(s=>{var c;return e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 rounded bg-gray-100 flex items-center justify-center",children:e.jsx(L,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["#",s.orderNumber||s.$id.slice(-6)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[((c=s.items)==null?void 0:c.length)||0," منتجات - ",se(s.$createdAt)]}),te(s.status)]})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-lg font-bold",children:T(s.total||s.totalAmount||0)}),e.jsxs(h,{variant:"outline",size:"sm",className:"mt-2",children:[e.jsx(le,{className:"h-4 w-4 ml-1"}),"التفاصيل"]})]})]},s.$id)})})})]})}),e.jsx(D,{value:"wishlist",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"قائمة المفضلة"}),e.jsx(I,{children:"المنتجات التي قمت بحفظها"})]}),e.jsx(l,{children:k.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(G,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"قائمة المفضلة فارغة"}),e.jsx(h,{className:"mt-4",onClick:()=>window.location.href="/products",children:"اكتشف المنتجات"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:k.map(s=>e.jsx(i,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("img",{src:s.productImage||he.product(s.productName),alt:s.productName,className:"w-full h-40 object-cover rounded mb-3"}),e.jsx("h4",{className:"font-semibold mb-2",children:s.productName}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-lg font-bold",children:T(s.productPrice)}),e.jsx(U,{variant:s.inStock?"default":"secondary",children:s.inStock?"متوفر":"نفذ"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-3",children:[e.jsx(h,{size:"sm",disabled:!s.inStock,children:"أضف للسلة"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>Z(s.$id),children:"إزالة"})]})]})},s.$id))})})]})}),e.jsx(D,{value:"addresses",className:"space-y-4",children:e.jsxs(i,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(y,{children:"عناويني"}),e.jsx(I,{children:"إدارة عناوين الشحن"})]}),e.jsxs(h,{children:[e.jsx(M,{className:"h-4 w-4 ml-2"}),"إضافة عنوان"]})]})}),e.jsx(l,{children:R.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد عناوين محفوظة"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:R.map(s=>e.jsx(i,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.label}),s.isDefault&&e.jsx(U,{variant:"secondary",className:"mt-1",children:"العنوان الافتراضي"})]})}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:[s.street,", ",s.city,", ",s.country]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.phone}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"outline",size:"sm",children:"تعديل"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>ee(s.$id),children:"حذف"})]})]})},s.$id))})})]})}),e.jsx(D,{value:"settings",className:"space-y-4",children:e.jsxs(i,{children:[e.jsx(w,{children:e.jsx(y,{children:"الأمان"})}),e.jsx(l,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"تغيير كلمة المرور"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"قم بتحديث كلمة المرور الخاصة بك"})]}),e.jsxs(h,{variant:"outline",children:[e.jsx(de,{className:"h-4 w-4 ml-2"}),"تغيير"]})]})})]})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsx(i,{className:"max-w-md w-full",children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(ne,{className:"h-12 w-12 text-yellow-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"يرجى تسجيل الدخول"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"يجب عليك تسجيل الدخول للوصول إلى حسابك"}),e.jsx(h,{onClick:()=>window.location.href="/login",children:"تسجيل الدخول"})]})})})})}export{Ae as default};
