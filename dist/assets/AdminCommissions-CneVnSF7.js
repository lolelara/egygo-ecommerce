import{r as j,j as e,by as A,_ as P,bz as G,z as S,p as I,U as H,k as q,X as R}from"./vendor-react-CCFRLLzk.js";import{A as M}from"./AdminLayout-Br9nuQvC.js";import{f as p,C as l,x as r,y as n,h as i,I as X,S as _,i as J,j as K,k as Q,l as u,B as g}from"./index-D7NOjX7I.js";import{T as W,a as Y,b as T,c,d as Z,e as d}from"./table-Z49QUUEs.js";import{e as k}from"./admin-api-CLVNj70g.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-other-CzBBjgu5.js";import"./vendor-animations-CPHPqPXb.js";import"./avatar-CwtoJR-j.js";import"./vendor-appwrite-CuqfvTq9.js";import"./appwrite-client-DFce-dPK.js";const $=({status:a})=>{const x={PENDING:{label:"في الانتظار",variant:"secondary",icon:G},APPROVED:{label:"موافق عليها",variant:"default",icon:S},PAID:{label:"مدفوعة",variant:"secondary",icon:A},CANCELLED:{label:"ملغية",variant:"destructive",icon:R}},f=x[a]||x.PENDING,N=f.icon;return e.jsxs(g,{variant:f.variant,className:"flex items-center gap-1",children:[e.jsx(N,{className:"h-3 w-3"}),f.label]})};function me(){const[a,x]=j.useState([]),[f,N]=j.useState(!0),[o,V]=j.useState(""),[v,z]=j.useState("all");j.useEffect(()=>{(async()=>{N(!0);try{const t=await k.getAll();x(t)}catch(t){console.error("Error fetching commissions:",t),x([])}finally{N(!1)}})()},[]);const E=a.filter(s=>{const t=s.affiliate.name.toLowerCase().includes(o.toLowerCase())||s.affiliate.email.toLowerCase().includes(o.toLowerCase())||s.affiliate.affiliateCode.toLowerCase().includes(o.toLowerCase())||s.order.orderNumber.toLowerCase().includes(o.toLowerCase()),h=v==="all"||s.status===v;return t&&h}),C=async(s,t)=>{try{await k.updateStatus(s,t),x(h=>h.map(y=>y.id===s?{...y,status:t,updatedAt:new Date().toISOString()}:y))}catch(h){console.error("Error updating commission status:",h)}},m=a.length,D=a.filter(s=>s.status==="PENDING"),w=a.filter(s=>s.status==="APPROVED"),b=a.filter(s=>s.status==="PAID"),L=a.reduce((s,t)=>s+t.amount,0),O=D.reduce((s,t)=>s+t.amount,0),B=w.reduce((s,t)=>s+t.amount,0),F=b.reduce((s,t)=>s+t.amount,0),U=new Set(a.map(s=>s.affiliateId)).size;return e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"إدارة العمولات"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(p,{variant:"outline",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"دفع العمولات المعتمدة"]})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"إجمالي العمولات"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[L.toLocaleString()," ج.م إجمالي"]})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"في الانتظار"}),e.jsx(G,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:D.length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[O.toLocaleString()," ج.م"]})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"معتمدة"}),e.jsx(S,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[B.toLocaleString()," ج.م جاهزة للدفع"]})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"مدفوعة"}),e.jsx(I,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b.length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[F.toLocaleString()," ج.م مدفوعة"]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"الشركاء النشطين"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:U}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"لديهم عمولات هذا الشهر"})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"متوسط العمولة"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(i,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[m>0?(L/m).toFixed(2):"0"," ","ج.م"]})})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"معدل الموافقة"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(i,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[m>0?Math.round((w.length+b.length)/m*100):0,"%"]})})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(X,{placeholder:"البحث في العمولات...",value:o,onChange:s=>V(s.target.value),className:"pl-10"})]})}),e.jsxs(_,{value:v,onValueChange:z,children:[e.jsx(J,{className:"w-48",children:e.jsx(K,{placeholder:"حالة العمولة"})}),e.jsxs(Q,{children:[e.jsx(u,{value:"all",children:"جميع الحالات"}),e.jsx(u,{value:"PENDING",children:"في الانتظار"}),e.jsx(u,{value:"APPROVED",children:"معتمدة"}),e.jsx(u,{value:"PAID",children:"مدفوعة"}),e.jsx(u,{value:"CANCELLED",children:"ملغية"})]})]})]}),e.jsxs(l,{children:[e.jsx(r,{children:e.jsxs(n,{children:["العمولات (",E.length,")"]})}),e.jsx(i,{children:e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(T,{children:[e.jsx(c,{children:"الشريك"}),e.jsx(c,{children:"الطلب"}),e.jsx(c,{children:"المنتج"}),e.jsx(c,{children:"المبلغ"}),e.jsx(c,{children:"النسبة"}),e.jsx(c,{children:"الحالة"}),e.jsx(c,{children:"التاريخ"}),e.jsx(c,{className:"text-center",children:"الإجراءات"})]})}),e.jsx(Z,{children:E.map(s=>{var t;return e.jsxs(T,{children:[e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.affiliate.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.affiliate.affiliateCode})]})}),e.jsx(d,{children:e.jsx(g,{variant:"outline",children:s.order.orderNumber})}),e.jsx(d,{children:e.jsx("div",{className:"text-sm",children:((t=s.product)==null?void 0:t.name)||"غير محدد"})}),e.jsx(d,{children:e.jsxs("div",{className:"font-medium",children:[s.amount.toFixed(2)," ج.م"]})}),e.jsxs(d,{children:[s.percentage,"%"]}),e.jsx(d,{children:e.jsx($,{status:s.status})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-sm",children:new Date(s.createdAt).toLocaleDateString("ar-EG")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>C(s.id,"APPROVED"),children:e.jsx(S,{className:"h-4 w-4 text-green-600"})}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>C(s.id,"CANCELLED"),children:e.jsx(R,{className:"h-4 w-4 text-red-600"})})]}),s.status==="APPROVED"&&e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>C(s.id,"PAID"),children:[e.jsx(A,{className:"h-4 w-4"}),"دفع"]}),s.status==="PAID"&&e.jsx(g,{variant:"secondary",children:"تم الدفع"}),s.status==="CANCELLED"&&e.jsx(g,{variant:"destructive",children:"ملغية"})]})})]},s.id)})})]})})]})]})})}export{me as default};
