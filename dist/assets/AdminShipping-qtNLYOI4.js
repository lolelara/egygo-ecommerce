import{r,j as e,a_ as fe,bi as Ne,n as Q,b7 as I,az as Y,b8 as _,k as ye,au as De,a0 as be}from"./vendor-react-BMq-IxHG.js";import{u as we,d as U,c as M,D as Se,F as Ce,e as p,t as Te,v as Ae,w as Oe,L as E,I as T,C as o,r as m,s as h,f as x,B as Z}from"./index-D6krH_cr.js";import{S as J,a as K,b as W,c as X,d as c}from"./select-BsjZPLk-.js";import{T as ke,a as Me,b as P,c as g,d as Ee,e as u}from"./table-BYZ2m4xu.js";import{P as Pe}from"./progress-c0YiQrhI.js";import{Q as y}from"./vendor-appwrite-BGb_FC-V.js";import{Z as Re,aE as Fe}from"./vendor-other-C5r3s8Py.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-GexG3wnZ.js";import"./vendor-animations-W1Z2cmit.js";function Je(){const[B,R]=r.useState([]),[F,ee]=r.useState([]),[se,z]=r.useState([]),[v,te]=r.useState({totalOrders:0,pendingShipment:0,inTransit:0,delivered:0,averageDeliveryTime:0,onTimeDeliveryRate:0}),[$e,ae]=r.useState(null),[Le,Ie]=r.useState([]),[Be,ie]=r.useState(!1),[le,$]=r.useState(!1),[A,re]=r.useState(""),[f,ne]=r.useState("all"),[d,ce]=r.useState(1),[N,de]=r.useState(1),[H,oe]=r.useState(0),[O,V]=r.useState(!1),D=20,{toast:b}=we(),[w,S]=r.useState({name:"",description:"",cost:0,estimatedDays:1,supportedRegions:[],isActive:!0});r.useEffect(()=>{C(),me()},[]),r.useEffect(()=>{he()},[F]),r.useEffect(()=>{C(1)},[f]);const C=async(s=1)=>{V(!0);try{const t=(s-1)*D,i=[y.orderDesc("$createdAt"),y.limit(D),y.offset(t)];f!=="all"&&i.push(y.equal("status",f));const j=await U.listDocuments(M.databaseId,M.collections.orders,i),k=j.documents.map(a=>({id:a.$id,orderNumber:a.orderNumber||`EGY-${a.$id.slice(0,8)}`,customerName:a.customerName||"غير محدد",customerEmail:a.customerEmail||"",customerPhone:a.customerPhone||"",shippingAddress:a.shippingAddress||{street:"",city:"",state:"",postalCode:"",country:"مصر"},items:a.items||[],total:a.totalAmount||0,status:a.status||"pending",shippingMethod:a.shippingMethod||"standard",trackingNumber:a.trackingNumber,estimatedDelivery:a.estimatedDelivery?new Date(a.estimatedDelivery):void 0,actualDelivery:a.actualDelivery?new Date(a.actualDelivery):void 0,createdAt:new Date(a.$createdAt),updatedAt:new Date(a.$updatedAt)}));if(R(k),oe(j.total),de(Math.ceil(j.total/D)),ce(s),s===1){const L=(await U.listDocuments(M.databaseId,M.collections.orders,[y.orderDesc("$createdAt"),y.limit(1e3)])).documents.map(l=>({id:l.$id,orderNumber:l.orderNumber||`EGY-${l.$id.slice(0,8)}`,customerName:l.customerName||"غير محدد",customerEmail:l.customerEmail||"",customerPhone:l.customerPhone||"",shippingAddress:l.shippingAddress||{street:"",city:"",state:"",postalCode:"",country:"مصر"},items:l.items||[],total:l.totalAmount||0,status:l.status||"pending",shippingMethod:l.shippingMethod||"standard",trackingNumber:l.trackingNumber,estimatedDelivery:l.estimatedDelivery?new Date(l.estimatedDelivery):void 0,actualDelivery:l.actualDelivery?new Date(l.actualDelivery):void 0,createdAt:new Date(l.$createdAt),updatedAt:new Date(l.$updatedAt)}));ee(L)}k.length===0&&console.log("No orders found")}catch(t){console.error("Error loading orders:",t),b({title:"خطأ",description:"فشل في تحميل الطلبات",variant:"destructive"}),R([])}finally{V(!1)}},me=async()=>{try{z([{id:"1",name:"الشحن السريع",description:"توصيل خلال 24 ساعة",cost:100,estimatedDays:1,isActive:!0,supportedRegions:["القاهرة","الجيزة"]},{id:"2",name:"الشحن العادي",description:"توصيل خلال 3-5 أيام",cost:50,estimatedDays:3,isActive:!0,supportedRegions:["جميع المحافظات"]},{id:"3",name:"الشحن الاقتصادي",description:"توصيل خلال 7-10 أيام",cost:25,estimatedDays:7,isActive:!0,supportedRegions:["جميع المحافظات"]}])}catch(s){console.error("Failed to load shipping methods:",s)}},he=async()=>{try{const s=F.length>0?F:B,t=s.length,i=s.filter(n=>n.status==="pending"||n.status==="processing").length,j=s.filter(n=>n.status==="shipped").length,k=s.filter(n=>n.status==="delivered").length,a=s.filter(n=>n.status==="delivered"&&n.actualDelivery&&n.createdAt),L=a.length>0?a.reduce((n,G)=>{const ve=Math.ceil((G.actualDelivery.getTime()-G.createdAt.getTime())/864e5);return n+ve},0)/a.length:0,l=a.filter(n=>!n.estimatedDelivery||!n.actualDelivery?!1:n.actualDelivery<=n.estimatedDelivery).length,ge=a.length>0?l/a.length*100:0;te({totalOrders:t,pendingShipment:i,inTransit:j,delivered:k,averageDeliveryTime:L,onTimeDeliveryRate:ge})}catch(s){console.error("Failed to load stats:",s)}},xe=async(s,t)=>{try{R(i=>i.map(j=>j.id===s?{...j,status:t,updatedAt:new Date}:j)),b({title:"نجح",description:"تم تحديث حالة الطلب بنجاح"})}catch{b({title:"خطأ",description:"فشل في تحديث حالة الطلب",variant:"destructive"})}},ue=async()=>{try{const s={id:Date.now().toString(),...w};z(t=>[...t,s]),S({name:"",description:"",cost:0,estimatedDays:1,supportedRegions:[],isActive:!0}),$(!1),b({title:"نجح",description:"تم إنشاء طريقة الشحن بنجاح"})}catch{b({title:"خطأ",description:"فشل في إنشاء طريقة الشحن",variant:"destructive"})}},je=s=>{const t={pending:{label:"في الانتظار",variant:"secondary"},processing:{label:"قيد المعالجة",variant:"default"},shipped:{label:"تم الشحن",variant:"default"},delivered:{label:"تم التسليم",variant:"default"},cancelled:{label:"ملغي",variant:"destructive"}},i=t[s]||t.pending;return e.jsx(Z,{variant:i.variant,children:i.label})},pe=s=>{switch(s){case"pending":return e.jsx(I,{className:"w-4 h-4"});case"processing":return e.jsx(Q,{className:"w-4 h-4"});case"shipped":return e.jsx(Y,{className:"w-4 h-4"});case"delivered":return e.jsx(_,{className:"w-4 h-4"});case"cancelled":return e.jsx(be,{className:"w-4 h-4"});default:return e.jsx(I,{className:"w-4 h-4"})}},q=B.filter(s=>{const t=s.orderNumber.toLowerCase().includes(A.toLowerCase())||s.customerName.toLowerCase().includes(A.toLowerCase())||s.customerEmail.toLowerCase().includes(A.toLowerCase()),i=f==="all"||s.status===f;return t&&i});return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"إدارة الشحن والتتبع"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(Se,{open:le,onOpenChange:$,children:[e.jsx(Ce,{asChild:!0,children:e.jsxs(p,{variant:"outline",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"إضافة طريقة شحن"]})}),e.jsxs(Te,{children:[e.jsx(Ae,{children:e.jsx(Oe,{children:"إضافة طريقة شحن جديدة"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"methodName",children:"اسم طريقة الشحن"}),e.jsx(T,{id:"methodName",value:w.name,onChange:s=>S(t=>({...t,name:s.target.value})),placeholder:"الشحن السريع"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"methodDescription",children:"الوصف"}),e.jsx(T,{id:"methodDescription",value:w.description,onChange:s=>S(t=>({...t,description:s.target.value})),placeholder:"توصيل خلال 24 ساعة"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"methodCost",children:"التكلفة (جنيه)"}),e.jsx(T,{id:"methodCost",type:"number",value:w.cost,onChange:s=>S(t=>({...t,cost:parseFloat(s.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"estimatedDays",children:"الأيام المتوقعة"}),e.jsx(T,{id:"estimatedDays",type:"number",value:w.estimatedDays,onChange:s=>S(t=>({...t,estimatedDays:parseInt(s.target.value)||1}))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{variant:"outline",onClick:()=>$(!1),children:"إلغاء"}),e.jsx(p,{onClick:ue,children:"إضافة"})]})]})]})]}),e.jsxs(p,{children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"تصدير التقرير"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"إجمالي الطلبات"}),e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.totalOrders})})]}),e.jsxs(o,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"في الانتظار"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.pendingShipment})})]}),e.jsxs(o,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"قيد النقل"}),e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.inTransit})})]}),e.jsxs(o,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"تم التسليم"}),e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.delivered})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(h,{children:"متوسط وقت التسليم"})}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-3xl font-bold",children:[v.averageDeliveryTime," أيام"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"متوسط الوقت من الشحن إلى التسليم"})]})]}),e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(h,{children:"معدل التسليم في الوقت"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"معدل التسليم في الوقت"}),e.jsxs("span",{children:[v.onTimeDeliveryRate,"%"]})]}),e.jsx(Pe,{value:v.onTimeDeliveryRate,className:"h-2"})]})})]})]}),e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(h,{children:"فلترة الطلبات"})}),e.jsx(x,{children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(T,{placeholder:"البحث في رقم الطلب، اسم العميل، أو البريد الإلكتروني...",value:A,onChange:s=>re(s.target.value),className:"pl-10"})]})}),e.jsxs(J,{value:f,onValueChange:ne,children:[e.jsx(K,{className:"w-48",children:e.jsx(W,{placeholder:"فلترة حسب الحالة"})}),e.jsxs(X,{children:[e.jsx(c,{value:"all",children:"جميع الحالات"}),e.jsx(c,{value:"pending",children:"في الانتظار"}),e.jsx(c,{value:"processing",children:"قيد المعالجة"}),e.jsx(c,{value:"shipped",children:"تم الشحن"}),e.jsx(c,{value:"delivered",children:"تم التسليم"}),e.jsx(c,{value:"cancelled",children:"ملغي"})]})]})]})})]}),e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(h,{children:"الطلبات"})}),e.jsxs(x,{children:[e.jsxs(ke,{children:[e.jsx(Me,{children:e.jsxs(P,{children:[e.jsx(g,{children:"رقم الطلب"}),e.jsx(g,{children:"العميل"}),e.jsx(g,{children:"العنوان"}),e.jsx(g,{children:"المبلغ"}),e.jsx(g,{children:"الحالة"}),e.jsx(g,{children:"رقم التتبع"}),e.jsx(g,{children:"تاريخ الإنشاء"}),e.jsx(g,{children:"الإجراءات"})]})}),e.jsx(Ee,{children:O?e.jsx(P,{children:e.jsx(u,{colSpan:8,className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{children:"جاري التحميل..."})]})})}):q.length===0?e.jsx(P,{children:e.jsx(u,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"لا توجد طلبات"})}):q.map(s=>e.jsxs(P,{children:[e.jsx(u,{children:e.jsx("div",{className:"font-medium",children:s.orderNumber})}),e.jsx(u,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customerName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.customerEmail})]})}),e.jsx(u,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:s.shippingAddress.street}),e.jsxs("div",{children:[s.shippingAddress.city,", ",s.shippingAddress.state]})]})}),e.jsx(u,{children:e.jsxs("div",{className:"font-medium",children:[s.total.toLocaleString()," جنيه"]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[pe(s.status),je(s.status)]})}),e.jsx(u,{children:s.trackingNumber?e.jsx("code",{className:"bg-muted px-2 py-1 rounded text-sm",children:s.trackingNumber}):e.jsx("span",{className:"text-muted-foreground",children:"غير متوفر"})}),e.jsx(u,{children:Re(s.createdAt,"dd/MM/yyyy",{locale:Fe})}),e.jsx(u,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{ae(s),ie(!0)},children:e.jsx(De,{className:"w-4 h-4"})}),e.jsxs(J,{value:s.status,onValueChange:t=>xe(s.id,t),children:[e.jsx(K,{className:"w-32",children:e.jsx(W,{})}),e.jsxs(X,{children:[e.jsx(c,{value:"pending",children:"في الانتظار"}),e.jsx(c,{value:"processing",children:"قيد المعالجة"}),e.jsx(c,{value:"shipped",children:"تم الشحن"}),e.jsx(c,{value:"delivered",children:"تم التسليم"}),e.jsx(c,{value:"cancelled",children:"ملغي"})]})]})]})})]},s.id))})]}),N>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["عرض ",(d-1)*D+1," إلى ",Math.min(d*D,H)," من ",H," طلب"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>C(d-1),disabled:d===1||O,children:"السابق"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,N)},(s,t)=>{let i;return N<=5||d<=3?i=t+1:d>=N-2?i=N-4+t:i=d-2+t,e.jsx(p,{variant:d===i?"default":"outline",size:"sm",onClick:()=>C(i),disabled:O,className:"w-10",children:i},i)})}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>C(d+1),disabled:d===N||O,children:"التالي"})]})]})]})]}),e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(h,{children:"طرق الشحن المتاحة"})}),e.jsx(x,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:se.map(s=>e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(h,{className:"text-lg",children:s.name})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"التكلفة:"}),e.jsxs("span",{className:"font-medium",children:[s.cost," جنيه"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"الوقت المتوقع:"}),e.jsxs("span",{className:"font-medium",children:[s.estimatedDays," أيام"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"الحالة:"}),e.jsx(Z,{variant:s.isActive?"default":"secondary",children:s.isActive?"نشط":"غير نشط"})]})]})})]},s.id))})})]})]})}export{Je as default};
