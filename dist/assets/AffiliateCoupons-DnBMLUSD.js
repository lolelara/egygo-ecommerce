import{l as P,W as Q,r as b,m as M,Y as y,j as e,b8 as C,bp as U,bU as k,_ as B,bV as K,bC as O,aZ as _}from"./vendor-react-CCFRLLzk.js";import{c as z,u as V,C as d,x as f,y as N,P as D,h as o,f as n,L as c,I as m,S as R,i as G,j as H,k as W,l as w,B as u,d as x}from"./index-D7NOjX7I.js";import{I as Y,Q as S}from"./vendor-appwrite-CuqfvTq9.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-other-CzBBjgu5.js";import"./vendor-animations-CPHPqPXb.js";const h="",p="coupons";function re(){const{user:a}=z(),{toast:l}=V(),L=P(),j=Q(),[Z,A]=b.useState(!1),[t,r]=b.useState({code:"",type:"percentage",value:10,expiryDate:"",usageLimit:100}),{data:g=[],isLoading:q}=M({queryKey:["affiliate-coupons",a==null?void 0:a.$id],queryFn:async()=>a!=null&&a.$id?(await x.listDocuments(h,p,[S.equal("affiliateId",a.$id),S.orderDesc("$createdAt")])).documents:[],enabled:!!(a!=null&&a.$id)}),v=y({mutationFn:async s=>{if(!(a!=null&&a.$id))throw new Error("User not found");const i={code:s.code.toUpperCase(),type:s.type,value:Number(s.value),expiryDate:s.expiryDate,usageLimit:Number(s.usageLimit),usageCount:0,affiliateId:a.$id,isActive:!0};return await x.createDocument(h,p,Y.unique(),i)},onSuccess:()=>{j.invalidateQueries({queryKey:["affiliate-coupons"]}),A(!1),r({code:"",type:"percentage",value:10,expiryDate:"",usageLimit:100}),l({title:"تم إنشاء الكوبون بنجاح!",description:"يمكنك مشاركة الكوبون مع عملائك الآن"})},onError:s=>{l({title:"خطأ",description:s.message||"فشل إنشاء الكوبون",variant:"destructive"})}}),F=y({mutationFn:async s=>{await x.deleteDocument(h,p,s)},onSuccess:()=>{j.invalidateQueries({queryKey:["affiliate-coupons"]}),l({title:"تم حذف الكوبون",description:"تم حذف الكوبون بنجاح"})}}),I=y({mutationFn:async({couponId:s,isActive:i})=>{await x.updateDocument(h,p,s,{isActive:!i})},onSuccess:()=>{j.invalidateQueries({queryKey:["affiliate-coupons"]})}}),$=s=>{if(s.preventDefault(),!t.code||!t.expiryDate){l({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}v.mutate(t)},E=s=>{navigator.clipboard.writeText(s),l({title:"تم النسخ!",description:`تم نسخ الكود: ${s}`})};return!(a!=null&&a.isAffiliate)&&(a==null?void 0:a.role)!=="affiliate"?e.jsx("div",{className:"container mx-auto px-4 py-16 text-center",children:e.jsxs(d,{className:"max-w-md mx-auto",children:[e.jsxs(f,{children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-4 text-orange-500"}),e.jsx(N,{children:"غير مصرح"}),e.jsx(D,{children:"هذه الصفحة متاحة فقط للمسوقين المفعلين"})]}),e.jsx(o,{children:e.jsx(n,{onClick:()=>L("/update-affiliate-prefs"),className:"w-full",children:"تفعيل حساب المسوق"})})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"كوبونات الخصم"}),e.jsx("p",{className:"text-muted-foreground",children:"أنشئ وأدر كوبونات الخصم الخاصة بك"})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs(d,{className:"lg:col-span-1",children:[e.jsx(f,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"إنشاء كوبون جديد"]})}),e.jsx(o,{children:e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"code",children:"كود الكوبون *"}),e.jsx(m,{id:"code",placeholder:"SUMMER2025",value:t.code,onChange:s=>r({...t,code:s.target.value.toUpperCase()}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"type",children:"نوع الخصم *"}),e.jsxs(R,{value:t.type,onValueChange:s=>r({...t,type:s}),children:[e.jsx(G,{children:e.jsx(H,{})}),e.jsxs(W,{children:[e.jsx(w,{value:"percentage",children:"نسبة مئوية (%)"}),e.jsx(w,{value:"fixed",children:"مبلغ ثابت (ج.م)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"value",children:["قيمة الخصم * ",t.type==="percentage"?"(%)":"(ج.م)"]}),e.jsx(m,{id:"value",type:"number",min:"1",max:t.type==="percentage"?"100":void 0,value:t.value,onChange:s=>r({...t,value:Number(s.target.value)}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"expiryDate",children:"تاريخ الانتهاء *"}),e.jsx(m,{id:"expiryDate",type:"date",value:t.expiryDate,onChange:s=>r({...t,expiryDate:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"usageLimit",children:"حد الاستخدام *"}),e.jsx(m,{id:"usageLimit",type:"number",min:"1",value:t.usageLimit,onChange:s=>r({...t,usageLimit:Number(s.target.value)}),required:!0})]}),e.jsx(n,{type:"submit",className:"w-full",disabled:v.isPending,children:v.isPending?"جاري الإنشاء...":"إنشاء كوبون"})]})})]}),e.jsx("div",{className:"lg:col-span-2 space-y-4",children:e.jsxs(d,{children:[e.jsxs(f,{children:[e.jsxs(N,{children:["كوبوناتي (",g.length,")"]}),e.jsx(D,{children:"جميع كوبونات الخصم التي أنشأتها"})]}),e.jsx(o,{children:q?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"جاري التحميل..."}):g.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لم تنشئ أي كوبونات بعد"}),e.jsx("p",{className:"text-sm mt-2",children:"ابدأ بإنشاء كوبون من النموذج على اليسار"})]}):e.jsx("div",{className:"space-y-3",children:g.map(s=>{const i=new Date(s.expiryDate)<new Date,T=s.usageCount/s.usageLimit*100;return e.jsx(d,{className:"border-l-4 border-l-orange-500",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("code",{className:"text-lg font-bold bg-muted px-3 py-1 rounded",children:s.code}),s.isActive&&!i?e.jsx(u,{className:"bg-green-500",children:"نشط"}):i?e.jsx(u,{variant:"destructive",children:"منتهي"}):e.jsx(u,{variant:"secondary",children:"متوقف"}),e.jsx(u,{variant:"outline",children:s.type==="percentage"?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),s.value,"%"]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),s.value," ج.م"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(K,{className:"h-4 w-4"}),"ينتهي: ",new Date(s.expiryDate).toLocaleDateString("ar-EG")]}),e.jsxs("div",{className:"text-muted-foreground",children:["الاستخدام: ",s.usageCount," / ",s.usageLimit]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500 transition-all",style:{width:`${T}%`}})})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",variant:"outline",onClick:()=>E(s.code),children:e.jsx(O,{className:"h-4 w-4"})}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>I.mutate({couponId:s.$id,isActive:s.isActive}),disabled:i,children:s.isActive?"إيقاف":"تفعيل"}),e.jsx(n,{size:"sm",variant:"destructive",onClick:()=>F.mutate(s.$id),children:e.jsx(_,{className:"h-4 w-4"})})]})]})})},s.$id)})})})]})})]})]})}export{re as default};
