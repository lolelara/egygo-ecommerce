import{r as x,j as e,B as l,X as O,I as H,L as U,a as v,u,b as K,c as X,d as j,A as L,C,e as k,f as w,T as P,g as S,S as A,M as G,P as J,D as V,h as W,i as Y,k as Z,l as _,m as ee,n as se,o as ae}from"./index-Ce-RwxJS.js";import{c as te}from"./coupons-api-KlkOGt2E.js";import{T}from"./tag-BB9opunb.js";import{S as le}from"./shopping-bag-CvqvafLt.js";function ne({cartTotal:m,onCouponApplied:c,onCouponRemoved:y,appliedCoupon:n}){const[o,r]=x.useState(""),[i,h]=x.useState(!1),d=async()=>{if(!o.trim()){u.error("يرجى إدخال كود الكوبون");return}h(!0);try{const a=await te.validateCoupon(o,m);a.valid&&a.coupon&&a.discount?(c(a.discount,a.coupon),u.success(a.message||"تم تطبيق الكوبون بنجاح!"),r("")):u.error(a.message||"الكوبون غير صالح")}catch(a){console.error("Error applying coupon:",a),u.error("حدث خطأ في تطبيق الكوبون")}finally{h(!1)}},p=()=>{y(),r(""),u.success("تم إزالة الكوبون")};return e.jsxs("div",{className:"space-y-3",children:[n?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-green-900",children:["كوبون مطبق: ",e.jsx("span",{className:"font-mono",children:n.code})]}),e.jsx("p",{className:"text-xs text-green-700",children:n.type==="percentage"?`خصم ${n.value}%`:`خصم ${n.value} ج.م`})]})]}),e.jsx(l,{variant:"ghost",size:"sm",onClick:p,className:"text-green-700 hover:text-green-900",children:e.jsx(O,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(T,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(H,{value:o,onChange:a=>r(a.target.value.toUpperCase()),placeholder:"أدخل كود الكوبون",className:"pr-10",disabled:i,onKeyPress:a=>{a.key==="Enter"&&d()}})]}),e.jsx(l,{onClick:d,disabled:i||!o.trim(),className:"min-w-[100px]",children:i?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 animate-spin ml-2"}),"جاري التطبيق"]}):"تطبيق"})]}),!n&&e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(v,{variant:"outline",className:"text-xs",children:"💡 استخدم كوبون للحصول على خصم"})})]})}function xe(){const{toast:m}=K(),{items:c,removeItem:y,updateQuantity:n,clearCart:o,subtotal:r}=X(),[i,h]=x.useState(null),[d,p]=x.useState(0),a=(s,t)=>{if(t<1)return;const b=c.find(M=>M.id===s);if(b){if(t>b.stockQuantity){m({title:"الكمية غير متوفرة",description:`الكمية المتوفرة فقط ${b.stockQuantity}`,variant:"destructive"});return}n(s,t)}},[R,g]=x.useState(!1),[z,D]=x.useState(null),q=s=>{D(s),g(!0)},$=()=>{z&&(y(z),m({title:"تمت الإزالة",description:"تم إزالة المنتج من السلة"})),g(!1),D(null)},B=()=>{o(),m({title:"تم إفراغ السلة",description:"تم إزالة جميع المنتجات من السلة"})},E=(s,t)=>{p(s),h(t)},Q=()=>{p(0),h(null)},I=c.reduce((s,t)=>s+(t.originalPrice||t.price)*t.quantity,0)-r,N=r-d,f=N>=500?0:50,F=N+f;return c.length===0?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto px-4 py-16",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"p-6 bg-muted rounded-full",children:e.jsx(le,{className:"h-16 w-16 text-muted-foreground"})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"سلة التسوق فارغة"}),e.jsx("p",{className:"text-muted-foreground",children:"لم تقم بإضافة أي منتجات إلى سلة التسوق بعد"})]}),e.jsx(l,{size:"lg",asChild:!0,children:e.jsxs(j,{to:"/products",children:["تصفح المنتجات",e.jsx(L,{className:"mr-2 h-5 w-5 rtl:mr-0 rtl:ml-2 rtl:rotate-180"})]})})]})})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"سلة التسوق"}),e.jsxs("p",{className:"text-muted-foreground",children:["لديك ",c.length," منتج في السلة"]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:e.jsxs(C,{children:[e.jsxs(k,{className:"flex flex-row items-center justify-between",children:[e.jsx(w,{children:"المنتجات"}),e.jsxs(l,{variant:"ghost",size:"sm",onClick:B,className:"text-destructive hover:text-destructive",children:[e.jsx(P,{className:"h-4 w-4 ml-2 rtl:ml-0 rtl:mr-2"}),"إفراغ السلة"]})]}),e.jsx(S,{className:"space-y-4",children:c.map((s,t)=>e.jsxs("div",{children:[t>0&&e.jsx(A,{className:"my-4"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(j,{to:`/product/${s.productId}`,className:"flex-shrink-0",children:e.jsx("img",{src:s.image,alt:s.name,className:"w-24 h-24 object-cover rounded-lg"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(j,{to:`/product/${s.productId}`,className:"hover:text-primary",children:e.jsx("h3",{className:"font-semibold mb-1 line-clamp-2",children:s.name})}),(s.color||s.size)&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.color&&e.jsxs(v,{variant:"outline",className:"text-xs",children:["اللون: ",s.color]}),s.size&&e.jsxs(v,{variant:"outline",className:"text-xs",children:["المقاس: ",s.size]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"text-lg font-bold text-primary",children:[s.price.toLocaleString()," ج.م"]}),s.originalPrice&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:[s.originalPrice.toLocaleString()," ج.م"]}),e.jsxs(v,{variant:"secondary",className:"text-xs",children:["وفر"," ",Math.round((s.originalPrice-s.price)/s.originalPrice*100),"%"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center border rounded-lg",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>a(s.id,s.quantity-1),disabled:s.quantity<=1,children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx("span",{className:"px-4 py-2 font-medium min-w-[3rem] text-center",children:s.quantity}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>a(s.id,s.quantity+1),disabled:s.quantity>=s.stockQuantity,children:e.jsx(J,{className:"h-4 w-4"})})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["متوفر: ",s.stockQuantity]})]})]}),e.jsxs(V,{open:R,onOpenChange:g,children:[e.jsx(W,{asChild:!0,children:e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>q(s.id),className:"flex-shrink-0",children:e.jsx(P,{className:"h-5 w-5 text-destructive"})})}),e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsx(_,{children:"تأكيد إزالة المنتج"})}),e.jsx("p",{children:"هل أنت متأكد أنك تريد إزالة هذا المنتج من السلة؟"}),e.jsxs(ee,{children:[e.jsx(l,{variant:"destructive",onClick:$,children:"نعم، إزالة"}),e.jsx(l,{variant:"outline",onClick:()=>g(!1),children:"إلغاء"})]})]})]})]})]},s.id))})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"sticky top-4 space-y-4",children:[e.jsxs(C,{children:[e.jsx(k,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"كود الخصم"]})}),e.jsx(S,{children:e.jsx(ne,{cartTotal:r,onCouponApplied:E,onCouponRemoved:Q,appliedCoupon:i})})]}),e.jsxs(C,{children:[e.jsx(k,{children:e.jsx(w,{children:"ملخص الطلب"})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"المجموع الفرعي"}),e.jsxs("span",{children:[r.toLocaleString()," ج.م"]})]}),I>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600 dark:text-green-400",children:[e.jsx("span",{children:"وفرت"}),e.jsxs("span",{children:["- ",I.toLocaleString()," ج.م"]})]}),i&&d>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600 dark:text-green-400",children:[e.jsxs("span",{children:["خصم الكود (",i.code,")"]}),e.jsxs("span",{children:["- ",d.toLocaleString()," ج.م"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{className:"text-muted-foreground",children:"الشحن"})]}),e.jsx("span",{className:f===0?"text-green-600 dark:text-green-400":"",children:f===0?"مجاني":`${f} ج.م`})]}),N<500&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950 rounded-lg text-xs text-blue-700 dark:text-blue-300",children:[e.jsx(ae,{className:"h-4 w-4 inline-block ml-1"}),"اشترِ بـ ",(500-N).toLocaleString()," ج.م إضافية للحصول على شحن مجاني!"]})]}),e.jsx(A,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"الإجمالي"}),e.jsxs("span",{className:"text-primary",children:[F.toLocaleString()," ج.م"]})]}),e.jsx(l,{size:"lg",className:"w-full",asChild:!0,children:e.jsxs(j,{to:"/checkout",children:["إتمام الطلب",e.jsx(L,{className:"mr-2 h-5 w-5 rtl:mr-0 rtl:ml-2 rtl:rotate-180"})]})}),e.jsx(l,{variant:"outline",size:"lg",className:"w-full",asChild:!0,children:e.jsx(j,{to:"/products",children:"متابعة التسوق"})})]})]})]})})]})]})})}export{xe as default};
