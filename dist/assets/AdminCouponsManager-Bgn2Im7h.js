import{af as F,r as o,u as r,j as e,D as B,h as H,B as x,P,i as _,k as z,l as O,b5 as R,s as i,I as h,ap as V,aq as G,ar as M,as as J,at as D,m as K,C as m,e as j,f as u,g,a6 as Q,L as W,T as X,a as C}from"./index-Ce-RwxJS.js";import{T as Y,a as Z,b as U,c as n,d as ee,e as c}from"./table-DhT4s9qg.js";import{c as v}from"./coupons-api-KlkOGt2E.js";import{A as se}from"./AdminLayout-DRAN_nM7.js";import{S as te}from"./square-pen-BvEjHzCI.js";import"./tag-BB9opunb.js";import"./settings-DdUeHZqS.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],re=F("toggle-left",ae);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],ie=F("toggle-right",le);function je(){const[d,A]=o.useState([]),[S,w]=o.useState(!0),[T,f]=o.useState(!1),[p,N]=o.useState(null),[t,l]=o.useState({code:"",type:"percentage",value:0,minAmount:0,maxUses:0,validFrom:"",validUntil:""});o.useEffect(()=>{y()},[]);const y=async()=>{w(!0);try{const s=await v.getAllCoupons();A(s)}catch(s){console.error("Error loading coupons:",s),r.error("فشل تحميل الكوبونات")}finally{w(!1)}},k=async s=>{if(s.preventDefault(),!t.code||!t.value||!t.validFrom||!t.validUntil){r.error("يرجى ملء جميع الحقول المطلوبة");return}try{p?await v.updateCoupon(p.$id,t)?r.success("تم تحديث الكوبون بنجاح"):r.error("فشل تحديث الكوبون"):await v.createCoupon(t)?r.success("تم إنشاء الكوبون بنجاح"):r.error("فشل إنشاء الكوبون"),f(!1),N(null),b(),y()}catch(a){console.error("Error saving coupon:",a),r.error("حدث خطأ أثناء الحفظ")}},E=s=>{N(s),l({code:s.code,type:s.type,value:s.value,minAmount:s.minAmount||0,maxUses:s.maxUses||0,validFrom:s.validFrom.split("T")[0],validUntil:s.validUntil.split("T")[0]}),f(!0)},L=async s=>{if(confirm("هل أنت متأكد من حذف هذا الكوبون؟"))try{await v.deleteCoupon(s)?(r.success("تم حذف الكوبون بنجاح"),y()):r.error("فشل حذف الكوبون")}catch(a){console.error("Error deleting coupon:",a),r.error("حدث خطأ أثناء الحذف")}},I=async s=>{try{await v.toggleActive(s)?(r.success("تم تحديث حالة الكوبون"),y()):r.error("فشل تحديث الحالة")}catch(a){console.error("Error toggling coupon:",a),r.error("حدث خطأ")}},b=()=>{l({code:"",type:"percentage",value:0,minAmount:0,maxUses:0,validFrom:"",validUntil:""})},$=s=>{const a=new Date,q=new Date(s.validUntil);return s.isActive?a>q?e.jsx(C,{variant:"destructive",children:"منتهي"}):s.maxUses&&s.usedCount>=s.maxUses?e.jsx(C,{variant:"destructive",children:"مستخدم بالكامل"}):e.jsx(C,{className:"bg-green-500",children:"نشط"}):e.jsx(C,{variant:"secondary",children:"معطل"})};return e.jsx(se,{children:e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"إدارة الكوبونات"}),e.jsx("p",{className:"text-muted-foreground",children:"إنشاء وإدارة كوبونات الخصم"})]}),e.jsxs(B,{open:T,onOpenChange:f,children:[e.jsx(H,{asChild:!0,children:e.jsxs(x,{onClick:()=>{b(),N(null)},children:[e.jsx(P,{className:"w-4 h-4 ml-2"}),"إضافة كوبون جديد"]})}),e.jsxs(_,{className:"max-w-2xl",children:[e.jsxs(z,{children:[e.jsx(O,{children:p?"تعديل الكوبون":"إضافة كوبون جديد"}),e.jsx(R,{children:"املأ البيانات لإنشاء كوبون خصم جديد"})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"code",children:"كود الكوبون *"}),e.jsx(h,{id:"code",value:t.code,onChange:s=>l({...t,code:s.target.value.toUpperCase()}),placeholder:"SAVE20",required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"type",children:"نوع الخصم *"}),e.jsxs(V,{value:t.type,onValueChange:s=>l({...t,type:s}),children:[e.jsx(G,{children:e.jsx(M,{})}),e.jsxs(J,{children:[e.jsx(D,{value:"percentage",children:"نسبة مئوية %"}),e.jsx(D,{value:"fixed",children:"مبلغ ثابت ج.م"})]})]})]}),e.jsxs("div",{children:[e.jsxs(i,{htmlFor:"value",children:["قيمة الخصم * ",t.type==="percentage"?"(%)":"(ج.م)"]}),e.jsx(h,{id:"value",type:"number",value:t.value,onChange:s=>l({...t,value:parseFloat(s.target.value)}),min:"0",step:"0.01",required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"minAmount",children:"الحد الأدنى للطلب (ج.م)"}),e.jsx(h,{id:"minAmount",type:"number",value:t.minAmount,onChange:s=>l({...t,minAmount:parseFloat(s.target.value)}),min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"maxUses",children:"الحد الأقصى للاستخدامات"}),e.jsx(h,{id:"maxUses",type:"number",value:t.maxUses,onChange:s=>l({...t,maxUses:parseInt(s.target.value)}),min:"0",placeholder:"غير محدود"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"validFrom",children:"صالح من *"}),e.jsx(h,{id:"validFrom",type:"date",value:t.validFrom,onChange:s=>l({...t,validFrom:s.target.value}),required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{htmlFor:"validUntil",children:"صالح حتى *"}),e.jsx(h,{id:"validUntil",type:"date",value:t.validUntil,onChange:s=>l({...t,validUntil:s.target.value}),required:!0})]})]}),e.jsxs(K,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>f(!1),children:"إلغاء"}),e.jsx(x,{type:"submit",children:p?"تحديث":"إنشاء"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(m,{children:[e.jsx(j,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(u,{className:"text-sm font-medium",children:"إجمالي الكوبونات"})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold",children:d.length})})]}),e.jsxs(m,{children:[e.jsx(j,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(u,{className:"text-sm font-medium",children:"الكوبونات النشطة"})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.filter(s=>s.isActive&&new Date(s.validUntil)>new Date).length})})]}),e.jsxs(m,{children:[e.jsx(j,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(u,{className:"text-sm font-medium",children:"الكوبونات المنتهية"})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:d.filter(s=>new Date(s.validUntil)<new Date).length})})]}),e.jsxs(m,{children:[e.jsx(j,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(u,{className:"text-sm font-medium",children:"إجمالي الاستخدامات"})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold",children:d.reduce((s,a)=>s+a.usedCount,0)})})]})]}),e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsx(u,{children:"جميع الكوبونات"}),e.jsx(Q,{children:"إدارة وتتبع كوبونات الخصم"})]}),e.jsx(g,{children:S?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(W,{className:"h-8 w-8 animate-spin text-primary"})}):d.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{children:"لا توجد كوبونات بعد"}),e.jsx("p",{className:"text-sm mt-2",children:"ابدأ بإنشاء كوبون جديد"})]}):e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(U,{children:[e.jsx(n,{children:"الكود"}),e.jsx(n,{children:"النوع"}),e.jsx(n,{children:"القيمة"}),e.jsx(n,{children:"الاستخدامات"}),e.jsx(n,{children:"الصلاحية"}),e.jsx(n,{children:"الحالة"}),e.jsx(n,{children:"الإجراءات"})]})}),e.jsx(ee,{children:d.map(s=>e.jsxs(U,{children:[e.jsx(c,{className:"font-mono font-bold",children:s.code}),e.jsx(c,{children:s.type==="percentage"?"نسبة مئوية":"مبلغ ثابت"}),e.jsx(c,{children:s.type==="percentage"?`${s.value}%`:`${s.value} ج.م`}),e.jsxs(c,{children:[s.usedCount," / ",s.maxUses||"∞"]}),e.jsxs(c,{className:"text-sm",children:[new Date(s.validFrom).toLocaleDateString("ar-EG")," - ",new Date(s.validUntil).toLocaleDateString("ar-EG")]}),e.jsx(c,{children:$(s)}),e.jsx(c,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>I(s.$id),children:s.isActive?e.jsx(ie,{className:"h-4 w-4 text-green-600"}):e.jsx(re,{className:"h-4 w-4 text-gray-400"})}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>E(s),children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>L(s.$id),children:e.jsx(X,{className:"h-4 w-4 text-red-600"})})]})})]},s.$id))})]})})]})]})})}export{je as default};
