import{r as d,j as e,C as o,e as h,f as m,J as w,g as u,n as I,ab as U,aE as q,I as z,ap as v,aq as p,ar as b,as as E,at as t,B as J,N as X,a as y}from"./index-Ce-RwxJS.js";import{A as $}from"./AdminLayout-DRAN_nM7.js";import{T as K,a as M,b as C,c as r,d as Q,e as c}from"./table-DhT4s9qg.js";import{c as D}from"./admin-api-DJKkOHRe.js";import{C as P}from"./clock-D_TAAEO_.js";import{S as W}from"./square-pen-BvEjHzCI.js";import{C as Y}from"./circle-x-Dru5y_zv.js";import{C as Z}from"./circle-check-big-DrIPWHSB.js";import"./tag-BB9opunb.js";import"./settings-DdUeHZqS.js";const _=({status:l})=>{const n={PENDING:{label:"في الانتظار",variant:"secondary",icon:P},PROCESSING:{label:"قيد المعالجة",variant:"default",icon:w},SHIPPED:{label:"تم الشحن",variant:"outline",icon:I},DELIVERED:{label:"تم التسليم",variant:"secondary",icon:Z},CANCELLED:{label:"ملغي",variant:"destructive",icon:Y}},i=n[l]||n.PENDING,j=i.icon;return e.jsxs(y,{variant:i.variant,className:"flex items-center gap-1",children:[e.jsx(j,{className:"h-3 w-3"}),i.label]})},ee=({status:l})=>{const n={PENDING:{label:"في الانتظار",variant:"secondary"},PAID:{label:"مدفوع",variant:"default"},FAILED:{label:"فشل",variant:"destructive"},REFUNDED:{label:"مسترد",variant:"outline"}},i=n[l]||n.PENDING;return e.jsx(y,{variant:i.variant,children:i.label})};function oe(){const[l,n]=d.useState([]),[i,j]=d.useState(!0),[N,L]=d.useState(""),[f,O]=d.useState("all"),[A,G]=d.useState("all");d.useEffect(()=>{(async()=>{j(!0);try{const a=await D.getAll();n(a)}catch(a){console.error("Error fetching orders:",a),n([])}j(!1)})()},[]);const S=l.filter(s=>{const a=s.orderNumber?.toLowerCase().includes(N.toLowerCase())||s.userId?.toLowerCase().includes(N.toLowerCase()),x=f==="all"||s.status===f;return a&&x}),R=async(s,a)=>{try{await D.updateStatus(s,a),n(x=>x.map(g=>g.id===s?{...g,status:a,updatedAt:new Date().toISOString()}:g))}catch(x){console.error("Error updating order status:",x),alert("فشل في تحديث حالة الطلب")}},T=l.length,F=l.filter(s=>s.status==="PENDING").length,B=l.filter(s=>s.status==="PROCESSING").length,H=l.filter(s=>s.status==="SHIPPED").length,V=l.reduce((s,a)=>s+a.total,0),k=l.filter(s=>s.paymentStatus==="PAID").reduce((s,a)=>s+a.total,0);return e.jsx($,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"إدارة الطلبات"})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(o,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"إجمالي الطلبات"}),e.jsx(w,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold",children:T})})]}),e.jsxs(o,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"الطلبات المعلقة"}),e.jsx(P,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:F}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[B," قيد المعالجة"]})]})]}),e.jsxs(o,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"تم الشحن"}),e.jsx(I,{className:"h-4 w-4 text-blue-600"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold",children:H})})]}),e.jsxs(o,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"إجمالي الإيرادات"}),e.jsx(U,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(u,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[V.toLocaleString()," ج.م"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[k.toLocaleString()," ج.م مدفوع"]})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(z,{placeholder:"البحث في الطلبات...",value:N,onChange:s=>L(s.target.value),className:"pl-10"})]})}),e.jsxs(v,{value:f,onValueChange:O,children:[e.jsx(p,{className:"w-48",children:e.jsx(b,{placeholder:"حالة الطلب"})}),e.jsxs(E,{children:[e.jsx(t,{value:"all",children:"جميع الحالات"}),e.jsx(t,{value:"PENDING",children:"في الانتظار"}),e.jsx(t,{value:"PROCESSING",children:"قيد المعالجة"}),e.jsx(t,{value:"SHIPPED",children:"تم الشحن"}),e.jsx(t,{value:"DELIVERED",children:"تم التسليم"}),e.jsx(t,{value:"CANCELLED",children:"ملغي"})]})]}),e.jsxs(v,{value:A,onValueChange:G,children:[e.jsx(p,{className:"w-48",children:e.jsx(b,{placeholder:"حالة الدفع"})}),e.jsxs(E,{children:[e.jsx(t,{value:"all",children:"جميع حالات الدفع"}),e.jsx(t,{value:"PENDING",children:"في الانتظار"}),e.jsx(t,{value:"PAID",children:"مدفوع"}),e.jsx(t,{value:"FAILED",children:"فشل"}),e.jsx(t,{value:"REFUNDED",children:"مسترد"})]})]})]}),e.jsxs(o,{children:[e.jsx(h,{children:e.jsxs(m,{children:["الطلبات (",S.length,")"]})}),e.jsx(u,{children:e.jsxs(K,{children:[e.jsx(M,{children:e.jsxs(C,{children:[e.jsx(r,{children:"رقم الطلب"}),e.jsx(r,{children:"العميل"}),e.jsx(r,{children:"المنتجات"}),e.jsx(r,{children:"المبلغ"}),e.jsx(r,{children:"حالة الطلب"}),e.jsx(r,{children:"حالة الدفع"}),e.jsx(r,{children:"التاريخ"}),e.jsx(r,{className:"text-center",children:"الإجراءات"})]})}),e.jsx(Q,{children:S.map(s=>e.jsxs(C,{children:[e.jsx(c,{children:e.jsx("div",{className:"font-medium",children:s.orderNumber})}),e.jsx(c,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.user?.name||"غير محدد"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.user?.email})]})}),e.jsx(c,{children:e.jsxs("div",{className:"text-sm",children:[s.items.length," منتج",s.items.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[s.items[0].product.name,s.items.length>1&&` +${s.items.length-1} أخرى`]})]})}),e.jsxs(c,{children:[e.jsxs("div",{className:"font-medium",children:[s.total.toLocaleString()," ج.م"]}),s.discount>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["خصم: ",s.discount," ج.م"]})]}),e.jsx(c,{children:e.jsx(_,{status:s.status})}),e.jsx(c,{children:e.jsx(ee,{status:s.paymentStatus})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-sm",children:new Date(s.createdAt).toLocaleDateString("ar-EG")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{variant:"outline",size:"sm",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsxs(v,{value:s.status,onValueChange:a=>R(s.id,a),children:[e.jsx(p,{className:"w-[120px] h-8",children:e.jsx(W,{className:"h-3 w-3"})}),e.jsxs(E,{children:[e.jsx(t,{value:"PENDING",children:"في الانتظار"}),e.jsx(t,{value:"PROCESSING",children:"قيد المعالجة"}),e.jsx(t,{value:"SHIPPED",children:"تم الشحن"}),e.jsx(t,{value:"DELIVERED",children:"تم التسليم"}),e.jsx(t,{value:"CANCELLED",children:"ملغي"})]})]})]})})]},s.id))})]})})]})]})})}export{oe as default};
