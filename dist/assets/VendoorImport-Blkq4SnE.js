import{b as ee,w as se,r as i,j as e,a2 as ae,a3 as te,a4 as B,aF as S,a5 as M,C as g,e as C,f as k,a6 as P,g as f,s as N,I as v,B as c,L as x,a as U,N as re,D as le,i as ie,k as ne,l as ce,b5 as de,J as oe}from"./index-Ce-RwxJS.js";import{D as O}from"./download-UgG-gTV9.js";import{U as H}from"./upload-BkldABOD.js";import{C as me}from"./circle-check-big-DrIPWHSB.js";const _="almlmibrahym574@gmail.com",q="hema2004";function je(){const{toast:t}=ee(),{user:d}=se(),[w,T]=i.useState(!1),[F,I]=i.useState(!1),[o,D]=i.useState({current:0,total:0}),[m,h]=i.useState([]),[r,W]=i.useState(null),[u,E]=i.useState(new Set),[G,b]=i.useState(!1),[A,V]=i.useState(!1),[y,$]=i.useState(""),[j,J]=i.useState(20),[R,z]=i.useState(!1),K=async()=>{T(!0),D({current:0,total:41});try{const s=await fetch("/api/vendoor/scrape-all",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:_,password:q,maxPages:41})});if(!s.ok){const l=await s.text();throw new Error(`فشل جلب المنتجات: ${s.status} - ${l}`)}const a=await s.json();if(a.success&&a.products)h(a.products),t({title:"نجح! 🎉",description:`تم جلب ${a.totalProducts} منتج من ${a.totalPages} صفحة`});else throw new Error(a.error||"فشل في جلب المنتجات")}catch(s){console.error("خطأ في جلب المنتجات:",s),t({title:"خطأ",description:s.message||"فشل جلب المنتجات",variant:"destructive"})}finally{T(!1),D({current:0,total:0})}},Q=async()=>{if(!y.trim()){t({title:"تحذير",description:"الرجاء إدخال رقم المنتج",variant:"destructive"});return}I(!0);try{const s=await fetch("/api/vendoor/scrape-single",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:_,password:q,productId:y.trim()})});if(!s.ok)throw new Error("فشل جلب المنتج");const a=await s.json();if(a.success&&a.product)h(l=>[a.product,...l]),$(""),t({title:"نجح!",description:`تم جلب المنتج ${a.product.title}`});else throw new Error(a.error||"فشل في جلب المنتج")}catch(s){t({title:"خطأ",description:s.message||"فشل جلب المنتج",variant:"destructive"})}finally{I(!1)}},X=s=>{const a=s.target.files?.[0];if(!a)return;const l=new FileReader;l.onload=p=>{try{const n=JSON.parse(p.target?.result);if(n.products&&Array.isArray(n.products))h(n.products),t({title:"نجح!",description:`تم تحميل ${n.products.length} منتج من الملف`});else throw new Error("صيغة الملف غير صحيحة")}catch{t({title:"خطأ",description:"فشل قراءة الملف. تأكد أنه ملف JSON صحيح.",variant:"destructive"})}},l.readAsText(a)},L=async s=>{if(!d){t({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}E(a=>new Set(a).add(s.id));try{const a=await fetch("/api/vendoor/import-product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:s,userId:d.$id,userName:d.name,markupPercentage:j})});if(!a.ok)throw new Error("فشل استيراد المنتج");const l=await a.json();t({title:"نجح!",description:l.message||`تم استيراد ${s.title} بنجاح`}),h(p=>p.map(n=>n.id===s.id?{...n,imported:!0}:n))}catch(a){t({title:"خطأ",description:a.message||"فشل استيراد المنتج",variant:"destructive"})}finally{E(a=>{const l=new Set(a);return l.delete(s.id),l})}},Y=async()=>{if(!d){t({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}if(m.length===0){t({title:"تحذير",description:"لا توجد منتجات للاستيراد",variant:"destructive"});return}z(!0);try{const s=await fetch("/api/vendoor/import-multiple",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({products:m,userId:d.$id,userName:d.name,markupPercentage:j})});if(!s.ok)throw new Error("فشل استيراد المنتجات");const a=await s.json();t({title:"نجح! 🎉",description:a.message||"تم استيراد المنتجات بنجاح"}),h(l=>l.map(p=>({...p,imported:!0})))}catch(s){t({title:"خطأ",description:s.message||"فشل استيراد المنتجات",variant:"destructive"})}finally{z(!1)}},Z=s=>{W(s),b(!0)};return e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"استيراد المنتجات من Ven-door"}),e.jsx("p",{className:"text-muted-foreground",children:"استورد منتجاتك بسهولة من Ven-door إلى موقعك"})]}),e.jsxs(ae,{defaultValue:"import",className:"space-y-6",children:[e.jsxs(te,{className:"grid w-full grid-cols-2 lg:w-[400px]",children:[e.jsxs(B,{value:"import",children:[e.jsx(O,{className:"ml-2 h-4 w-4"}),"استيراد المنتجات"]}),e.jsxs(B,{value:"settings",children:[e.jsx(S,{className:"ml-2 h-4 w-4"}),"الإعدادات"]})]}),e.jsxs(M,{value:"import",className:"space-y-6",children:[e.jsxs(g,{children:[e.jsxs(C,{children:[e.jsx(k,{children:"جلب كتالوج المنتجات"}),e.jsx(P,{children:"قم بجلب جميع المنتجات من حسابك في Ven-door"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 p-4 border rounded-lg bg-muted/50",children:[e.jsx(N,{htmlFor:"single-product-id",children:"استيراد منتج واحد (رقم المنتج)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{id:"single-product-id",type:"text",placeholder:"4259",value:y,onChange:s=>$(s.target.value),className:"flex-1"}),e.jsx(c,{onClick:Q,disabled:F,children:F?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"ml-2 h-4 w-4"}),"جلب"]})})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(c,{onClick:K,disabled:w,className:"flex-1",size:"lg",children:w?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري جلب المنتجات... (",o.current,"/",o.total,")"]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"ml-2 h-4 w-4"}),"جلب جميع المنتجات (41 صفحة)"]})}),e.jsx(N,{htmlFor:"json-upload",className:"flex-1 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 w-full h-full px-4 py-3 bg-secondary hover:bg-secondary/80 rounded-md border border-input transition-colors text-sm font-medium",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{children:"رفع ملف JSON"})]})}),e.jsx(v,{id:"json-upload",type:"file",accept:".json",onChange:X,className:"hidden"})]})}),w&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"جاري المعالجة..."}),e.jsxs("span",{children:[Math.round(o.current/o.total*100),"%"]})]}),e.jsx("div",{className:"w-full bg-secondary h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-primary h-full transition-all duration-300",style:{width:`${o.current/o.total*100}%`}})})]})]})]}),m.length>0&&e.jsxs(g,{children:[e.jsxs(C,{children:[e.jsxs(k,{children:["المنتجات المتاحة (",m.length,")"]}),e.jsx(P,{children:"اختر المنتجات التي تريد استيرادها إلى موقعك"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(N,{htmlFor:"markup",children:"نسبة الهامش الربحي (%)"}),e.jsx(v,{id:"markup",type:"number",value:j,onChange:s=>J(Number(s.target.value)),min:"0",max:"100",className:"mt-1"})]}),e.jsx("div",{className:"flex-1 flex items-end",children:e.jsx(c,{onClick:Y,disabled:R,className:"w-full",size:"lg",children:R?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الاستيراد..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"ml-2 h-4 w-4"}),"استيراد جميع المنتجات (",m.length,")"]})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(s=>e.jsxs(g,{className:"overflow-hidden",children:[e.jsxs("div",{className:"aspect-square relative",children:[e.jsx("img",{src:s.image||"/placeholder-product.jpg",alt:s.title,className:"w-full h-full object-cover"}),e.jsx(U,{className:"absolute top-2 right-2",variant:parseInt(s.stock)>50?"default":"destructive",children:s.stock})]}),e.jsxs(f,{className:"p-4 space-y-3",children:[e.jsx("h3",{className:"font-semibold line-clamp-2 min-h-[3rem]",children:s.title}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"السعر:"}),e.jsxs("span",{className:"font-bold text-primary",children:[s.price," جنيه"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"العمولة:"}),e.jsxs("span",{className:"font-bold text-green-600",children:[s.commission," جنيه"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"المورد:"}),e.jsx("span",{className:"text-xs",children:s.supplier})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>Z(s),children:[e.jsx(re,{className:"ml-2 h-4 w-4"}),"عرض"]}),e.jsx(c,{size:"sm",className:"flex-1",onClick:()=>L(s),disabled:u.has(s.id),children:u.has(s.id)?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"ml-2 h-4 w-4"}),"استيراد"]})})]})]})]},s.id))})]})]})]}),e.jsx(M,{value:"settings",children:e.jsxs(g,{children:[e.jsxs(C,{children:[e.jsx(k,{children:"إعدادات الاستيراد"}),e.jsx(P,{children:"قم بتخصيص إعدادات استيراد المنتجات والتحديث التلقائي"})]}),e.jsxs(f,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"إعدادات الاستيراد"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"نسبة الهامش الربحي الافتراضية (%)"}),e.jsx(v,{type:"number",value:j,onChange:s=>J(Number(s.target.value)),min:"0",max:"100"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"سيتم إضافة هذه النسبة على سعر Vendoor الأصلي"})]})]}),e.jsxs("div",{className:"border-t pt-6 space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"التحديث التلقائي"}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(S,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium mb-1",children:"التحديث التلقائي كل ساعة"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"يتم تحديث الأسعار والمخزون تلقائياً كل ساعة"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-100 dark:bg-green-900 rounded-md",children:[e.jsx("div",{className:"h-2 w-2 bg-green-600 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"نشط"})]})})]})]})}),e.jsx(c,{onClick:async()=>{try{V(!0);const a=await(await fetch("/api/vendoor/sync-manual",{method:"POST",headers:{"Content-Type":"application/json"}})).json();t({title:a.success?"نجح!":"خطأ",description:a.success?`تم تحديث ${a.updated} منتج بنجاح`:a.error||"فشل التحديث",variant:a.success?"default":"destructive"})}catch(s){t({title:"خطأ",description:s.message||"فشل التحديث اليدوي",variant:"destructive"})}finally{V(!1)}},disabled:A,variant:"outline",className:"w-full",children:A?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري التحديث..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"ml-2 h-4 w-4"}),"تحديث يدوي الآن"]})})]})]})]})})]}),e.jsx(le,{open:G,onOpenChange:b,children:e.jsxs(ie,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsx(ce,{children:r?.title}),e.jsx(de,{children:"تفاصيل المنتج من Ven-door"})]}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("img",{src:r.image,alt:r.title,className:"w-full h-64 object-cover rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"رقم المنتج"}),e.jsxs("p",{className:"font-semibold",children:["#",r.id]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"المورد"}),e.jsx("p",{className:"font-semibold",children:r.supplier})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"السعر"}),e.jsxs("p",{className:"font-semibold text-primary",children:[r.price," جنيه"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"العمولة"}),e.jsxs("p",{className:"font-semibold text-green-600",children:[r.commission," جنيه"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"المخزون"}),e.jsx("p",{className:"font-semibold",children:r.stock})]})]}),r.variations&&Object.keys(r.variations).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"الألوان والمقاسات"}),e.jsx("div",{className:"space-y-2",children:Object.entries(r.variations).map(([s,a])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{variant:"outline",children:s}),e.jsx("span",{className:"text-sm text-muted-foreground",children:a.join(", ")})]},s))})]}),e.jsx(c,{className:"w-full",size:"lg",onClick:()=>{L(r),b(!1)},disabled:u.has(r.id),children:u.has(r.id)?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الاستيراد..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"ml-2 h-4 w-4"}),"استيراد هذا المنتج"]})})]})]})})]})}export{je as default};
