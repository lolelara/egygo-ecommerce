import{r as m,j as e,b8 as y,X as M,af as U,bv as k,a7 as d,aZ as A,bs as G,bp as K,aC as L,a_ as X,a8 as Z,bt as _}from"./vendor-react-CCFRLLzk.js";import{f as t,I as J,B as v,u as V,a as W,C as f,h as N,x as S,y as z,r as P,D as Y,N as ee,z as se,A as ae,E as te,G as re}from"./index-CtsYZAzS.js";import{am as j}from"./vendor-other-CzBBjgu5.js";import{c as le}from"./coupons-api-USCFv_Xl.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-animations-CPHPqPXb.js";import"./vendor-appwrite-CuqfvTq9.js";function ne({cartTotal:h,onCouponApplied:l,onCouponRemoved:b,appliedCoupon:n}){const[o,c]=m.useState(""),[i,u]=m.useState(!1),x=async()=>{if(!o.trim()){j.error("يرجى إدخال كود الكوبون");return}u(!0);try{const a=await le.validateCoupon(o,h);a.valid&&a.coupon&&a.discount?(l(a.discount,a.coupon),j.success(a.message||"تم تطبيق الكوبون بنجاح!"),c("")):j.error(a.message||"الكوبون غير صالح")}catch(a){console.error("Error applying coupon:",a),j.error("حدث خطأ في تطبيق الكوبون")}finally{u(!1)}},p=()=>{b(),c(""),j.success("تم إزالة الكوبون")};return e.jsxs("div",{className:"space-y-3",children:[n?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-green-900",children:["كوبون مطبق: ",e.jsx("span",{className:"font-mono",children:n.code})]}),e.jsx("p",{className:"text-xs text-green-700",children:n.type==="percentage"?`خصم ${n.value}%`:`خصم ${n.value} ج.م`})]})]}),e.jsx(t,{variant:"ghost",size:"sm",onClick:p,className:"text-green-700 hover:text-green-900",children:e.jsx(M,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(y,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(J,{value:o,onChange:a=>c(a.target.value.toUpperCase()),placeholder:"أدخل كود الكوبون",className:"pr-10",disabled:i,onKeyPress:a=>{a.key==="Enter"&&x()}})]}),e.jsx(t,{onClick:x,disabled:i||!o.trim(),className:"min-w-[100px]",children:i?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 animate-spin ml-2"}),"جاري التطبيق"]}):"تطبيق"})]}),!n&&e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(v,{variant:"outline",className:"text-xs",children:"💡 استخدم كوبون للحصول على خصم"})})]})}function pe(){const{toast:h}=V(),{items:l,removeItem:b,updateQuantity:n,clearCart:o,subtotal:c}=W(),[i,u]=m.useState(null),[x,p]=m.useState(0),a=(s,r)=>{if(r<1)return;const w=l.find(H=>H.id===s);if(w){if(r>w.stockQuantity){h({title:"الكمية غير متوفرة",description:`الكمية المتوفرة فقط ${w.stockQuantity}`,variant:"destructive"});return}n(s,r)}},[q,g]=m.useState(!1),[D,I]=m.useState(null),$=s=>{I(s),g(!0)},B=()=>{D&&(b(D),h({title:"تمت الإزالة",description:"تم إزالة المنتج من السلة"})),g(!1),I(null)},E=()=>{o(),h({title:"تم إفراغ السلة",description:"تم إزالة جميع المنتجات من السلة"})},Q=(s,r)=>{p(s),u(r)},F=()=>{p(0),u(null)},R=l.reduce((s,r)=>s+(r.originalPrice||r.price)*r.quantity,0)-c,T=c-x,C=T>=500?0:50,O=T+C;return l.length===0?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto px-4 py-16",children:e.jsx(f,{className:"max-w-2xl mx-auto border-2 border-dashed",children:e.jsx(N,{className:"py-16",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"h-24 w-24 rounded-full bg-gradient-to-br from-primary/10 to-purple-600/10 flex items-center justify-center",children:e.jsx(k,{className:"h-12 w-12 text-primary"})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"سلة التسوق فارغة"}),e.jsx("p",{className:"text-muted-foreground",children:"لم تضف أي منتجات بعد. ابدأ بإضافة منتجاتك المفضلة!"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx(t,{size:"lg",asChild:!0,className:"bg-gradient-to-r from-primary to-purple-600",children:e.jsxs(d,{to:"/products",children:[e.jsx(k,{className:"h-5 w-5 ml-2"}),"ابدأ التسوق"]})}),e.jsx(t,{size:"lg",variant:"outline",asChild:!0,children:e.jsxs(d,{to:"/deals",children:[e.jsx(y,{className:"h-5 w-5 ml-2"}),"العروض الخاصة"]})})]})]})})})})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"سلة التسوق 🛒"}),e.jsxs("p",{className:"text-muted-foreground",children:["لديك ",e.jsx("span",{className:"font-semibold text-primary",children:l.length})," ",l.length===1?"منتج":"منتجات"," في السلة"]})]}),e.jsx(t,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(d,{to:"/products",children:"متابعة التسوق"})})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:e.jsxs(f,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between",children:[e.jsx(z,{children:"المنتجات"}),e.jsxs(t,{variant:"ghost",size:"sm",onClick:E,className:"text-destructive hover:text-destructive",children:[e.jsx(A,{className:"h-4 w-4 ml-2 rtl:ml-0 rtl:mr-2"}),"إفراغ السلة"]})]}),e.jsx(N,{className:"space-y-4",children:l.map((s,r)=>e.jsxs("div",{children:[r>0&&e.jsx(P,{className:"my-4"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(d,{to:`/product/${s.productId}`,className:"flex-shrink-0",children:e.jsx("img",{src:s.image,alt:s.name,className:"w-24 h-24 object-cover rounded-lg"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(d,{to:`/product/${s.productId}`,className:"hover:text-primary",children:e.jsx("h3",{className:"font-semibold mb-1 line-clamp-2",children:s.name})}),(s.color||s.size)&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.color&&e.jsxs(v,{variant:"outline",className:"text-xs",children:["اللون: ",s.color]}),s.size&&e.jsxs(v,{variant:"outline",className:"text-xs",children:["المقاس: ",s.size]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"text-lg font-bold text-primary",children:[s.price.toLocaleString()," ج.م"]}),s.originalPrice&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:[s.originalPrice.toLocaleString()," ج.م"]}),e.jsxs(v,{variant:"secondary",className:"text-xs",children:["وفر"," ",Math.round((s.originalPrice-s.price)/s.originalPrice*100),"%"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center border rounded-lg",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>a(s.id,s.quantity-1),disabled:s.quantity<=1,children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx("span",{className:"px-4 py-2 font-medium min-w-[3rem] text-center",children:s.quantity}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>a(s.id,s.quantity+1),disabled:s.quantity>=s.stockQuantity,children:e.jsx(K,{className:"h-4 w-4"})})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["متوفر: ",s.stockQuantity]})]})]}),e.jsxs(Y,{open:q,onOpenChange:g,children:[e.jsx(ee,{asChild:!0,children:e.jsx(t,{variant:"ghost",size:"icon",onClick:()=>$(s.id),className:"flex-shrink-0",children:e.jsx(A,{className:"h-5 w-5 text-destructive"})})}),e.jsxs(se,{children:[e.jsx(ae,{children:e.jsx(te,{children:"تأكيد إزالة المنتج"})}),e.jsx("p",{children:"هل أنت متأكد أنك تريد إزالة هذا المنتج من السلة؟"}),e.jsxs(re,{children:[e.jsx(t,{variant:"destructive",onClick:B,children:"نعم، إزالة"}),e.jsx(t,{variant:"outline",onClick:()=>g(!1),children:"إلغاء"})]})]})]})]})]},s.id))})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"sticky top-4 space-y-4",children:[e.jsxs(f,{children:[e.jsx(S,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"كود الخصم"]})}),e.jsx(N,{children:e.jsx(ne,{cartTotal:c,onCouponApplied:Q,onCouponRemoved:F,appliedCoupon:i})})]}),e.jsxs(f,{children:[e.jsx(S,{children:e.jsx(z,{children:"ملخص الطلب"})}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"المجموع الفرعي"}),e.jsxs("span",{children:[c.toLocaleString()," ج.م"]})]}),R>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600 dark:text-green-400",children:[e.jsx("span",{children:"وفرت"}),e.jsxs("span",{children:["- ",R.toLocaleString()," ج.م"]})]}),i&&x>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600 dark:text-green-400",children:[e.jsxs("span",{children:["خصم الكود (",i.code,")"]}),e.jsxs("span",{children:["- ",x.toLocaleString()," ج.م"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"text-muted-foreground",children:"الشحن"})]}),e.jsx("span",{children:C===0?"مجاني":`${C} ج.م`})]})]}),e.jsx(P,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"الإجمالي"}),e.jsxs("span",{className:"text-primary",children:[O.toLocaleString()," ج.م"]})]}),e.jsx(t,{size:"lg",className:"w-full bg-gradient-to-r from-primary to-purple-600 hover:from-primary/90 hover:to-purple-600/90",asChild:!0,children:e.jsxs(d,{to:"/checkout",children:[e.jsx(X,{className:"h-5 w-5 ml-2"}),"إتمام عملية الشراء 💳"]})}),e.jsx(t,{variant:"outline",size:"lg",className:"w-full",asChild:!0,children:e.jsxs(d,{to:"/products",children:[e.jsx(k,{className:"h-4 w-4 ml-2"}),"متابعة التسوق"]})}),e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Z,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"دفع آمن ومشفر 100%"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(_,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"إرجاع مجاني خلال 14 يوم"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(L,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{children:"توصيل سريع في جميع أنحاء مصر"})]})]})]})]})]})})]})]})})}export{pe as default};
