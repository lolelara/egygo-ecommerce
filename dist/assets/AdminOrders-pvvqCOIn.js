import{r as o,j as e,o as I,b7 as y,aA as P,_ as q,k as z,au as X,bG as _,b9 as $,b8 as J}from"./vendor-react-wP-gPk8e.js";import{A as K}from"./AdminLayout-Bi0XjebE.js";import{C as h,r as m,s as u,f as j,I as M,e as Q,B as L}from"./index-BjwBfcA6.js";import{T as W,a as Y,b as D,c as i,d as Z,e as d}from"./table-DjZxPEeY.js";import{S as g,a as p,b as C,c as E,d as t}from"./select--uXl0eT9.js";import{c as w}from"./admin-api-DhN-ueGs.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-GexG3wnZ.js";import"./vendor-other-DcnDEVts.js";import"./vendor-animations-W1Z2cmit.js";import"./avatar-DWfEzynm.js";import"./vendor-appwrite-BGb_FC-V.js";const ee=({status:l})=>{const n={PENDING:{label:"في الانتظار",variant:"secondary",icon:y},PROCESSING:{label:"قيد المعالجة",variant:"default",icon:I},SHIPPED:{label:"تم الشحن",variant:"outline",icon:P},DELIVERED:{label:"تم التسليم",variant:"secondary",icon:J},CANCELLED:{label:"ملغي",variant:"destructive",icon:$}},x=n[l]||n.PENDING,N=x.icon;return e.jsxs(L,{variant:x.variant,className:"flex items-center gap-1",children:[e.jsx(N,{className:"h-3 w-3"}),x.label]})},se=({status:l})=>{const n={PENDING:{label:"في الانتظار",variant:"secondary"},PAID:{label:"مدفوع",variant:"default"},FAILED:{label:"فشل",variant:"destructive"},REFUNDED:{label:"مسترد",variant:"outline"}},x=n[l]||n.PENDING;return e.jsx(L,{variant:x.variant,children:x.label})};function ue(){const[l,n]=o.useState([]),[x,N]=o.useState(!0),[f,A]=o.useState(""),[v,O]=o.useState("all"),[G,R]=o.useState("all");o.useEffect(()=>{(async()=>{N(!0);try{const a=await w.getAll();n(a)}catch(a){console.error("Error fetching orders:",a),n([])}N(!1)})()},[]);const S=l.filter(s=>{var c,b;const a=((c=s.orderNumber)==null?void 0:c.toLowerCase().includes(f.toLowerCase()))||((b=s.userId)==null?void 0:b.toLowerCase().includes(f.toLowerCase())),r=v==="all"||s.status===v;return a&&r}),T=async(s,a)=>{try{await w.updateStatus(s,a),n(r=>r.map(c=>c.id===s?{...c,status:a,updatedAt:new Date().toISOString()}:c))}catch(r){console.error("Error updating order status:",r),alert("فشل في تحديث حالة الطلب")}},F=l.length,B=l.filter(s=>s.status==="PENDING").length,H=l.filter(s=>s.status==="PROCESSING").length,V=l.filter(s=>s.status==="SHIPPED").length,k=l.reduce((s,a)=>s+a.total,0),U=l.filter(s=>s.paymentStatus==="PAID").reduce((s,a)=>s+a.total,0);return e.jsx(K,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"إدارة الطلبات"})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(h,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"إجمالي الطلبات"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold",children:F})})]}),e.jsxs(h,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"الطلبات المعلقة"}),e.jsx(y,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:B}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[H," قيد المعالجة"]})]})]}),e.jsxs(h,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"تم الشحن"}),e.jsx(P,{className:"h-4 w-4 text-blue-600"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold",children:V})})]}),e.jsxs(h,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"إجمالي الإيرادات"}),e.jsx(q,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[k.toLocaleString()," ج.م"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[U.toLocaleString()," ج.م مدفوع"]})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(M,{placeholder:"البحث في الطلبات...",value:f,onChange:s=>A(s.target.value),className:"pl-10"})]})}),e.jsxs(g,{value:v,onValueChange:O,children:[e.jsx(p,{className:"w-48",children:e.jsx(C,{placeholder:"حالة الطلب"})}),e.jsxs(E,{children:[e.jsx(t,{value:"all",children:"جميع الحالات"}),e.jsx(t,{value:"PENDING",children:"في الانتظار"}),e.jsx(t,{value:"PROCESSING",children:"قيد المعالجة"}),e.jsx(t,{value:"SHIPPED",children:"تم الشحن"}),e.jsx(t,{value:"DELIVERED",children:"تم التسليم"}),e.jsx(t,{value:"CANCELLED",children:"ملغي"})]})]}),e.jsxs(g,{value:G,onValueChange:R,children:[e.jsx(p,{className:"w-48",children:e.jsx(C,{placeholder:"حالة الدفع"})}),e.jsxs(E,{children:[e.jsx(t,{value:"all",children:"جميع حالات الدفع"}),e.jsx(t,{value:"PENDING",children:"في الانتظار"}),e.jsx(t,{value:"PAID",children:"مدفوع"}),e.jsx(t,{value:"FAILED",children:"فشل"}),e.jsx(t,{value:"REFUNDED",children:"مسترد"})]})]})]}),e.jsxs(h,{children:[e.jsx(m,{children:e.jsxs(u,{children:["الطلبات (",S.length,")"]})}),e.jsx(j,{children:e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(D,{children:[e.jsx(i,{children:"رقم الطلب"}),e.jsx(i,{children:"العميل"}),e.jsx(i,{children:"المنتجات"}),e.jsx(i,{children:"المبلغ"}),e.jsx(i,{children:"حالة الطلب"}),e.jsx(i,{children:"حالة الدفع"}),e.jsx(i,{children:"التاريخ"}),e.jsx(i,{className:"text-center",children:"الإجراءات"})]})}),e.jsx(Z,{children:S.map(s=>{var a,r;return e.jsxs(D,{children:[e.jsx(d,{children:e.jsx("div",{className:"font-medium",children:s.orderNumber})}),e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((a=s.user)==null?void 0:a.name)||"غير محدد"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:(r=s.user)==null?void 0:r.email})]})}),e.jsx(d,{children:e.jsxs("div",{className:"text-sm",children:[s.items.length," منتج",s.items.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[s.items[0].product.name,s.items.length>1&&` +${s.items.length-1} أخرى`]})]})}),e.jsxs(d,{children:[e.jsxs("div",{className:"font-medium",children:[s.total.toLocaleString()," ج.م"]}),s.discount>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["خصم: ",s.discount," ج.م"]})]}),e.jsx(d,{children:e.jsx(ee,{status:s.status})}),e.jsx(d,{children:e.jsx(se,{status:s.paymentStatus})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-sm",children:new Date(s.createdAt).toLocaleDateString("ar-EG")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{variant:"outline",size:"sm",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsxs(g,{value:s.status,onValueChange:c=>T(s.id,c),children:[e.jsx(p,{className:"w-[120px] h-8",children:e.jsx(_,{className:"h-3 w-3"})}),e.jsxs(E,{children:[e.jsx(t,{value:"PENDING",children:"في الانتظار"}),e.jsx(t,{value:"PROCESSING",children:"قيد المعالجة"}),e.jsx(t,{value:"SHIPPED",children:"تم الشحن"}),e.jsx(t,{value:"DELIVERED",children:"تم التسليم"}),e.jsx(t,{value:"CANCELLED",children:"ملغي"})]})]})]})})]},s.id)})})]})})]})]})})}export{ue as default};
