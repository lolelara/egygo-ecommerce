import{af as k,w as P,b as M,p as Q,x as U,r as C,y as _,E as y,a8 as d,$ as z,j as e,C as o,e as f,f as N,a6 as b,g as u,B as l,P as B,s as c,I as m,ap as K,aq as O,ar as R,as as V,at as D,a as x,ab as G,T as H,a0 as w}from"./index-Ce-RwxJS.js";import{T as S}from"./tag-BB9opunb.js";import{C as J}from"./calendar-DpJ3Foaq.js";import{C as W}from"./copy-CCGvNwUs.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],Y=k("percent",X),h="",p="coupons";function ie(){const{user:t}=P(),{toast:n}=M(),L=Q(),j=U(),[Z,q]=C.useState(!1),[a,r]=C.useState({code:"",type:"percentage",value:10,expiryDate:"",usageLimit:100}),{data:g=[],isLoading:A}=_({queryKey:["affiliate-coupons",t?.$id],queryFn:async()=>t?.$id?(await d.listDocuments(h,p,[w.equal("affiliateId",t.$id),w.orderDesc("$createdAt")])).documents:[],enabled:!!t?.$id}),v=y({mutationFn:async s=>{if(!t?.$id)throw new Error("User not found");const i={code:s.code.toUpperCase(),type:s.type,value:Number(s.value),expiryDate:s.expiryDate,usageLimit:Number(s.usageLimit),usageCount:0,affiliateId:t.$id,isActive:!0};return await d.createDocument(h,p,z.unique(),i)},onSuccess:()=>{j.invalidateQueries({queryKey:["affiliate-coupons"]}),q(!1),r({code:"",type:"percentage",value:10,expiryDate:"",usageLimit:100}),n({title:"تم إنشاء الكوبون بنجاح!",description:"يمكنك مشاركة الكوبون مع عملائك الآن"})},onError:s=>{n({title:"خطأ",description:s.message||"فشل إنشاء الكوبون",variant:"destructive"})}}),$=y({mutationFn:async s=>{await d.deleteDocument(h,p,s)},onSuccess:()=>{j.invalidateQueries({queryKey:["affiliate-coupons"]}),n({title:"تم حذف الكوبون",description:"تم حذف الكوبون بنجاح"})}}),F=y({mutationFn:async({couponId:s,isActive:i})=>{await d.updateDocument(h,p,s,{isActive:!i})},onSuccess:()=>{j.invalidateQueries({queryKey:["affiliate-coupons"]})}}),I=s=>{if(s.preventDefault(),!a.code||!a.expiryDate){n({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}v.mutate(a)},E=s=>{navigator.clipboard.writeText(s),n({title:"تم النسخ!",description:`تم نسخ الكود: ${s}`})};return!t?.isAffiliate&&t?.role!=="affiliate"?e.jsx("div",{className:"container mx-auto px-4 py-16 text-center",children:e.jsxs(o,{className:"max-w-md mx-auto",children:[e.jsxs(f,{children:[e.jsx(S,{className:"h-12 w-12 mx-auto mb-4 text-orange-500"}),e.jsx(N,{children:"غير مصرح"}),e.jsx(b,{children:"هذه الصفحة متاحة فقط للمسوقين المفعلين"})]}),e.jsx(u,{children:e.jsx(l,{onClick:()=>L("/update-affiliate-prefs"),className:"w-full",children:"تفعيل حساب المسوق"})})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"كوبونات الخصم"}),e.jsx("p",{className:"text-muted-foreground",children:"أنشئ وأدر كوبونات الخصم الخاصة بك"})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs(o,{className:"lg:col-span-1",children:[e.jsx(f,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5"}),"إنشاء كوبون جديد"]})}),e.jsx(u,{children:e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"code",children:"كود الكوبون *"}),e.jsx(m,{id:"code",placeholder:"SUMMER2025",value:a.code,onChange:s=>r({...a,code:s.target.value.toUpperCase()}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"type",children:"نوع الخصم *"}),e.jsxs(K,{value:a.type,onValueChange:s=>r({...a,type:s}),children:[e.jsx(O,{children:e.jsx(R,{})}),e.jsxs(V,{children:[e.jsx(D,{value:"percentage",children:"نسبة مئوية (%)"}),e.jsx(D,{value:"fixed",children:"مبلغ ثابت (ج.م)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"value",children:["قيمة الخصم * ",a.type==="percentage"?"(%)":"(ج.م)"]}),e.jsx(m,{id:"value",type:"number",min:"1",max:a.type==="percentage"?"100":void 0,value:a.value,onChange:s=>r({...a,value:Number(s.target.value)}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"expiryDate",children:"تاريخ الانتهاء *"}),e.jsx(m,{id:"expiryDate",type:"date",value:a.expiryDate,onChange:s=>r({...a,expiryDate:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"usageLimit",children:"حد الاستخدام *"}),e.jsx(m,{id:"usageLimit",type:"number",min:"1",value:a.usageLimit,onChange:s=>r({...a,usageLimit:Number(s.target.value)}),required:!0})]}),e.jsx(l,{type:"submit",className:"w-full",disabled:v.isPending,children:v.isPending?"جاري الإنشاء...":"إنشاء كوبون"})]})})]}),e.jsx("div",{className:"lg:col-span-2 space-y-4",children:e.jsxs(o,{children:[e.jsxs(f,{children:[e.jsxs(N,{children:["كوبوناتي (",g.length,")"]}),e.jsx(b,{children:"جميع كوبونات الخصم التي أنشأتها"})]}),e.jsx(u,{children:A?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"جاري التحميل..."}):g.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(S,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لم تنشئ أي كوبونات بعد"}),e.jsx("p",{className:"text-sm mt-2",children:"ابدأ بإنشاء كوبون من النموذج على اليسار"})]}):e.jsx("div",{className:"space-y-3",children:g.map(s=>{const i=new Date(s.expiryDate)<new Date,T=s.usageCount/s.usageLimit*100;return e.jsx(o,{className:"border-l-4 border-l-orange-500",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("code",{className:"text-lg font-bold bg-muted px-3 py-1 rounded",children:s.code}),s.isActive&&!i?e.jsx(x,{className:"bg-green-500",children:"نشط"}):i?e.jsx(x,{variant:"destructive",children:"منتهي"}):e.jsx(x,{variant:"secondary",children:"متوقف"}),e.jsx(x,{variant:"outline",children:s.type==="percentage"?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),s.value,"%"]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),s.value," ج.م"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(J,{className:"h-4 w-4"}),"ينتهي: ",new Date(s.expiryDate).toLocaleDateString("ar-EG")]}),e.jsxs("div",{className:"text-muted-foreground",children:["الاستخدام: ",s.usageCount," / ",s.usageLimit]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500 transition-all",style:{width:`${T}%`}})})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>E(s.code),children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>F.mutate({couponId:s.$id,isActive:s.isActive}),disabled:i,children:s.isActive?"إيقاف":"تفعيل"}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>$.mutate(s.$id),children:e.jsx(H,{className:"h-4 w-4"})})]})]})})},s.$id)})})})]})})]})]})}export{ie as default};
