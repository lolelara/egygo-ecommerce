import{r as i,j as e,bJ as re,b_ as ne,p as le,_ as ce,bw as de,b3 as oe,a_ as w,bR as xe,a0 as he}from"./vendor-react-CCFRLLzk.js";import{A as je}from"./AdminLayout-C-VSnXvz.js";import{u as me,d as f,C as c,x as d,y as o,h as x,B as m,P as D,f as u,D as ue,z as fe,A as pe,E as ge,F as Ne,L as y,I as C,T as be,G as ve}from"./index-CtsYZAzS.js";import{T as we,a as ye,b as S,c as T}from"./tabs-Boky9FfO.js";import{T as P,a as A,b as p,c as t,d as F,e as a}from"./table-DM4QjHXT.js";import{Q as g}from"./vendor-appwrite-CuqfvTq9.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-other-CzBBjgu5.js";import"./vendor-animations-CPHPqPXb.js";import"./avatar-Glpu3gcq.js";import"./appwrite-client-DFce-dPK.js";function Le(){const{toast:h}=me(),[De,$]=i.useState(!0),[R,z]=i.useState(0),[L,B]=i.useState(0),[M,_]=i.useState(0),[H,O]=i.useState(0),[W,G]=i.useState([]),[Q,U]=i.useState([]),[V,J]=i.useState([]),[K,N]=i.useState(!1),[l,X]=i.useState(null),[k,Y]=i.useState(""),[E,Z]=i.useState("");i.useEffect(()=>{b()},[]);const b=async()=>{$(!0);try{const s=await f.listDocuments("68d8b9db00134c41e7c8","commissions",[g.orderDesc("$createdAt"),g.limit(100)]),n=await f.listDocuments("68d8b9db00134c41e7c8","merchantPayments",[g.orderDesc("$createdAt"),g.limit(100)]),v=await f.listDocuments("68d8b9db00134c41e7c8","withdrawalRequests",[g.orderDesc("$createdAt"),g.limit(100)]);G(s.documents),U(n.documents),J(v.documents),q(s.documents,n.documents)}catch(s){console.error("Error fetching financial data:",s),h({title:"خطأ",description:"فشل تحميل البيانات المالية",variant:"destructive"})}finally{$(!1)}},q=(s,n)=>{const v=n.filter(r=>r.status==="verified"||r.status==="completed").reduce((r,j)=>r+(j.platformFee||0),0);z(v);const te=s.filter(r=>r.status==="approved").reduce((r,j)=>r+j.amount,0);B(te);const ae=s.reduce((r,j)=>r+j.amount,0);_(ae);const ie=n.reduce((r,j)=>r+j.totalAmount,0);O(ie)},ee=async()=>{if(l)try{await f.updateDocument("68d8b9db00134c41e7c8","commissions",l.$id,{status:"paid",paidAt:new Date().toISOString(),paymentProof:k,paymentNotes:E}),h({title:"تم الدفع",description:"تم تسجيل دفع العمولة بنجاح"}),N(!1),b()}catch{h({title:"خطأ",description:"فشل تسجيل الدفع",variant:"destructive"})}},se=async s=>{try{await f.updateDocument("68d8b9db00134c41e7c8","merchantPayments",s,{status:"verified",verifiedAt:new Date().toISOString()}),h({title:"تم التحقق",description:"تم التحقق من دفع التاجر بنجاح"}),b()}catch{h({title:"خطأ",description:"فشل التحقق من الدفع",variant:"destructive"})}},I=async(s,n)=>{try{await f.updateDocument("68d8b9db00134c41e7c8","withdrawalRequests",s,{status:n,processedAt:new Date().toISOString()}),h({title:n==="completed"?"تم السحب":"تم الرفض",description:n==="completed"?"تم معالجة طلب السحب":"تم رفض طلب السحب"}),b()}catch{h({title:"خطأ",description:"فشل معالجة الطلب",variant:"destructive"})}};return e.jsx(je,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"لوحة التحكم المالية"}),e.jsx("p",{className:"text-muted-foreground",children:"إدارة العمولات والمدفوعات"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"أرباح المنصة"}),e.jsx(re,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[R.toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"الأرباح الصافية للمنصة"})]})]}),e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"مستحقات المسوقين"}),e.jsx(ne,{className:"h-4 w-4 text-orange-600"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[L.toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"يجب تحويلها للمسوقين"})]})]}),e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"إجمالي العمولات"}),e.jsx(le,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[M.toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"جميع العمولات المسجلة"})]})]}),e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"مدفوعات التجار"}),e.jsx(ce,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[H.toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"إجمالي مدفوعات التجار"})]})]})]}),e.jsxs(c,{className:"bg-blue-50 border-blue-200",children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),"طرق التحويل المتاحة"]})}),e.jsxs(x,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"outline",children:"فودافون كاش"}),e.jsx("span",{className:"font-mono",children:"01034324551"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"outline",children:"إنستا باي"}),e.jsx("span",{className:"font-mono",children:"ebank_hema@instapay"})]})]})]}),e.jsxs(we,{defaultValue:"commissions",className:"space-y-4",children:[e.jsxs(ye,{children:[e.jsx(S,{value:"commissions",children:"عمولات المسوقين"}),e.jsx(S,{value:"merchant-payments",children:"مدفوعات التجار"}),e.jsx(S,{value:"withdrawals",children:"طلبات السحب"})]}),e.jsx(T,{value:"commissions",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"عمولات المسوقين"}),e.jsx(D,{children:"إدارة ودفع عمولات المسوقين"})]}),e.jsx(x,{children:e.jsxs(P,{children:[e.jsx(A,{children:e.jsxs(p,{children:[e.jsx(t,{children:"المسوق"}),e.jsx(t,{children:"رقم الطلب"}),e.jsx(t,{children:"المبلغ"}),e.jsx(t,{children:"الحالة"}),e.jsx(t,{children:"التاريخ"}),e.jsx(t,{children:"الإجراءات"})]})}),e.jsx(F,{children:W.map(s=>e.jsxs(p,{children:[e.jsx(a,{className:"font-medium",children:s.affiliateName}),e.jsx(a,{children:s.orderId}),e.jsxs(a,{className:"font-bold text-green-600",children:[s.amount.toFixed(2)," ج.م"]}),e.jsx(a,{children:e.jsx(m,{variant:s.status==="paid"?"default":s.status==="approved"?"secondary":"outline",children:s.status==="paid"?"مدفوعة":s.status==="approved"?"موافق عليها":"قيد الانتظار"})}),e.jsx(a,{children:new Date(s.createdAt).toLocaleDateString("ar-EG")}),e.jsxs(a,{children:[s.status==="approved"&&e.jsxs(u,{size:"sm",onClick:()=>{X(s),N(!0)},children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"دفع"]}),s.status==="paid"&&e.jsxs(m,{variant:"default",children:[e.jsx(w,{className:"h-3 w-3 mr-1"}),"تم الدفع"]})]})]},s.$id))})]})})]})}),e.jsx(T,{value:"merchant-payments",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"مدفوعات التجار"}),e.jsx(D,{children:"التحقق من مدفوعات التجار للعمولات ورسوم المنصة"})]}),e.jsx(x,{children:e.jsxs(P,{children:[e.jsx(A,{children:e.jsxs(p,{children:[e.jsx(t,{children:"التاجر"}),e.jsx(t,{children:"رقم الطلب"}),e.jsx(t,{children:"المبلغ الكلي"}),e.jsx(t,{children:"عمولة المسوق"}),e.jsx(t,{children:"رسوم المنصة"}),e.jsx(t,{children:"إثبات التحويل"}),e.jsx(t,{children:"الحالة"}),e.jsx(t,{children:"الإجراءات"})]})}),e.jsx(F,{children:Q.map(s=>e.jsxs(p,{children:[e.jsx(a,{className:"font-medium",children:s.merchantName}),e.jsx(a,{children:s.orderId}),e.jsxs(a,{children:[s.totalAmount.toFixed(2)," ج.م"]}),e.jsxs(a,{className:"text-orange-600",children:[s.commissionAmount.toFixed(2)," ج.م"]}),e.jsxs(a,{className:"text-green-600 font-bold",children:[s.platformFee.toFixed(2)," ج.م"]}),e.jsx(a,{children:s.transferProof?e.jsx(u,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:s.transferProof,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"عرض"]})}):e.jsx("span",{className:"text-muted-foreground",children:"لا يوجد"})}),e.jsx(a,{children:e.jsx(m,{variant:s.status==="verified"?"default":s.status==="completed"?"secondary":"outline",children:s.status==="verified"?"تم التحقق":s.status==="completed"?"مكتمل":"قيد المراجعة"})}),e.jsx(a,{children:s.status==="pending"&&e.jsxs(u,{size:"sm",onClick:()=>se(s.$id),children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"تحقق"]})})]},s.$id))})]})})]})}),e.jsx(T,{value:"withdrawals",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"طلبات السحب"}),e.jsx(D,{children:"معالجة طلبات سحب الأرباح"})]}),e.jsx(x,{children:e.jsxs(P,{children:[e.jsx(A,{children:e.jsxs(p,{children:[e.jsx(t,{children:"المستخدم"}),e.jsx(t,{children:"النوع"}),e.jsx(t,{children:"المبلغ"}),e.jsx(t,{children:"الطريقة"}),e.jsx(t,{children:"تفاصيل الحساب"}),e.jsx(t,{children:"الحالة"}),e.jsx(t,{children:"الإجراءات"})]})}),e.jsx(F,{children:V.map(s=>e.jsxs(p,{children:[e.jsx(a,{className:"font-medium",children:s.userName}),e.jsx(a,{children:e.jsx(m,{variant:"outline",children:s.userType==="affiliate"?"مسوق":"تاجر"})}),e.jsxs(a,{className:"font-bold",children:[s.amount.toFixed(2)," ج.م"]}),e.jsx(a,{children:s.method==="vodafone"?"فودافون كاش":"إنستا باي"}),e.jsx(a,{className:"font-mono",children:s.accountDetails}),e.jsx(a,{children:e.jsx(m,{variant:s.status==="completed"?"default":s.status==="processing"?"secondary":s.status==="rejected"?"destructive":"outline",children:s.status==="completed"?"مكتمل":s.status==="processing"?"قيد المعالجة":s.status==="rejected"?"مرفوض":"قيد الانتظار"})}),e.jsx(a,{children:s.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>I(s.$id,"completed"),children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"قبول"]}),e.jsxs(u,{size:"sm",variant:"destructive",onClick:()=>I(s.$id,"rejected"),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"رفض"]})]})})]},s.$id))})]})})]})})]}),e.jsx(ue,{open:K,onOpenChange:N,children:e.jsxs(fe,{children:[e.jsxs(pe,{children:[e.jsx(ge,{children:"تسجيل دفع العمولة"}),e.jsx(Ne,{children:"سجل تفاصيل الدفع للمسوق"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{children:"المسوق"}),e.jsx(C,{value:(l==null?void 0:l.affiliateName)||"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(y,{children:"المبلغ"}),e.jsx(C,{value:`${l==null?void 0:l.amount.toFixed(2)} ج.م`||"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(y,{children:"رابط إثبات التحويل (اختياري)"}),e.jsx(C,{placeholder:"https://...",value:k,onChange:s=>Y(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(y,{children:"ملاحظات"}),e.jsx(be,{placeholder:"تفاصيل إضافية...",value:E,onChange:s=>Z(s.target.value)})]})]}),e.jsxs(ve,{children:[e.jsx(u,{variant:"outline",onClick:()=>N(!1),children:"إلغاء"}),e.jsxs(u,{onClick:ee,children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"تأكيد الدفع"]})]})]})})]})})}export{Le as default};
