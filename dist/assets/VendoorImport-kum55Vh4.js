import{r as o,j as e,bi as k,ai as E,ae as u,bF as M,b8 as ae,au as re,o as ne}from"./vendor-react-BMq-IxHG.js";import{u as le,o as ie,C as y,r as F,s as O,H as V,f as b,L as S,I as T,e as d,B as q,D as ce,t as oe,v as de,w as me,x as he}from"./index-C03DQAFm.js";import{T as xe,a as ue,b as _,c as W}from"./tabs-BPIonpTl.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-GexG3wnZ.js";import"./vendor-other-C5r3s8Py.js";import"./vendor-animations-W1Z2cmit.js";import"./vendor-appwrite-BGb_FC-V.js";async function A(t,l={}){const{timeout:r=9e5,...m}=l,p=new AbortController,j=setTimeout(()=>p.abort(),r);try{const i=await fetch(t,{...m,signal:p.signal});return clearTimeout(j),i}catch(i){throw clearTimeout(j),i.name==="AbortError"?new Error(`Request timeout after ${r/1e3} seconds`):i}}const N="https://68e1f6240030405882c5.fra.appwrite.run",G=89e4;console.log(`🔧 Using Appwrite Function: ${N}`);console.log(`⏱️ Timeout: ${G/1e3} seconds`);async function pe(){console.log("🔄 جلب جميع المنتجات من Vendoor...");try{const t=await A(N,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"scrape-all",email:"almlmibrahym574@gmail.com",password:"hema2004"}),timeout:G});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching Vendoor products:",t),new Error("فشل جلب المنتجات من Vendoor: "+t.message)}}async function je(t){console.log(`🔄 جلب المنتج ${t}...`);try{const l=await A(N,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"scrape-single",productId:t,email:"almlmibrahym574@gmail.com",password:"hema2004"})});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const r=await l.json();if(!r.success)throw new Error(r.error||"فشل جلب المنتج");return r.product}catch(l){throw console.error("Error fetching single Vendoor product:",l),new Error("فشل جلب المنتج من Vendoor: "+l.message)}}async function ge(t,l=20){console.log(`🔄 استيراد المنتج ${t}...`);try{const r=await A(N,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"import-product",productId:t,markupPercentage:l,email:"almlmibrahym574@gmail.com",password:"hema2004"})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){return console.error("Error importing Vendoor product:",r),{success:!1,error:"فشل استيراد المنتج: "+r.message}}}async function fe(t,l=20){try{const r=await fetch(N,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"import-multiple",productIds:t,markupPercentage:l,email:"almlmibrahym574@gmail.com",password:"hema2004"})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Error importing multiple Vendoor products:",r),new Error("فشل استيراد المنتجات: "+r.message)}}function Pe(){const{toast:t}=le(),{user:l}=ie(),[r,m]=o.useState(!1),[p,j]=o.useState(!1),[i,$]=o.useState({current:0,total:0}),[h,g]=o.useState([]),[n,K]=o.useState(null),[w,I]=o.useState(new Set),[Q,C]=o.useState(!1),[D,J]=o.useState(!1),[P,H]=o.useState(""),[v,U]=o.useState(20),[z,L]=o.useState(!1),X=async()=>{m(!0),$({current:0,total:41});try{const s=await pe();if(s.success&&s.products)g(s.products),t({title:"نجح! 🎉",description:`تم جلب ${s.products.length} منتج`});else throw new Error(s.error||"فشل في جلب المنتجات")}catch(s){console.error("خطأ في جلب المنتجات:",s),t({title:"خطأ",description:s.message||"فشل جلب المنتجات",variant:"destructive"})}finally{m(!1),$({current:0,total:0})}},Y=async()=>{if(!P.trim()){t({title:"خطأ",description:"الرجاء إدخال رقم المنتج",variant:"destructive"});return}j(!0);try{const a={success:!0,product:await je(P)};if(a.success&&a.product)g(c=>[a.product,...c]),H(""),t({title:"نجح!",description:`تم جلب المنتج ${a.product.title}`});else throw new Error(a.error||"فشل في جلب المنتج")}catch(s){t({title:"خطأ",description:s.message||"فشل جلب المنتج",variant:"destructive"})}finally{j(!1)}},Z=s=>{var x;const a=(x=s.target.files)==null?void 0:x[0];if(!a)return;const c=new FileReader;c.onload=te=>{var B;try{const f=JSON.parse((B=te.target)==null?void 0:B.result);if(f.products&&Array.isArray(f.products))g(f.products),t({title:"نجح!",description:`تم تحميل ${f.products.length} منتج من الملف`});else throw new Error("صيغة الملف غير صحيحة")}catch{t({title:"خطأ",description:"فشل قراءة الملف. تأكد أنه ملف JSON صحيح.",variant:"destructive"})}},c.readAsText(a)},R=async s=>{I(a=>new Set(a).add(s.id));try{const a=await ge(s.id,v);t({title:"نجح!",description:a.message||`تم استيراد ${s.title} بنجاح`}),g(c=>c.map(x=>x.id===s.id?{...x,imported:!0}:x))}catch(a){t({title:"خطأ",description:a.message||"فشل استيراد المنتج",variant:"destructive"})}finally{I(a=>{const c=new Set(a);return c.delete(s.id),c})}},ee=async()=>{if(h.length===0){t({title:"تنبيه",description:"لا توجد منتجات للاستيراد",variant:"destructive"});return}L(!0);try{const s=await fe(h.map(a=>a.id),v);t({title:"نجح! 🎉",description:s.message||"تم استيراد المنتجات بنجاح"}),g(a=>a.map(c=>({...c,imported:!0})))}catch(s){t({title:"خطأ",description:s.message||"فشل استيراد المنتجات",variant:"destructive"})}finally{L(!1)}},se=s=>{K(s),C(!0)};return e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"استيراد المنتجات من Ven-door"}),e.jsx("p",{className:"text-muted-foreground",children:"استورد منتجاتك بسهولة من Ven-door إلى موقعك"})]}),e.jsxs(xe,{defaultValue:"import",className:"space-y-6",children:[e.jsxs(ue,{className:"grid w-full grid-cols-2 lg:w-[400px]",children:[e.jsxs(_,{value:"import",children:[e.jsx(k,{className:"ml-2 h-4 w-4"}),"استيراد المنتجات"]}),e.jsxs(_,{value:"settings",children:[e.jsx(E,{className:"ml-2 h-4 w-4"}),"الإعدادات"]})]}),e.jsxs(W,{value:"import",className:"space-y-6",children:[e.jsxs(y,{children:[e.jsxs(F,{children:[e.jsx(O,{children:"جلب كتالوج المنتجات"}),e.jsx(V,{children:"قم بجلب جميع المنتجات من حسابك في Ven-door"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 p-4 border rounded-lg bg-muted/50",children:[e.jsx(S,{htmlFor:"single-product-id",children:"استيراد منتج واحد (رقم المنتج)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{id:"single-product-id",type:"text",placeholder:"4259",value:P,onChange:s=>H(s.target.value),className:"flex-1"}),e.jsx(d,{onClick:Y,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"ml-2 h-4 w-4"}),"جلب"]})})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(d,{onClick:X,disabled:r,className:"flex-1",size:"lg",children:r?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري جلب المنتجات... (",i.current,"/",i.total,")"]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"ml-2 h-4 w-4"}),"جلب جميع المنتجات (41 صفحة)"]})}),e.jsx(S,{htmlFor:"json-upload",className:"flex-1 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 w-full h-full px-4 py-3 bg-secondary hover:bg-secondary/80 rounded-md border border-input transition-colors text-sm font-medium",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{children:"رفع ملف JSON"})]})}),e.jsx(T,{id:"json-upload",type:"file",accept:".json",onChange:Z,className:"hidden"})]})}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"جاري المعالجة..."}),e.jsxs("span",{children:[Math.round(i.current/i.total*100),"%"]})]}),e.jsx("div",{className:"w-full bg-secondary h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-primary h-full transition-all duration-300",style:{width:`${i.current/i.total*100}%`}})})]})]})]}),h.length>0&&e.jsxs(y,{children:[e.jsxs(F,{children:[e.jsxs(O,{children:["المنتجات المتاحة (",h.length,")"]}),e.jsx(V,{children:"اختر المنتجات التي تريد استيرادها إلى موقعك"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(S,{htmlFor:"markup",children:"نسبة الهامش الربحي (%)"}),e.jsx(T,{id:"markup",type:"number",value:v,onChange:s=>U(Number(s.target.value)),min:"0",max:"100",className:"mt-1"})]}),e.jsx("div",{className:"flex-1 flex items-end",children:e.jsx(d,{onClick:ee,disabled:z,className:"w-full",size:"lg",children:z?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الاستيراد..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"ml-2 h-4 w-4"}),"استيراد جميع المنتجات (",h.length,")"]})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(s=>e.jsxs(y,{className:"overflow-hidden",children:[e.jsxs("div",{className:"aspect-square relative",children:[e.jsx("img",{src:s.image||"/placeholder-product.jpg",alt:s.title,className:"w-full h-full object-cover"}),e.jsx(q,{className:"absolute top-2 right-2",variant:parseInt(s.stock)>50?"default":"destructive",children:s.stock})]}),e.jsxs(b,{className:"p-4 space-y-3",children:[e.jsx("h3",{className:"font-semibold line-clamp-2 min-h-[3rem]",children:s.title}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"السعر:"}),e.jsxs("span",{className:"font-bold text-primary",children:[s.price," جنيه"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"العمولة:"}),e.jsxs("span",{className:"font-bold text-green-600",children:[s.commission," جنيه"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"المورد:"}),e.jsx("span",{className:"text-xs",children:s.supplier})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>se(s),children:[e.jsx(re,{className:"ml-2 h-4 w-4"}),"عرض"]}),e.jsx(d,{size:"sm",className:"flex-1",onClick:()=>R(s),disabled:w.has(s.id),children:w.has(s.id)?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"ml-2 h-4 w-4"}),"استيراد"]})})]})]})]},s.id))})]})]})]}),e.jsx(W,{value:"settings",children:e.jsxs(y,{children:[e.jsxs(F,{children:[e.jsx(O,{children:"إعدادات الاستيراد"}),e.jsx(V,{children:"قم بتخصيص إعدادات استيراد المنتجات والتحديث التلقائي"})]}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"إعدادات الاستيراد"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"نسبة الهامش الربحي الافتراضية (%)"}),e.jsx(T,{type:"number",value:v,onChange:s=>U(Number(s.target.value)),min:"0",max:"100"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"سيتم إضافة هذه النسبة على سعر Vendoor الأصلي"})]})]}),e.jsxs("div",{className:"border-t pt-6 space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"التحديث التلقائي"}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(E,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium mb-1",children:"التحديث التلقائي كل ساعة"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"يتم تحديث الأسعار والمخزون تلقائياً كل ساعة"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-100 dark:bg-green-900 rounded-md",children:[e.jsx("div",{className:"h-2 w-2 bg-green-600 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"نشط"})]})})]})]})}),e.jsx(d,{onClick:async()=>{try{J(!0);const a=await(await fetch("/api/vendoor/sync-manual",{method:"POST",headers:{"Content-Type":"application/json"}})).json();t({title:a.success?"نجح!":"خطأ",description:a.success?`تم تحديث ${a.updated} منتج بنجاح`:a.error||"فشل التحديث",variant:a.success?"default":"destructive"})}catch(s){t({title:"خطأ",description:s.message||"فشل التحديث اليدوي",variant:"destructive"})}finally{J(!1)}},disabled:D,variant:"outline",className:"w-full",children:D?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري التحديث..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"ml-2 h-4 w-4"}),"تحديث يدوي الآن"]})})]})]})]})})]}),e.jsx(ce,{open:Q,onOpenChange:C,children:e.jsxs(oe,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(de,{children:[e.jsx(me,{children:n==null?void 0:n.title}),e.jsx(he,{children:"تفاصيل المنتج من Ven-door"})]}),n&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("img",{src:n.image,alt:n.title,className:"w-full h-64 object-cover rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"رقم المنتج"}),e.jsxs("p",{className:"font-semibold",children:["#",n.id]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"المورد"}),e.jsx("p",{className:"font-semibold",children:n.supplier})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"السعر"}),e.jsxs("p",{className:"font-semibold text-primary",children:[n.price," جنيه"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"العمولة"}),e.jsxs("p",{className:"font-semibold text-green-600",children:[n.commission," جنيه"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"المخزون"}),e.jsx("p",{className:"font-semibold",children:n.stock})]})]}),n.variations&&Object.keys(n.variations).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"الألوان والمقاسات"}),e.jsx("div",{className:"space-y-2",children:Object.entries(n.variations).map(([s,a])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{variant:"outline",children:s}),e.jsx("span",{className:"text-sm text-muted-foreground",children:a.join(", ")})]},s))})]}),e.jsx(d,{className:"w-full",size:"lg",onClick:()=>{R(n),C(!1)},disabled:w.has(n.id),children:w.has(n.id)?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الاستيراد..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"ml-2 h-4 w-4"}),"استيراد هذا المنتج"]})})]})]})})]})}export{Pe as default};
