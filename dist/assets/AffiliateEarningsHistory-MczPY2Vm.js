import{r as a,j as e,p as re,bJ as ne,bz as g,b_ as le,bd as ce,a_ as v,bA as ie}from"./vendor-react-CCFRLLzk.js";import{c as de,u as oe,d as w,C as c,x as o,y as x,h as i,D as xe,N as he,f as D,z as je,A as ue,E as me,F as pe,L as y,I as W,S as ge,i as fe,j as Ne,k as be,l as $,G as ve,P as q,B as R}from"./index-CtsYZAzS.js";import{T as we,a as De,b as k,c as G}from"./tabs-Boky9FfO.js";import{T as H,a as z,b as h,c as n,d as V,e as t}from"./table-DM4QjHXT.js";import{Q as j}from"./vendor-appwrite-CuqfvTq9.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-other-CzBBjgu5.js";import"./vendor-animations-CPHPqPXb.js";function We(){const{user:l}=de(),{toast:d}=oe(),[ye,S]=a.useState(!0),[M,O]=a.useState(0),[u,P]=a.useState(0),[Q,U]=a.useState(0),[_,J]=a.useState(0),[C,X]=a.useState([]),[T,K]=a.useState([]),[Y,N]=a.useState(!1),[A,F]=a.useState(""),[f,Z]=a.useState("vodafone"),[b,E]=a.useState("");a.useEffect(()=>{l&&I()},[l]);const I=async()=>{if(l){S(!0);try{const s=await w.listDocuments("68d8b9db00134c41e7c8","commissions",[j.equal("affiliateId",l.$id),j.orderDesc("$createdAt"),j.limit(100)]),m=await w.listDocuments("68d8b9db00134c41e7c8","withdrawalRequests",[j.equal("userId",l.$id),j.orderDesc("$createdAt"),j.limit(50)]);X(s.documents),K(m.documents),ee(s.documents,m.documents)}catch(s){console.error("Error fetching earnings data:",s),d({title:"خطأ",description:"فشل تحميل بيانات الأرباح",variant:"destructive"})}finally{S(!1)}}},ee=(s,m)=>{const L=s.filter(r=>r.status==="paid").reduce((r,p)=>r+p.amount,0);O(L);const te=s.filter(r=>r.status==="approved").reduce((r,p)=>r+p.amount,0);U(te);const B=m.filter(r=>r.status==="completed").reduce((r,p)=>r+p.amount,0);J(B);const ae=L-B;P(ae)},se=async()=>{if(!l)return;const s=parseFloat(A);if(isNaN(s)||s<=0){d({title:"خطأ",description:"الرجاء إدخال مبلغ صحيح",variant:"destructive"});return}if(s>u){d({title:"خطأ",description:"المبلغ المطلوب أكبر من الرصيد المتاح",variant:"destructive"});return}if(!b){d({title:"خطأ",description:"الرجاء إدخال تفاصيل الحساب",variant:"destructive"});return}try{await w.createDocument("68d8b9db00134c41e7c8","withdrawalRequests","unique()",{userId:l.$id,userName:l.name,userType:"affiliate",amount:s,method:f,accountDetails:b,status:"pending",createdAt:new Date().toISOString()}),d({title:"تم الإرسال",description:"تم إرسال طلب السحب بنجاح. سيتم المراجعة قريباً."}),N(!1),F(""),E(""),I()}catch{d({title:"خطأ",description:"فشل إرسال طلب السحب",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"سجل الأرباح والعمولات"}),e.jsx("p",{className:"text-muted-foreground",children:"تتبع أرباحك وطلبات السحب"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(c,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"إجمالي الأرباح"}),e.jsx(re,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[M.toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"جميع العمولات المدفوعة"})]})]}),e.jsxs(c,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"الرصيد المتاح"}),e.jsx(ne,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[u.toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"متاح للسحب"})]})]}),e.jsxs(c,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"قيد الانتظار"}),e.jsx(g,{className:"h-4 w-4 text-orange-600"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[Q.toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"في انتظار الدفع"})]})]}),e.jsxs(c,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"تم السحب"}),e.jsx(le,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[_.toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"المبالغ المسحوبة"})]})]})]}),e.jsx(c,{className:"bg-gradient-to-r from-blue-50 to-green-50 border-blue-200",children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"سحب الأرباح"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["الرصيد المتاح: ",e.jsxs("span",{className:"font-bold text-green-600",children:[u.toFixed(2)," ج.م"]})]})]}),e.jsxs(xe,{open:Y,onOpenChange:N,children:[e.jsx(he,{asChild:!0,children:e.jsxs(D,{size:"lg",disabled:u<=0,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"طلب سحب"]})}),e.jsxs(je,{children:[e.jsxs(ue,{children:[e.jsx(me,{children:"طلب سحب الأرباح"}),e.jsx(pe,{children:"اختر طريقة السحب وأدخل التفاصيل"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{children:"المبلغ"}),e.jsx(W,{type:"number",placeholder:"0.00",value:A,onChange:s=>F(s.target.value)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["الحد الأقصى: ",u.toFixed(2)," ج.م"]})]}),e.jsxs("div",{children:[e.jsx(y,{children:"طريقة السحب"}),e.jsxs(ge,{value:f,onValueChange:s=>Z(s),children:[e.jsx(fe,{children:e.jsx(Ne,{})}),e.jsxs(be,{children:[e.jsx($,{value:"vodafone",children:"فودافون كاش"}),e.jsx($,{value:"instapay",children:"إنستا باي"})]})]})]}),e.jsxs("div",{children:[e.jsx(y,{children:f==="vodafone"?"رقم الهاتف":"عنوان إنستا باي"}),e.jsx(W,{placeholder:f==="vodafone"?"01xxxxxxxxx":"username@instapay",value:b,onChange:s=>E(s.target.value)})]})]}),e.jsxs(ve,{children:[e.jsx(D,{variant:"outline",onClick:()=>N(!1),children:"إلغاء"}),e.jsxs(D,{onClick:se,children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"إرسال الطلب"]})]})]})]})]})})}),e.jsxs(we,{defaultValue:"commissions",className:"space-y-4",children:[e.jsxs(De,{children:[e.jsx(k,{value:"commissions",children:"سجل العمولات"}),e.jsx(k,{value:"withdrawals",children:"طلبات السحب"})]}),e.jsx(G,{value:"commissions",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsx(x,{children:"سجل العمولات"}),e.jsx(q,{children:"جميع العمولات المكتسبة من الطلبات"})]}),e.jsx(i,{children:e.jsxs(H,{children:[e.jsx(z,{children:e.jsxs(h,{children:[e.jsx(n,{children:"رقم الطلب"}),e.jsx(n,{children:"المبلغ"}),e.jsx(n,{children:"الحالة"}),e.jsx(n,{children:"تاريخ الإنشاء"}),e.jsx(n,{children:"تاريخ الدفع"})]})}),e.jsx(V,{children:C.length===0?e.jsx(h,{children:e.jsx(t,{colSpan:5,className:"text-center text-muted-foreground",children:"لا توجد عمولات بعد"})}):C.map(s=>e.jsxs(h,{children:[e.jsx(t,{className:"font-mono",children:s.orderId}),e.jsxs(t,{className:"font-bold text-green-600",children:[s.amount.toFixed(2)," ج.م"]}),e.jsx(t,{children:e.jsx(R,{variant:s.status==="paid"?"default":s.status==="approved"?"secondary":"outline",children:s.status==="paid"?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"h-3 w-3 mr-1"})," مدفوعة"]}):s.status==="approved"?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-3 w-3 mr-1"})," موافق عليها"]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-3 w-3 mr-1"})," قيد الانتظار"]})})}),e.jsx(t,{children:new Date(s.createdAt).toLocaleDateString("ar-EG")}),e.jsx(t,{children:s.paidAt?new Date(s.paidAt).toLocaleDateString("ar-EG"):e.jsx("span",{className:"text-muted-foreground",children:"-"})})]},s.$id))})]})})]})}),e.jsx(G,{value:"withdrawals",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsx(x,{children:"طلبات السحب"}),e.jsx(q,{children:"سجل طلبات سحب الأرباح"})]}),e.jsx(i,{children:e.jsxs(H,{children:[e.jsx(z,{children:e.jsxs(h,{children:[e.jsx(n,{children:"المبلغ"}),e.jsx(n,{children:"الطريقة"}),e.jsx(n,{children:"تفاصيل الحساب"}),e.jsx(n,{children:"الحالة"}),e.jsx(n,{children:"تاريخ الطلب"}),e.jsx(n,{children:"تاريخ المعالجة"})]})}),e.jsx(V,{children:T.length===0?e.jsx(h,{children:e.jsx(t,{colSpan:6,className:"text-center text-muted-foreground",children:"لا توجد طلبات سحب"})}):T.map(s=>e.jsxs(h,{children:[e.jsxs(t,{className:"font-bold",children:[s.amount.toFixed(2)," ج.م"]}),e.jsx(t,{children:s.method==="vodafone"?"فودافون كاش":"إنستا باي"}),e.jsx(t,{className:"font-mono",children:s.accountDetails}),e.jsx(t,{children:e.jsx(R,{variant:s.status==="completed"?"default":s.status==="processing"?"secondary":s.status==="rejected"?"destructive":"outline",children:s.status==="completed"?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"h-3 w-3 mr-1"})," مكتمل"]}):s.status==="processing"?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-3 w-3 mr-1"})," قيد المعالجة"]}):s.status==="rejected"?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-3 w-3 mr-1"})," مرفوض"]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-3 w-3 mr-1"})," قيد الانتظار"]})})}),e.jsx(t,{children:new Date(s.createdAt).toLocaleDateString("ar-EG")}),e.jsx(t,{children:s.processedAt?new Date(s.processedAt).toLocaleDateString("ar-EG"):e.jsx("span",{className:"text-muted-foreground",children:"-"})})]},s.$id))})]})})]})})]})]})}export{We as default};
