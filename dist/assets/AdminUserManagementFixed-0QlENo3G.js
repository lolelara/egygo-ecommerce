import{r as t,j as e,U as Z,k as _,c2 as G,aZ as J}from"./vendor-react-CCFRLLzk.js";import{c as K,u as V,d as u,C as W,x as X,y as Y,h as ee,I as m,f as l,L as h,B as se}from"./index-D7NOjX7I.js";import{Q as I}from"./vendor-appwrite-CuqfvTq9.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-other-CzBBjgu5.js";import"./vendor-animations-CPHPqPXb.js";const p=void 0;function de(){const{user:ae}=K(),{toast:i}=V(),[A,$]=t.useState([]),[U,f]=t.useState(!1),[x,L]=t.useState(""),[j,T]=t.useState("all"),[P,v]=t.useState(!1),[g,N]=t.useState(null),[a,n]=t.useState({name:"",email:"",phone:"",role:"customer"}),[F,y]=t.useState(!1),[r,b]=t.useState(null),[C,w]=t.useState("20");t.useEffect(()=>{c()},[]);const c=async()=>{f(!0);try{const s=await u.listDocuments(p,"userPreferences",[I.limit(100),I.orderDesc("$createdAt")]);console.log("✅ Loaded users:",s.documents.length),$(s.documents)}catch(s){console.error("Error loading users:",s),i({title:"خطأ",description:"فشل تحميل المستخدمين",variant:"destructive"})}finally{f(!1)}},z=s=>{console.log("Opening edit modal for:",s.name),N(s),n({name:s.name||"",email:s.email||"",phone:s.phone||"",role:s.role||"customer"}),v(!0)},S=()=>{v(!1),N(null),n({name:"",email:"",phone:"",role:"customer"})},B=async()=>{if(g)try{const s={name:a.name,email:a.email,phone:a.phone||"",role:a.role,isAdmin:a.role==="admin",isAffiliate:a.role==="affiliate",isMerchant:a.role==="merchant",isIntermediary:a.role==="intermediary",accountStatus:"approved"};a.role!==g.role&&(s.affiliateCode=a.role==="affiliate"?`AFF${Date.now()}`:"",s.intermediaryCode=a.role==="intermediary"?`INT${Date.now()}`:"",s.defaultMarkupPercentage=a.role==="intermediary"?20:0,s.commissionRate=a.role==="affiliate"?10:0),await u.updateDocument(p,"userPreferences",g.$id,s),i({title:"نجح",description:"تم تحديث بيانات المستخدم بنجاح"}),S(),c()}catch(s){console.error("Error updating user:",s),i({title:"خطأ",description:"فشل تحديث بيانات المستخدم",variant:"destructive"})}},R=s=>{console.log("Opening intermediary modal for:",s.name),b(s),y(!0)},k=()=>{y(!1),b(null),w("20")},O=async()=>{if(r)try{const s=`INT${Date.now()}`;await u.updateDocument(p,"userPreferences",r.$id,{role:"intermediary",isIntermediary:!0,intermediaryCode:s,defaultMarkupPercentage:parseFloat(C)}),i({title:"نجح",description:`تم تفعيل ${r.name} كوسيط بنجاح`}),k(),c()}catch(s){console.error("Error activating intermediary:",s),i({title:"خطأ",description:"فشل تفعيل الوسيط",variant:"destructive"})}},Q=async(s,o)=>{if(confirm(`هل أنت متأكد من حذف ${o}؟`))try{await u.deleteDocument(p,"userPreferences",s),i({title:"نجح",description:"تم حذف المستخدم بنجاح"}),c()}catch(d){console.error("Error deleting user:",d),i({title:"خطأ",description:"فشل حذف المستخدم",variant:"destructive"})}},q=s=>{const o={admin:"bg-red-100 text-red-800",intermediary:"bg-purple-100 text-purple-800",merchant:"bg-blue-100 text-blue-800",affiliate:"bg-green-100 text-green-800",customer:"bg-gray-100 text-gray-800"},d={admin:"مدير",intermediary:"وسيط",merchant:"تاجر",affiliate:"مسوق",customer:"عميل"};return e.jsx(se,{className:o[s]||o.customer,children:d[s]||s})},H=A.filter(s=>{var D,E,M;const o=((D=s.name)==null?void 0:D.toLowerCase().includes(x.toLowerCase()))||((E=s.email)==null?void 0:E.toLowerCase().includes(x.toLowerCase()))||((M=s.phone)==null?void 0:M.includes(x)),d=j==="all"||s.role===j;return o&&d});return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-6 w-6"}),"إدارة المستخدمين والشركاء"]})}),e.jsxs(ee,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(m,{placeholder:"بحث بالاسم أو البريد أو الهاتف...",value:x,onChange:s=>L(s.target.value),className:"pl-10"})]}),e.jsx("div",{children:e.jsxs("select",{className:"w-full p-2 border rounded-md",value:j,onChange:s=>T(s.target.value),children:[e.jsx("option",{value:"all",children:"جميع الأدوار"}),e.jsx("option",{value:"customer",children:"عملاء"}),e.jsx("option",{value:"merchant",children:"تجار"}),e.jsx("option",{value:"affiliate",children:"مسوقين"}),e.jsx("option",{value:"intermediary",children:"وسطاء"}),e.jsx("option",{value:"admin",children:"مدراء"})]})}),e.jsx(l,{onClick:()=>c(),variant:"outline",children:"تحديث القائمة"})]}),U?e.jsx("div",{className:"text-center py-8",children:"جاري التحميل..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-right p-2",children:"الاسم"}),e.jsx("th",{className:"text-right p-2",children:"البريد"}),e.jsx("th",{className:"text-right p-2",children:"الهاتف"}),e.jsx("th",{className:"text-right p-2",children:"الدور"}),e.jsx("th",{className:"text-right p-2",children:"الكود"}),e.jsx("th",{className:"text-right p-2",children:"الإجراءات"})]})}),e.jsx("tbody",{children:H.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2",children:s.email}),e.jsx("td",{className:"p-2",children:s.phone||"-"}),e.jsx("td",{className:"p-2",children:q(s.role)}),e.jsx("td",{className:"p-2",children:e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:s.affiliateCode||s.intermediaryCode||"-"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2",children:[s.role==="customer"&&!s.isIntermediary&&e.jsx(l,{size:"sm",className:"bg-purple-600 hover:bg-purple-700 text-white",onClick:()=>R(s),children:"تفعيل وسيط"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>z(s),children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>Q(s.$id,s.name),children:e.jsx(J,{className:"h-4 w-4"})})]})})]},s.$id))})]})})]})]}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"تعديل بيانات المستخدم"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"الاسم"}),e.jsx(m,{value:a.name,onChange:s=>n({...a,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{children:"البريد الإلكتروني"}),e.jsx(m,{type:"email",value:a.email,onChange:s=>n({...a,email:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{children:"رقم الهاتف"}),e.jsx(m,{value:a.phone,onChange:s=>n({...a,phone:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{children:"الدور"}),e.jsxs("select",{className:"w-full p-2 border rounded-md",value:a.role,onChange:s=>n({...a,role:s.target.value}),children:[e.jsx("option",{value:"customer",children:"عميل"}),e.jsx("option",{value:"merchant",children:"تاجر"}),e.jsx("option",{value:"affiliate",children:"مسوق"}),e.jsx("option",{value:"intermediary",children:"وسيط"}),e.jsx("option",{value:"admin",children:"مدير"})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(l,{onClick:S,variant:"outline",children:"إلغاء"}),e.jsx(l,{onClick:B,children:"حفظ التغييرات"})]})]})}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"تفعيل دور الوسيط"}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"العميل:"})," ",r==null?void 0:r.name]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"البريد:"})," ",r==null?void 0:r.email]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(h,{children:"نسبة الهامش الافتراضية (%)"}),e.jsx(m,{type:"number",min:"0",max:"100",value:C,onChange:s=>w(s.target.value),placeholder:"20"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"النسبة التي سيتم إضافتها على سعر المنتج الأصلي"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{onClick:k,variant:"outline",children:"إلغاء"}),e.jsx(l,{onClick:O,className:"bg-purple-600 hover:bg-purple-700",children:"تفعيل الوسيط"})]})]})})]})}export{de as default};
