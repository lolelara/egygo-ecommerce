import{j as e,cn as ee,co as te,cp as se,r as d,cq as ae,cr as $,a_ as ie,bz as re,p as ne,U as _,_ as de,be as le,bG as oe,a$ as ce}from"./vendor-react-wP-gPk8e.js";import{O as A,T as F,u as me,D as k,F as ue,e as n,t as U,v as P,w as M,L as c,I as h,C as v,r as f,s as y,f as C,B as O}from"./index-BjwBfcA6.js";import{S as xe,a as pe,b as he,c as ge,d as z}from"./select--uXl0eT9.js";import{T as je,a as ve,b as I,c as u,d as fe,e as x}from"./table-DjZxPEeY.js";import{Z as R,aE as ye}from"./vendor-other-DcnDEVts.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-GexG3wnZ.js";import"./vendor-animations-W1Z2cmit.js";import"./vendor-appwrite-BGb_FC-V.js";function V({className:g,classNames:l,showOutsideDays:o=!0,...j}){return e.jsx(ee,{showOutsideDays:o,className:A("p-3",g),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:A(F({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:A(F({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...l},...j})}V.displayName="Calendar";const Ce=te,Ae=se,B=d.forwardRef(({className:g,align:l="center",sideOffset:o=4,...j},w)=>e.jsx(ae,{children:e.jsx($,{ref:w,align:l,sideOffset:o,className:A("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",g),...j})}));B.displayName=$.displayName;function _e(){const[g,l]=d.useState([]),[o,j]=d.useState({totalCoupons:0,activeCoupons:0,totalUsage:0,totalSavings:0,topCoupons:[]}),[w,N]=d.useState(!1),[H,b]=d.useState(!1),[D,L]=d.useState(null),[p,S]=d.useState(),{toast:i}=me(),[s,r]=d.useState({code:"",type:"percentage",value:0,usageLimit:"",expiresAt:"",description:"",minOrderAmount:"",maxDiscountAmount:"",isActive:!0});d.useEffect(()=>{W(),q()},[]);const W=async()=>{try{l([{id:"1",code:"WELCOME10",type:"percentage",value:10,usageLimit:100,usageCount:45,expiresAt:new Date("2024-12-31"),isActive:!0,createdAt:new Date("2024-01-01"),description:"خصم 10% للعملاء الجدد",minOrderAmount:100},{id:"2",code:"SAVE50",type:"fixed",value:50,usageLimit:50,usageCount:23,expiresAt:new Date("2024-11-30"),isActive:!0,createdAt:new Date("2024-02-01"),description:"خصم 50 جنيه على الطلبات",minOrderAmount:200},{id:"3",code:"SUMMER20",type:"percentage",value:20,usageLimit:200,usageCount:156,expiresAt:new Date("2024-08-31"),isActive:!1,createdAt:new Date("2024-06-01"),description:"عرض الصيف - خصم 20%"}])}catch{i({title:"خطأ",description:"فشل في تحميل الكوبونات",variant:"destructive"})}},q=async()=>{try{j({totalCoupons:15,activeCoupons:8,totalUsage:1247,totalSavings:45680,topCoupons:[{code:"SUMMER20",usageCount:156,totalSavings:12500},{code:"WELCOME10",usageCount:145,totalSavings:8900},{code:"SAVE50",usageCount:89,totalSavings:4450}]})}catch(t){console.error("Failed to load stats:",t)}},G=async()=>{try{if(!s.code||s.value<=0){i({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}const t={id:Date.now().toString(),code:s.code.toUpperCase(),type:s.type,value:s.value,usageLimit:s.usageLimit?parseInt(s.usageLimit):void 0,usageCount:0,expiresAt:p,isActive:s.isActive,createdAt:new Date,description:s.description,minOrderAmount:s.minOrderAmount?parseFloat(s.minOrderAmount):void 0,maxDiscountAmount:s.maxDiscountAmount?parseFloat(s.maxDiscountAmount):void 0};l(a=>[t,...a]),r({code:"",type:"percentage",value:0,usageLimit:"",expiresAt:"",description:"",minOrderAmount:"",maxDiscountAmount:"",isActive:!0}),S(void 0),N(!1),i({title:"نجح",description:"تم إنشاء الكوبون بنجاح"})}catch{i({title:"خطأ",description:"فشل في إنشاء الكوبون",variant:"destructive"})}},Z=t=>{var a,m,E,T;L(t),r({code:t.code,type:t.type,value:t.value,usageLimit:((a=t.usageLimit)==null?void 0:a.toString())||"",expiresAt:((m=t.expiresAt)==null?void 0:m.toISOString().split("T")[0])||"",description:t.description||"",minOrderAmount:((E=t.minOrderAmount)==null?void 0:E.toString())||"",maxDiscountAmount:((T=t.maxDiscountAmount)==null?void 0:T.toString())||"",isActive:t.isActive}),S(t.expiresAt),b(!0)},J=async()=>{if(D)try{const t={...D,code:s.code.toUpperCase(),type:s.type,value:s.value,usageLimit:s.usageLimit?parseInt(s.usageLimit):void 0,expiresAt:p,isActive:s.isActive,description:s.description,minOrderAmount:s.minOrderAmount?parseFloat(s.minOrderAmount):void 0,maxDiscountAmount:s.maxDiscountAmount?parseFloat(s.maxDiscountAmount):void 0};l(a=>a.map(m=>m.id===D.id?t:m)),b(!1),L(null),i({title:"نجح",description:"تم تحديث الكوبون بنجاح"})}catch{i({title:"خطأ",description:"فشل في تحديث الكوبون",variant:"destructive"})}},K=async t=>{try{l(a=>a.filter(m=>m.id!==t)),i({title:"نجح",description:"تم حذف الكوبون بنجاح"})}catch{i({title:"خطأ",description:"فشل في حذف الكوبون",variant:"destructive"})}},Q=t=>{navigator.clipboard.writeText(t),i({title:"تم النسخ",description:`تم نسخ كود الكوبون: ${t}`})},X=(t,a)=>a?Math.round(t/a*100):0,Y=t=>t?new Date>t:!1;return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"إدارة الكوبونات والعروض"}),e.jsxs(k,{open:w,onOpenChange:N,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(n,{children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"إضافة كوبون جديد"]})}),e.jsxs(U,{className:"max-w-2xl",children:[e.jsx(P,{children:e.jsx(M,{children:"إنشاء كوبون جديد"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"code",children:"كود الكوبون"}),e.jsx(h,{id:"code",value:s.code,onChange:t=>r(a=>({...a,code:t.target.value})),placeholder:"مثال: WELCOME10"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"type",children:"نوع الخصم"}),e.jsxs(xe,{value:s.type,onValueChange:t=>r(a=>({...a,type:t})),children:[e.jsx(pe,{children:e.jsx(he,{})}),e.jsxs(ge,{children:[e.jsx(z,{value:"percentage",children:"نسبة مئوية"}),e.jsx(z,{value:"fixed",children:"مبلغ ثابت"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"value",children:"قيمة الخصم"}),e.jsx(h,{id:"value",type:"number",value:s.value,onChange:t=>r(a=>({...a,value:parseFloat(t.target.value)||0})),placeholder:s.type==="percentage"?"10":"50"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"usageLimit",children:"حد الاستخدام"}),e.jsx(h,{id:"usageLimit",type:"number",value:s.usageLimit,onChange:t=>r(a=>({...a,usageLimit:t.target.value})),placeholder:"100"})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"تاريخ الانتهاء"}),e.jsxs(Ce,{children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(n,{variant:"outline",className:A("w-full justify-start text-left font-normal",!p&&"text-muted-foreground"),children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),p?R(p,"PPP",{locale:ye}):"اختر التاريخ"]})}),e.jsx(B,{className:"w-auto p-0",children:e.jsx(V,{mode:"single",selected:p,onSelect:S,initialFocus:!0})})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"description",children:"الوصف"}),e.jsx(h,{id:"description",value:s.description,onChange:t=>r(a=>({...a,description:t.target.value})),placeholder:"وصف الكوبون"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"minOrderAmount",children:"الحد الأدنى للطلب"}),e.jsx(h,{id:"minOrderAmount",type:"number",value:s.minOrderAmount,onChange:t=>r(a=>({...a,minOrderAmount:t.target.value})),placeholder:"100"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"maxDiscountAmount",children:"الحد الأقصى للخصم"}),e.jsx(h,{id:"maxDiscountAmount",type:"number",value:s.maxDiscountAmount,onChange:t=>r(a=>({...a,maxDiscountAmount:t.target.value})),placeholder:"200"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(n,{variant:"outline",onClick:()=>N(!1),children:"إلغاء"}),e.jsx(n,{onClick:G,children:"إنشاء الكوبون"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(v,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"إجمالي الكوبونات"}),e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold",children:o.totalCoupons})})]}),e.jsxs(v,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"الكوبونات النشطة"}),e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold",children:o.activeCoupons})})]}),e.jsxs(v,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"إجمالي الاستخدام"}),e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold",children:o.totalUsage})})]}),e.jsxs(v,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"إجمالي التوفير"}),e.jsx(de,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[o.totalSavings.toLocaleString()," جنيه"]})})]})]}),e.jsxs(v,{children:[e.jsx(f,{children:e.jsx(y,{children:"قائمة الكوبونات"})}),e.jsx(C,{children:e.jsxs(je,{children:[e.jsx(ve,{children:e.jsxs(I,{children:[e.jsx(u,{children:"كود الكوبون"}),e.jsx(u,{children:"النوع"}),e.jsx(u,{children:"القيمة"}),e.jsx(u,{children:"الاستخدام"}),e.jsx(u,{children:"الحالة"}),e.jsx(u,{children:"تاريخ الانتهاء"}),e.jsx(u,{children:"الإجراءات"})]})}),e.jsx(fe,{children:g.map(t=>e.jsxs(I,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("code",{className:"bg-muted px-2 py-1 rounded text-sm",children:t.code}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>Q(t.code),children:e.jsx(le,{className:"w-3 h-3"})})]})}),e.jsx(x,{children:e.jsx(O,{variant:t.type==="percentage"?"default":"secondary",children:t.type==="percentage"?"نسبة مئوية":"مبلغ ثابت"})}),e.jsx(x,{children:t.type==="percentage"?`${t.value}%`:`${t.value} جنيه`}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-sm",children:[t.usageCount," / ",t.usageLimit||"∞"]}),t.usageLimit&&e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full",style:{width:`${X(t.usageCount,t.usageLimit)}%`}})})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{variant:t.isActive?"default":"secondary",children:t.isActive?"نشط":"غير نشط"}),Y(t.expiresAt)&&e.jsx(O,{variant:"destructive",children:"منتهي الصلاحية"})]})}),e.jsx(x,{children:t.expiresAt?R(t.expiresAt,"dd/MM/yyyy"):"بدون انتهاء"}),e.jsx(x,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>Z(t),children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>K(t.id),children:e.jsx(ce,{className:"w-4 h-4"})})]})})]},t.id))})]})})]}),e.jsx(k,{open:H,onOpenChange:b,children:e.jsxs(U,{className:"max-w-2xl",children:[e.jsx(P,{children:e.jsx(M,{children:"تعديل الكوبون"})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(n,{variant:"outline",onClick:()=>b(!1),children:"إلغاء"}),e.jsx(n,{onClick:J,children:"حفظ التغييرات"})]})})]})})]})}export{_e as default};
