import{a8 as n,a9 as g,a0 as u}from"./index-Ce-RwxJS.js";const c=g.databaseId,d={PRODUCTS:g.collections.products,CATEGORIES:g.collections.categories,ORDERS:g.collections.orders,USERS:g.collections.users,REVIEWS:g.collections.reviews,COMMISSIONS:"commissions",NOTIFICATIONS:"notifications"},P={getStats:async()=>{try{const t=await n.listDocuments(c,d.ORDERS,[u.orderDesc("$createdAt"),u.limit(100)]),s=await n.listDocuments(c,d.PRODUCTS,[u.limit(1e3)]),e=await n.listDocuments(c,d.USERS,[u.limit(1e3)]);let r=0;try{r=(await n.listDocuments(c,d.USERS,[u.equal("isAffiliate",!0),u.limit(1e3)])).total}catch(a){console.error("Error fetching affiliates:",a),r=e.documents.filter(m=>m.isAffiliate===!0).length}const i=await n.listDocuments(c,d.COMMISSIONS,[u.limit(1e3)]),o=new Date;o.setDate(1),o.setHours(0,0,0,0);const y=t.documents.filter(a=>new Date(a.$createdAt)>=o),w=y.filter(a=>a.status!=="CANCELLED").reduce((a,l)=>a+(l.total||0),0),A=t.documents.filter(a=>a.status!=="CANCELLED").reduce((a,l)=>a+(l.total||0),0),I=t.documents.filter(a=>a.status==="PENDING").length,v=i.documents.filter(a=>a.status==="PENDING").reduce((a,l)=>a+(l.amount||0),0),h=t.documents.slice(0,10).map(a=>({id:a.$id,orderNumber:a.orderNumber,status:a.status,total:a.total,createdAt:a.$createdAt,userId:a.userId})),p={};t.documents.forEach(a=>{a.items&&Array.isArray(a.items)&&a.items.forEach(l=>{const m=l.productId;p[m]||(p[m]={productId:m,quantity:0,revenue:0}),p[m].quantity+=l.quantity||0,p[m].revenue+=(l.price||0)*(l.quantity||0)})});const S=Object.values(p).sort((a,l)=>l.quantity-a.quantity).slice(0,5),D=t.documents.filter(a=>a.status==="COMPLETED").length,C=t.total>0?D/t.total*100:0,E=t.total>0?A/t.total:0;let f=0;try{const a=await n.listDocuments(c,d.REVIEWS,[u.limit(1e3)]);a.total>0&&(f=a.documents.reduce((m,O)=>m+(O.rating||0),0)/a.total)}catch(a){console.error("Error fetching reviews:",a),f=0}return{totalRevenue:A,totalOrders:t.total,totalProducts:s.total,totalUsers:e.total,pendingOrders:I,totalAffiliates:r,pendingCommissions:v,thisMonthRevenue:w,thisMonthOrders:y.length,recentOrders:h,topProducts:S,conversionRate:C,averageOrderValue:E,customerSatisfaction:f}}catch(t){return console.error("Error fetching admin stats:",t),{totalRevenue:0,totalOrders:0,totalProducts:0,totalUsers:0,pendingOrders:0,totalAffiliates:0,pendingCommissions:0,thisMonthRevenue:0,thisMonthOrders:0,recentOrders:[],topProducts:[],conversionRate:0,averageOrderValue:0,customerSatisfaction:0}}}},$={create:async(t,s)=>{try{console.log("Creating product with data:",t),console.log("User ID (merchantId):",s);const e={name:t.name,description:t.description,price:t.price,comparePrice:t.comparePrice||t.originalPrice||null,stock:t.stock||t.stockQuantity||0,categoryId:t.categoryId,images:t.images||[],tags:t.tags||[],isActive:t.isActive??!0,isFeatured:t.isFeatured??!1,rating:0,reviewCount:0};t.merchantId?e.merchantId=t.merchantId:s&&(e.merchantId=s,console.log("Auto-assigned merchantId:",s)),t.colors&&Array.isArray(t.colors)&&(e.colors=t.colors),t.sizes&&Array.isArray(t.sizes)&&(e.sizes=t.sizes),t.colorSizeInventory&&(e.colorSizeInventory=t.colorSizeInventory,console.log("ğŸ“¦ Saving colorSizeInventory:",t.colorSizeInventory));try{const r=await n.createDocument(c,d.PRODUCTS,"unique()",e);return console.log("Product created successfully:",r),{id:r.$id,name:r.name,description:r.description,price:r.price,comparePrice:r.comparePrice,stock:r.stock,categoryId:r.categoryId,images:r.images,tags:r.tags,isActive:r.isActive,isFeatured:r.isFeatured,rating:r.rating,reviewCount:r.reviewCount,createdAt:r.$createdAt}}catch(r){if(r.message?.includes("Unknown attribute")){console.warn("Retrying without optional attributes:",r.message),delete e.colorSizeInventory,delete e.merchantId,delete e.colors,delete e.sizes;const i=await n.createDocument(c,d.PRODUCTS,"unique()",e);return console.log("Product created successfully (without optional fields):",i),{id:i.$id,name:i.name,description:i.description,price:i.price,comparePrice:i.comparePrice,stock:i.stock,categoryId:i.categoryId,images:i.images,tags:i.tags,isActive:i.isActive,isFeatured:i.isFeatured,rating:i.rating,reviewCount:i.reviewCount,createdAt:i.$createdAt}}throw r}}catch(e){throw console.error("Product creation error:",e),new Error(e.message||"ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬")}},update:async t=>{try{const{id:s,...e}=t,r={};e.name&&(r.name=e.name),e.description&&(r.description=e.description),e.price!==void 0&&(r.price=e.price),(e.comparePrice!==void 0||e.originalPrice!==void 0)&&(r.comparePrice=e.comparePrice||e.originalPrice||null),(e.stock!==void 0||e.stockQuantity!==void 0)&&(r.stock=e.stock??e.stockQuantity??0),e.categoryId&&(r.categoryId=e.categoryId),e.images&&(r.images=e.images),e.tags&&(r.tags=e.tags),e.isActive!==void 0&&(r.isActive=e.isActive),e.isFeatured!==void 0&&(r.isFeatured=e.isFeatured),e.rating!==void 0&&(r.rating=e.rating),e.reviewCount!==void 0&&(r.reviewCount=e.reviewCount),e.merchantId&&(r.merchantId=e.merchantId),e.colors&&(r.colors=e.colors),e.sizes&&(r.sizes=e.sizes),e.colorSizeInventory!==void 0&&(r.colorSizeInventory=e.colorSizeInventory,console.log("ğŸ“¦ Updating colorSizeInventory:",e.colorSizeInventory));try{const i=await n.updateDocument(c,d.PRODUCTS,s,r);return{id:i.$id,name:i.name,description:i.description,price:i.price,comparePrice:i.comparePrice,stock:i.stock,categoryId:i.categoryId,images:i.images,tags:i.tags,isActive:i.isActive,isFeatured:i.isFeatured,rating:i.rating,reviewCount:i.reviewCount,updatedAt:i.$updatedAt}}catch(i){if(i.message?.includes("Unknown attribute")){console.warn("Retrying update without optional attributes:",i.message),delete r.colorSizeInventory,delete r.merchantId,delete r.colors,delete r.sizes;const o=await n.updateDocument(c,d.PRODUCTS,s,r);return{id:o.$id,name:o.name,description:o.description,price:o.price,comparePrice:o.comparePrice,stock:o.stock,categoryId:o.categoryId,images:o.images,tags:o.tags,isActive:o.isActive,isFeatured:o.isFeatured,rating:o.rating,reviewCount:o.reviewCount,updatedAt:o.$updatedAt}}throw i}}catch(s){throw new Error(s.message||"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬")}},delete:async t=>{try{return await n.deleteDocument(c,d.PRODUCTS,t),{message:"ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­"}}catch(s){throw new Error(s.message||"ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬")}}},z={create:async t=>{try{const s=t.slug||t.name.toLowerCase().replace(/[Ø£-ÙŠ\s]+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),e=await n.createDocument(c,d.CATEGORIES,"unique()",{name:t.name,description:t.description||"",image:t.image||"",isActive:!0});return{id:e.$id,name:e.name,slug:s,description:e.description,image:e.image,productCount:0,createdAt:e.$createdAt}}catch(s){throw console.error("Category creation error:",s),new Error(s.message||"ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ¦Ø©")}},update:async(t,s)=>{try{const e=await n.updateDocument(c,d.CATEGORIES,t,{name:s.name,description:s.description,image:s.image}),r=s.name.toLowerCase().replace(/[Ø£-ÙŠ\s]+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"");return{id:e.$id,name:e.name,slug:r,description:e.description,image:e.image,updatedAt:e.$updatedAt}}catch(e){throw console.error("Category update error:",e),new Error(e.message||"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ¦Ø©")}},delete:async t=>{try{return await n.deleteDocument(c,d.CATEGORIES,t),{message:"ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ¦Ø© Ø¨Ù†Ø¬Ø§Ø­"}}catch(s){throw new Error(s.message||"ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙØ¦Ø©")}}},k={getAll:async()=>{try{return(await n.listDocuments(c,d.ORDERS,[u.orderDesc("$createdAt")])).documents.map(s=>({id:s.$id,orderNumber:s.orderNumber,status:s.status,total:s.total,userId:s.userId,createdAt:s.$createdAt}))}catch(t){return console.error("Error fetching orders:",t),[]}},updateStatus:async(t,s)=>{try{const e=await n.updateDocument(c,d.ORDERS,t,{status:s});return{id:e.$id,status:e.status,updatedAt:e.$updatedAt}}catch(e){throw new Error(e.message||"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨")}}},U={getAll:async()=>{try{return(await n.listDocuments(c,d.COMMISSIONS,[u.orderDesc("$createdAt")])).documents.map(s=>({id:s.$id,amount:s.amount,status:s.status,affiliateId:s.affiliateId,orderId:s.orderId,createdAt:s.$createdAt}))}catch(t){return console.error("Error fetching commissions:",t),[]}},updateStatus:async(t,s)=>{try{const e=await n.updateDocument(c,d.COMMISSIONS,t,{status:s});return{id:e.$id,status:e.status,updatedAt:e.$updatedAt}}catch(e){throw new Error(e.message||"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©")}}};export{P as a,$ as b,k as c,z as d,U as e};
