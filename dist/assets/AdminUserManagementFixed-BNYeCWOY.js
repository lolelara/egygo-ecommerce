import{w as q,b as H,r,a8 as u,a0 as E,j as e,C as Q,e as _,f as G,aw as J,g as K,aE as V,I as m,B as t,T as W,s as h,a as X}from"./index-Ce-RwxJS.js";import{S as Y}from"./square-pen-BvEjHzCI.js";const p=void 0;function ae(){const{user:Z}=q(),{toast:l}=H(),[k,D]=r.useState([]),[M,f]=r.useState(!1),[x,U]=r.useState(""),[j,A]=r.useState("all"),[F,v]=r.useState(!1),[g,y]=r.useState(null),[a,n]=r.useState({name:"",email:"",phone:"",role:"customer"}),[$,N]=r.useState(!1),[c,b]=r.useState(null),[w,C]=r.useState("20");r.useEffect(()=>{o()},[]);const o=async()=>{f(!0);try{const s=await u.listDocuments(p,"userPreferences",[E.limit(100),E.orderDesc("$createdAt")]);console.log("✅ Loaded users:",s.documents.length),D(s.documents)}catch(s){console.error("Error loading users:",s),l({title:"خطأ",description:"فشل تحميل المستخدمين",variant:"destructive"})}finally{f(!1)}},T=s=>{console.log("Opening edit modal for:",s.name),y(s),n({name:s.name||"",email:s.email||"",phone:s.phone||"",role:s.role||"customer"}),v(!0)},S=()=>{v(!1),y(null),n({name:"",email:"",phone:"",role:"customer"})},L=async()=>{if(g)try{const s={name:a.name,email:a.email,phone:a.phone||"",role:a.role,isAdmin:a.role==="admin",isAffiliate:a.role==="affiliate",isMerchant:a.role==="merchant",isIntermediary:a.role==="intermediary",accountStatus:"approved"};a.role!==g.role&&(s.affiliateCode=a.role==="affiliate"?`AFF${Date.now()}`:"",s.intermediaryCode=a.role==="intermediary"?`INT${Date.now()}`:"",s.defaultMarkupPercentage=a.role==="intermediary"?20:0,s.commissionRate=a.role==="affiliate"?10:0),await u.updateDocument(p,"userPreferences",g.$id,s),l({title:"نجح",description:"تم تحديث بيانات المستخدم بنجاح"}),S(),o()}catch(s){console.error("Error updating user:",s),l({title:"خطأ",description:"فشل تحديث بيانات المستخدم",variant:"destructive"})}},P=s=>{console.log("Opening intermediary modal for:",s.name),b(s),N(!0)},I=()=>{N(!1),b(null),C("20")},z=async()=>{if(c)try{const s=`INT${Date.now()}`;await u.updateDocument(p,"userPreferences",c.$id,{role:"intermediary",isIntermediary:!0,intermediaryCode:s,defaultMarkupPercentage:parseFloat(w)}),l({title:"نجح",description:`تم تفعيل ${c.name} كوسيط بنجاح`}),I(),o()}catch(s){console.error("Error activating intermediary:",s),l({title:"خطأ",description:"فشل تفعيل الوسيط",variant:"destructive"})}},B=async(s,i)=>{if(confirm(`هل أنت متأكد من حذف ${i}؟`))try{await u.deleteDocument(p,"userPreferences",s),l({title:"نجح",description:"تم حذف المستخدم بنجاح"}),o()}catch(d){console.error("Error deleting user:",d),l({title:"خطأ",description:"فشل حذف المستخدم",variant:"destructive"})}},R=s=>{const i={admin:"bg-red-100 text-red-800",intermediary:"bg-purple-100 text-purple-800",merchant:"bg-blue-100 text-blue-800",affiliate:"bg-green-100 text-green-800",customer:"bg-gray-100 text-gray-800"},d={admin:"مدير",intermediary:"وسيط",merchant:"تاجر",affiliate:"مسوق",customer:"عميل"};return e.jsx(X,{className:i[s]||i.customer,children:d[s]||s})},O=k.filter(s=>{const i=s.name?.toLowerCase().includes(x.toLowerCase())||s.email?.toLowerCase().includes(x.toLowerCase())||s.phone?.includes(x),d=j==="all"||s.role===j;return i&&d});return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs(Q,{children:[e.jsx(_,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-6 w-6"}),"إدارة المستخدمين والشركاء"]})}),e.jsxs(K,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(m,{placeholder:"بحث بالاسم أو البريد أو الهاتف...",value:x,onChange:s=>U(s.target.value),className:"pl-10"})]}),e.jsx("div",{children:e.jsxs("select",{className:"w-full p-2 border rounded-md",value:j,onChange:s=>A(s.target.value),children:[e.jsx("option",{value:"all",children:"جميع الأدوار"}),e.jsx("option",{value:"customer",children:"عملاء"}),e.jsx("option",{value:"merchant",children:"تجار"}),e.jsx("option",{value:"affiliate",children:"مسوقين"}),e.jsx("option",{value:"intermediary",children:"وسطاء"}),e.jsx("option",{value:"admin",children:"مدراء"})]})}),e.jsx(t,{onClick:()=>o(),variant:"outline",children:"تحديث القائمة"})]}),M?e.jsx("div",{className:"text-center py-8",children:"جاري التحميل..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-right p-2",children:"الاسم"}),e.jsx("th",{className:"text-right p-2",children:"البريد"}),e.jsx("th",{className:"text-right p-2",children:"الهاتف"}),e.jsx("th",{className:"text-right p-2",children:"الدور"}),e.jsx("th",{className:"text-right p-2",children:"الكود"}),e.jsx("th",{className:"text-right p-2",children:"الإجراءات"})]})}),e.jsx("tbody",{children:O.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2",children:s.email}),e.jsx("td",{className:"p-2",children:s.phone||"-"}),e.jsx("td",{className:"p-2",children:R(s.role)}),e.jsx("td",{className:"p-2",children:e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:s.affiliateCode||s.intermediaryCode||"-"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2",children:[s.role==="customer"&&!s.isIntermediary&&e.jsx(t,{size:"sm",className:"bg-purple-600 hover:bg-purple-700 text-white",onClick:()=>P(s),children:"تفعيل وسيط"}),e.jsx(t,{size:"sm",variant:"outline",onClick:()=>T(s),children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(t,{size:"sm",variant:"destructive",onClick:()=>B(s.$id,s.name),children:e.jsx(W,{className:"h-4 w-4"})})]})})]},s.$id))})]})})]})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"تعديل بيانات المستخدم"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"الاسم"}),e.jsx(m,{value:a.name,onChange:s=>n({...a,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{children:"البريد الإلكتروني"}),e.jsx(m,{type:"email",value:a.email,onChange:s=>n({...a,email:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{children:"رقم الهاتف"}),e.jsx(m,{value:a.phone,onChange:s=>n({...a,phone:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{children:"الدور"}),e.jsxs("select",{className:"w-full p-2 border rounded-md",value:a.role,onChange:s=>n({...a,role:s.target.value}),children:[e.jsx("option",{value:"customer",children:"عميل"}),e.jsx("option",{value:"merchant",children:"تاجر"}),e.jsx("option",{value:"affiliate",children:"مسوق"}),e.jsx("option",{value:"intermediary",children:"وسيط"}),e.jsx("option",{value:"admin",children:"مدير"})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(t,{onClick:S,variant:"outline",children:"إلغاء"}),e.jsx(t,{onClick:L,children:"حفظ التغييرات"})]})]})}),$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"تفعيل دور الوسيط"}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"العميل:"})," ",c?.name]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"البريد:"})," ",c?.email]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(h,{children:"نسبة الهامش الافتراضية (%)"}),e.jsx(m,{type:"number",min:"0",max:"100",value:w,onChange:s=>C(s.target.value),placeholder:"20"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"النسبة التي سيتم إضافتها على سعر المنتج الأصلي"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{onClick:I,variant:"outline",children:"إلغاء"}),e.jsx(t,{onClick:z,className:"bg-purple-600 hover:bg-purple-700",children:"تفعيل الوسيط"})]})]})})]})}export{ae as default};
