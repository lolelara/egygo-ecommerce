import{r,j as e,b4 as F,a9 as _,b1 as y,b5 as U,b6 as q}from"./vendor-react-BTCGZZAN.js";import{a as te,S as re,T as ne}from"./LoadingSkeletons-Bxazgn_3.js";import{o as le,u as ie,d,c as n,C as h,r as S,s as k,f as j,L as l,I as ce,e as c,D as H,t as Q,v as z,w as M,x as oe,y as de,B as A}from"./index-DAwEpow4.js";import{Q as T,I as me}from"./vendor-appwrite-BQhTxLk4.js";import{T as xe}from"./textarea-DC34-8pe.js";import{S as he,a as je,b as fe,c as ue,d as P}from"./select-DcBOtlUf.js";import{T as pe,a as ge,b as V,c as f,d as ve,e as u}from"./table-C5DXC0ob.js";import{bg as Ne,bh as be}from"./vendor-other-ws_0vYaO.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-GexG3wnZ.js";import"./vendor-animations-W1Z2cmit.js";import"./skeleton-DOUS7_WT.js";function Le(){const{user:m}=le(),{toast:o}=ie(),[x,G]=r.useState([]),[E,W]=r.useState([]),[X,I]=r.useState(!0),[p,J]=r.useState("all"),[g,K]=r.useState(""),[Y,v]=r.useState(!1),[a,C]=r.useState(null),[N,$]=r.useState(""),[Z,b]=r.useState(!1);r.useEffect(()=>{m&&D()},[m]),r.useEffect(()=>{ee()},[x,p,g]);const D=async()=>{try{I(!0);const s=await d.listDocuments(n.databaseId,n.collections.users,[T.equal("accountStatus","pending"),T.orderDesc("$createdAt"),T.limit(100)]);console.log("Pending users fetched:",s.documents),G(s.documents)}catch(s){console.error("Error fetching pending users:",s),o({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©",variant:"destructive"})}finally{I(!1)}},ee=()=>{let s=[...x];if(p==="merchant"?s=s.filter(t=>t.isMerchant):p==="affiliate"&&(s=s.filter(t=>t.isAffiliate)),g){const t=g.toLowerCase();s=s.filter(i=>i.name.toLowerCase().includes(t)||i.email.toLowerCase().includes(t)||i.phone.includes(t))}W(s)},L=async(s,t)=>{try{const i={accountStatus:"approved",approvedAt:new Date().toISOString(),approvedBy:m==null?void 0:m.$id,isActive:!0};await d.updateDocument(n.databaseId,n.collections.users,s,i);try{await d.createDocument(n.databaseId,"user_updates",me.unique(),{userId:s,...i,timestamp:new Date().toISOString()})}catch{console.log("Sync collection not available, user will see update on next refresh")}try{await d.createDocument(n.databaseId,n.collections.notifications||"notifications","unique()",{userId:s,title:"ğŸ‰ ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ",message:"Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø­Ø³Ø§Ø¨Ùƒ ÙˆÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª",type:"info",isRead:!1,link:"/dashboard"})}catch(B){console.error("Error creating notification:",B)}o({title:"âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©",description:`ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø­Ø³Ø§Ø¨ ${t} Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„ØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.`}),D()}catch(i){console.error("Error approving account:",i),o({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨",variant:"destructive"})}},se=async()=>{if(!a||!N.trim()){o({title:"Ø®Ø·Ø£",description:"ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶",variant:"destructive"});return}try{await d.updateDocument(n.databaseId,n.collections.users,a.$id,{accountStatus:"rejected",rejectionReason:N,isActive:!1});try{await d.createDocument(n.databaseId,n.collections.notifications,"unique()",{userId:a.$id,title:"ØªØ­Ø¯ÙŠØ« Ø­ÙˆÙ„ Ø·Ù„Ø¨ Ø­Ø³Ø§Ø¨Ùƒ",message:`Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… ÙŠØªÙ… Ù‚Ø¨ÙˆÙ„ Ø­Ø³Ø§Ø¨Ùƒ. Ø§Ù„Ø³Ø¨Ø¨: ${N}`,type:"account_rejected",isRead:!1})}catch(s){console.error("Error creating notification:",s)}o({title:"ØªÙ… Ø§Ù„Ø±ÙØ¶",description:`ØªÙ… Ø±ÙØ¶ Ø­Ø³Ø§Ø¨ ${a.name}`}),v(!1),C(null),$(""),D()}catch(s){console.error("Error rejecting account:",s),o({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ÙÙŠ Ø±ÙØ¶ Ø§Ù„Ø­Ø³Ø§Ø¨",variant:"destructive"})}},R=s=>{C(s),v(!0)},ae=s=>{C(s),b(!0)},O=s=>s.isMerchant?e.jsx(A,{className:"bg-brand-purple",children:"ğŸª ØªØ§Ø¬Ø±"}):s.isAffiliate?e.jsx(A,{className:"bg-brand-orange",children:"ğŸ’° Ù…Ø³ÙˆÙ‚"}):e.jsx(A,{variant:"secondary",children:"Ø¹Ù…ÙŠÙ„"}),w=s=>`https://wa.me/${s.replace(/\D/g,"")}`;return X?e.jsxs(te,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[...Array(3)].map((s,t)=>e.jsx(re,{},t))}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:"min-w-full",children:e.jsx("tbody",{children:e.jsx(ne,{rows:8,cols:7})})})})]}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©"}),e.jsx("p",{className:"text-muted-foreground",children:"Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ØªØ¬Ø§Ø± ÙˆØ§Ù„Ù…Ø³ÙˆÙ‚ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(h,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold",children:x.length})})]}),e.jsxs(h,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Ø§Ù„ØªØ¬Ø§Ø±"}),e.jsx(_,{className:"h-4 w-4 text-brand-purple"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold",children:x.filter(s=>s.isMerchant).length})})]}),e.jsxs(h,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Ø§Ù„Ù…Ø³ÙˆÙ‚ÙˆÙ†"}),e.jsx(_,{className:"h-4 w-4 text-brand-orange"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold",children:x.filter(s=>s.isAffiliate).length})})]})]}),e.jsx(h,{className:"mb-6",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"search",children:"Ø¨Ø­Ø«"}),e.jsx(ce,{id:"search",placeholder:"Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØŒ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ...",value:g,onChange:s=>K(s.target.value)})]}),e.jsxs("div",{className:"w-full md:w-48",children:[e.jsx(l,{htmlFor:"filter",children:"Ø§Ù„ÙÙ„ØªØ±"}),e.jsxs(he,{value:p,onValueChange:s=>J(s),children:[e.jsx(je,{id:"filter",children:e.jsx(fe,{})}),e.jsxs(ue,{children:[e.jsx(P,{value:"all",children:"Ø§Ù„ÙƒÙ„"}),e.jsx(P,{value:"merchant",children:"Ø§Ù„ØªØ¬Ø§Ø± ÙÙ‚Ø·"}),e.jsx(P,{value:"affiliate",children:"Ø§Ù„Ù…Ø³ÙˆÙ‚ÙˆÙ† ÙÙ‚Ø·"})]})]})]})]})})}),e.jsx(h,{children:e.jsx(j,{className:"pt-6",children:E.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©"}),e.jsx("p",{className:"text-muted-foreground",children:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØªÙ…Øª Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(pe,{children:[e.jsx(ge,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"}),e.jsx(f,{children:"Ø§Ù„Ù†ÙˆØ¹"}),e.jsx(f,{children:"Ø§Ù„ØªÙˆØ§ØµÙ„"}),e.jsx(f,{children:"ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„"}),e.jsx(f,{className:"text-left",children:"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª"})]})}),e.jsx(ve,{children:E.map(s=>e.jsxs(V,{children:[e.jsx(u,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email})]})}),e.jsx(u,{children:O(s)}),e.jsx(u,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("a",{href:w(s.phone),target:"_blank",rel:"noopener noreferrer",className:"text-sm text-green-600 hover:underline flex items-center gap-1",children:[e.jsx(y,{className:"h-3 w-3"}),s.phone]}),s.alternativePhone&&e.jsxs("a",{href:w(s.alternativePhone),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-muted-foreground hover:underline flex items-center gap-1",children:[e.jsx(y,{className:"h-3 w-3"}),s.alternativePhone]})]})}),e.jsx(u,{children:e.jsx("div",{className:"text-sm",children:Ne(new Date(s.$createdAt),{addSuffix:!0,locale:be})})}),e.jsx(u,{children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>ae(s),children:"Ø¹Ø±Ø¶"}),e.jsxs(c,{size:"sm",variant:"default",className:"bg-green-600 hover:bg-green-700",onClick:()=>L(s.$id,s.name),children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),"Ù…ÙˆØ§ÙÙ‚Ø©"]}),e.jsxs(c,{size:"sm",variant:"destructive",onClick:()=>R(s),children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Ø±ÙØ¶"]})]})})]},s.$id))})]})})})}),e.jsx(H,{open:Y,onOpenChange:v,children:e.jsxs(Q,{children:[e.jsxs(z,{children:[e.jsx(M,{children:"Ø±ÙØ¶ Ø§Ù„Ø­Ø³Ø§Ø¨"}),e.jsxs(oe,{children:["ÙŠØ±Ø¬Ù‰ ØªÙˆØ¶ÙŠØ­ Ø³Ø¨Ø¨ Ø±ÙØ¶ Ø­Ø³Ø§Ø¨ ",a==null?void 0:a.name]})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(l,{htmlFor:"reason",children:"Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶"}),e.jsx(xe,{id:"reason",placeholder:"Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¨Ø¨ Ø¨ÙˆØ¶ÙˆØ­...",value:N,onChange:s=>$(s.target.value),rows:4,className:"mt-2"})]}),e.jsxs(de,{children:[e.jsx(c,{variant:"outline",onClick:()=>v(!1),children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(c,{variant:"destructive",onClick:se,children:"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ÙØ¶"})]})]})}),e.jsx(H,{open:Z,onOpenChange:b,children:e.jsxs(Q,{className:"max-w-2xl",children:[e.jsx(z,{children:e.jsx(M,{children:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨"})}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Ø§Ù„Ø§Ø³Ù…"}),e.jsx("p",{className:"font-medium",children:a.name})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨"}),e.jsx("div",{className:"mt-1",children:O(a)})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"}),e.jsx("p",{className:"font-medium",children:a.email})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"}),e.jsxs("a",{href:w(a.phone),target:"_blank",rel:"noopener noreferrer",className:"font-medium text-green-600 hover:underline flex items-center gap-1",children:[e.jsx(y,{className:"h-4 w-4"}),a.phone]})]}),a.alternativePhone&&e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Ø±Ù‚Ù… Ø¨Ø¯ÙŠÙ„"}),e.jsxs("a",{href:w(a.alternativePhone),target:"_blank",rel:"noopener noreferrer",className:"font-medium text-green-600 hover:underline flex items-center gap-1",children:[e.jsx(y,{className:"h-4 w-4"}),a.alternativePhone]})]}),a.affiliateCode&&e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"ÙƒÙˆØ¯ Ø§Ù„Ù…Ø³ÙˆÙ‚"}),e.jsx("p",{className:"font-medium font-mono",children:a.affiliateCode})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„"}),e.jsx("p",{className:"font-medium",children:new Date(a.$createdAt).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(c,{className:"flex-1 bg-green-600 hover:bg-green-700",onClick:()=>{L(a.$id,a.name),b(!1)},children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Ù…ÙˆØ§ÙÙ‚Ø©"]}),e.jsxs(c,{className:"flex-1",variant:"destructive",onClick:()=>{b(!1),R(a)},children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Ø±ÙØ¶"]})]})]})]})})]})}export{Le as default};
