import{r as o,j as e,bp as q,af as B,cl as z,cm as H,c2 as P,aZ as G}from"./vendor-react-CCFRLLzk.js";import{D as O,N as R,f as x,z as V,A as M,E as Z,F as J,L as i,I as m,S as K,i as Q,j as W,k as X,l as D,G as Y,C as h,x as j,y as u,h as v,P as _,B as C}from"./index-D7NOjX7I.js";import{T as ee,a as se,b as U,c as n,d as ae,e as c}from"./table-Z49QUUEs.js";import{am as r}from"./vendor-other-CzBBjgu5.js";import{c as g}from"./coupons-api-_6XAyAAE.js";import{A as te}from"./AdminLayout-Br9nuQvC.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-animations-CPHPqPXb.js";import"./vendor-appwrite-CuqfvTq9.js";import"./avatar-CwtoJR-j.js";import"./appwrite-client-DFce-dPK.js";function ve(){const[d,F]=o.useState([]),[A,b]=o.useState(!0),[S,p]=o.useState(!1),[f,N]=o.useState(null),[a,l]=o.useState({code:"",type:"percentage",value:0,minAmount:0,maxUses:0,validFrom:"",validUntil:""});o.useEffect(()=>{y()},[]);const y=async()=>{b(!0);try{const s=await g.getAllCoupons();F(s)}catch(s){console.error("Error loading coupons:",s),r.error("فشل تحميل الكوبونات")}finally{b(!1)}},T=async s=>{if(s.preventDefault(),!a.code||!a.value||!a.validFrom||!a.validUntil){r.error("يرجى ملء جميع الحقول المطلوبة");return}try{f?await g.updateCoupon(f.$id,a)?r.success("تم تحديث الكوبون بنجاح"):r.error("فشل تحديث الكوبون"):await g.createCoupon(a)?r.success("تم إنشاء الكوبون بنجاح"):r.error("فشل إنشاء الكوبون"),p(!1),N(null),w(),y()}catch(t){console.error("Error saving coupon:",t),r.error("حدث خطأ أثناء الحفظ")}},E=s=>{N(s),l({code:s.code,type:s.type,value:s.value,minAmount:s.minAmount||0,maxUses:s.maxUses||0,validFrom:s.validFrom.split("T")[0],validUntil:s.validUntil.split("T")[0]}),p(!0)},L=async s=>{if(confirm("هل أنت متأكد من حذف هذا الكوبون؟"))try{await g.deleteCoupon(s)?(r.success("تم حذف الكوبون بنجاح"),y()):r.error("فشل حذف الكوبون")}catch(t){console.error("Error deleting coupon:",t),r.error("حدث خطأ أثناء الحذف")}},k=async s=>{try{await g.toggleActive(s)?(r.success("تم تحديث حالة الكوبون"),y()):r.error("فشل تحديث الحالة")}catch(t){console.error("Error toggling coupon:",t),r.error("حدث خطأ")}},w=()=>{l({code:"",type:"percentage",value:0,minAmount:0,maxUses:0,validFrom:"",validUntil:""})},I=s=>{const t=new Date,$=new Date(s.validUntil);return s.isActive?t>$?e.jsx(C,{variant:"destructive",children:"منتهي"}):s.maxUses&&s.usedCount>=s.maxUses?e.jsx(C,{variant:"destructive",children:"مستخدم بالكامل"}):e.jsx(C,{className:"bg-green-500",children:"نشط"}):e.jsx(C,{variant:"secondary",children:"معطل"})};return e.jsx(te,{children:e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"إدارة الكوبونات"}),e.jsx("p",{className:"text-muted-foreground",children:"إنشاء وإدارة كوبونات الخصم"})]}),e.jsxs(O,{open:S,onOpenChange:p,children:[e.jsx(R,{asChild:!0,children:e.jsxs(x,{onClick:()=>{w(),N(null)},children:[e.jsx(q,{className:"w-4 h-4 ml-2"}),"إضافة كوبون جديد"]})}),e.jsxs(V,{className:"max-w-2xl",children:[e.jsxs(M,{children:[e.jsx(Z,{children:f?"تعديل الكوبون":"إضافة كوبون جديد"}),e.jsx(J,{children:"املأ البيانات لإنشاء كوبون خصم جديد"})]}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"code",children:"كود الكوبون *"}),e.jsx(m,{id:"code",value:a.code,onChange:s=>l({...a,code:s.target.value.toUpperCase()}),placeholder:"SAVE20",required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"type",children:"نوع الخصم *"}),e.jsxs(K,{value:a.type,onValueChange:s=>l({...a,type:s}),children:[e.jsx(Q,{children:e.jsx(W,{})}),e.jsxs(X,{children:[e.jsx(D,{value:"percentage",children:"نسبة مئوية %"}),e.jsx(D,{value:"fixed",children:"مبلغ ثابت ج.م"})]})]})]}),e.jsxs("div",{children:[e.jsxs(i,{htmlFor:"value",children:["قيمة الخصم * ",a.type==="percentage"?"(%)":"(ج.م)"]}),e.jsx(m,{id:"value",type:"number",value:a.value,onChange:s=>l({...a,value:parseFloat(s.target.value)}),min:"0",step:"0.01",required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"minAmount",children:"الحد الأدنى للطلب (ج.م)"}),e.jsx(m,{id:"minAmount",type:"number",value:a.minAmount,onChange:s=>l({...a,minAmount:parseFloat(s.target.value)}),min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"maxUses",children:"الحد الأقصى للاستخدامات"}),e.jsx(m,{id:"maxUses",type:"number",value:a.maxUses,onChange:s=>l({...a,maxUses:parseInt(s.target.value)}),min:"0",placeholder:"غير محدود"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"validFrom",children:"صالح من *"}),e.jsx(m,{id:"validFrom",type:"date",value:a.validFrom,onChange:s=>l({...a,validFrom:s.target.value}),required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{htmlFor:"validUntil",children:"صالح حتى *"}),e.jsx(m,{id:"validUntil",type:"date",value:a.validUntil,onChange:s=>l({...a,validUntil:s.target.value}),required:!0})]})]}),e.jsxs(Y,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>p(!1),children:"إلغاء"}),e.jsx(x,{type:"submit",children:f?"تحديث":"إنشاء"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(h,{children:[e.jsx(j,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(u,{className:"text-sm font-medium",children:"إجمالي الكوبونات"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold",children:d.length})})]}),e.jsxs(h,{children:[e.jsx(j,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(u,{className:"text-sm font-medium",children:"الكوبونات النشطة"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.filter(s=>s.isActive&&new Date(s.validUntil)>new Date).length})})]}),e.jsxs(h,{children:[e.jsx(j,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(u,{className:"text-sm font-medium",children:"الكوبونات المنتهية"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:d.filter(s=>new Date(s.validUntil)<new Date).length})})]}),e.jsxs(h,{children:[e.jsx(j,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(u,{className:"text-sm font-medium",children:"إجمالي الاستخدامات"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold",children:d.reduce((s,t)=>s+t.usedCount,0)})})]})]}),e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx(u,{children:"جميع الكوبونات"}),e.jsx(_,{children:"إدارة وتتبع كوبونات الخصم"})]}),e.jsx(v,{children:A?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(B,{className:"h-8 w-8 animate-spin text-primary"})}):d.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{children:"لا توجد كوبونات بعد"}),e.jsx("p",{className:"text-sm mt-2",children:"ابدأ بإنشاء كوبون جديد"})]}):e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(U,{children:[e.jsx(n,{children:"الكود"}),e.jsx(n,{children:"النوع"}),e.jsx(n,{children:"القيمة"}),e.jsx(n,{children:"الاستخدامات"}),e.jsx(n,{children:"الصلاحية"}),e.jsx(n,{children:"الحالة"}),e.jsx(n,{children:"الإجراءات"})]})}),e.jsx(ae,{children:d.map(s=>e.jsxs(U,{children:[e.jsx(c,{className:"font-mono font-bold",children:s.code}),e.jsx(c,{children:s.type==="percentage"?"نسبة مئوية":"مبلغ ثابت"}),e.jsx(c,{children:s.type==="percentage"?`${s.value}%`:`${s.value} ج.م`}),e.jsxs(c,{children:[s.usedCount," / ",s.maxUses||"∞"]}),e.jsxs(c,{className:"text-sm",children:[new Date(s.validFrom).toLocaleDateString("ar-EG")," - ",new Date(s.validUntil).toLocaleDateString("ar-EG")]}),e.jsx(c,{children:I(s)}),e.jsx(c,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>k(s.$id),children:s.isActive?e.jsx(z,{className:"h-4 w-4 text-green-600"}):e.jsx(H,{className:"h-4 w-4 text-gray-400"})}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>E(s),children:e.jsx(P,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>L(s.$id),children:e.jsx(G,{className:"h-4 w-4 text-red-600"})})]})})]},s.$id))})]})})]})]})})}export{ve as default};
