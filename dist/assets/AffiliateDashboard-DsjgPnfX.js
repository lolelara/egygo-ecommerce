import{af as B,a8 as A,a9 as E,a0 as f,r as p,j as e,L as Me,C as v,e as w,f as y,ab as M,g as k,J as ge,aa as O,a2 as Se,a3 as Ee,a4 as U,a6 as W,b as se,B as S,ag as Oe,ah as qe,ai as _e,aj as Ue,t as ze,w as V,ak as je,a1 as G,al as pe,s as F,I as z,d as R,am as De,S as Z,a as P,G as Ae,N as te,an as fe,q as Be,ao as re,ap as We,aq as He,ar as Ve,as as Ke,at as Q,$ as Ge,au as Ze,av as Qe,a5 as Y,aw as Ne,ac as Ye}from"./index-Ce-RwxJS.js";import{A as X}from"./arrow-up-right-zD7_oLce.js";import{R as J,C as ne,X as le,Y as ie,T as ee,L as ce,B as Xe,a as ve,b as Je,c as es,P as ss,d as ts,e as as}from"./PieChart-Bo3gzuJc.js";import{A as rs,a as we}from"./AreaChart-C8-Li05-.js";import{C as be}from"./copy-CCGvNwUs.js";import{E as ns}from"./external-link-BlE5MYZK.js";import{T as H}from"./target-CDawgCx5.js";import{L as Le}from"./link-2-BDsvD2Ou.js";import{D as Pe}from"./download-UgG-gTV9.js";import{B as ls}from"./book-open-BiyIz1g9.js";import{Z as Ie}from"./zap-CZ8kwfra.js";import{L as is}from"./lightbulb-zSKIhQ1h.js";import{C as K}from"./clock-D_TAAEO_.js";import{f as cs}from"./formatDistanceToNow-BbsxV4jN.js";import{a as os}from"./ar-tf8aslgS.js";import{G as ds}from"./gift-51jgOl60.js";import{T as ms,a as xs,b as q,c as ye,d as hs,e as T}from"./table-DhT4s9qg.js";import{W as oe}from"./wallet-U6e7gbWw.js";import"./en-US-BI35v3bL.js";import"./endOfMonth-L50Q6j7v.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]],Re=B("calculator",us);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ue=B("circle-check",gs);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],de=B("crown",js);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]],ke=B("medal",ps);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"M14 4.1 12 6",key:"ita8i4"}],["path",{d:"m5.1 8-2.9-.8",key:"1go3kf"}],["path",{d:"m6 12-1.9 2",key:"mnht97"}],["path",{d:"M7.2 2.2 8 5.1",key:"1cfko1"}],["path",{d:"M9.037 9.69a.498.498 0 0 1 .653-.653l11 4.5a.5.5 0 0 1-.074.949l-4.349 1.041a1 1 0 0 0-.74.739l-1.04 4.35a.5.5 0 0 1-.95.074z",key:"s0h3yz"}]],bs=B("mouse-pointer-click",fs);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],Ce=B("scale",Ns);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],$e=B("trophy",vs);async function ws(t){try{const a=await A.listDocuments(E.databaseId,E.collections.affiliateStats,[f.equal("affiliateId",t),f.limit(1)]);if(a.documents.length>0){const r=a.documents[0];return{totalClicks:r.totalClicks||0,totalOrders:r.totalOrders||0,totalEarnings:r.totalEarnings||0,pendingEarnings:r.pendingEarnings||0,thisMonthEarnings:r.thisMonthEarnings||0,conversionRate:r.conversionRate||0,clicks:r.totalClicks||0,conversions:r.totalOrders||0,referralCount:r.totalOrders||0,commissionRate:15,affiliateCode:`AFF${t.slice(0,6).toUpperCase()}`,rank:r.rank||null}}const i={affiliateId:t,totalClicks:0,totalOrders:0,totalEarnings:0,pendingEarnings:0,thisMonthEarnings:0,conversionRate:0,updatedAt:new Date().toISOString()};try{await A.createDocument(E.databaseId,E.collections.affiliateStats,"unique()",i)}catch(r){console.error("Error creating stats:",r)}return{...i,clicks:0,conversions:0,referralCount:0,commissionRate:15,affiliateCode:`AFF${t.slice(0,6).toUpperCase()}`,rank:null}}catch(a){throw console.error("Error getting affiliate stats:",a),a}}async function ys(t,a=10){try{return(await A.listDocuments(E.databaseId,E.collections.affiliateActivities,[f.equal("affiliateId",t),f.orderDesc("createdAt"),f.limit(a)])).documents.map(r=>({id:r.$id,type:r.type,title:r.title,description:r.description,amount:r.amount,time:new Date(r.createdAt),productName:r.productName}))}catch(i){return console.error("Error getting activities:",i),[]}}async function ks(t,a=5){try{return(await A.listDocuments(E.databaseId,E.collections.notifications,[f.equal("userId",t),f.orderDesc("createdAt"),f.limit(a)])).documents.map(r=>({id:r.$id,type:r.type,title:r.title,message:r.message,actionLabel:r.actionLabel,actionLink:r.actionLink,isRead:r.isRead,isNew:r.isNew}))}catch(i){return console.error("Error getting notifications:",i),[]}}async function Cs(t){try{return(await A.listDocuments(E.databaseId,E.collections.withdrawalRequests,[f.equal("affiliateId",t),f.orderDesc("createdAt"),f.limit(10)])).documents.map(i=>({id:i.$id,amount:i.amount,fee:i.fee,netAmount:i.netAmount,paymentMethod:i.paymentMethod,status:i.status,createdAt:i.createdAt,processedAt:i.processedAt}))}catch(a){return console.error("Error getting withdrawal requests:",a),[]}}async function $s(t=10){try{return(await A.listDocuments(E.databaseId,E.collections.products,[f.equal("isActive",!0),f.orderDesc("$createdAt"),f.limit(t)])).documents}catch(a){return console.error("Error getting products:",a),[]}}async function Ss(t=10){try{return(await A.listDocuments(E.databaseId,E.collections.affiliateStats,[f.orderDesc("totalEarnings"),f.limit(t)])).documents.map((i,r)=>({rank:r+1,affiliateId:i.affiliateId,earnings:i.totalEarnings||0,clicks:i.totalClicks||0,orders:i.totalOrders||0}))}catch(a){return console.error("Error getting leaderboard:",a),[]}}const _=E.databaseId,me="affiliate_conversions",xe="affiliate_clicks",Es="affiliate_withdrawals";class Ds{async getStats(a){try{const r=(await A.listDocuments(_,me,[f.equal("affiliateId",a)])).documents,j=r.filter(C=>C.status==="paid"||C.status==="approved").reduce((C,I)=>C+(I.commission||0),0),m=r.filter(C=>C.status==="pending").reduce((C,I)=>C+(I.commission||0),0),x=(await A.listDocuments(_,xe,[f.equal("affiliateId",a),f.limit(1)])).total,d=r.length,l=x>0?d/x*100:0,u=new Date,s=new Date(u.getFullYear(),u.getMonth(),1),c=r.filter(C=>new Date(C.convertedAt)>=s),g=c.filter(C=>C.status==="paid"||C.status==="approved").reduce((C,I)=>C+(I.commission||0),0),D=c.length,o=(await A.listDocuments(_,xe,[f.equal("affiliateId",a),f.greaterThanEqual("clickedAt",s.toISOString()),f.limit(1)])).total,h=(await A.listDocuments(_,Es,[f.equal("affiliateId",a),f.equal("status","completed")])).documents.reduce((C,I)=>C+(I.amount||0),0),b=j-h;return{totalEarnings:j,totalClicks:x,totalSales:d,conversionRate:l,pendingEarnings:m,availableBalance:b,thisMonthEarnings:g,thisMonthClicks:o,thisMonthSales:D}}catch(i){return console.error("Error fetching affiliate stats:",i),{totalEarnings:0,totalClicks:0,totalSales:0,conversionRate:0,pendingEarnings:0,availableBalance:0,thisMonthEarnings:0,thisMonthClicks:0,thisMonthSales:0}}}async getEarningsData(a,i=7){try{const r=[],j=new Date;for(let m=i-1;m>=0;m--){const n=new Date(j);n.setDate(n.getDate()-m);const x=n.toISOString().split("T")[0],d=new Date(n);d.setDate(d.getDate()+1);const l=await A.listDocuments(_,me,[f.equal("affiliateId",a),f.greaterThanEqual("convertedAt",n.toISOString()),f.lessThan("convertedAt",d.toISOString())]),u=l.documents.filter(D=>D.status==="paid"||D.status==="approved").reduce((D,L)=>D+(L.commission||0),0),s=l.documents.length,g=(await A.listDocuments(_,xe,[f.equal("affiliateId",a),f.greaterThanEqual("clickedAt",n.toISOString()),f.lessThan("clickedAt",d.toISOString()),f.limit(1)])).total;r.push({date:x,earnings:u,clicks:g,sales:s})}return r}catch(r){return console.error("Error fetching earnings data:",r),[]}}async getProductPerformance(a){try{const i=await A.listDocuments(_,me,[f.equal("affiliateId",a)]),r=new Map;i.documents.forEach(m=>{const n=m.productId||"unknown",x=r.get(n)||{sales:0,earnings:0};r.set(n,{sales:x.sales+1,earnings:x.earnings+(m.commission||0)})});const j=[];for(const[m,n]of r.entries())j.push({name:`منتج ${m.substring(0,8)}`,sales:n.sales,earnings:n.earnings});return j.sort((m,n)=>n.earnings-m.earnings).slice(0,5)}catch(i){return console.error("Error fetching product performance:",i),[]}}}const he=new Ds;function As({affiliateId:t}){const[a,i]=p.useState("month"),[r,j]=p.useState(!0),[m,n]=p.useState({totalEarnings:0,totalClicks:0,totalSales:0,conversionRate:0,pendingEarnings:0,availableBalance:0}),[x,d]=p.useState([]),[l,u]=p.useState([]);p.useEffect(()=>{s()},[t,a]);const s=async()=>{if(t){j(!0);try{const g=await he.getStats(t);n(g);const D=a==="week"?7:a==="month"?30:365,L=await he.getEarningsData(t,D);d(L);const o=await he.getProductPerformance(t);u(o)}catch(g){console.error("Error loading affiliate data:",g)}finally{j(!1)}}},c=[{stage:"زيارات",value:m.totalClicks*4,color:"#8b5cf6"},{stage:"نقرات",value:m.totalClicks,color:"#ec4899"},{stage:"إضافة للسلة",value:Math.floor(m.totalClicks*.3),color:"#3b82f6"},{stage:"مبيعات",value:m.totalSales,color:"#10b981"}];return r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Me,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(v,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-purple-900",children:"إجمالي الأرباح"}),e.jsx(M,{className:"h-5 w-5 text-purple-600"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-900",children:["$",m.totalEarnings.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-purple-700 flex items-center mt-1",children:[e.jsx(X,{className:"h-3 w-3 ml-1"}),"+12.5% من الشهر الماضي"]})]})]}),e.jsxs(v,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-blue-900",children:"إجمالي النقرات"}),e.jsx(bs,{className:"h-5 w-5 text-blue-600"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:m.totalClicks.toLocaleString()}),e.jsxs("p",{className:"text-xs text-blue-700 flex items-center mt-1",children:[e.jsx(X,{className:"h-3 w-3 ml-1"}),"+8.2% من الشهر الماضي"]})]})]}),e.jsxs(v,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-green-900",children:"إجمالي المبيعات"}),e.jsx(ge,{className:"h-5 w-5 text-green-600"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-900",children:m.totalSales}),e.jsxs("p",{className:"text-xs text-green-700 flex items-center mt-1",children:[e.jsx(X,{className:"h-3 w-3 ml-1"}),"+15.3% من الشهر الماضي"]})]})]}),e.jsxs(v,{className:"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-orange-900",children:"معدل التحويل"}),e.jsx(O,{className:"h-5 w-5 text-orange-600"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[m.conversionRate,"%"]}),e.jsxs("p",{className:"text-xs text-orange-700 flex items-center mt-1",children:[e.jsx(X,{className:"h-3 w-3 ml-1"}),"+2.1% من الشهر الماضي"]})]})]})]}),e.jsxs(Se,{value:a,onValueChange:g=>i(g),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"تحليلات الأداء"}),e.jsxs(Ee,{children:[e.jsx(U,{value:"week",children:"أسبوع"}),e.jsx(U,{value:"month",children:"شهر"}),e.jsx(U,{value:"year",children:"سنة"})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"الأرباح والمبيعات"}),e.jsx(W,{children:"تتبع أرباحك ومبيعاتك بمرور الوقت"})]}),e.jsx(k,{children:e.jsx(J,{width:"100%",height:300,children:e.jsxs(rs,{data:x,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorEarnings",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorSales",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})]}),e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"date"}),e.jsx(ie,{}),e.jsx(ee,{}),e.jsx(ce,{}),e.jsx(we,{type:"monotone",dataKey:"earnings",stroke:"#8b5cf6",fillOpacity:1,fill:"url(#colorEarnings)",name:"الأرباح ($)"}),e.jsx(we,{type:"monotone",dataKey:"sales",stroke:"#10b981",fillOpacity:1,fill:"url(#colorSales)",name:"المبيعات"})]})})})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"أداء المنتجات"}),e.jsx(W,{children:"أفضل الفئات مبيعاً"})]}),e.jsx(k,{children:e.jsx(J,{width:"100%",height:300,children:e.jsxs(Xe,{data:l,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name"}),e.jsx(ie,{}),e.jsx(ee,{}),e.jsx(ce,{}),e.jsx(ve,{dataKey:"sales",fill:"#8b5cf6",name:"المبيعات"}),e.jsx(ve,{dataKey:"earnings",fill:"#ec4899",name:"الأرباح ($)"})]})})})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"اتجاه النقرات"}),e.jsx(W,{children:"عدد النقرات على روابطك"})]}),e.jsx(k,{children:e.jsx(J,{width:"100%",height:300,children:e.jsxs(Je,{data:x,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"date"}),e.jsx(ie,{}),e.jsx(ee,{}),e.jsx(ce,{}),e.jsx(es,{type:"monotone",dataKey:"clicks",stroke:"#3b82f6",strokeWidth:3,name:"النقرات",dot:{fill:"#3b82f6",r:5}})]})})})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"قمع التحويل"}),e.jsx(W,{children:"رحلة العميل من الزيارة للشراء"})]}),e.jsx(k,{children:e.jsx(J,{width:"100%",height:300,children:e.jsxs(ss,{children:[e.jsx(ts,{data:c,cx:"50%",cy:"50%",labelLine:!1,label:({stage:g,value:D})=>`${g}: ${D}`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:c.map((g,D)=>e.jsx(as,{fill:g.color},`cell-${D}`))}),e.jsx(ee,{})]})})})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(v,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 border-yellow-200",children:[e.jsxs(w,{children:[e.jsx(y,{className:"text-yellow-900",children:"الأرباح المعلقة"}),e.jsx(W,{className:"text-yellow-700",children:"في انتظار تأكيد الطلبات"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-3xl font-bold text-yellow-900",children:["$",m.pendingEarnings.toLocaleString()]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-2",children:"سيتم إضافتها للرصيد المتاح بعد 7 أيام"})]})]}),e.jsxs(v,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsxs(w,{children:[e.jsx(y,{className:"text-green-900",children:"الرصيد المتاح"}),e.jsx(W,{className:"text-green-700",children:"جاهز للسحب"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-3xl font-bold text-green-900",children:["$",m.availableBalance.toLocaleString()]}),e.jsx("p",{className:"text-sm text-green-700 mt-2",children:"الحد الأدنى للسحب: $50"})]})]})]})]})}function Ls({link:t,productName:a="منتج رائع"}){const{toast:i}=se(),r=()=>{const l=`🛍️ ${a}

تسوق الآن واحصل على أفضل الأسعار!
${t}`;window.open(`https://wa.me/?text=${encodeURIComponent(l)}`,"_blank")},j=()=>{window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(t)}`,"_blank")},m=()=>{const l=`🛍️ ${a} - تسوق الآن!`;window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(l)}&url=${encodeURIComponent(t)}`,"_blank")},n=()=>{const l=`🛍️ ${a}

تسوق الآن واحصل على أفضل الأسعار!`;window.open(`https://t.me/share/url?url=${encodeURIComponent(t)}&text=${encodeURIComponent(l)}`,"_blank")},x=()=>{const l=`تسوق الآن: ${a}`,u=`مرحباً،

أود أن أشارك معك هذا المنتج الرائع:

${a}

رابط المنتج: ${t}

تسوق سعيد!`;window.open(`mailto:?subject=${encodeURIComponent(l)}&body=${encodeURIComponent(u)}`)},d=()=>{navigator.clipboard.writeText(t),i({title:"✅ تم النسخ",description:"تم نسخ الرابط بنجاح"})};return e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(S,{size:"sm",variant:"outline",onClick:r,className:"hover:bg-green-50 hover:border-green-500 transition-all",title:"مشاركة على واتساب",children:e.jsx(Oe,{className:"h-4 w-4 text-green-600"})}),e.jsx(S,{size:"sm",variant:"outline",onClick:j,className:"hover:bg-blue-50 hover:border-blue-500 transition-all",title:"مشاركة على فيسبوك",children:e.jsx(qe,{className:"h-4 w-4 text-blue-600"})}),e.jsx(S,{size:"sm",variant:"outline",onClick:m,className:"hover:bg-sky-50 hover:border-sky-500 transition-all",title:"مشاركة على تويتر",children:e.jsx(_e,{className:"h-4 w-4 text-sky-500"})}),e.jsx(S,{size:"sm",variant:"outline",onClick:n,className:"hover:bg-blue-50 hover:border-blue-400 transition-all",title:"مشاركة على تيليجرام",children:e.jsx(Ue,{className:"h-4 w-4 text-blue-500"})}),e.jsx(S,{size:"sm",variant:"outline",onClick:x,className:"hover:bg-gray-50 hover:border-gray-500 transition-all",title:"مشاركة عبر البريد",children:e.jsx(ze,{className:"h-4 w-4 text-gray-600"})}),e.jsx(S,{size:"sm",variant:"outline",onClick:d,className:"hover:bg-purple-50 hover:border-purple-500 transition-all",title:"نسخ الرابط",children:e.jsx(be,{className:"h-4 w-4 text-purple-600"})})]})}function Ps(){const{user:t}=V(),{toast:a}=se(),[i,r]=p.useState([]),[j,m]=p.useState(!0),[n,x]=p.useState({}),[d,l]=p.useState(null);p.useEffect(()=>{t&&u()},[t]);const u=async()=>{try{m(!0);const N=(await A.listDocuments(E.databaseId,E.collections.products,[f.equal("isActive",!0),f.orderDesc("$createdAt"),f.limit(50)])).documents.map(b=>({$id:b.$id,name:b.name,basePrice:b.basePrice||b.price||0,minCommissionPrice:b.minCommissionPrice||b.price||0,images:b.images||[],merchantId:b.merchantId,isActive:b.isActive}));r(N);const h={};N.forEach(b=>{h[b.$id]=b.minCommissionPrice}),x(h)}catch(o){console.error("Error loading products:",o),a({title:"خطأ",description:"فشل في تحميل المنتجات",variant:"destructive"})}finally{m(!1)}},s=(o,N)=>{const h=N-o.basePrice,b=(h/o.basePrice*100).toFixed(1);return{commission:h,commissionPercentage:b}},c=o=>{const N=t?.affiliateCode||`AFF${t?.$id.slice(0,6).toUpperCase()}`,h=n[o]||0;return`${window.location.origin}/#/product/${o}?ref=${N}&price=${h}`},g=async(o,N)=>{try{await navigator.clipboard.writeText(o),l(N),a({title:"تم النسخ!",description:"تم نسخ رابط الشراكة إلى الحافظة"}),setTimeout(()=>l(null),2e3)}catch{a({title:"خطأ",description:"فشل في نسخ الرابط",variant:"destructive"})}},D=(o,N)=>{const h=parseFloat(N)||0;x(b=>({...b,[o]:h}))},L=(o,N)=>N>=o.minCommissionPrice;return j?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري التحميل..."})]})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"إنشاء روابط الشراكة"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"قم بإنشاء روابط شراكة مخصصة مع تحديد سعرك الخاص (يجب أن يكون أعلى من الحد الأدنى)"})]}),e.jsxs(k,{children:[e.jsxs(je,{className:"mb-6",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsxs(pe,{children:[e.jsx("strong",{children:"كيف يعمل النظام:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"السعر الأساسي: سعر المنتج قبل العمولة (يحدده التاجر)"}),e.jsx("li",{children:"الحد الأدنى للسعر: أقل سعر يمكنك بيع المنتج به (يحدده التاجر)"}),e.jsx("li",{children:"سعرك المخصص: يمكنك إضافة أي قيمة أعلى من الحد الأدنى"}),e.jsx("li",{children:"عمولتك = سعرك المخصص - السعر الأساسي"})]})]})]}),e.jsx("div",{className:"space-y-4",children:i.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"لا توجد منتجات متاحة حالياً"})}):i.map(o=>{const N=n[o.$id]||o.minCommissionPrice,{commission:h,commissionPercentage:b}=s(o,N),C=L(o,N);return e.jsxs("div",{className:`p-4 border rounded-lg ${C?"":"border-destructive"}`,children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("img",{src:o.images[0]||"/placeholder.svg",alt:o.name,className:"w-16 h-16 object-cover rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium mb-2",children:o.name}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"السعر الأساسي:"}),e.jsxs("p",{className:"font-semibold",children:["$",o.basePrice.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحد الأدنى:"}),e.jsxs("p",{className:"font-semibold text-orange-600",children:["$",o.minCommissionPrice.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"عمولتك:"}),e.jsxs("p",{className:"font-semibold text-green-600",children:["$",h.toFixed(2)," (",b,"%)"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"سعرك النهائي:"}),e.jsxs("p",{className:"font-semibold text-blue-600",children:["$",N.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(F,{htmlFor:`price-${o.$id}`,children:["سعرك المخصص (الحد الأدنى: $",o.minCommissionPrice.toFixed(2),")"]}),e.jsx(z,{id:`price-${o.$id}`,type:"number",step:"0.01",min:o.minCommissionPrice,value:N,onChange:I=>D(o.$id,I.target.value),className:C?"":"border-destructive"}),!C&&e.jsxs("p",{className:"text-xs text-destructive mt-1",children:["السعر يجب أن يكون أعلى من أو يساوي $",o.minCommissionPrice.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:`link-${o.$id}`,children:"رابط الشراكة"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{id:`link-${o.$id}`,value:c(o.$id),readOnly:!0,className:"flex-1"}),e.jsx(S,{variant:"outline",size:"icon",onClick:()=>g(c(o.$id),o.$id),disabled:!C,children:d===o.$id?e.jsx("span",{className:"text-xs",children:"✓"}):e.jsx(be,{className:"h-4 w-4"})}),e.jsx(S,{variant:"outline",size:"icon",asChild:!0,disabled:!C,children:e.jsx("a",{href:c(o.$id),target:"_blank",rel:"noopener noreferrer",children:e.jsx(ns,{className:"h-4 w-4"})})})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx(F,{className:"mb-2 block",children:"مشاركة سريعة"}),e.jsx(Ls,{link:c(o.$id),productName:o.name})]})]},o.$id)})})]})]})})}function Is({onCalculatorClick:t}){return e.jsxs(v,{className:"border-primary/20 shadow-lg",children:[e.jsx(w,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-primary"}),"إجراءات سريعة"]})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:[e.jsx(S,{variant:"outline",className:"flex-col h-24 hover:bg-primary/10 hover:border-primary transition-all",asChild:!0,children:e.jsxs(R,{to:"#links",children:[e.jsx(Le,{className:"h-6 w-6 mb-2 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:"إنشاء رابط"})]})}),e.jsxs(S,{variant:"outline",className:"flex-col h-24 hover:bg-green-50 hover:border-green-500 transition-all",onClick:()=>{const a=`تسوق الآن من إيجي جو واحصل على أفضل العروض! 🛍️
${window.location.origin}`;navigator.share?navigator.share({text:a}):navigator.clipboard.writeText(a)},children:[e.jsx(De,{className:"h-6 w-6 mb-2 text-green-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"مشاركة سريعة"})]}),e.jsx(S,{variant:"outline",className:"flex-col h-24 hover:bg-blue-50 hover:border-blue-500 transition-all",asChild:!0,children:e.jsxs(R,{to:"/affiliate/banners",children:[e.jsx(Pe,{className:"h-6 w-6 mb-2 text-blue-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"تحميل بانر"})]})}),e.jsxs(S,{variant:"outline",className:"flex-col h-24 hover:bg-purple-50 hover:border-purple-500 transition-all",onClick:t,children:[e.jsx(Re,{className:"h-6 w-6 mb-2 text-purple-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"حاسبة الأرباح"})]}),e.jsx(S,{variant:"outline",className:"flex-col h-24 hover:bg-orange-50 hover:border-orange-500 transition-all",asChild:!0,children:e.jsxs(R,{to:"/affiliate/marketing-tips",children:[e.jsx(ls,{className:"h-6 w-6 mb-2 text-orange-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"نصائح التسويق"})]})}),e.jsx(S,{variant:"outline",className:"flex-col h-24 hover:bg-pink-50 hover:border-pink-500 transition-all",asChild:!0,children:e.jsxs(R,{to:"/affiliate/courses",children:[e.jsx(H,{className:"h-6 w-6 mb-2 text-pink-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"الكورسات"})]})})]})})]})}function Rs(){const[t,a]=p.useState(10),[i,r]=p.useState(50),[j,m]=p.useState(2),n=()=>{const u=t*i,s=u*7,c=u*30,g=u*365;return{daily:u,weekly:s,monthly:c,yearly:g}},x=()=>Math.ceil(t/(j/100)),d=n(),l=x();return e.jsxs(v,{className:"border-green-200 shadow-lg bg-gradient-to-br from-white to-green-50/30 dark:from-neutral-800 dark:to-neutral-800",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-green-600"}),"حاسبة الأرباح المتوقعة"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"احسب أرباحك المتوقعة بناءً على أهدافك"})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"sales",className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"المبيعات اليومية"]}),e.jsx(z,{id:"sales",type:"number",min:"1",value:t,onChange:u=>a(Number(u.target.value)),className:"text-lg font-semibold"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"commission",className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"متوسط العمولة (ج.م)"]}),e.jsx(z,{id:"commission",type:"number",min:"1",value:i,onChange:u=>r(Number(u.target.value)),className:"text-lg font-semibold"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"conversion",className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"معدل التحويل (%)"]}),e.jsx(z,{id:"conversion",type:"number",min:"0.1",step:"0.1",value:j,onChange:u=>m(Number(u.target.value)),className:"text-lg font-semibold"})]})]}),e.jsx(Z,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg text-center border border-green-200",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"يومياً"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d.daily.toFixed(0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ج.م"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-lg text-center border border-blue-200",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"أسبوعياً"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:d.weekly.toFixed(0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ج.م"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg text-center border border-purple-200",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"شهرياً"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:d.monthly.toFixed(0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ج.م"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-orange-50 to-yellow-50 dark:from-orange-900/20 dark:to-yellow-900/20 rounded-lg text-center border border-orange-200",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"سنوياً"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:d.yearly.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ج.م"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"النقرات المطلوبة يومياً"}),e.jsx(P,{variant:"secondary",className:"text-lg font-bold mt-1",children:l})]}),e.jsx(Z,{orientation:"vertical",className:"h-12"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"المبيعات المطلوبة شهرياً"}),e.jsx(P,{variant:"secondary",className:"text-lg font-bold mt-1",children:t*30})]})]}),e.jsxs("div",{className:"text-center text-xs text-muted-foreground p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:["💡 ",e.jsx("strong",{children:"نصيحة:"})," لتحقيق هدفك الشهري، ركز على زيادة معدل التحويل من خلال استهداف الجمهور المناسب"]})]})]})]})}function Fs(){const[t,a]=p.useState([]),[i,r]=p.useState(!0);p.useEffect(()=>{j()},[]);const j=async()=>{try{const m=await A.listDocuments(E.databaseId,E.collections.products,[f.equal("isActive",!0),f.orderDesc("$createdAt"),f.limit(5)]),n=await Promise.all(m.documents.map(async x=>{const d=x.basePrice||x.price||0,l=x.minCommissionPrice||x.price||0,u=l-d;let s=0,c=0;try{const g=await A.listDocuments(E.databaseId,E.collections.affiliateClicks,[f.equal("productId",x.$id),f.limit(1e3)]);s=g.total,c=g.documents.filter(D=>D.converted).length}catch(g){console.error("Error loading product stats:",g)}return{id:x.$id,name:x.name,image:Ae(x.images?.[0]),basePrice:d,minCommissionPrice:l,commission:u,clicks:s,sales:c}}));n.sort((x,d)=>d.commission-x.commission),a(n)}catch(m){console.error("Error loading top products:",m)}finally{r(!1)}};return i?e.jsx(v,{children:e.jsx(w,{children:e.jsx(y,{children:"جاري التحميل..."})})}):e.jsxs(v,{className:"border-yellow-200 shadow-lg",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5 text-yellow-500"}),"أفضل المنتجات للترويج"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"المنتجات الأعلى عمولة والأكثر مبيعاً"})]}),e.jsxs(k,{className:"space-y-3",children:[t.map((m,n)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 hover:bg-muted rounded-lg transition-all group",children:[e.jsx(P,{className:`w-8 h-8 flex items-center justify-center text-sm font-bold ${n===0?"bg-gradient-to-br from-yellow-400 to-yellow-600":n===1?"bg-gradient-to-br from-gray-300 to-gray-500":n===2?"bg-gradient-to-br from-orange-400 to-orange-600":"bg-gradient-to-br from-blue-400 to-blue-600"}`,children:n+1}),e.jsx("img",{src:m.image,alt:m.name,className:"w-14 h-14 rounded-lg object-cover border-2 border-muted group-hover:border-primary transition-all"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm line-clamp-1 group-hover:text-primary transition-colors",children:m.name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(M,{className:"h-3 w-3 text-green-600"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[m.commission.toFixed(0)," ج.م"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(te,{className:"h-3 w-3"}),m.clicks]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(O,{className:"h-3 w-3"}),m.sales," مبيعة"]})]})]}),e.jsx(S,{size:"sm",variant:"outline",className:"group-hover:bg-primary group-hover:text-white transition-all",asChild:!0,children:e.jsx(R,{to:`#product-${m.id}`,children:"روّج الآن"})})]},m.id)),t.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx($e,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد منتجات متاحة حالياً"})]})]})]})}function Ts({stats:t}){const a=t?.conversionRate||0,i=t?.totalClicks||0,r=t?.totalOrders||0,j=t?.totalEarnings||0,n=a>=5?{level:"ممتاز",color:"green",percentage:90}:a>=3?{level:"جيد جداً",color:"blue",percentage:70}:a>=2?{level:"جيد",color:"yellow",percentage:50}:{level:"يحتاج تحسين",color:"orange",percentage:30},x=[];a>=3?x.push({icon:O,color:"green",title:"أداء ممتاز!",description:`معدل التحويل ${a.toFixed(1)}% أعلى من ${n.percentage}% من المسوقين`,type:"success"}):a<2&&x.push({icon:G,color:"orange",title:"يمكنك تحسين الأداء",description:"جرب استهداف جمهور أكثر تحديداً لزيادة معدل التحويل",type:"warning"}),i>100&&x.push({icon:Ie,color:"blue",title:"نشاط رائع!",description:`حققت ${i} نقرة - استمر في المشاركة النشطة`,type:"info"}),x.push({icon:is,color:"purple",title:"نصيحة ذكية",description:"المنتجات في فئة 'إلكترونيات' تحقق أعلى عمولة بمتوسط 15%",type:"tip"}),j<1e3?x.push({icon:H,color:"pink",title:"هدفك القادم",description:`تحتاج ${(1e3-j).toFixed(0)} ج.م للوصول لمستوى 'المسوق الذهبي'`,type:"goal"}):x.push({icon:fe,color:"yellow",title:"إنجاز رائع!",description:"وصلت لمستوى 'المسوق الذهبي' - استمر في التميز",type:"achievement"});const d=(l,u)=>{const s={green:{bg:"bg-green-50 dark:bg-green-900/20",text:"text-green-600",border:"border-green-200"},blue:{bg:"bg-blue-50 dark:bg-blue-900/20",text:"text-blue-600",border:"border-blue-200"},orange:{bg:"bg-orange-50 dark:bg-orange-900/20",text:"text-orange-600",border:"border-orange-200"},purple:{bg:"bg-purple-50 dark:bg-purple-900/20",text:"text-purple-600",border:"border-purple-200"},pink:{bg:"bg-pink-50 dark:bg-pink-900/20",text:"text-pink-600",border:"border-pink-200"},yellow:{bg:"bg-yellow-50 dark:bg-yellow-900/20",text:"text-yellow-600",border:"border-yellow-200"}};return s[l]?.[u]||s.blue[u]};return e.jsxs(v,{className:"border-purple-200 shadow-lg",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5 text-purple-600"}),"رؤى الأداء"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"تحليل ذكي لأدائك ونصائح للتحسين"})]}),e.jsxs(k,{className:"space-y-3",children:[e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg border-2 ${d(n.color,"bg")} ${d(n.color,"border")}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"مستوى الأداء"}),e.jsx("p",{className:`text-2xl font-bold ${d(n.color,"text")}`,children:n.level})]}),e.jsxs(P,{className:`${d(n.color,"bg")} ${d(n.color,"text")} text-lg px-4 py-2`,children:[a.toFixed(1),"%"]})]}),x.map((l,u)=>{const s=l.icon;return e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border ${d(l.color,"bg")} ${d(l.color,"border")} transition-all hover:shadow-md`,children:[e.jsx("div",{className:`p-2 rounded-lg ${d(l.color,"bg")}`,children:e.jsx(s,{className:`h-5 w-5 ${d(l.color,"text")}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm",children:l.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:l.description})]})]},u)}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 pt-2",children:[e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"النقرات"}),e.jsx("p",{className:"text-lg font-bold",children:i})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"المبيعات"}),e.jsx("p",{className:"text-lg font-bold",children:r})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"التحويل"}),e.jsxs("p",{className:"text-lg font-bold",children:[a.toFixed(1),"%"]})]})]})]})]})}function Ms({activities:t}){const{user:a}=V(),[i,r]=p.useState(t||[]),[j,m]=p.useState(!t);p.useEffect(()=>{!t&&a?.$id&&n()},[a,t]);const n=async()=>{if(a?.$id)try{m(!0);const c=await ys(a.$id,10);r(c)}catch(c){console.error("Error loading activities:",c),r([])}finally{m(!1)}},x=[{id:"1",type:"sale",title:"مبيعة جديدة",description:"تم شراء ساعة ذكية عبر رابطك",amount:45.5,time:new Date(Date.now()-1e3*60*30),productName:"ساعة ذكية متطورة"},{id:"2",type:"earning",title:"عمولة مضافة",description:"تم إضافة عمولة إلى رصيدك",amount:45.5,time:new Date(Date.now()-1e3*60*45)},{id:"3",type:"click",title:"نقرات جديدة",description:"15 نقرة على رابط سماعات لاسلكية",time:new Date(Date.now()-1e3*60*60*2),productName:"سماعات لاسلكية Pro"},{id:"4",type:"link_created",title:"رابط جديد",description:"تم إنشاء رابط لمنتج كاميرا احترافية",time:new Date(Date.now()-1e3*60*60*5),productName:"كاميرا احترافية 4K"},{id:"5",type:"sale",title:"مبيعة جديدة",description:"تم شراء لابتوب ألعاب عبر رابطك",amount:120,time:new Date(Date.now()-1e3*60*60*24),productName:"لابتوب ألعاب متطور"},{id:"6",type:"click",title:"نقرات جديدة",description:"8 نقرات على رابط تابلت رسم",time:new Date(Date.now()-1e3*60*60*24*2),productName:"تابلت رسم رقمي"}],d=i.length>0?i:j?[]:x,l=c=>{switch(c){case"sale":return ge;case"click":return te;case"link_created":return Le;case"earning":return M;default:return O}},u=c=>{switch(c){case"sale":return"text-green-600 bg-green-100 dark:bg-green-900/20";case"click":return"text-blue-600 bg-blue-100 dark:bg-blue-900/20";case"link_created":return"text-purple-600 bg-purple-100 dark:bg-purple-900/20";case"earning":return"text-orange-600 bg-orange-100 dark:bg-orange-900/20";default:return"text-gray-600 bg-gray-100 dark:bg-gray-900/20"}},s=c=>c==="sale"||c==="earning"?"default":"secondary";return e.jsxs(v,{className:"shadow-lg",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5 text-primary"}),"النشاطات الأخيرة"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"تتبع آخر تحديثات حسابك"})]}),e.jsx(k,{children:j?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-4",children:[d.map((c,g)=>{const D=l(c.type),L=u(c.type);return e.jsxs("div",{className:"flex gap-3 items-start group",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${L} group-hover:scale-110 transition-transform`,children:e.jsx(D,{className:"h-5 w-5"})}),g<i.length-1&&e.jsx("div",{className:"w-0.5 h-12 bg-muted mt-2"})]}),e.jsx("div",{className:"flex-1 pb-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm group-hover:text-primary transition-colors",children:c.title}),c.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:c.description}),c.productName&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:"المنتج:"}),c.productName]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3"}),cs(c.time,{addSuffix:!0,locale:os})]})]}),c.amount&&e.jsxs(P,{variant:s(c.type),className:"text-sm font-bold whitespace-nowrap",children:["+",c.amount.toFixed(2)," ج.م"]})]})})]},c.id)}),d.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(K,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد نشاطات حديثة"}),e.jsx("p",{className:"text-xs mt-1",children:"ابدأ بإنشاء روابط ومشاركتها"})]})]})})]})}function Os({currentUserRank:t,currentUserEarnings:a}){const{user:i}=V(),[r,j]=p.useState([]),[m,n]=p.useState(!0),[x,d]=p.useState(t||0),[l,u]=p.useState(a||0);p.useEffect(()=>{s()},[]);const s=async()=>{try{n(!0);const h=await Ss(10);if(j(h),i?.$id){const b=h.findIndex(C=>C.affiliateId===i.$id);b!==-1&&(d(b+1),u(h[b].earnings))}}catch(h){console.error("Error loading leaderboard:",h),j([])}finally{n(!1)}},c=r.slice(0,5).map((h,b)=>({rank:b+1,affiliateId:h.affiliateId,name:h.affiliateId===i?.$id?"أنت":`مسوق ${b+1}`,earnings:h.earnings||0,avatar:b===0?"👑":b===1?"🌟":b===2?"🎯":b===3?"⭐":"💎",isCurrentUser:h.affiliateId===i?.$id})),g=c.find(h=>h.rank===x-1),D=g?g.earnings-l:0,L=g?l/g.earnings*100:100,o=h=>{switch(h){case 1:return e.jsx(de,{className:"h-5 w-5 text-yellow-500"});case 2:return e.jsx(ke,{className:"h-5 w-5 text-gray-400"});case 3:return e.jsx(ke,{className:"h-5 w-5 text-orange-500"});default:return e.jsx(fe,{className:"h-5 w-5 text-blue-500"})}},N=h=>{switch(h){case 1:return"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white";case 2:return"bg-gradient-to-r from-gray-300 to-gray-500 text-white";case 3:return"bg-gradient-to-r from-orange-400 to-orange-600 text-white";default:return"bg-gradient-to-r from-blue-400 to-blue-600 text-white"}};return e.jsxs(v,{className:"border-yellow-200 shadow-lg bg-gradient-to-br from-white to-yellow-50/30 dark:from-neutral-800 dark:to-neutral-800",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5 text-yellow-500"}),"لوحة المتصدرين"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"تنافس مع أفضل المسوقين هذا الشهر"})]}),e.jsx(k,{className:"space-y-4",children:m?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs(e.Fragment,{children:[x>0&&e.jsxs("div",{className:"p-4 bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-lg border-2 border-yellow-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(P,{className:`${N(x)} text-lg px-3 py-1`,children:["#",x]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-lg",children:"أنت 🎯"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"مركزك الحالي"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-2xl text-orange-600",children:l.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ج.م"})]})]}),g&&D>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-muted-foreground",children:["التقدم للمركز ",g.rank]}),e.jsxs("span",{className:"font-semibold",children:[L.toFixed(0),"%"]})]}),e.jsx(Be,{value:L,className:"h-2"}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground",children:["تحتاج ",e.jsxs("strong",{className:"text-primary",children:[D.toLocaleString()," ج.م"]})," للوصول للمركز ",g.rank]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold text-muted-foreground mb-3",children:["أفضل ",c.length," مسوقين"]}),c.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(de,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات متاحة"}),e.jsx("p",{className:"text-xs mt-1",children:"كن أول المتصدرين!"})]}):c.map(h=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg transition-all ${h.isCurrentUser?"bg-primary/10 border-2 border-primary":"bg-muted/50 hover:bg-muted"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:`${N(h.rank)} w-8 h-8 flex items-center justify-center`,children:h.rank}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:h.avatar}),e.jsxs("div",{children:[e.jsx("p",{className:`font-semibold text-sm ${h.isCurrentUser?"text-primary":""}`,children:h.name}),h.rank<=3&&e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[o(h.rank),e.jsx("span",{className:"text-xs text-muted-foreground",children:h.rank===1?"البطل":h.rank===2?"الوصيف":"الثالث"})]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-lg",children:h.earnings.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ج.م"})]})]},h.rank))]}),e.jsxs("div",{className:"text-center p-3 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg",children:[e.jsx(O,{className:"h-8 w-8 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-sm font-semibold",children:"استمر في التميز!"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"كل مبيعة تقربك من القمة 🚀"})]})]})})]})}function qs(){const{user:t}=V(),[a,i]=p.useState([]),[r,j]=p.useState(!0);p.useEffect(()=>{t?.$id?m():j(!1)},[t]);const m=async()=>{if(t?.$id)try{j(!0);const l=await ks(t.$id,10);i(l)}catch(l){console.error("Error loading notifications:",l),i([])}finally{j(!1)}},n=async l=>{try{await A.updateDocument(E.databaseId,E.collections.notifications,l,{isRead:!0,isNew:!1}),i(u=>u.map(s=>s.id===l?{...s,isNew:!1}:s))}catch(u){console.error("Error marking as read:",u)}},x=l=>{switch(l){case"opportunity":return Ie;case"achievement":return fe;case"tip":return H;case"warning":return G;case"promotion":return ds;default:return re}},d=l=>{switch(l){case"opportunity":return{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200",icon:"text-blue-600"};case"achievement":return{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200",icon:"text-green-600"};case"tip":return{bg:"bg-purple-50 dark:bg-purple-900/20",border:"border-purple-200",icon:"text-purple-600"};case"warning":return{bg:"bg-orange-50 dark:bg-orange-900/20",border:"border-orange-200",icon:"text-orange-600"};case"promotion":return{bg:"bg-pink-50 dark:bg-pink-900/20",border:"border-pink-200",icon:"text-pink-600"};default:return{bg:"bg-gray-50 dark:bg-gray-900/20",border:"border-gray-200",icon:"text-gray-600"}}};return e.jsxs(v,{className:"border-blue-200 shadow-lg",children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-blue-600"}),"تنبيهات ذكية"]}),e.jsxs(P,{variant:"destructive",className:"animate-pulse",children:[a.filter(l=>l.isNew).length," جديد"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"إشعارات مخصصة لتحسين أدائك"})]}),e.jsx(k,{className:"space-y-3",children:r?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):a.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(re,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد إشعارات جديدة"}),e.jsx("p",{className:"text-xs mt-1",children:"سنبقيك على اطلاع بكل جديد"})]}):a.map(l=>{const u=x(l.type),s=d(l.type);return e.jsxs(je,{className:`${s.bg} ${s.border} border-2 transition-all hover:shadow-md relative`,children:[l.isNew&&e.jsx(P,{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs px-2 py-0.5",children:"جديد"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.bg}`,children:e.jsx(u,{className:`h-5 w-5 ${s.icon}`})}),e.jsx("div",{className:"flex-1",children:e.jsxs(pe,{children:[e.jsx("p",{className:"font-semibold text-sm mb-1",children:l.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l.message}),l.actionLabel&&e.jsx(S,{size:"sm",variant:"outline",className:"mt-3 h-8 text-xs",onClick:()=>{if(l.isNew&&n(l.id),l.actionLink)if(l.actionLink.startsWith("#")){const c=document.querySelector(l.actionLink);c&&c.scrollIntoView({behavior:"smooth"})}else window.location.href=l.actionLink},children:l.actionLabel})]})})]})]},l.id)})})]})}function _s(){const[t,a]=p.useState([]),[i,r]=p.useState(!0),[j,m]=p.useState([]);p.useEffect(()=>{n()},[]);const n=async()=>{try{const s=await A.listDocuments(E.databaseId,E.collections.products,[f.equal("isActive",!0),f.orderDesc("$createdAt"),f.limit(6)]),c=await Promise.all(s.documents.map(async g=>{const D=g.basePrice||g.price||0,L=g.minCommissionPrice||g.price||0,o=L-D;let N=0,h=0;try{const b=await A.listDocuments(E.databaseId,E.collections.affiliateClicks,[f.equal("productId",g.$id),f.limit(1e3)]);h=b.total;const C=b.documents.filter(I=>I.converted).length;N=h>0?parseFloat((C/h*100).toFixed(1)):0}catch(b){console.error("Error loading conversion rate:",b)}return{id:g.$id,name:g.name,image:Ae(g.images?.[0]),basePrice:D,minCommissionPrice:L,commission:o,conversionRate:N,clicks:h}}));a(c)}catch(s){console.error("Error loading products:",s)}finally{r(!1)}},x=s=>{m(c=>c.includes(s)?c.filter(g=>g!==s):c.length>=3?c:[...c,s])},d=t.filter(s=>j.includes(s.id)),u=d.length===0?null:d.reduce((s,c)=>c.commission>s.commission?c:s);return i?e.jsx(v,{children:e.jsx(w,{children:e.jsx(y,{children:"جاري التحميل..."})})}):e.jsxs(v,{className:"shadow-lg",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5 text-primary"}),"قارن المنتجات"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"اختر حتى 3 منتجات للمقارنة واختيار الأفضل للترويج"})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:t.map(s=>{const c=j.includes(s.id);return e.jsxs("button",{onClick:()=>x(s.id),className:`p-3 rounded-lg border-2 transition-all text-left ${c?"border-primary bg-primary/10":"border-muted hover:border-primary/50"}`,disabled:!c&&j.length>=3,children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-24 object-cover rounded-lg mb-2"}),c&&e.jsx(ue,{className:"absolute top-1 right-1 h-6 w-6 text-primary bg-white rounded-full"})]}),e.jsx("p",{className:"font-semibold text-xs line-clamp-2",children:s.name}),e.jsxs(P,{variant:"secondary",className:"mt-1 text-xs",children:[s.commission.toFixed(0)," ج.م"]})]},s.id)})}),d.length>0&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(ms,{children:[e.jsx(xs,{children:e.jsxs(q,{className:"bg-muted/50",children:[e.jsx(ye,{className:"font-bold",children:"المعيار"}),d.map(s=>e.jsx(ye,{className:"text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("img",{src:s.image,alt:s.name,className:"w-12 h-12 rounded object-cover"}),e.jsx("span",{className:"text-xs line-clamp-1",children:s.name})]})},s.id))]})}),e.jsxs(hs,{children:[e.jsxs(q,{children:[e.jsx(T,{className:"font-semibold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-green-600"}),"العمولة"]})}),d.map(s=>e.jsx(T,{className:"text-center",children:e.jsxs(P,{variant:s.id===u?.id?"default":"secondary",className:"font-bold",children:[s.commission.toFixed(0)," ج.م"]})},s.id))]}),e.jsxs(q,{children:[e.jsx(T,{className:"font-semibold",children:"السعر الأساسي"}),d.map(s=>e.jsxs(T,{className:"text-center",children:[s.basePrice.toFixed(0)," ج.م"]},s.id))]}),e.jsxs(q,{children:[e.jsx(T,{className:"font-semibold",children:"الحد الأدنى للسعر"}),d.map(s=>e.jsxs(T,{className:"text-center",children:[s.minCommissionPrice.toFixed(0)," ج.م"]},s.id))]}),e.jsxs(q,{children:[e.jsx(T,{className:"font-semibold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-blue-600"}),"معدل التحويل"]})}),d.map(s=>e.jsx(T,{className:"text-center",children:e.jsxs(P,{variant:"outline",children:[s.conversionRate,"%"]})},s.id))]}),e.jsxs(q,{children:[e.jsx(T,{className:"font-semibold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-purple-600"}),"النقرات"]})}),d.map(s=>e.jsx(T,{className:"text-center",children:s.clicks},s.id))]}),e.jsxs(q,{children:[e.jsx(T,{className:"font-semibold",children:"الإجراء"}),d.map(s=>e.jsx(T,{className:"text-center",children:e.jsx(S,{size:"sm",variant:s.id===u?.id?"default":"outline",children:"روّج"})},s.id))]})]})]})}),u&&d.length>1&&e.jsx("div",{className:"p-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg border-2 border-green-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ue,{className:"h-6 w-6 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900 dark:text-green-100",children:"الأفضل للترويج"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[e.jsx("strong",{children:u.name})," يقدم أعلى عمولة بقيمة"," ",e.jsxs("strong",{className:"text-green-600",children:[u.commission.toFixed(0)," ج.م"]})]})]})]})}),d.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ce,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"اختر منتجات للمقارنة"}),e.jsx("p",{className:"text-xs mt-1",children:"يمكنك اختيار حتى 3 منتجات"})]})]})]})}function Us({availableBalance:t=0,pendingWithdrawals:a=0}){const{user:i}=V(),{toast:r}=se(),[j,m]=p.useState(""),[n,x]=p.useState(""),[d,l]=p.useState(""),[u,s]=p.useState(!1),[c,g]=p.useState([]),[D,L]=p.useState(!0),o=100,N=t>=o;p.useEffect(()=>{i?.$id&&h()},[i]);const h=async()=>{if(i?.$id)try{L(!0);const $=await Cs(i.$id);g($)}catch($){console.error("Error loading withdrawal history:",$)}finally{L(!1)}},b=async()=>{if(!i?.$id){r({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}const $=parseFloat(j);if(!$||$<o){r({title:"خطأ",description:`الحد الأدنى للسحب هو ${o} ج.م`,variant:"destructive"});return}if($>t){r({title:"خطأ",description:"المبلغ المطلوب أكبر من الرصيد المتاح",variant:"destructive"});return}if(!n){r({title:"خطأ",description:"يرجى اختيار طريقة الدفع",variant:"destructive"});return}if(!d){r({title:"خطأ",description:"يرجى إدخال تفاصيل الحساب",variant:"destructive"});return}s(!0);try{const ae=parseFloat(C($)),Te=parseFloat(I($));await A.createDocument(E.databaseId,E.collections.withdrawalRequests,Ge.unique(),{affiliateId:i.$id,amount:$,fee:ae,netAmount:Te,paymentMethod:n,accountDetails:d,status:"pending",createdAt:new Date().toISOString()}),r({title:"✅ تم إرسال الطلب",description:`تم إرسال طلب سحب ${$} ج.م بنجاح. سيتم المعالجة خلال 2-3 أيام عمل.`}),m(""),x(""),l(""),await h()}catch(ae){console.error("Error submitting withdrawal:",ae),r({title:"خطأ",description:"فشل في إرسال الطلب. حاول مرة أخرى.",variant:"destructive"})}finally{s(!1)}},C=$=>($*.02).toFixed(2),I=$=>($-parseFloat(C($))).toFixed(2),Fe=$=>{switch($){case"pending":return e.jsxs(P,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:[e.jsx(K,{className:"h-3 w-3 mr-1"})," قيد المعالجة"]});case"approved":return e.jsxs(P,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"})," تم التحويل"]});case"rejected":return e.jsxs(P,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:[e.jsx(G,{className:"h-3 w-3 mr-1"})," مرفوض"]});default:return e.jsx(P,{variant:"outline",children:$})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{className:"border-green-200 shadow-lg",children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-green-600"}),"طلب سحب الأرباح"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"اسحب أرباحك بسهولة وأمان"})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-2 border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(M,{className:"h-4 w-4 text-green-600"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"الرصيد المتاح"})]}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[t.toLocaleString()," ج.م"]})]}),e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border-2 border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{className:"h-4 w-4 text-orange-600"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"قيد المعالجة"})]}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[a.toLocaleString()," ج.م"]})]})]}),!N&&e.jsxs(je,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(G,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(pe,{className:"text-yellow-800",children:["الحد الأدنى للسحب هو ",o," ج.م. رصيدك الحالي: ",t," ج.م"]})]}),e.jsx(Z,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"amount",children:"المبلغ (ج.م)"}),e.jsx(z,{id:"amount",type:"number",placeholder:`الحد الأدنى ${o} ج.م`,value:j,onChange:$=>m($.target.value),disabled:!N||u,min:o,max:t})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"payment-method",children:"طريقة الدفع"}),e.jsxs(We,{value:n,onValueChange:x,disabled:!N||u,children:[e.jsx(He,{children:e.jsx(Ve,{placeholder:"اختر طريقة الدفع"})}),e.jsxs(Ke,{children:[e.jsx(Q,{value:"bank",children:"تحويل بنكي"}),e.jsx(Q,{value:"vodafone-cash",children:"فودافون كاش"}),e.jsx(Q,{value:"instapay",children:"إنستاباي"}),e.jsx(Q,{value:"paypal",children:"PayPal"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"account-details",children:"تفاصيل الحساب"}),e.jsx(z,{id:"account-details",placeholder:"رقم الحساب أو المحفظة",value:d,onChange:$=>l($.target.value),disabled:!N||u})]}),j&&parseFloat(j)>=o&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"المبلغ المطلوب:"}),e.jsxs("span",{className:"font-semibold",children:[parseFloat(j).toLocaleString()," ج.م"]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"رسوم التحويل (2%):"}),e.jsxs("span",{children:["-",C(parseFloat(j))," ج.م"]})]}),e.jsx(Z,{}),e.jsxs("div",{className:"flex justify-between text-base font-bold",children:[e.jsx("span",{children:"المبلغ الصافي:"}),e.jsxs("span",{className:"text-green-600",children:[I(parseFloat(j))," ج.م"]})]})]}),e.jsx(S,{onClick:b,disabled:!N||u||!j||!n||!d,className:"w-full",size:"lg",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"جاري الإرسال..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"إرسال طلب السحب"]})})]})]})]}),e.jsxs(v,{children:[e.jsx(w,{children:e.jsx(y,{className:"text-lg",children:"سجل طلبات السحب"})}),e.jsx(k,{children:D?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):c.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد طلبات سحب سابقة"})]}):e.jsx("div",{className:"space-y-3",children:c.map($=>e.jsxs("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-semibold",children:[$.amount.toLocaleString()," ج.م"]})]}),Fe($.status)]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["الطريقة: ",$.paymentMethod]}),e.jsxs("p",{children:["الصافي: ",$.netAmount.toLocaleString()," ج.م"]}),e.jsxs("p",{children:["التاريخ: ",new Date($.createdAt).toLocaleDateString("ar-EG")]})]})]},$.id))})})]})]})}function ct(){const{user:t}=V(),{toast:a}=se(),[i,r]=p.useState([]),[j,m]=p.useState(null),[n,x]=p.useState(null),[d,l]=p.useState(!0),[u,s]=p.useState(null),[c,g]=p.useState(!1);p.useEffect(()=>{D()},[t]);const D=async()=>{try{if(l(!0),s(null),!t){s("يجب تسجيل الدخول أولاً");return}if(!t.isAffiliate&&t.role!=="affiliate"&&t.role!=="admin"){s("ليس لديك صلاحية الوصول لهذه الصفحة. يجب أن تكون مسوق بالعمولة.");return}const o=await $s(6);if(r(o||[]),t?.$id)try{const N=await ws(t.$id);x(N)}catch(N){console.error("Error loading stats:",N),x({totalClicks:0,totalOrders:0,totalEarnings:0,pendingEarnings:0,thisMonthEarnings:0,affiliateCode:t.affiliateCode||`AFF${t.$id.slice(0,6).toUpperCase()}`,conversionRate:0,clicks:0,conversions:0,referralCount:0,commissionRate:15})}}catch(o){console.error("Error loading data:",o),s("فشل في تحميل البيانات. حاول مرة أخرى."),a({variant:"destructive",title:"خطأ",description:"فشل في تحميل البيانات"})}finally{l(!1)}},L=async(o,N)=>{try{await navigator.clipboard.writeText(o),m(N),setTimeout(()=>m(null),2e3),a({title:"تم النسخ",description:"تم نسخ الرابط بنجاح"})}catch(h){console.error("فشل في نسخ الرابط:",h),a({variant:"destructive",title:"خطأ",description:"فشل في نسخ الرابط"})}};return e.jsx("div",{className:"container mx-auto px-4 py-8 space-y-8 bg-gradient-to-br from-orange-50/50 via-white to-yellow-50/50 dark:from-neutral-900 dark:via-neutral-900 dark:to-neutral-900 min-h-screen",children:d?e.jsx("div",{className:"py-8",children:e.jsx(Ze,{count:4})}):u?e.jsx(v,{className:"border-red-200 bg-red-50 dark:bg-red-950/20",children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Qe,{className:"h-12 w-12 text-red-500 mx-auto"}),e.jsx("h2",{className:"text-xl font-semibold text-red-700 dark:text-red-400",children:u}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(S,{onClick:()=>window.location.href="/login",variant:"outline",children:"تسجيل الدخول"}),e.jsx(S,{onClick:()=>window.location.href="/affiliate",children:"التسجيل كمسوق"})]})]})})}):n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-orange-600 to-yellow-500 bg-clip-text text-transparent",children:["مرحباً، ",t?.name||"الشريك"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"إليك نظرة عامة على أداء شراكتك"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(P,{className:"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg",children:"شريك نشط"})})]}),e.jsx(Is,{onCalculatorClick:()=>g(!c)}),c&&e.jsx(Rs,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(v,{className:"border-orange-200 dark:border-orange-900 shadow-lg hover:shadow-xl transition-shadow bg-gradient-to-br from-white to-orange-50/30 dark:from-neutral-800 dark:to-neutral-800",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"إجمالي الأرباح"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(n.totalEarnings||0).toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+12.5% من الشهر الماضي"})]})]}),e.jsxs(v,{className:"border-green-200 dark:border-green-900 shadow-lg hover:shadow-xl transition-shadow bg-gradient-to-br from-white to-green-50/30 dark:from-neutral-800 dark:to-neutral-800",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"أرباح هذا الشهر"}),e.jsx(O,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(n.thisMonthEarnings||0).toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+8.2% من الشهر الماضي"})]})]}),e.jsxs(v,{className:"border-blue-200 dark:border-blue-900 shadow-lg hover:shadow-xl transition-shadow bg-gradient-to-br from-white to-blue-50/30 dark:from-neutral-800 dark:to-neutral-800",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"النقرات هذا الشهر"}),e.jsx(te,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.clicks?.toLocaleString()||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"إجمالي النقرات"})]})]}),e.jsxs(v,{className:"border-purple-200 dark:border-purple-900 shadow-lg hover:shadow-xl transition-shadow bg-gradient-to-br from-white to-purple-50/30 dark:from-neutral-800 dark:to-neutral-800",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"معدل التحويل"}),e.jsx(H,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.conversionRate,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+0.8% من الشهر الماضي"})]})]})]}),e.jsxs(Se,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-4",children:[e.jsx(U,{value:"overview",children:"نظرة عامة"}),e.jsx(U,{value:"links",children:"روابط الشراكة"}),e.jsx(U,{value:"performance",children:"الأداء"}),e.jsx(U,{value:"resources",children:"مصادر التسويق"})]}),e.jsxs(Y,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(qs,{}),e.jsx(Ts,{stats:n})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(Fs,{}),e.jsx(Os,{currentUserRank:3,currentUserEarnings:n?.totalEarnings||0})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(Ms,{}),e.jsx(Us,{availableBalance:n?.totalEarnings||0,pendingWithdrawals:n?.pendingEarnings||0})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(v,{children:[e.jsx(w,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5"}),"معلومات الحساب"]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{className:"text-sm font-medium",children:"كود الشراكة"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("code",{className:"bg-muted px-2 py-1 rounded text-sm",children:n.affiliateCode}),e.jsx(S,{size:"sm",variant:"outline",onClick:()=>L(n.affiliateCode,"code"),children:e.jsx(be,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-sm font-medium",children:"معدل العمولة"}),e.jsxs("p",{className:"text-lg font-semibold text-brand-orange mt-1",children:[n.commissionRate,"%"]})]})]}),e.jsx(Z,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{className:"text-sm font-medium",children:"عدد الإحالات"}),e.jsx("p",{className:"text-lg font-semibold mt-1",children:n.referralCount})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-sm font-medium",children:"تاريخ الانضمام"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:new Date().toLocaleDateString("ar")})]})]})]})]}),e.jsxs(v,{children:[e.jsx(w,{children:e.jsx(y,{children:"النشاط الأخير"})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-3",children:n.recentCommissions&&n.recentCommissions.length>0?n.recentCommissions.slice(0,5).map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(M,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"عمولة جديدة"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["طلب #",o.orderId.substring(0,8)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-600",children:["+",(o.amount||0).toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(o.createdAt).toLocaleDateString("ar")})]})]},o.id)):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"لا يوجد نشاط حديث"})})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{children:[e.jsx(w,{children:e.jsx(y,{children:"إجراءات سريعة"})}),e.jsxs(k,{className:"space-y-3",children:[e.jsx(S,{className:"w-full justify-start",asChild:!0,children:e.jsxs(R,{to:"/affiliate/withdraw",children:[e.jsx(M,{className:"h-4 w-4 ml-2 rtl:ml-0 rtl:mr-2"}),"سحب الأرباح"]})}),e.jsx(S,{variant:"outline",className:"w-full justify-start",asChild:!0,children:e.jsxs(R,{to:"/affiliate/resources",children:[e.jsx(Pe,{className:"h-4 w-4 ml-2 rtl:ml-0 rtl:mr-2"}),"مواد التسويق"]})}),e.jsx(S,{variant:"outline",className:"w-full justify-start",asChild:!0,children:e.jsxs(R,{to:"/affiliate/support",children:[e.jsx(Ne,{className:"h-4 w-4 ml-2 rtl:ml-0 rtl:mr-2"}),"الدعم الفني"]})})]})]}),e.jsxs(v,{children:[e.jsx(w,{children:e.jsx(y,{children:"الأرباح المعلقة"})}),e.jsx(k,{children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-brand-orange",children:[(n.pendingEarnings||0).toFixed(2)," ج.م"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"سيتم دفعها خلال 7 أيام"}),e.jsx(S,{size:"sm",className:"mt-3",asChild:!0,children:e.jsx(R,{to:"/affiliate/withdraw",children:"عرض التفاصيل"})})]})})]})]})]})]}),e.jsx(Y,{value:"links",className:"space-y-6",children:e.jsx(Ps,{})}),e.jsxs(Y,{value:"performance",className:"space-y-6",children:[e.jsx(_s,{}),e.jsx(As,{affiliateId:t?.$id||""}),e.jsx("div",{className:"grid lg:grid-cols-2 gap-6",children:e.jsxs(v,{children:[e.jsx(w,{children:e.jsx(y,{children:"إحصائيات الأداء"})}),e.jsx(k,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold",children:n.clicks||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"إجمالي النقرات"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold",children:n.conversions||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"إجمالي التحويلات"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.conversionRate||0,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"معدل التحويل"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold",children:n.referralCount||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"عدد الإحالات"})]})]})})]})})]}),e.jsx(Y,{value:"resources",className:"space-y-6",children:e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(v,{children:[e.jsx(w,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"بانرات إعلانية"]})}),e.jsxs(k,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"قم بتحميل بانرات جاهزة لاستخدامها في موقعك أو وسائل التواصل"}),e.jsx(S,{className:"w-full",asChild:!0,children:e.jsx(R,{to:"/affiliate/banners",children:"تحميل البانرات"})})]})]}),e.jsxs(v,{children:[e.jsx(w,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5"}),"نصائح التسويق"]})}),e.jsxs(k,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"اكتشف أفضل الاستراتيجيات لزيادة مبيعاتك وأرباحك"}),e.jsx(S,{variant:"outline",className:"w-full",asChild:!0,children:e.jsx(R,{to:"/affiliate/marketing-tips",children:"عرض النصائح"})})]})]}),e.jsxs(v,{children:[e.jsx(w,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"الكورسات التسويقية"]})}),e.jsxs(k,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"تعلم استراتيجيات التسويق الاحترافية لزيادة مبيعاتك"}),e.jsx(S,{variant:"outline",className:"w-full",asChild:!0,children:e.jsx(R,{to:"/affiliate/courses",children:"عرض الكورسات"})})]})]})]})})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"لم يتم العثور على بيانات الشريك"}),e.jsx(S,{asChild:!0,children:e.jsx(R,{to:"/",children:"العودة للرئيسية"})})]})})}export{ct as default};
