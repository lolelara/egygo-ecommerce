var K=Object.defineProperty;var W=(i,t,s)=>t in i?K(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var w=(i,t,s)=>W(i,typeof t!="symbol"?t+"":t,s);import{r as m,j as e,af as L,bp as O,a_ as X,p as C,_ as Y,ax as k,ch as Z,bV as ee}from"./vendor-react-CCFRLLzk.js";import{d as n,c as se,u as te,D as re,N as ae,f as E,z as ce,A as ne,E as ie,L as T,S as B,i as P,j as $,k as q,l as p,I as le,C as j,x as g,y as f,h as D,P as R,B as de}from"./index-CtsYZAzS.js";import{I as oe,Q as d}from"./vendor-appwrite-CuqfvTq9.js";import{A as M}from"./AdminLayout-C-VSnXvz.js";import{d as me,D as xe}from"./appwrite-client-DFce-dPK.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-other-CzBBjgu5.js";import"./vendor-animations-CPHPqPXb.js";import"./avatar-Glpu3gcq.js";const he={homepage_banner:500,homepage_featured:300,category_top:200,search_sponsored:150};class ue{constructor(){w(this,"DATABASE_ID","68de037e003bd03c4d45");w(this,"COLLECTION_ID","advertisements")}async createAd(t){try{return await n.createDocument(this.DATABASE_ID,this.COLLECTION_ID,oe.unique(),{...t,clicks:0,impressions:0,createdAt:new Date().toISOString()})}catch(s){throw console.error("Error creating ad:",s),s}}async getActiveAds(t,s=10){try{const l=[d.equal("status","active"),d.greaterThan("endDate",new Date().toISOString()),d.limit(s),d.orderDesc("$createdAt")];return t&&l.push(d.equal("adType",t)),(await n.listDocuments(this.DATABASE_ID,this.COLLECTION_ID,l)).documents}catch(l){return console.error("Error getting active ads:",l),[]}}async getMerchantAds(t){try{return(await n.listDocuments(this.DATABASE_ID,this.COLLECTION_ID,[d.equal("merchantId",t),d.orderDesc("$createdAt")])).documents}catch(s){return console.error("Error getting merchant ads:",s),[]}}async trackImpression(t){try{const s=await n.getDocument(this.DATABASE_ID,this.COLLECTION_ID,t);await n.updateDocument(this.DATABASE_ID,this.COLLECTION_ID,t,{impressions:s.impressions+1})}catch(s){console.error("Error tracking impression:",s)}}async trackClick(t){try{const s=await n.getDocument(this.DATABASE_ID,this.COLLECTION_ID,t);await n.updateDocument(this.DATABASE_ID,this.COLLECTION_ID,t,{clicks:s.clicks+1})}catch(s){console.error("Error tracking click:",s)}}calculatePrice(t,s){return he[t]*s}async approveAd(t){try{await n.updateDocument(this.DATABASE_ID,this.COLLECTION_ID,t,{status:"active"})}catch(s){throw console.error("Error approving ad:",s),s}}async rejectAd(t,s){try{await n.updateDocument(this.DATABASE_ID,this.COLLECTION_ID,t,{status:"rejected"})}catch(l){throw console.error("Error rejecting ad:",l),l}}async getPendingAds(){try{return(await n.listDocuments(this.DATABASE_ID,this.COLLECTION_ID,[d.equal("status","pending")])).documents}catch(t){return console.error("Error getting pending ads:",t),[]}}async checkExpiredAds(){try{const t=await n.listDocuments(this.DATABASE_ID,this.COLLECTION_ID,[d.equal("status","active"),d.lessThan("endDate",new Date().toISOString())]);for(const s of t.documents)await n.updateDocument(this.DATABASE_ID,this.COLLECTION_ID,s.$id,{status:"expired"})}catch(t){console.error("Error checking expired ads:",t)}}async getAdAnalytics(t){try{const s=await n.getDocument(this.DATABASE_ID,this.COLLECTION_ID,t),l=s.impressions>0?s.clicks/s.impressions*100:0,o=s.clicks>0?s.price/s.clicks:0;return{impressions:s.impressions,clicks:s.clicks,ctr:l.toFixed(2),costPerClick:o.toFixed(2),totalSpent:s.price,daysRemaining:Math.ceil((new Date(s.endDate).getTime()-Date.now())/(1e3*60*60*24))}}catch(s){return console.error("Error getting ad analytics:",s),null}}async getRevenueStats(){try{const[t,s]=await Promise.all([n.listDocuments(this.DATABASE_ID,this.COLLECTION_ID,[d.equal("status","active")]),n.listDocuments(this.DATABASE_ID,this.COLLECTION_ID,[])]),l=t.documents.reduce((x,h)=>x+(h.price||0),0),o=s.documents.reduce((x,h)=>x+(h.price||0),0);return{activeAds:t.total,totalAds:s.total,activeRevenue:l,totalRevenue:o,averagePrice:s.total>0?o/s.total:0}}catch(t){return console.error("Error getting revenue stats:",t),{activeAds:0,totalAds:0,activeRevenue:0,totalRevenue:0,averagePrice:0}}}}const A=new ue;function we(){const[i,t]=m.useState([]),[s,l]=m.useState([]),[o,x]=m.useState(!0),[h,S]=m.useState(!1),[F,b]=m.useState(!1),{user:u}=se(),{toast:N}=te(),[c,I]=m.useState({productId:"",adType:"homepage_featured",weeks:1});m.useEffect(()=>{_()},[u]);const _=async()=>{if(u)try{x(!0);const[r,a]=await Promise.all([A.getMerchantAds(u.$id),me.listDocuments(xe,"products",[d.equal("merchantId",u.$id),d.equal("status","approved")])]);t(r),l(a.documents)}catch(r){console.error("Error loading data:",r),N({title:"خطأ",description:"فشل تحميل البيانات",variant:"destructive"})}finally{x(!1)}},V=async()=>{var r;if(!c.productId){N({title:"خطأ",description:"الرجاء اختيار منتج",variant:"destructive"});return}S(!0);try{const a=s.find(J=>J.$id===c.productId);if(!a)throw new Error("Product not found");const v=A.calculatePrice(c.adType,c.weeks),G=new Date,y=new Date;y.setDate(y.getDate()+c.weeks*7),await A.createAd({merchantId:u.$id,merchantName:u.name,productId:a.$id,productName:a.name,productImage:((r=a.images)==null?void 0:r[0])||"",adType:c.adType,placement:"top",duration:c.weeks*7,price:v,startDate:G.toISOString(),endDate:y.toISOString(),status:"pending"}),N({title:"تم الإنشاء",description:"تم إنشاء الإعلان بنجاح. في انتظار الموافقة."}),b(!1),_()}catch(a){console.error("Error creating ad:",a),N({title:"خطأ",description:"فشل إنشاء الإعلان",variant:"destructive"})}finally{S(!1)}},H=r=>({homepage_banner:"بانر الصفحة الرئيسية",homepage_featured:"منتج مميز - الصفحة الرئيسية",category_top:"أعلى صفحة التصنيف",search_sponsored:"نتائج البحث المدعومة"})[r]||r,Q=r=>{const a={pending:{label:"قيد المراجعة",variant:"secondary"},active:{label:"نشط",variant:"default"},expired:{label:"منتهي",variant:"outline"},rejected:{label:"مرفوض",variant:"destructive"}},v=a[r]||a.pending;return e.jsx(de,{variant:v.variant,children:v.label})},z=i.reduce((r,a)=>r+a.price,0),U=i.filter(r=>r.status==="active").length;return o?e.jsx(M,{children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(L,{className:"h-8 w-8 animate-spin"})})}):e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"إعلانات المنتجات"}),e.jsx("p",{className:"text-muted-foreground",children:"روّج لمنتجاتك وزد مبيعاتك"})]}),e.jsxs(re,{open:F,onOpenChange:b,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(E,{children:[e.jsx(O,{className:"h-4 w-4 ml-2"}),"إنشاء إعلان جديد"]})}),e.jsxs(ce,{className:"max-w-md",children:[e.jsx(ne,{children:e.jsx(ie,{children:"إنشاء إعلان جديد"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(T,{children:"اختر المنتج"}),e.jsxs(B,{value:c.productId,onValueChange:r=>I({...c,productId:r}),children:[e.jsx(P,{children:e.jsx($,{placeholder:"اختر منتج"})}),e.jsx(q,{children:s.map(r=>e.jsx(p,{value:r.$id,children:r.name},r.$id))})]})]}),e.jsxs("div",{children:[e.jsx(T,{children:"نوع الإعلان"}),e.jsxs(B,{value:c.adType,onValueChange:r=>I({...c,adType:r}),children:[e.jsx(P,{children:e.jsx($,{})}),e.jsxs(q,{children:[e.jsx(p,{value:"homepage_featured",children:"منتج مميز - الصفحة الرئيسية (300 ج.م/أسبوع)"}),e.jsx(p,{value:"homepage_banner",children:"بانر الصفحة الرئيسية (500 ج.م/أسبوع)"}),e.jsx(p,{value:"category_top",children:"أعلى صفحة التصنيف (200 ج.م/أسبوع)"}),e.jsx(p,{value:"search_sponsored",children:"نتائج البحث (150 ج.م/أسبوع)"})]})]})]}),e.jsxs("div",{children:[e.jsx(T,{children:"المدة (أسابيع)"}),e.jsx(le,{type:"number",min:"1",max:"12",value:c.weeks,onChange:r=>I({...c,weeks:parseInt(r.target.value)||1})})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"التكلفة الإجمالية:"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:[A.calculatePrice(c.adType,c.weeks)," ج.م"]})]})}),e.jsx(E,{onClick:V,disabled:h,className:"w-full",children:h?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 ml-2 animate-spin"}),"جاري الإنشاء..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4 ml-2"}),"إنشاء الإعلان"]})})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(j,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"الإعلانات النشطة"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:U}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["من أصل ",i.length," إعلان"]})]})]}),e.jsxs(j,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"إجمالي الإنفاق"}),e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[z.toLocaleString()," ج.م"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"جميع الإعلانات"})]})]}),e.jsxs(j,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"إجمالي المشاهدات"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.reduce((r,a)=>r+a.impressions,0).toLocaleString()}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.reduce((r,a)=>r+a.clicks,0).toLocaleString()," نقرة"]})]})]})]}),e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsx(f,{children:"إعلاناتي"}),e.jsx(R,{children:"جميع إعلاناتك وإحصائياتها"})]}),e.jsx(D,{children:i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"لم تنشئ أي إعلانات بعد"}),e.jsxs(E,{onClick:()=>b(!0),children:[e.jsx(O,{className:"h-4 w-4 ml-2"}),"إنشاء إعلان"]})]}):e.jsx("div",{className:"space-y-4",children:i.map(r=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold",children:r.productName}),Q(r.status)]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:H(r.adType)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-lg",children:[r.price," ج.م"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.duration," يوم"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground mb-1",children:[e.jsx(k,{className:"h-3 w-3"}),e.jsx("span",{children:"المشاهدات"})]}),e.jsx("p",{className:"font-semibold",children:r.impressions.toLocaleString()})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground mb-1",children:[e.jsx(Z,{className:"h-3 w-3"}),e.jsx("span",{children:"النقرات"})]}),e.jsx("p",{className:"font-semibold",children:r.clicks.toLocaleString()})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground mb-1",children:[e.jsx(C,{className:"h-3 w-3"}),e.jsx("span",{children:"CTR"})]}),e.jsxs("p",{className:"font-semibold",children:[r.impressions>0?(r.clicks/r.impressions*100).toFixed(2):0,"%"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground mb-1",children:[e.jsx(ee,{className:"h-3 w-3"}),e.jsx("span",{children:"الحالة"})]}),e.jsx("p",{className:"font-semibold text-xs",children:new Date(r.endDate)>new Date?"نشط":"منتهي"})]})]})]},r.$id))})})]}),e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsx(f,{children:"الأسعار"}),e.jsx(R,{children:"أسعار الإعلانات المختلفة"})]}),e.jsx(D,{children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"منتج مميز - الصفحة الرئيسية"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mb-2",children:"300 ج.م/أسبوع"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"يظهر في قسم المنتجات المميزة"})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"بانر الصفحة الرئيسية"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 mb-2",children:"500 ج.م/أسبوع"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"بانر كبير في أعلى الصفحة"})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"أعلى صفحة التصنيف"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 mb-2",children:"200 ج.م/أسبوع"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"يظهر في أعلى صفحة التصنيف"})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"نتائج البحث المدعومة"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600 mb-2",children:"150 ج.م/أسبوع"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"يظهر في نتائج البحث"})]})]})})]})]})})}export{we as default};
