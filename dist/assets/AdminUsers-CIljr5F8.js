import{w as _,b as G,r as t,a8 as h,a0 as D,j as e,C as K,e as V,f as W,aw as X,g as Y,aE as Z,I as u,B as l,T as ee,s as x,a9 as j,$ as R,a as se}from"./index-Ce-RwxJS.js";import{A as ae}from"./AdminLayout-DRAN_nM7.js";import{S as re}from"./square-pen-BvEjHzCI.js";import"./tag-BB9opunb.js";import"./settings-DdUeHZqS.js";const v=void 0;function de(){const{user:te}=_(),{toast:o}=G(),[T,U]=t.useState([]),[$,y]=t.useState(!1),[p,A]=t.useState(""),[g,M]=t.useState("all"),[F,N]=t.useState(!1),[n,b]=t.useState(null),[a,c]=t.useState({name:"",email:"",phone:"",role:"customer"}),[L,w]=t.useState(!1),[d,C]=t.useState(null),[I,S]=t.useState("20");t.useEffect(()=>{m()},[]);const m=async()=>{y(!0);try{const s=await h.listDocuments(v,"userPreferences",[D.limit(100),D.orderDesc("$createdAt")]);console.log("âœ… Loaded users:",s.documents.length),U(s.documents)}catch(s){console.error("Error loading users:",s),o({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†",variant:"destructive"})}finally{y(!1)}},P=s=>{console.log("Opening edit modal for:",s.name),b(s),c({name:s.name||"",email:s.email||"",phone:s.phone||"",role:s.role||"customer"}),N(!0)},E=()=>{N(!1),b(null),c({name:"",email:"",phone:"",role:"customer"})},O=async()=>{if(n)try{if(a.role!==n.role){if(!(await fetch("/api/admin/update-user-role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n.userId,newRole:a.role})})).ok)throw new Error("Failed to update user role");console.log("âœ… Role updated via server API")}const s={name:a.name,email:a.email,phone:a.phone||""};if(a.role===n.role&&(s.role=a.role),await h.updateDocument(v,"userPreferences",n.$id,s),a.role!==n.role){const r={customer:"Ø¹Ù…ÙŠÙ„",merchant:"ØªØ§Ø¬Ø±",affiliate:"Ù…Ø³ÙˆÙ‚",intermediary:"ÙˆØ³ÙŠØ·",admin:"Ù…Ø¯ÙŠØ±"},i=r[n.role]||n.role,f=r[a.role]||a.role;try{await h.createDocument(j.databaseId,j.collections.notifications,R.unique(),{userId:n.userId,title:"ğŸ‰ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±Ùƒ Ø¨Ù†Ø¬Ø§Ø­",message:`ØªÙ… ØªØºÙŠÙŠØ± Ø¯ÙˆØ±Ùƒ Ù…Ù† ${i} Ø¥Ù„Ù‰ ${f}. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©!`,type:"success",isRead:!1,link:a.role==="merchant"?"/merchant/dashboard":a.role==="affiliate"?"/affiliate/dashboard":a.role==="intermediary"?"/intermediary/dashboard":a.role==="admin"?"/admin/dashboard":"/"}),console.log("âœ… Role change notification sent")}catch(Q){console.error("Error sending notification:",Q)}}o({title:"Ù†Ø¬Ø­",description:"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­"}),E(),m()}catch(s){console.error("Error updating user:",s),o({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",variant:"destructive"})}},z=s=>{console.log("Opening intermediary modal for:",s.name),C(s),w(!0)},k=()=>{w(!1),C(null),S("20")},B=async()=>{if(d)try{const s=await fetch("/api/admin/update-user-role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:d.userId,newRole:"intermediary"})});if(!s.ok)throw new Error("Failed to activate intermediary");const i=(await s.json()).intermediaryCode||`INT${Date.now()}`;console.log("âœ… Intermediary activated via server API");try{await h.createDocument(j.databaseId,j.collections.notifications,R.unique(),{userId:d.userId,title:"ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ… ØªÙØ¹ÙŠÙ„Ùƒ ÙƒÙˆØ³ÙŠØ·",message:`ØªÙ… ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ ÙƒÙˆØ³ÙŠØ· Ø¨Ù†Ø¬Ø§Ø­! ÙƒÙˆØ¯ Ø§Ù„ÙˆØ³ÙŠØ· Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ: ${i}. Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: ${I}%. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ù†Ø´Ø§Ø¡ Ø±ÙˆØ§Ø¨Ø· Ø®Ø§ØµØ© Ø¨Ùƒ ÙˆØ¥Ø¶Ø§ÙØ© Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.`,type:"success",isRead:!1,link:"/intermediary/dashboard"}),console.log("âœ… Intermediary activation notification sent")}catch(f){console.error("Error sending notification:",f)}o({title:"Ù†Ø¬Ø­",description:`ØªÙ… ØªÙØ¹ÙŠÙ„ ${d.name} ÙƒÙˆØ³ÙŠØ· Ø¨Ù†Ø¬Ø§Ø­`}),k(),m()}catch(s){console.error("Error activating intermediary:",s),o({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ³ÙŠØ·",variant:"destructive"})}},q=async(s,r)=>{if(confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${r}ØŸ`))try{await h.deleteDocument(v,"userPreferences",s),o({title:"Ù†Ø¬Ø­",description:"ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­"}),m()}catch(i){console.error("Error deleting user:",i),o({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",variant:"destructive"})}},J=s=>{const r={admin:"bg-red-100 text-red-800",intermediary:"bg-purple-100 text-purple-800",merchant:"bg-blue-100 text-blue-800",affiliate:"bg-green-100 text-green-800",customer:"bg-gray-100 text-gray-800"},i={admin:"Ù…Ø¯ÙŠØ±",intermediary:"ÙˆØ³ÙŠØ·",merchant:"ØªØ§Ø¬Ø±",affiliate:"Ù…Ø³ÙˆÙ‚",customer:"Ø¹Ù…ÙŠÙ„"};return e.jsx(se,{className:r[s]||r.customer,children:i[s]||s})},H=T.filter(s=>{const r=s.name?.toLowerCase().includes(p.toLowerCase())||s.email?.toLowerCase().includes(p.toLowerCase())||s.phone?.includes(p),i=g==="all"||s.role===g;return r&&i});return e.jsxs(ae,{children:[e.jsxs(K,{children:[e.jsx(V,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-6 w-6"}),"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø´Ø±ÙƒØ§Ø¡"]})}),e.jsxs(Y,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(u,{placeholder:"Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ...",value:p,onChange:s=>A(s.target.value),className:"pl-10"})]}),e.jsx("div",{children:e.jsxs("select",{className:"w-full p-2 border rounded-md",value:g,onChange:s=>M(s.target.value),children:[e.jsx("option",{value:"all",children:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±"}),e.jsx("option",{value:"customer",children:"Ø¹Ù…Ù„Ø§Ø¡"}),e.jsx("option",{value:"merchant",children:"ØªØ¬Ø§Ø±"}),e.jsx("option",{value:"affiliate",children:"Ù…Ø³ÙˆÙ‚ÙŠÙ†"}),e.jsx("option",{value:"intermediary",children:"ÙˆØ³Ø·Ø§Ø¡"}),e.jsx("option",{value:"admin",children:"Ù…Ø¯Ø±Ø§Ø¡"})]})}),e.jsx(l,{onClick:()=>m(),variant:"outline",children:"ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©"})]}),$?e.jsx("div",{className:"text-center py-8",children:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-right p-2",children:"Ø§Ù„Ø§Ø³Ù…"}),e.jsx("th",{className:"text-right p-2",children:"Ø§Ù„Ø¨Ø±ÙŠØ¯"}),e.jsx("th",{className:"text-right p-2",children:"Ø§Ù„Ù‡Ø§ØªÙ"}),e.jsx("th",{className:"text-right p-2",children:"Ø§Ù„Ø¯ÙˆØ±"}),e.jsx("th",{className:"text-right p-2",children:"Ø§Ù„ÙƒÙˆØ¯"}),e.jsx("th",{className:"text-right p-2",children:"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª"})]})}),e.jsx("tbody",{children:H.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2",children:s.email}),e.jsx("td",{className:"p-2",children:s.phone||"-"}),e.jsx("td",{className:"p-2",children:J(s.role)}),e.jsx("td",{className:"p-2",children:e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:s.affiliateCode||s.intermediaryCode||"-"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2",children:[s.role==="customer"&&!s.isIntermediary&&e.jsx(l,{size:"sm",className:"bg-purple-600 hover:bg-purple-700 text-white",onClick:()=>z(s),children:"ØªÙØ¹ÙŠÙ„ ÙˆØ³ÙŠØ·"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>P(s),children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>q(s.$id,s.name),children:e.jsx(ee,{className:"h-4 w-4"})})]})})]},s.$id))})]})})]})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Ø§Ù„Ø§Ø³Ù…"}),e.jsx(u,{value:a.name,onChange:s=>c({...a,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"}),e.jsx(u,{type:"email",value:a.email,onChange:s=>c({...a,email:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"}),e.jsx(u,{value:a.phone,onChange:s=>c({...a,phone:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Ø§Ù„Ø¯ÙˆØ±"}),e.jsxs("select",{className:"w-full p-2 border rounded-md",value:a.role,onChange:s=>c({...a,role:s.target.value}),children:[e.jsx("option",{value:"customer",children:"Ø¹Ù…ÙŠÙ„"}),e.jsx("option",{value:"merchant",children:"ØªØ§Ø¬Ø±"}),e.jsx("option",{value:"affiliate",children:"Ù…Ø³ÙˆÙ‚"}),e.jsx("option",{value:"intermediary",children:"ÙˆØ³ÙŠØ·"}),e.jsx("option",{value:"admin",children:"Ù…Ø¯ÙŠØ±"})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(l,{onClick:E,variant:"outline",children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(l,{onClick:O,children:"Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª"})]})]})}),L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"ØªÙØ¹ÙŠÙ„ Ø¯ÙˆØ± Ø§Ù„ÙˆØ³ÙŠØ·"}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Ø§Ù„Ø¹Ù…ÙŠÙ„:"})," ",d?.name]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Ø§Ù„Ø¨Ø±ÙŠØ¯:"})," ",d?.email]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(x,{children:"Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (%)"}),e.jsx(u,{type:"number",min:"0",max:"100",value:I,onChange:s=>S(s.target.value),placeholder:"20"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¹Ù„Ù‰ Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ØµÙ„ÙŠ"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{onClick:k,variant:"outline",children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(l,{onClick:B,className:"bg-purple-600 hover:bg-purple-700",children:"ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ³ÙŠØ·"})]})]})})]})}export{de as default};
