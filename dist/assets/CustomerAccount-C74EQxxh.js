import{l as ne,r as x,j as e,af as G,a0 as ce,n as P,bv as ie,by as le,ac as H,ax as de,bx as M,ai as oe}from"./vendor-react-CCFRLLzk.js";import{c as me,u as he,C as c,h as i,f as h,x as y,y as w,P as E,L as A,I as L,J as xe,B as $}from"./index-D-h96Znd.js";import{T as ue,a as pe,b,c as S}from"./tabs-LmPLZOOP.js";import{d as l,D as d,a as je}from"./appwrite-client-DFce-dPK.js";import{I as Q,Q as f}from"./vendor-appwrite-CuqfvTq9.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-other-CzBBjgu5.js";import"./vendor-animations-CPHPqPXb.js";const J="users",V="orders",W="wishlist",U="addresses",ge="products",u={async getUserProfile(t){try{return(await l.listDocuments(d,J,[f.equal("email",t)])).documents[0]||null}catch(r){return console.error("Error fetching user profile:",r),null}},async updateUserProfile(t,r){try{return await l.updateDocument(d,J,t,r)}catch(a){throw console.error("Error updating user profile:",a),a}},async getUserOrders(t){try{return(await l.listDocuments(d,V,[f.equal("userId",t),f.orderDesc("$createdAt"),f.limit(20)])).documents}catch(r){return console.error("Error fetching orders:",r),[]}},async getOrderDetails(t){try{return await l.getDocument(d,V,t)}catch(r){return console.error("Error fetching order details:",r),null}},async getUserWishlist(t){try{const r=await l.listDocuments(d,W,[f.equal("userId",t),f.orderDesc("$createdAt")]);return await Promise.all(r.documents.map(async g=>{var v;try{const p=await l.getDocument(d,ge,g.productId);return{...g,productName:p.name,productPrice:p.price,productImage:((v=p.images)==null?void 0:v[0])||p.image,inStock:p.stock>0}}catch{return g}}))}catch(r){return console.error("Error fetching wishlist:",r),[]}},async addToWishlist(t,r){try{return await l.createDocument(d,W,Q.unique(),{userId:t,productId:r,createdAt:new Date().toISOString()})}catch(a){throw console.error("Error adding to wishlist:",a),a}},async removeFromWishlist(t){try{return await l.deleteDocument(d,W,t),!0}catch(r){throw console.error("Error removing from wishlist:",r),r}},async getUserAddresses(t){try{return(await l.listDocuments(d,U,[f.equal("userId",t)])).documents}catch(r){return console.error("Error fetching addresses:",r),[]}},async addAddress(t,r){try{return await l.createDocument(d,U,Q.unique(),{userId:t,...r,createdAt:new Date().toISOString()})}catch(a){throw console.error("Error adding address:",a),a}},async updateAddress(t,r){try{return await l.updateDocument(d,U,t,r)}catch(a){throw console.error("Error updating address:",a),a}},async deleteAddress(t){try{return await l.deleteDocument(d,U,t),!0}catch(r){throw console.error("Error deleting address:",r),r}},async getUserStats(t){try{const r=await this.getUserOrders(t),a=await this.getUserWishlist(t),g=r.length,v=r.filter(j=>{var o;return["pending","processing","shipped"].includes((o=j.status)==null?void 0:o.toLowerCase())}).length,p=r.filter(j=>{var o;return((o=j.status)==null?void 0:o.toLowerCase())==="delivered"}).length,D=r.reduce((j,o)=>j+(o.total||o.totalAmount||0),0);return{totalOrders:g,activeOrders:v,completedOrders:p,totalSpent:D,savedItems:a.length,reviews:0}}catch(r){return console.error("Error calculating user stats:",r),{totalOrders:0,activeOrders:0,completedOrders:0,totalSpent:0,savedItems:0,reviews:0}}}};function Oe(){const{user:t}=me(),{toast:r}=he(),a=ne(),[g,v]=x.useState("profile"),[p,D]=x.useState(!0),[j,o]=x.useState(!1),[C,K]=x.useState(null),[k,X]=x.useState([]),[_,F]=x.useState([]),[R,q]=x.useState([]),[O,B]=x.useState({totalOrders:0,activeOrders:0,completedOrders:0,totalSpent:0,savedItems:0,reviews:0}),[m,I]=x.useState({name:"",phone:"",birthdate:""});x.useEffect(()=>{t&&z()},[t]);const z=async()=>{if(t){D(!0);try{const s=await u.getUserProfile(t.email);s&&(K(s),I({name:s.name||t.name||"",phone:s.phone||"",birthdate:s.birthdate||""}));const n=await u.getUserOrders(t.$id);X(n);const N=await u.getUserWishlist(t.$id);F(N);const re=await u.getUserAddresses(t.$id);q(re);const ae=await u.getUserStats(t.$id);B(ae)}catch(s){console.error("Error loading data:",s),r({title:"خطأ في التحميل",description:"حدث خطأ أثناء تحميل البيانات",variant:"destructive"})}finally{D(!1)}}},Y=async()=>{if(C!=null&&C.$id){o(!0);try{m.name!==(t==null?void 0:t.name)&&await je.updateName(m.name),await u.updateUserProfile(C.$id,{name:m.name,phone:m.phone,birthdate:m.birthdate,updatedAt:new Date().toISOString()}),r({title:"تم التحديث",description:"تم تحديث معلوماتك بنجاح"}),await z()}catch(s){console.error("Error updating profile:",s),r({title:"خطأ",description:"حدث خطأ في تحديث المعلومات",variant:"destructive"})}finally{o(!1)}}},Z=async s=>{try{await u.removeFromWishlist(s),r({title:"تم الحذف",description:"تم إزالة المنتج من المفضلة"});const n=await u.getUserWishlist((t==null?void 0:t.$id)||"");F(n),B(N=>({...N,savedItems:n.length}))}catch{r({title:"خطأ",description:"حدث خطأ في إزالة المنتج",variant:"destructive"})}},ee=async s=>{try{await u.deleteAddress(s),r({title:"تم الحذف",description:"تم حذف العنوان بنجاح"});const n=await u.getUserAddresses((t==null?void 0:t.$id)||"");q(n)}catch{r({title:"خطأ",description:"حدث خطأ في حذف العنوان",variant:"destructive"})}},se=s=>s?new Date(s).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric"}):"",T=s=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(s||0),te=s=>{const N={pending:{label:"قيد الانتظار",variant:"secondary"},processing:{label:"قيد المعالجة",variant:"default"},shipped:{label:"تم الشحن",variant:"default"},delivered:{label:"تم التوصيل",variant:"success"},cancelled:{label:"ملغي",variant:"destructive"}}[s==null?void 0:s.toLowerCase()]||{label:s||"غير محدد",variant:"secondary"};return e.jsx($,{variant:N.variant,children:N.label})};return p?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(G,{className:"h-8 w-8 animate-spin text-primary"})}):t?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"حسابي"}),e.jsxs("p",{className:"text-muted-foreground",children:["مرحباً ",(t==null?void 0:t.name)||(t==null?void 0:t.email)," - إدارة معلوماتك وطلباتك"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-8",children:[e.jsx(c,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي الطلبات"}),e.jsx("p",{className:"text-2xl font-bold",children:O.totalOrders})]}),e.jsx(P,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(c,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"طلبات نشطة"}),e.jsx("p",{className:"text-2xl font-bold",children:O.activeOrders})]}),e.jsx(ie,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(c,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي المشتريات"}),e.jsx("p",{className:"text-2xl font-bold",children:T(O.totalSpent)})]}),e.jsx(le,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(c,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"المفضلة"}),e.jsx("p",{className:"text-2xl font-bold",children:O.savedItems})]}),e.jsx(H,{className:"h-8 w-8 text-muted-foreground"})]})})})]}),e.jsxs(ue,{value:g,onValueChange:v,children:[e.jsxs(pe,{className:"grid w-full grid-cols-5",children:[e.jsx(b,{value:"profile",children:"الملف الشخصي"}),e.jsx(b,{value:"orders",children:"طلباتي"}),e.jsx(b,{value:"wishlist",children:"المفضلة"}),e.jsx(b,{value:"addresses",children:"العناوين"}),e.jsx(b,{value:"settings",children:"الإعدادات"})]}),e.jsx(S,{value:"profile",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(y,{children:[e.jsx(w,{children:"المعلومات الشخصية"}),e.jsx(E,{children:"قم بتحديث معلوماتك الشخصية"})]}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"name",children:"الاسم الكامل"}),e.jsx(L,{id:"name",value:m.name,onChange:s=>I({...m,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"email",children:"البريد الإلكتروني"}),e.jsx(L,{id:"email",type:"email",value:(t==null?void 0:t.email)||"",disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"phone",children:"رقم الهاتف"}),e.jsx(L,{id:"phone",value:m.phone,onChange:s=>I({...m,phone:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"birthdate",children:"تاريخ الميلاد"}),e.jsx(L,{id:"birthdate",type:"date",value:m.birthdate,onChange:s=>I({...m,birthdate:s.target.value})})]})]}),e.jsxs(h,{onClick:Y,disabled:j,children:[j&&e.jsx(G,{className:"ml-2 h-4 w-4 animate-spin"}),"حفظ التغييرات"]})]})]})}),e.jsx(S,{value:"orders",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(y,{children:[e.jsx(w,{children:"طلباتي"}),e.jsx(E,{children:"تتبع وإدارة طلباتك"})]}),e.jsx(i,{children:k.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد طلبات حتى الآن"}),e.jsx(h,{className:"mt-4",onClick:()=>a("/products"),children:"تسوق الآن"})]}):e.jsx("div",{className:"space-y-4",children:k.map(s=>{var n;return e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 rounded bg-gray-100 flex items-center justify-center",children:e.jsx(P,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["#",s.orderNumber||s.$id.slice(-6)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[((n=s.items)==null?void 0:n.length)||0," منتجات - ",se(s.$createdAt)]}),te(s.status)]})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-lg font-bold",children:T(s.total||s.totalAmount||0)}),e.jsxs(h,{variant:"outline",size:"sm",className:"mt-2",children:[e.jsx(de,{className:"h-4 w-4 ml-1"}),"التفاصيل"]})]})]},s.$id)})})})]})}),e.jsx(S,{value:"wishlist",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(y,{children:[e.jsx(w,{children:"قائمة المفضلة"}),e.jsx(E,{children:"المنتجات التي قمت بحفظها"})]}),e.jsx(i,{children:_.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(H,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"قائمة المفضلة فارغة"}),e.jsx(h,{className:"mt-4",onClick:()=>a("/products"),children:"اكتشف المنتجات"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:_.map(s=>e.jsx(c,{children:e.jsxs(i,{className:"p-4",children:[e.jsx("img",{src:s.productImage||xe.product(s.productName),alt:s.productName,className:"w-full h-40 object-cover rounded mb-3"}),e.jsx("h4",{className:"font-semibold mb-2",children:s.productName}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-lg font-bold",children:T(s.productPrice)}),e.jsx($,{variant:s.inStock?"default":"secondary",children:s.inStock?"متوفر":"نفذ"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-3",children:[e.jsx(h,{size:"sm",disabled:!s.inStock,children:"أضف للسلة"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>Z(s.$id),children:"إزالة"})]})]})},s.$id))})})]})}),e.jsx(S,{value:"addresses",className:"space-y-4",children:e.jsxs(c,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(w,{children:"عناويني"}),e.jsx(E,{children:"إدارة عناوين الشحن"})]}),e.jsxs(h,{children:[e.jsx(M,{className:"h-4 w-4 ml-2"}),"إضافة عنوان"]})]})}),e.jsx(i,{children:R.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد عناوين محفوظة"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:R.map(s=>e.jsx(c,{children:e.jsxs(i,{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.label}),s.isDefault&&e.jsx($,{variant:"secondary",className:"mt-1",children:"العنوان الافتراضي"})]})}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:[s.street,", ",s.city,", ",s.country]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.phone}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"outline",size:"sm",children:"تعديل"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>ee(s.$id),children:"حذف"})]})]})},s.$id))})})]})}),e.jsx(S,{value:"settings",className:"space-y-4",children:e.jsxs(c,{children:[e.jsx(y,{children:e.jsx(w,{children:"الأمان"})}),e.jsx(i,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"تغيير كلمة المرور"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"قم بتحديث كلمة المرور الخاصة بك"})]}),e.jsxs(h,{variant:"outline",children:[e.jsx(oe,{className:"h-4 w-4 ml-2"}),"تغيير"]})]})})]})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsx(c,{className:"max-w-md w-full",children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(ce,{className:"h-12 w-12 text-yellow-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"يرجى تسجيل الدخول"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"يجب عليك تسجيل الدخول للوصول إلى حسابك"}),e.jsx(h,{onClick:()=>a("/login"),children:"تسجيل الدخول"})]})})})})}export{Oe as default};
