import{r as o,j as e,aX as R,cn as U,g as A,e as X,bS as Y,aY as _}from"./vendor-react-BTCGZZAN.js";import{A as E}from"./AdminLayout-DqAgGWSf.js";import{u as G,D as L,A as k,e as g,t as F,v as O,w as q,x as H,C as p,r as f,s as N,f as v,I as b,n as J,L as C,y as K}from"./index-DAwEpow4.js";import{T as Q}from"./textarea-DC34-8pe.js";import{T as V,a as W,b as z,c as u,d as Z,e as j}from"./table-C5DXC0ob.js";import{d as S}from"./admin-api-C0fQRsN9.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-GexG3wnZ.js";import"./vendor-other-ws_0vYaO.js";import"./vendor-animations-W1Z2cmit.js";import"./avatar-Bz0dpiLw.js";import"./vendor-appwrite-BQhTxLk4.js";const I=({category:r,onSubmit:i,onCancel:x})=>{const[n,d]=o.useState({name:(r==null?void 0:r.name)||"",slug:(r==null?void 0:r.slug)||"",description:(r==null?void 0:r.description)||"",image:(r==null?void 0:r.image)||""}),m=l=>{l.preventDefault(),i(n)},w=l=>l.toLowerCase().replace(/[أ-ي]/g,t=>({أ:"a",ب:"b",ت:"t",ث:"th",ج:"j",ح:"h",خ:"kh",د:"d",ذ:"dh",ر:"r",ز:"z",س:"s",ش:"sh",ص:"s",ض:"d",ط:"t",ظ:"dh",ع:"a",غ:"gh",ف:"f",ق:"q",ك:"k",ل:"l",م:"m",ن:"n",ه:"h",و:"w",ي:"y"})[t]||t).replace(/\s+/g,"-").replace(/[^\w\-]+/g,""),T=l=>{d(t=>({...t,name:l,slug:r?t.slug:w(l)}))};return e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"name",children:"اسم الفئة"}),e.jsx(b,{id:"name",value:n.name,onChange:l=>T(l.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"slug",children:"الرابط (Slug)"}),e.jsx(b,{id:"slug",value:n.slug,onChange:l=>d(t=>({...t,slug:l.target.value})),placeholder:"electronics",required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["سيكون الرابط: /category/",n.slug]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"description",children:"الوصف"}),e.jsx(Q,{id:"description",value:n.description,onChange:l=>d(t=>({...t,description:l.target.value})),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"image",children:"رابط الصورة"}),e.jsx(b,{id:"image",value:n.image,onChange:l=>d(t=>({...t,image:l.target.value})),placeholder:"/placeholder.svg"})]}),e.jsxs(K,{children:[e.jsx(g,{type:"button",variant:"outline",onClick:x,children:"إلغاء"}),e.jsx(g,{type:"submit",children:r?"تحديث الفئة":"إضافة الفئة"})]})]})};function xe(){const{toast:r}=G(),[i,x]=o.useState([]),[n,d]=o.useState(!0),[m,w]=o.useState(""),[T,l]=o.useState(!1),[t,h]=o.useState(null);o.useEffect(()=>{(async()=>{d(!0);try{const a=await J.getAll();x(a.categories)}catch(a){console.error("Error fetching categories:",a)}d(!1)})()},[]);const y=i.filter(s=>s.name.toLowerCase().includes(m.toLowerCase())||s.slug.toLowerCase().includes(m.toLowerCase())),P=async s=>{try{console.log("Creating category with data:",s);const a=await S.create(s);console.log("Category created successfully:",a),x(c=>[a,...c]),l(!1),r({title:"تم بنجاح",description:"تم إضافة الفئة بنجاح"})}catch(a){console.error("Error adding category:",a);const c=(a==null?void 0:a.message)||(a==null?void 0:a.toString())||"فشل في إضافة الفئة";r({variant:"destructive",title:"خطأ",description:c})}},B=async s=>{if(t)try{const a=await S.update(t.id,s);x(c=>c.map(D=>D.id===t.id?{...D,...a}:D)),h(null)}catch(a){console.error("Error updating category:",a),alert("فشل في تحديث الفئة")}},M=async s=>{if(confirm("هل أنت متأكد من حذف هذه الفئة؟"))try{await S.delete(s),x(a=>a.filter(c=>c.id!==s))}catch(a){console.error("Error deleting category:",a),alert("فشل في حذف الفئة")}};return n?e.jsx(E,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"إدارة الفئات"})}),e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-10 bg-muted rounded mb-4"}),e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,a)=>e.jsx("div",{className:"h-16 bg-muted rounded"},a))})]})]})}):e.jsx(E,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"إدارة الفئات"}),e.jsxs(L,{open:T,onOpenChange:l,children:[e.jsx(k,{asChild:!0,children:e.jsxs(g,{children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"إضافة فئة جديدة"]})}),e.jsxs(F,{className:"max-w-md",children:[e.jsxs(O,{children:[e.jsx(q,{children:"إضافة فئة جديدة"}),e.jsx(H,{children:"أدخل تفاصيل الفئة الجديدة"})]}),e.jsx(I,{onSubmit:P,onCancel:()=>l(!1)})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"إجمالي الفئات"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold",children:i.length})})]}),e.jsxs(p,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"إجمالي المنتجات"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold",children:i.reduce((s,a)=>s+a.productCount,0)})})]}),e.jsxs(p,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"متوسط المنتجات"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold",children:i.length>0?Math.round(i.reduce((s,a)=>s+a.productCount,0)/i.length):0})})]})]}),e.jsx("div",{className:"flex gap-4",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(b,{placeholder:"البحث في الفئات...",value:m,onChange:s=>w(s.target.value),className:"pl-10"})]})})}),e.jsxs(p,{children:[e.jsx(f,{children:e.jsxs(N,{children:["الفئات (",y.length,")"]})}),e.jsx(v,{children:e.jsxs(V,{children:[e.jsx(W,{children:e.jsxs(z,{children:[e.jsx(u,{children:"الفئة"}),e.jsx(u,{children:"الرابط"}),e.jsx(u,{children:"الوصف"}),e.jsx(u,{children:"عدد المنتجات"}),e.jsx(u,{className:"text-center",children:"الإجراءات"})]})}),e.jsx(Z,{children:y.map(s=>e.jsxs(z,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.image||"/placeholder.svg",alt:s.name,className:"w-10 h-10 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: ",s.id]})]})]})}),e.jsx(j,{children:e.jsxs("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:["/category/",s.slug]})}),e.jsx(j,{children:e.jsx("div",{className:"max-w-[300px] truncate text-sm text-muted-foreground",children:s.description||"لا يوجد وصف"})}),e.jsx(j,{children:e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-medium",children:s.productCount})})}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsxs(L,{open:(t==null?void 0:t.id)===s.id,onOpenChange:a=>!a&&h(null),children:[e.jsx(k,{asChild:!0,children:e.jsx(g,{variant:"outline",size:"sm",onClick:()=>h(s),children:e.jsx(Y,{className:"h-4 w-4"})})}),e.jsxs(F,{className:"max-w-md",children:[e.jsxs(O,{children:[e.jsx(q,{children:"تعديل الفئة"}),e.jsx(H,{children:"تعديل تفاصيل الفئة"})]}),t&&e.jsx(I,{category:t,onSubmit:B,onCancel:()=>h(null)})]})]}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>{confirm("هل أنت متأكد من حذف هذه الفئة؟")&&M(s.id)},children:e.jsx(_,{className:"h-4 w-4 text-red-600"})})]})})]},s.id))})]})})]})]})})}export{xe as default};
