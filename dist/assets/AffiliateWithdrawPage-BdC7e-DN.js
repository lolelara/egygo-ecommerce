import{r as l,j as e,a0 as k,af as W,bJ as E,_ as F,by as L}from"./vendor-react-CCFRLLzk.js";import{c as P,u as I,Q as j,R as u,C as n,h as d,x as y,y as w,P as R,L as C,I as T,f as p}from"./index-CtsYZAzS.js";import{a as f}from"./affiliate-api-BMy8PTXd.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-other-CzBBjgu5.js";import"./vendor-animations-CPHPqPXb.js";import"./vendor-appwrite-CuqfvTq9.js";function G(){const{user:t}=P(),{toast:c}=I(),[r,g]=l.useState(""),[i,N]=l.useState("bank"),[x,A]=l.useState(null),[m,S]=l.useState([]),[D,v]=l.useState(!0);l.useEffect(()=>{t!=null&&t.$id&&b()},[t]);const b=async()=>{if(t!=null&&t.$id)try{v(!0);const[s,h]=await Promise.all([f.getStats(t.$id),f.getWithdrawals(t.$id)]);A(s),S(h)}catch(s){console.error("Error loading data:",s)}finally{v(!1)}},o=(x==null?void 0:x.totalEarnings)||0,a=100,$=async()=>{const s=parseFloat(r);if(isNaN(s)||s<a){c({variant:"destructive",title:"خطأ",description:`الحد الأدنى للسحب ${a} ج.م`});return}if(s>o){c({variant:"destructive",title:"خطأ",description:"المبلغ أكبر من رصيدك المتاح"});return}try{await f.requestWithdrawal(t.$id,s,i,{}),c({title:"تم إرسال الطلب",description:"سيتم مراجعة طلبك والدفع خلال 7 أيام عمل"}),g(""),b()}catch(h){c({variant:"destructive",title:"خطأ",description:h.message||"فشل في إرسال طلب السحب"})}};return!(t!=null&&t.isAffiliate)&&(t==null?void 0:t.role)!=="affiliate"?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(j,{variant:"destructive",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx(u,{children:"هذه الصفحة متاحة للمسوقين فقط"})]})}):D?e.jsx("div",{className:"container mx-auto px-4 py-8 flex justify-center items-center min-h-[400px]",children:e.jsx(W,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"سحب الأرباح"}),e.jsx("p",{className:"text-muted-foreground",children:"اسحب عمولاتك بسهولة وأمان"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3 mb-8",children:[e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-500/10 rounded-lg",children:e.jsx(E,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"الرصيد المتاح"}),e.jsxs("p",{className:"text-2xl font-bold",children:[o.toFixed(2)," ج.م"]})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-yellow-500/10 rounded-lg",children:e.jsx(F,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"قيد المراجعة"}),e.jsx("p",{className:"text-2xl font-bold",children:"500.00 ج.م"})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-500/10 rounded-lg",children:e.jsx(L,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي المسحوبات"}),e.jsx("p",{className:"text-2xl font-bold",children:"5,000 ج.م"})]})]})})})]}),e.jsxs(n,{className:"mb-6",children:[e.jsxs(y,{children:[e.jsx(w,{children:"طلب سحب جديد"}),e.jsxs(R,{children:["الحد الأدنى للسحب: ",a," ج.م"]})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"amount",children:"المبلغ (ج.م)"}),e.jsx(T,{id:"amount",type:"number",value:r,onChange:s=>g(s.target.value),placeholder:`أدخل المبلغ (الحد الأدنى ${a} ج.م)`,min:a,max:o})]}),e.jsxs("div",{children:[e.jsx(C,{children:"طريقة الاستلام"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[e.jsx(p,{variant:i==="bank"?"default":"outline",onClick:()=>N("bank"),className:"w-full",children:"حساب بنكي"}),e.jsx(p,{variant:i==="wallet"?"default":"outline",onClick:()=>N("wallet"),className:"w-full",children:"محفظة إلكترونية"})]})]}),i==="bank"&&e.jsx(j,{children:e.jsx(u,{children:"سيتم التحويل للحساب البنكي المسجل في ملفك الشخصي"})}),i==="wallet"&&e.jsx(j,{children:e.jsx(u,{children:"متاح قريباً: فودافون كاش، إنستاباي، فوري"})}),e.jsx(p,{onClick:$,disabled:!r||parseFloat(r)<a||parseFloat(r)>o,className:"w-full",children:"طلب السحب"})]})]}),e.jsxs(n,{children:[e.jsx(y,{children:e.jsx(w,{children:"طلبات السحب السابقة"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:m&&m.length>0?m.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.amount," ج.م"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString("ar")})]}),e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${s.status==="completed"?"bg-green-500/10 text-green-700":s.status==="rejected"?"bg-red-500/10 text-red-700":"bg-yellow-500/10 text-yellow-700"}`,children:s.status==="completed"?"مكتمل":s.status==="rejected"?"مرفوض":"قيد المراجعة"})]},s.id)):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"لا توجد طلبات سحب سابقة"})})})]})]})}export{G as default};
