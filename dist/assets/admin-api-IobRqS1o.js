import{d as n,e as p}from"./index-D-h96Znd.js";import{Q as m}from"./vendor-appwrite-CuqfvTq9.js";const c=p.databaseId,d={PRODUCTS:p.collections.products,CATEGORIES:p.collections.categories,ORDERS:p.collections.orders,USERS:p.collections.users,REVIEWS:p.collections.reviews,COMMISSIONS:"commissions",NOTIFICATIONS:"notifications"},$={getStats:async()=>{try{const e=await n.listDocuments(c,d.ORDERS,[m.orderDesc("$createdAt"),m.limit(100)]),s=await n.listDocuments(c,d.PRODUCTS,[m.limit(1e3)]),o=await n.listDocuments(c,d.USERS,[m.limit(1e3)]);let t=0;try{t=(await n.listDocuments(c,d.USERS,[m.equal("isAffiliate",!0),m.limit(1e3)])).total}catch(a){console.error("Error fetching affiliates:",a),t=o.documents.filter(g=>g.isAffiliate===!0).length}const r=await n.listDocuments(c,d.COMMISSIONS,[m.limit(1e3)]),i=new Date;i.setDate(1),i.setHours(0,0,0,0);const l=e.documents.filter(a=>new Date(a.$createdAt)>=i),w=l.filter(a=>a.status!=="CANCELLED").reduce((a,u)=>a+(u.total||0),0),A=e.documents.filter(a=>a.status!=="CANCELLED").reduce((a,u)=>a+(u.total||0),0),I=e.documents.filter(a=>a.status==="PENDING").length,v=r.documents.filter(a=>a.status==="PENDING").reduce((a,u)=>a+(u.amount||0),0),h=e.documents.slice(0,10).map(a=>({id:a.$id,orderNumber:a.orderNumber,status:a.status,total:a.total,createdAt:a.$createdAt,userId:a.userId})),f={};e.documents.forEach(a=>{a.items&&Array.isArray(a.items)&&a.items.forEach(u=>{const g=u.productId;f[g]||(f[g]={productId:g,quantity:0,revenue:0}),f[g].quantity+=u.quantity||0,f[g].revenue+=(u.price||0)*(u.quantity||0)})});const S=Object.values(f).sort((a,u)=>u.quantity-a.quantity).slice(0,5),D=e.documents.filter(a=>a.status==="COMPLETED").length,C=e.total>0?D/e.total*100:0,E=e.total>0?A/e.total:0;let y=0;try{const a=await n.listDocuments(c,d.REVIEWS,[m.limit(1e3)]);a.total>0&&(y=a.documents.reduce((g,O)=>g+(O.rating||0),0)/a.total)}catch(a){console.error("Error fetching reviews:",a),y=0}return{totalRevenue:A,totalOrders:e.total,totalProducts:s.total,totalUsers:o.total,pendingOrders:I,totalAffiliates:t,pendingCommissions:v,thisMonthRevenue:w,thisMonthOrders:l.length,recentOrders:h,topProducts:S,conversionRate:C,averageOrderValue:E,customerSatisfaction:y}}catch(e){return console.error("Error fetching admin stats:",e),{totalRevenue:0,totalOrders:0,totalProducts:0,totalUsers:0,pendingOrders:0,totalAffiliates:0,pendingCommissions:0,thisMonthRevenue:0,thisMonthOrders:0,recentOrders:[],topProducts:[],conversionRate:0,averageOrderValue:0,customerSatisfaction:0}}}},z={create:async(e,s)=>{var o;try{console.log("Creating product with data:",e),console.log("User ID (merchantId):",s);const t={name:e.name,description:e.description,price:e.price,comparePrice:e.comparePrice||e.originalPrice||null,stock:e.stock||e.stockQuantity||0,categoryId:e.categoryId,images:e.images||[],tags:e.tags||[],isActive:e.isActive??!0,isFeatured:e.isFeatured??!1,rating:0,reviewCount:0,status:s?"pending":"approved"};e.merchantId?t.merchantId=e.merchantId:s&&(t.merchantId=s,console.log("Auto-assigned merchantId:",s)),e.colors&&Array.isArray(e.colors)&&(t.colors=e.colors),e.sizes&&Array.isArray(e.sizes)&&(t.sizes=e.sizes),e.colorSizeInventory&&(t.colorSizeInventory=e.colorSizeInventory,console.log("ğŸ“¦ Saving colorSizeInventory:",e.colorSizeInventory));try{const r=await n.createDocument(c,d.PRODUCTS,"unique()",t);return console.log("Product created successfully:",r),{id:r.$id,name:r.name,description:r.description,price:r.price,comparePrice:r.comparePrice,stock:r.stock,categoryId:r.categoryId,images:r.images,tags:r.tags,isActive:r.isActive,isFeatured:r.isFeatured,rating:r.rating,reviewCount:r.reviewCount,createdAt:r.$createdAt}}catch(r){if((o=r.message)!=null&&o.includes("Unknown attribute")){console.warn("Retrying without optional attributes:",r.message),delete t.colorSizeInventory,delete t.merchantId,delete t.colors,delete t.sizes;const i=await n.createDocument(c,d.PRODUCTS,"unique()",t);return console.log("Product created successfully (without optional fields):",i),{id:i.$id,name:i.name,description:i.description,price:i.price,comparePrice:i.comparePrice,stock:i.stock,categoryId:i.categoryId,images:i.images,tags:i.tags,isActive:i.isActive,isFeatured:i.isFeatured,rating:i.rating,reviewCount:i.reviewCount,createdAt:i.$createdAt}}throw r}}catch(t){throw console.error("Product creation error:",t),new Error(t.message||"ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬")}},update:async e=>{var s;try{const{id:o,...t}=e,r={};t.name&&(r.name=t.name),t.description&&(r.description=t.description),t.price!==void 0&&(r.price=t.price),(t.comparePrice!==void 0||t.originalPrice!==void 0)&&(r.comparePrice=t.comparePrice||t.originalPrice||null),(t.stock!==void 0||t.stockQuantity!==void 0)&&(r.stock=t.stock??t.stockQuantity??0),t.categoryId&&(r.categoryId=t.categoryId),t.images&&(r.images=t.images),t.tags&&(r.tags=t.tags),t.isActive!==void 0&&(r.isActive=t.isActive),t.isFeatured!==void 0&&(r.isFeatured=t.isFeatured),t.rating!==void 0&&(r.rating=t.rating),t.reviewCount!==void 0&&(r.reviewCount=t.reviewCount),t.merchantId&&(r.merchantId=t.merchantId),t.colors&&(r.colors=t.colors),t.sizes&&(r.sizes=t.sizes),t.colorSizeInventory!==void 0&&(r.colorSizeInventory=t.colorSizeInventory,console.log("ğŸ“¦ Updating colorSizeInventory:",t.colorSizeInventory));try{const i=await n.updateDocument(c,d.PRODUCTS,o,r);return{id:i.$id,name:i.name,description:i.description,price:i.price,comparePrice:i.comparePrice,stock:i.stock,categoryId:i.categoryId,images:i.images,tags:i.tags,isActive:i.isActive,isFeatured:i.isFeatured,rating:i.rating,reviewCount:i.reviewCount,updatedAt:i.$updatedAt}}catch(i){if((s=i.message)!=null&&s.includes("Unknown attribute")){console.warn("Retrying update without optional attributes:",i.message),delete r.colorSizeInventory,delete r.merchantId,delete r.colors,delete r.sizes;const l=await n.updateDocument(c,d.PRODUCTS,o,r);return{id:l.$id,name:l.name,description:l.description,price:l.price,comparePrice:l.comparePrice,stock:l.stock,categoryId:l.categoryId,images:l.images,tags:l.tags,isActive:l.isActive,isFeatured:l.isFeatured,rating:l.rating,reviewCount:l.reviewCount,updatedAt:l.$updatedAt}}throw i}}catch(o){throw new Error(o.message||"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬")}},delete:async e=>{try{return await n.deleteDocument(c,d.PRODUCTS,e),{message:"ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­"}}catch(s){throw new Error(s.message||"ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬")}}},k={create:async e=>{try{const s=e.slug||e.name.toLowerCase().replace(/[Ø£-ÙŠ\s]+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),o=await n.createDocument(c,d.CATEGORIES,"unique()",{name:e.name,description:e.description||"",image:e.image||"",isActive:!0});return{id:o.$id,name:o.name,slug:s,description:o.description,image:o.image,productCount:0,createdAt:o.$createdAt}}catch(s){throw console.error("Category creation error:",s),new Error(s.message||"ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ¦Ø©")}},update:async(e,s)=>{try{const o=await n.updateDocument(c,d.CATEGORIES,e,{name:s.name,description:s.description,image:s.image}),t=s.name.toLowerCase().replace(/[Ø£-ÙŠ\s]+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"");return{id:o.$id,name:o.name,slug:t,description:o.description,image:o.image,updatedAt:o.$updatedAt}}catch(o){throw console.error("Category update error:",o),new Error(o.message||"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ¦Ø©")}},delete:async e=>{try{return await n.deleteDocument(c,d.CATEGORIES,e),{message:"ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ¦Ø© Ø¨Ù†Ø¬Ø§Ø­"}}catch(s){throw new Error(s.message||"ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙØ¦Ø©")}}},U={getAll:async()=>{try{return(await n.listDocuments(c,d.ORDERS,[m.orderDesc("$createdAt")])).documents.map(s=>({id:s.$id,orderNumber:s.orderNumber,status:s.status,total:s.total,userId:s.userId,createdAt:s.$createdAt}))}catch(e){return console.error("Error fetching orders:",e),[]}},updateStatus:async(e,s)=>{try{const o=await n.updateDocument(c,d.ORDERS,e,{status:s});return{id:o.$id,status:o.status,updatedAt:o.$updatedAt}}catch(o){throw new Error(o.message||"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨")}}},N={getAll:async()=>{try{return(await n.listDocuments(c,d.COMMISSIONS,[m.orderDesc("$createdAt")])).documents.map(s=>({id:s.$id,amount:s.amount,status:s.status,affiliateId:s.affiliateId,orderId:s.orderId,createdAt:s.$createdAt}))}catch(e){return console.error("Error fetching commissions:",e),[]}},updateStatus:async(e,s)=>{try{const o=await n.updateDocument(c,d.COMMISSIONS,e,{status:s});return{id:o.$id,status:o.status,updatedAt:o.$updatedAt}}catch(o){throw new Error(o.message||"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©")}}};export{z as a,U as b,$ as c,k as d,N as e};
