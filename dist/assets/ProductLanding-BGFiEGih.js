import{aX as ee,l as se,r as c,W as ae,m as B,Y as te,j as e,av as re,z as U,az as $,a7 as _,o as ie,ab as le,aW as ne,ai as ce,p as oe}from"./vendor-react-BMq-IxHG.js";import{a as de,V as me,g as f,B as K,C as o,f as m,L as M,e as g,d as O,p as xe}from"./index-C03DQAFm.js";import{Q as he}from"./vendor-appwrite-BGb_FC-V.js";import{P as ge}from"./LoadingSkeletons-B7PGqMbh.js";import{S as pe}from"./SEO-CoadIhO0.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-GexG3wnZ.js";import"./vendor-other-C5r3s8Py.js";import"./vendor-animations-W1Z2cmit.js";import"./skeleton-DujnZR4C.js";const R="";function Ie(){var Q,F,T;const{linkCode:p}=ee(),k=se(),{addItem:C}=de(),[ue,je]=c.useState(null),[z,W]=c.useState(!1),[r,I]=c.useState(""),[n,q]=c.useState(""),[A,b]=c.useState([]),[E,w]=c.useState([]),[x,G]=c.useState([]),[h,N]=c.useState(0),H=ae(),S=()=>{if(!r||!n||x.length===0)return 0;const a=x.find(t=>t.color===r&&t.size===n);return(a==null?void 0:a.quantity)||0},{data:i,isLoading:J,error:P}=B({queryKey:["affiliate-link",p],queryFn:async()=>{if(!p)throw new Error("Link code is required");const a=await O.listDocuments(R,"affiliate_links",[he.equal("linkCode",p)]);if(a.documents.length===0)throw new Error("رابط غير صالح");return a.documents[0]},enabled:!!p}),{data:s,isLoading:V}=B({queryKey:["product",i==null?void 0:i.productId],queryFn:()=>xe.getById(i.productId),enabled:!!(i!=null&&i.productId)}),X=te({mutationFn:async()=>{i&&await O.updateDocument(R,"affiliate_links",i.$id,{clicks:(i.clicks||0)+1,lastClickAt:new Date().toISOString()})},onSuccess:()=>{H.invalidateQueries({queryKey:["affiliate-link",p]})}});c.useEffect(()=>{i&&!z&&(X.mutate(),W(!0),sessionStorage.setItem("referralAffiliateId",i.affiliateId),sessionStorage.setItem("referralLinkCode",p||""))},[i,z]),c.useEffect(()=>{if(s){console.log("🔍 Product data:",s),console.log("📦 colorSizeInventory:",s.colorSizeInventory),console.log("🎨 colors:",s.colors),console.log("📏 sizes:",s.sizes);try{const a=s.colorSizeInventory;if(a&&a!=="[]"&&a!==""){const d=JSON.parse(a);if(console.log("✅ Parsed inventory:",d),d.length>0){G(d);const L=d.reduce((j,Z)=>j+(Z.quantity||0),0);N(L),console.log("📊 Total stock:",L);const y=new Set,v=new Set;d.forEach(j=>{j.quantity>0&&(y.add(j.color),v.add(j.size))}),b(Array.from(y)),w(Array.from(v)),y.size>0&&!r&&I(Array.from(y)[0]),v.size>0&&!n&&q(Array.from(v)[0]);return}}console.log("⚠️ No inventory data, using fallback");const t=s.colors||[],l=s.sizes||[];if(b(t),w(l),t.length>0||l.length>0)N(999),console.log("✅ Product has colors/sizes, setting stock to 999");else{const d=s.stock||s.stockQuantity||0;N(d>0?d:999),console.log("📦 Using old stock:",d||999)}}catch(a){console.error("❌ Error parsing inventory:",a);const t=s.colors||[],l=s.sizes||[];b(t),w(l),N(999)}}},[s]);const Y=()=>{var l;if(!s)return;const a=f((l=s.images)==null?void 0:l[0]),t=x.length>0&&r&&n?S():h;C({productId:s.id,name:s.name,price:s.price,image:a,quantity:1,stockQuantity:t,inStock:h>0,selectedColor:r||void 0,selectedSize:n||void 0}),k("/cart")},D=()=>{var l;if(!s)return;const a=f((l=s.images)==null?void 0:l[0]),t=x.length>0&&r&&n?S():h;C({productId:s.id,name:s.name,price:s.price,image:a,quantity:1,stockQuantity:t,inStock:h>0,selectedColor:r||void 0,selectedSize:n||void 0}),k("/checkout")};if(J||V)return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-primary/5 to-white",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(ge,{count:1})})});if(P||!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"max-w-md w-full px-4",children:e.jsx(me,{error:P||new Error("المنتج غير موجود"),onRetry:()=>window.location.reload()})})});const u=s.originalPrice?Math.round((s.originalPrice-s.price)/s.originalPrice*100):0;return e.jsxs(e.Fragment,{children:[e.jsx(pe,{title:`${s.name} - عرض خاص`,description:s.description,ogImage:f((Q=s.images)==null?void 0:Q[0])}),e.jsx("div",{className:"bg-gradient-to-r from-primary via-orange-500 to-pink-500 text-white",children:e.jsxs("div",{className:"container mx-auto px-4 py-12 text-center",children:[e.jsx(K,{className:"mb-4 bg-white text-primary hover:bg-white",children:"🔥 عرض خاص لفترة محدودة"}),e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:s.name}),u>0&&e.jsxs("p",{className:"text-2xl md:text-3xl font-semibold",children:["وفّر ",u,"% الآن!"]})]})}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 lg:gap-12",children:[e.jsxs("div",{children:[e.jsx(o,{className:"overflow-hidden shadow-xl",children:e.jsx("img",{src:f((F=s.images)==null?void 0:F[0]),alt:s.name,className:"w-full aspect-square object-cover"})}),s.images&&s.images.length>1&&e.jsx("div",{className:"grid grid-cols-4 gap-2 mt-4",children:s.images.slice(1,5).map((a,t)=>{const l=f(a);return e.jsx(o,{className:"overflow-hidden cursor-pointer hover:ring-2 hover:ring-primary transition-all",children:e.jsx("img",{src:l,alt:`${s.name} ${t+2}`,className:"w-full aspect-square object-cover"})},t)})})]}),e.jsxs("div",{className:"space-y-6",children:[s.rating>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((a,t)=>e.jsx(re,{className:`h-5 w-5 ${t<Math.round(s.rating)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},t))}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.rating.toFixed(1)," (",s.reviewCount," تقييم)"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-baseline gap-3",children:[e.jsxs("span",{className:"text-5xl font-bold text-primary",children:[s.price.toFixed(2)," جنيه"]}),s.originalPrice&&e.jsxs("span",{className:"text-2xl text-gray-400 line-through",children:[s.originalPrice.toFixed(2)," جنيه"]})]}),u>0&&e.jsxs(K,{variant:"destructive",className:"text-lg px-3 py-1",children:["وفّر ",(s.originalPrice-s.price).toFixed(2)," جنيه"]})]}),e.jsx(o,{className:"bg-green-50 border-green-200",children:e.jsxs(m,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-700",children:[e.jsx(U,{className:"h-5 w-5"}),e.jsx("span",{children:"ضمان استرجاع المال خلال 14 يوم"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-green-700",children:[e.jsx($,{className:"h-5 w-5"}),e.jsx("span",{children:"شحن مجاني للطلبات فوق 500 جنيه"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-green-700",children:[e.jsx(_,{className:"h-5 w-5"}),e.jsx("span",{children:"منتج أصلي 100%"})]})]})}),h>0?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(U,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"متوفر في المخزون"}),x.length>0&&r&&n&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",S()," متوفر)"]})]}):e.jsx("div",{className:"text-red-600 font-semibold",children:"غير متوفر حالياً"}),A.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{className:"text-base font-semibold",children:"اختر اللون:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:A.map((a,t)=>e.jsx(g,{variant:r===a?"default":"outline",className:"min-w-[80px]",onClick:()=>I(a),children:a},t))}),r&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["تم اختيار: ",e.jsx("span",{className:"font-semibold",children:r})]})]}),E.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{className:"text-base font-semibold",children:"اختر المقاس:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:E.map((a,t)=>e.jsx(g,{variant:n===a?"default":"outline",className:"min-w-[60px]",onClick:()=>q(a),children:a},t))}),n&&r&&x.length>0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["الكمية المتاحة: ",e.jsxs("span",{className:"font-semibold",children:[((T=x.find(a=>a.color===r&&a.size===n))==null?void 0:T.quantity)||0," قطعة"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(g,{onClick:D,size:"lg",className:"w-full text-lg h-14 bg-gradient-to-r from-primary to-orange-500 hover:from-primary/90 hover:to-orange-600",disabled:h===0,children:[e.jsx(ie,{className:"ml-2 h-6 w-6"}),"اشترِ الآن - وفّر ",u,"%"]}),e.jsx(g,{onClick:Y,variant:"outline",size:"lg",className:"w-full text-lg h-14",disabled:h===0,children:"أضف إلى السلة"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"outline",size:"icon",children:e.jsx(le,{className:"h-5 w-5"})}),e.jsx(g,{variant:"outline",size:"icon",children:e.jsx(ne,{className:"h-5 w-5"})})]})]})]}),e.jsxs("div",{className:"mt-12",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"تفاصيل المنتج"}),e.jsx(o,{children:e.jsx(m,{className:"p-6",children:e.jsx("p",{className:"text-lg text-gray-700 leading-relaxed whitespace-pre-wrap",children:s.description})})})]}),s.reviewCount>0&&e.jsxs("div",{className:"mt-12",children:[e.jsxs("h2",{className:"text-3xl font-bold mb-6",children:["آراء العملاء (",s.reviewCount,")"]}),e.jsx(o,{children:e.jsx(m,{className:"p-6",children:e.jsx("div",{className:"text-center text-gray-500",children:"التقييمات قادمة قريباً..."})})})]}),e.jsxs("div",{className:"mt-12 grid md:grid-cols-4 gap-6",children:[e.jsx(o,{children:e.jsxs(m,{className:"p-6 text-center",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-3 text-primary"}),e.jsx("h3",{className:"font-semibold mb-2",children:"دفع آمن"}),e.jsx("p",{className:"text-sm text-gray-600",children:"جميع المعاملات محمية ومشفرة"})]})}),e.jsx(o,{children:e.jsxs(m,{className:"p-6 text-center",children:[e.jsx($,{className:"h-12 w-12 mx-auto mb-3 text-primary"}),e.jsx("h3",{className:"font-semibold mb-2",children:"شحن سريع"}),e.jsx("p",{className:"text-sm text-gray-600",children:"توصيل خلال 2-5 أيام عمل"})]})}),e.jsx(o,{children:e.jsxs(m,{className:"p-6 text-center",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto mb-3 text-primary"}),e.jsx("h3",{className:"font-semibold mb-2",children:"إرجاع مجاني"}),e.jsx("p",{className:"text-sm text-gray-600",children:"استرجاع المال خلال 14 يوم"})]})}),e.jsx(o,{children:e.jsxs(m,{className:"p-6 text-center",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto mb-3 text-primary"}),e.jsx("h3",{className:"font-semibold mb-2",children:"الأكثر مبيعاً"}),e.jsx("p",{className:"text-sm text-gray-600",children:"يثق به آلاف العملاء"})]})})]}),e.jsx(o,{className:"mt-12 bg-gradient-to-r from-primary/10 to-orange-500/10 border-primary",children:e.jsxs(m,{className:"p-8 text-center",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:"لا تفوت هذا العرض الخاص!"}),e.jsxs("p",{className:"text-lg text-gray-700 mb-6",children:["احصل على ",s.name," الآن بسعر مخفّض"]}),e.jsxs(g,{onClick:D,size:"lg",className:"text-xl px-12 h-16 bg-gradient-to-r from-primary to-orange-500",disabled:!s.inStock,children:["اطلب الآن - وفّر ",u,"%!"]})]})})]})]})}export{Ie as default};
