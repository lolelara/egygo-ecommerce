import{af as B,a8 as f,a0 as le,r as p,b as xe,j as e,ba as h,C as M,e as q,g as T,D as H,h as me,B as g,i as K,k as G,l as Q,b5 as Z,ab as je,o as pe,T as fe,f as ge,I as $,ap as J,aq as W,ar as X,as as Y,at as z,bb as ee,a as se,a1 as te,q as ve,s as ye,m as we}from"./index-Ce-RwxJS.js";import{T as ae,a as re,b as _,c as x,d as ce,e as m}from"./table-DhT4s9qg.js";import{D as ke}from"./download-UgG-gTV9.js";import{U as be}from"./upload-BkldABOD.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],Ce=B("keyboard",Ne);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Se=B("power-off",De);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],Ee=B("power",Ae);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Te=B("square-check-big",Me),v=void 0,y=void 0;async function $e(i,a){const r={success:0,failed:0,total:i.length,errors:[]};for(const l of i)try{const t=await f.getDocument(v,y,l);let c;typeof a=="number"?c=t.price+a:a.type==="percentage"?c=t.price*(1+a.value/100):c=a.value,await f.updateDocument(v,y,l,{price:c}),r.success++}catch(t){r.failed++,r.errors.push({id:l,error:t.message||"Unknown error"})}return r}async function ze(i,a){const r={success:0,failed:0,total:i.length,errors:[]};for(const l of i)try{await f.updateDocument(v,y,l,{isActive:a}),r.success++}catch(t){r.failed++,r.errors.push({id:l,error:t.message||"Unknown error"})}return r}async function Le(i){const a={success:0,failed:0,total:i.length,errors:[]};for(const r of i)try{await f.deleteDocument(v,y,r),a.success++}catch(l){a.failed++,a.errors.push({id:r,error:l.message||"Unknown error"})}return a}async function Pe(i,a){const r={success:0,failed:0,total:i.length,errors:[]};for(const l of i)try{await f.updateDocument(v,y,l,{categoryId:a}),r.success++}catch(t){r.failed++,r.errors.push({id:l,error:t.message||"Unknown error"})}return r}async function Ie(i,a){const r={success:0,failed:0,total:i.length,errors:[]};for(const l of i)try{const t=await f.getDocument(v,y,l);let c;typeof a=="number"?c=t.stock+a:a.type==="add"?c=t.stock+a.value:c=a.value,c=Math.max(0,c),await f.updateDocument(v,y,l,{stock:c}),r.success++}catch(t){r.failed++,r.errors.push({id:l,error:t.message||"Unknown error"})}return r}async function _e(i){try{let a;i&&i.length>0?a=await Promise.all(i.map(c=>f.getDocument(v,y,c))):a=(await f.listDocuments(v,y,[le.limit(1e3)])).documents;const r=["ID","Name","Price","Stock","Category","Status","Created"],l=a.map(c=>[c.$id,c.name,c.price,c.stock,c.category||"",c.isActive?"Active":"Inactive",new Date(c.$createdAt).toLocaleDateString("ar-EG")]);return[r.join(","),...l.map(c=>c.map(d=>`"${d}"`).join(","))].join(`
`)}catch(a){throw console.error("Error exporting products:",a),a}}async function Be(i){const a={success:0,failed:0,total:0,errors:[]};try{const r=i.trim().split(`
`),l=r[0].split(",").map(t=>t.trim().replace(/"/g,""));for(let t=1;t<r.length;t++){a.total++;try{const c=r[t].split(",").map(n=>n.trim().replace(/"/g,"")),d={};l.forEach((n,k)=>{d[n.toLowerCase()]=c[k]}),await f.createDocument(v,y,"unique()",{name:d.name,price:parseFloat(d.price)||0,stock:parseInt(d.stock)||0,category:d.category||"",isActive:d.status==="Active",description:d.description||"",merchantId:d.merchantid||""}),a.success++}catch(c){a.failed++,a.errors.push({id:`Line ${t+1}`,error:c.message||"Unknown error"})}}}catch(r){a.failed=a.total,a.errors.push({id:"CSV Parsing",error:r.message||"Failed to parse CSV"})}return a}function Ue(i,a="products.csv"){const r=new Blob([i],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),t=URL.createObjectURL(r);l.setAttribute("href",t),l.setAttribute("download",a),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)}const Fe=void 0,Oe=void 0;function Ke(){const[i,a]=p.useState(!0),[r,l]=p.useState([]),[t,c]=p.useState(new Set),{toast:d}=xe(),[n,k]=p.useState({search:"",category:"all",status:"all",priceMin:"",priceMax:"",stockMin:""}),[u,b]=p.useState({open:!1,action:null}),[U,L]=p.useState(!1),[S,P]=p.useState(null),[R,V]=p.useState(""),[I,F]=p.useState({current:0,total:0});p.useEffect(()=>{O()},[]);const O=async()=>{a(!0);try{const s=await f.listDocuments(Fe,Oe,[le.limit(1e3)]);l(s.documents)}catch(s){console.error("Error loading products:",s)}finally{a(!1)}},N=r.filter(s=>!(n.search&&!s.name.toLowerCase().includes(n.search.toLowerCase())||n.category!=="all"&&s.category!==n.category||n.status==="active"&&!s.isActive||n.status==="inactive"&&s.isActive||n.priceMin&&s.price<parseFloat(n.priceMin)||n.priceMax&&s.price>parseFloat(n.priceMax)||n.stockMin&&s.stock<parseInt(n.stockMin)));p.useEffect(()=>{const s=o=>{if(o.ctrlKey&&o.key==="a"&&!o.shiftKey){o.preventDefault();const C=N.map(A=>A.$id);c(new Set(C)),d({title:"تم التحديد",description:`تم تحديد ${C.length} منتج`})}o.key==="Delete"&&t.size>0&&!u.open&&(o.preventDefault(),b({open:!0,action:"delete"})),o.key==="Escape"&&t.size>0&&!u.open&&(o.preventDefault(),c(new Set),d({title:"تم الإلغاء",description:"تم إلغاء التحديد"}))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[N,t,u.open,d]);const ne=s=>{const o=new Set(t);o.has(s)?o.delete(s):o.add(s),c(o)},ie=()=>{t.size===N.length?c(new Set):c(new Set(N.map(s=>s.$id)))},oe=async()=>{if(t.size!==0){L(!0),P(null),F({current:0,total:t.size});try{const s=Array.from(t),o=50;let C=0,A=0;for(let j=0;j<s.length;j+=o){const E=s.slice(j,j+o);F({current:j,total:s.length});let D;switch(u.action){case"price":D=await $e(E,u.value);break;case"stock":D=await Ie(E,u.value);break;case"category":D=await Pe(E,u.value);break;case"status":D=await ze(E,u.value);break;case"delete":D=await Le(E);break;default:return}C+=D.success,A+=D.failed}const w={success:C,failed:A,total:s.length,errors:[]};F({current:s.length,total:s.length}),P(w),w.success>0?(await O(),c(new Set),d({title:"نجح!",description:`تم ${u.action==="delete"?"حذف":"تحديث"} ${w.success} منتج بنجاح${w.failed>0?` (فشل ${w.failed})`:""}`,variant:"default"})):w.failed>0&&d({title:"فشل!",description:`فشل تحديث ${w.failed} منتج`,variant:"destructive"})}catch(s){console.error("Bulk action error:",s),d({title:"خطأ!",description:"حدث خطأ أثناء تنفيذ العملية",variant:"destructive"})}finally{L(!1)}}},de=async()=>{try{const s=await _e(t.size>0?Array.from(t):void 0);Ue(s,`products-${new Date().toISOString().split("T")[0]}.csv`),d({title:"تم التصدير!",description:`تم تصدير ${t.size>0?t.size:r.length} منتج بنجاح`,variant:"default"})}catch(s){console.error("Export error:",s),d({title:"خطأ!",description:"فشل تصدير المنتجات",variant:"destructive"})}},he=s=>{const o=s.target.files?.[0];if(!o)return;const C=new FileReader;C.onload=async A=>{const w=A.target?.result;L(!0);try{const j=await Be(w);P(j),await O(),j.success>0?d({title:"تم الاستيراد!",description:`تم استيراد ${j.success} منتج بنجاح${j.failed>0?` (فشل ${j.failed})`:""}`,variant:"default"}):d({title:"فشل الاستيراد!",description:"فشل استيراد جميع المنتجات",variant:"destructive"})}catch(j){console.error("Import error:",j),d({title:"خطأ!",description:"فشل استيراد الملف",variant:"destructive"})}finally{L(!1)}},C.readAsText(o)},ue=Array.from(new Set(r.map(s=>s.category).filter(Boolean)));return i?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"h-9 w-64"}),e.jsx(h,{className:"h-4 w-48"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{className:"h-10 w-24"}),e.jsx(h,{className:"h-10 w-24"})]})]}),e.jsxs(M,{children:[e.jsx(q,{children:e.jsx(h,{className:"h-6 w-32"})}),e.jsx(T,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[...Array(6)].map((s,o)=>e.jsx(h,{className:"h-10"},o))})})]}),e.jsx(M,{children:e.jsx(T,{className:"p-0",children:e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(_,{children:[e.jsx(x,{className:"w-12",children:e.jsx(h,{className:"h-4 w-4"})}),e.jsx(x,{children:e.jsx(h,{className:"h-4 w-24"})}),e.jsx(x,{children:e.jsx(h,{className:"h-4 w-16"})}),e.jsx(x,{children:e.jsx(h,{className:"h-4 w-16"})}),e.jsx(x,{children:e.jsx(h,{className:"h-4 w-20"})}),e.jsx(x,{children:e.jsx(h,{className:"h-4 w-16"})}),e.jsx(x,{children:e.jsx(h,{className:"h-4 w-20"})})]})}),e.jsx(ce,{children:[...Array(10)].map((s,o)=>e.jsxs(_,{children:[e.jsx(m,{children:e.jsx(h,{className:"h-4 w-4"})}),e.jsx(m,{children:e.jsx(h,{className:"h-4 w-32"})}),e.jsx(m,{children:e.jsx(h,{className:"h-4 w-16"})}),e.jsx(m,{children:e.jsx(h,{className:"h-6 w-12"})}),e.jsx(m,{children:e.jsx(h,{className:"h-4 w-20"})}),e.jsx(m,{children:e.jsx(h,{className:"h-6 w-16"})}),e.jsx(m,{children:e.jsx(h,{className:"h-4 w-20"})})]},o))})]})})})]}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"إدارة المنتجات المتقدمة"}),e.jsxs("p",{className:"text-muted-foreground",children:[N.length," منتج • ",t.size," محدد"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(H,{children:[e.jsx(me,{asChild:!0,children:e.jsx(g,{variant:"outline",size:"icon",title:"اختصارات لوحة المفاتيح",children:e.jsx(Ce,{className:"w-4 h-4"})})}),e.jsxs(K,{children:[e.jsxs(G,{children:[e.jsx(Q,{children:"اختصارات لوحة المفاتيح"}),e.jsx(Z,{children:"استخدم هذه الاختصارات لإدارة المنتجات بسرعة"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsx("span",{children:"تحديد الكل"}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-semibold bg-background border rounded",children:"Ctrl + A"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsx("span",{children:"حذف المحدد"}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-semibold bg-background border rounded",children:"Delete"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsx("span",{children:"إلغاء التحديد"}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-semibold bg-background border rounded",children:"Escape"})]})]})]})]}),e.jsxs(g,{onClick:de,variant:"outline",children:[e.jsx(ke,{className:"w-4 h-4 ml-2"}),"تصدير"]}),e.jsxs("label",{children:[e.jsx(g,{variant:"outline",asChild:!0,children:e.jsxs("span",{children:[e.jsx(be,{className:"w-4 h-4 ml-2"}),"استيراد"]})}),e.jsx("input",{type:"file",accept:".csv",onChange:he,className:"hidden"})]})]})]}),t.size>0&&e.jsx(M,{className:"bg-primary/5",children:e.jsx(T,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:[t.size," منتج محدد"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>b({open:!0,action:"price"}),children:[e.jsx(je,{className:"w-4 h-4 ml-2"}),"تحديث السعر"]}),e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>b({open:!0,action:"stock"}),children:[e.jsx(pe,{className:"w-4 h-4 ml-2"}),"تحديث المخزون"]}),e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>b({open:!0,action:"status",value:!0}),children:[e.jsx(Ee,{className:"w-4 h-4 ml-2"}),"تفعيل"]}),e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>b({open:!0,action:"status",value:!1}),children:[e.jsx(Se,{className:"w-4 h-4 ml-2"}),"إلغاء تفعيل"]}),e.jsxs(g,{size:"sm",variant:"destructive",onClick:()=>b({open:!0,action:"delete"}),children:[e.jsx(fe,{className:"w-4 h-4 ml-2"}),"حذف"]})]})]})})}),e.jsxs(M,{children:[e.jsx(q,{children:e.jsx(ge,{children:"التصفية والبحث"})}),e.jsx(T,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx($,{placeholder:"بحث بالاسم...",value:n.search,onChange:s=>k({...n,search:s.target.value})}),e.jsxs(J,{value:n.category,onValueChange:s=>k({...n,category:s}),children:[e.jsx(W,{children:e.jsx(X,{placeholder:"الفئة"})}),e.jsxs(Y,{children:[e.jsx(z,{value:"all",children:"كل الفئات"}),ue.map(s=>e.jsx(z,{value:s,children:s},s))]})]}),e.jsxs(J,{value:n.status,onValueChange:s=>k({...n,status:s}),children:[e.jsx(W,{children:e.jsx(X,{placeholder:"الحالة"})}),e.jsxs(Y,{children:[e.jsx(z,{value:"all",children:"الكل"}),e.jsx(z,{value:"active",children:"نشط"}),e.jsx(z,{value:"inactive",children:"غير نشط"})]})]}),e.jsx($,{type:"number",placeholder:"السعر من",value:n.priceMin,onChange:s=>k({...n,priceMin:s.target.value})}),e.jsx($,{type:"number",placeholder:"السعر إلى",value:n.priceMax,onChange:s=>k({...n,priceMax:s.target.value})}),e.jsx($,{type:"number",placeholder:"مخزون أقل من",value:n.stockMin,onChange:s=>k({...n,stockMin:s.target.value})})]})})]}),e.jsx(M,{children:e.jsx(T,{className:"p-0",children:e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(_,{children:[e.jsx(x,{className:"w-12",children:e.jsx(ee,{checked:t.size===N.length&&N.length>0,onCheckedChange:ie})}),e.jsx(x,{children:"المنتج"}),e.jsx(x,{children:"السعر"}),e.jsx(x,{children:"المخزون"}),e.jsx(x,{children:"الفئة"}),e.jsx(x,{children:"الحالة"}),e.jsx(x,{children:"التاريخ"})]})}),e.jsx(ce,{children:N.map(s=>e.jsxs(_,{children:[e.jsx(m,{children:e.jsx(ee,{checked:t.has(s.$id),onCheckedChange:()=>ne(s.$id)})}),e.jsx(m,{className:"font-medium",children:s.name}),e.jsxs(m,{children:[s.price.toFixed(2)," ج.م"]}),e.jsx(m,{children:e.jsx(se,{variant:s.stock>10?"default":"destructive",children:s.stock})}),e.jsx(m,{children:s.category||"-"}),e.jsx(m,{children:e.jsx(se,{variant:s.isActive?"default":"secondary",children:s.isActive?"نشط":"غير نشط"})}),e.jsx(m,{children:new Date(s.$createdAt).toLocaleDateString("ar-EG")})]},s.$id))})]})})}),e.jsx(H,{open:u.open,onOpenChange:s=>b({...u,open:s}),children:e.jsxs(K,{dir:"rtl",children:[e.jsxs(G,{children:[e.jsx(Q,{children:"عملية جماعية"}),e.jsxs(Z,{children:["سيتم تطبيق هذه العملية على ",t.size," منتج"]})]}),S?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(Te,{className:"w-5 h-5"}),e.jsxs("span",{children:["نجح: ",S.success," منتج"]})]}),S.failed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(te,{className:"w-5 h-5"}),e.jsxs("span",{children:["فشل: ",S.failed," منتج"]})]})]}):U?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"جاري المعالجة..."}),e.jsxs("span",{children:[I.current," / ",I.total]})]}),e.jsx(ve,{value:I.current/I.total*100,className:"h-2"}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"يتم معالجة المنتجات في مجموعات من 50 منتج لضمان الأداء الأمثل"})]})}):u.action==="delete"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(te,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-100",children:"⚠️ تحذير: عملية حذف نهائية"}),e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-200",children:["سيتم حذف ",e.jsx("strong",{children:t.size})," منتج نهائياً. هذا الإجراء لا يمكن التراجع عنه!"]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ye,{htmlFor:"confirm-delete",children:["للتأكيد، اكتب ",e.jsx("strong",{className:"text-red-600",children:"DELETE"})," في الحقل أدناه:"]}),e.jsx($,{id:"confirm-delete",value:R,onChange:s=>V(s.target.value),placeholder:"اكتب DELETE",className:"text-center font-mono uppercase",autoFocus:!0})]})]}):null,e.jsxs(we,{children:[e.jsx(g,{variant:"outline",onClick:()=>{b({open:!1,action:null}),P(null),V("")},children:S?"إغلاق":"إلغاء"}),!S&&e.jsx(g,{onClick:oe,disabled:U||u.action==="delete"&&R!=="DELETE",variant:u.action==="delete"?"destructive":"default",children:U?e.jsx(h,{className:"w-20 h-6 ml-2 inline-block align-middle"}):"تأكيد"})]})]})})]})}export{Ke as default};
