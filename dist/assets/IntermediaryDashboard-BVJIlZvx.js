var Ne=Object.defineProperty;var Ce=(n,e,s)=>e in n?Ne(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var k=(n,e,s)=>Ce(n,typeof e!="symbol"?e+"":e,s);import{l as De,r as u,j as t,bD as Pe,bd as te,n as ke,_ as Te,o as Ie,cJ as Ee,aj as Ae,c2 as $e}from"./vendor-react-CCFRLLzk.js";import{d as g,e as $,a3 as Ue,a0 as re,c as Le,u as Re,C as v,x as b,y as S,h as N,f as j,L as C,I as R,S as se,i as ie,j as ae,k as ne,l as q,D as qe,z as Fe,A as Me,E as Oe,F as ze,T as _e,G as Be}from"./index-CtsYZAzS.js";import{Q as f,I as O}from"./vendor-appwrite-CuqfvTq9.js";import{aL as D,aM as He}from"./vendor-other-CzBBjgu5.js";import{T as Ve,a as We,b as ce,c as F,d as Je,e as M}from"./table-DM4QjHXT.js";import{T as Ge,a as Ke,b as oe,c as le}from"./tabs-Boky9FfO.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-animations-CPHPqPXb.js";class Qe{constructor(){k(this,"proxies",[{url:"https://api.allorigins.win/get?url=",name:"AllOrigins",active:!0,rateLimit:60},{url:"https://corsproxy.io/?",name:"CORSProxy.io",active:!0,rateLimit:100},{url:"https://api.codetabs.com/v1/proxy?quest=",name:"CodeTabs",active:!0,rateLimit:60},{url:"https://cors-anywhere.herokuapp.com/",name:"CORS Anywhere",active:!1,rateLimit:50}]);k(this,"failedProxies",new Set);k(this,"requestCounts",new Map)}getBestProxy(){const e=this.proxies.filter(s=>s.active&&!this.failedProxies.has(s.name)&&this.canUseProxy(s));return e.length===0?this.failedProxies.size>0?(console.log("âš ï¸  All proxies failed, resetting..."),this.failedProxies.clear(),this.getBestProxy()):null:e.sort((s,r)=>(s.lastUsed||0)-(r.lastUsed||0))[0]}canUseProxy(e){if(!e.rateLimit)return!0;const s=Date.now(),i=(this.requestCounts.get(e.name)||[]).filter(c=>s-c<6e4);return this.requestCounts.set(e.name,i),i.length<e.rateLimit}recordUsage(e){const s=this.proxies.find(r=>r.name===e);if(s){s.lastUsed=Date.now();const r=this.requestCounts.get(e)||[];r.push(Date.now()),this.requestCounts.set(e,r)}}markFailed(e){console.log(`âŒ Marking proxy as failed: ${e}`),this.failedProxies.add(e),setTimeout(()=>{this.failedProxies.delete(e),console.log(`âœ… Proxy reset: ${e}`)},5*60*1e3)}async fetchThroughProxy(e){let s=null;for(let r=0;r<this.proxies.length;r++){const i=this.getBestProxy();if(!i)throw new Error("No available proxies");try{console.log(`ğŸ”„ Trying proxy: ${i.name}`);const c=i.url+encodeURIComponent(e),l=await fetch(c,{method:"GET",headers:{Accept:"application/json, text/html"},signal:AbortSignal.timeout(3e4)});if(!l.ok)throw new Error(`HTTP ${l.status}`);this.recordUsage(i.name);const o=l.headers.get("content-type");if(o!=null&&o.includes("application/json")){const d=await l.json();return d.contents?d.contents:d.data?d.data:JSON.stringify(d)}else return await l.text()}catch(c){console.error(`âŒ Proxy ${i.name} failed:`,c),this.markFailed(i.name),s=c;continue}}throw new Error(`All proxies failed. Last error: ${s==null?void 0:s.message}`)}addProxy(e){this.proxies.push(e)}removeProxy(e){this.proxies=this.proxies.filter(s=>s.name!==e)}getStats(){return{total:this.proxies.length,active:this.proxies.filter(e=>e.active).length,failed:this.failedProxies.size,proxies:this.proxies.map(e=>({name:e.name,active:e.active,failed:this.failedProxies.has(e.name),requests:(this.requestCounts.get(e.name)||[]).length,lastUsed:e.lastUsed}))}}resetFailed(){this.failedProxies.clear(),console.log("âœ… All failed proxies reset")}}const Xe=new Qe;class Ye{constructor(e={}){k(this,"options");k(this,"cache");k(this,"cacheDuration",5*60*1e3);this.options={timeout:3e4,userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",followRedirects:!0,maxRedirects:5,...e},this.cache=new Map}async scrape(e,s=!0){if(s){const i=this.cache.get(e);if(i&&Date.now()-i.timestamp<this.cacheDuration)return console.log("ğŸ“¦ Using cached data"),i.data}let r=null;try{if(r=await this.scrapeWithJsonLd(e),r&&r.name&&r.price>0)return console.log("âœ… Scraped with JSON-LD"),this.cacheResult(e,r),r}catch{console.log("âš ï¸  JSON-LD extraction failed")}try{if(r=await this.scrapeWithMetaTags(e),r&&r.name&&r.price>0)return console.log("âœ… Scraped with Meta Tags"),this.cacheResult(e,r),r}catch{console.log("âš ï¸  Meta tags extraction failed")}try{if(r=await this.scrapeWithSelectors(e),r&&r.name)return console.log("âœ… Scraped with Selectors"),this.cacheResult(e,r),r}catch{console.log("âš ï¸  Selector extraction failed")}try{if(r=await this.scrapeWithSiteSpecific(e),r&&r.name)return console.log("âœ… Scraped with Site-Specific"),this.cacheResult(e,r),r}catch{console.log("âš ï¸  Site-specific extraction failed")}throw new Error("ÙØ´Ù„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ø±Ù‚")}async scrapeWithJsonLd(e){var c;const s=await this.fetchHtml(e),r=D(s),i=r('script[type="application/ld+json"]');for(let l=0;l<i.length;l++)try{const o=r(i[l]).html();if(!o)continue;const d=JSON.parse(o),y=Array.isArray(d)?d:[d];for(const m of y)if(m["@type"]==="Product"||(c=m["@type"])!=null&&c.includes("Product"))return this.extractFromJsonLd(m)}catch{continue}throw new Error("No JSON-LD product data found")}extractFromJsonLd(e){var i;const s=e.offers||e.Offers||{},r=e.aggregateRating||e.AggregateRating||{};return{name:e.name||e.Name||"",price:this.parsePrice(s.price||s.Price||s.lowPrice||0),description:e.description||e.Description||"",images:this.extractImages(e.image||e.Image),brand:((i=e.brand)==null?void 0:i.name)||e.brand||e.Brand||"",sku:e.sku||e.SKU||e.mpn||"",availability:s.availability||s.Availability||"",rating:parseFloat(r.ratingValue||0),reviewCount:parseInt(r.reviewCount||0),category:e.category||""}}async scrapeWithMetaTags(e){const s=await this.fetchHtml(e),r=D(s),i=m=>{for(const p of m){const T=r(`meta[property="${p}"]`).attr("content")||r(`meta[name="${p}"]`).attr("content")||r(`meta[itemprop="${p}"]`).attr("content");if(T)return T}return""},c=i(["og:title","twitter:title","product:title","title"])||r("title").text(),l=i(["og:description","twitter:description","description","product:description"]),o=i(["og:image","twitter:image","product:image"]),d=i(["product:price:amount","og:price:amount","price","product:price"]),y=i(["product:brand","og:brand","brand"]);return{name:c.trim(),price:this.parsePrice(d),description:l.trim(),images:o?[o]:[],brand:y.trim(),category:""}}async scrapeWithSelectors(e){const s=await this.fetchHtml(e),r=D(s),i=["h1.product-title",'h1[itemprop="name"]',".product-name","#product-name",".product-title","h1.title",".product h1","h1"],c=[".price",'[itemprop="price"]',".product-price","#price",".sale-price",".current-price",".price-current","span.price",".product-price-value"],l=['[itemprop="description"]',".product-description","#description",".description",".product-details"],o=['[itemprop="image"]',".product-image img","#product-image",".main-image",".product-gallery img","img[data-zoom]"],d=this.findBySelectors(r,i),y=this.findBySelectors(r,c),m=this.findBySelectors(r,l),p=[];for(const T of o)if(r(T).each((z,I)=>{const E=r(I).attr("src")||r(I).attr("data-src")||r(I).attr("data-lazy");E&&!p.includes(E)&&p.push(this.resolveUrl(E,e))}),p.length>=5)break;return{name:d.trim(),price:this.parsePrice(y),description:m.trim(),images:p.slice(0,5),category:""}}async scrapeWithSiteSpecific(e){const s=new URL(e).hostname.toLowerCase();if(s.includes("amazon"))return this.scrapeAmazon(e);if(s.includes("ebay"))return this.scrapeEbay(e);if(s.includes("aliexpress"))return this.scrapeAliExpress(e);if(s.includes("jumia"))return this.scrapeJumia(e);if(s.includes("noon"))return this.scrapeNoon(e);throw new Error("No site-specific scraper available")}async scrapeAmazon(e){const s=await this.fetchHtml(e),r=D(s);return{name:r("#productTitle").text().trim(),price:this.parsePrice(r(".a-price .a-offscreen").first().text()),description:r("#feature-bullets").text().trim()||r("#productDescription").text().trim(),images:this.extractAmazonImages(r),brand:r("#bylineInfo").text().replace("Visit the","").replace("Store","").trim(),rating:parseFloat(r(".a-icon-star .a-icon-alt").first().text().split(" ")[0]||"0"),reviewCount:parseInt(r("#acrCustomerReviewText").text().replace(/[^\d]/g,"")||"0"),category:""}}async scrapeEbay(e){const s=await this.fetchHtml(e),r=D(s);return{name:r(".x-item-title__mainTitle").text().trim()||r("h1.it-ttl").text().trim(),price:this.parsePrice(r(".x-price-primary").text()||r(".notranslate").first().text()),description:r("#viTabs_0_panel").text().trim(),images:this.extractEbayImages(r),category:""}}async scrapeAliExpress(e){const s=await this.fetchHtml(e),r=D(s);return{name:r(".product-title-text").text().trim()||r("h1").first().text().trim(),price:this.parsePrice(r(".product-price-value").text()),description:r(".product-description").text().trim(),images:[],category:""}}async scrapeJumia(e){const s=await this.fetchHtml(e),r=D(s);return{name:r(".-fs20").text().trim()||r("h1").first().text().trim(),price:this.parsePrice(r(".-b.-ltr.-tal.-fs24").text()),description:r(".markup").text().trim(),images:[],rating:parseFloat(r(".stars").attr("data-rating")||"0"),category:""}}async scrapeNoon(e){const s=await this.fetchHtml(e),r=D(s);return{name:r("h1").first().text().trim(),price:this.parsePrice(r(".priceNow").text()),description:r(".detailsSection").text().trim(),images:[],category:""}}async fetchHtml(e){try{return(await He.get(e,{timeout:this.options.timeout,headers:{"User-Agent":this.options.userAgent,Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"en-US,en;q=0.5","Accept-Encoding":"gzip, deflate, br",Connection:"keep-alive","Upgrade-Insecure-Requests":"1",...this.options.headers},maxRedirects:this.options.maxRedirects,validateStatus:r=>r<400})).data}catch{console.log("âš ï¸  Direct fetch failed, trying proxy manager...");try{return await Xe.fetchThroughProxy(e)}catch(r){throw console.error("âŒ All proxies failed:",r),new Error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø±")}}}findBySelectors(e,s){for(const r of s){const i=e(r).first().text().trim();if(i)return i}return""}parsePrice(e){if(!e)return 0;const s=e.replace(/[^\d.,]/g,"").replace(",",".");return parseFloat(s)||0}extractImages(e){return e?typeof e=="string"?[e]:Array.isArray(e)?e.filter(s=>typeof s=="string"):e.url?[e.url]:[]:[]}extractAmazonImages(e){const s=[];return e(".imgTagWrapper img").each((r,i)=>{const c=e(i).attr("src");if(c&&!s.includes(c)){const l=c.replace(/\._.*_\./,".");s.push(l)}}),s.slice(0,5)}extractEbayImages(e){const s=[];return e(".ux-image-carousel-item img").each((r,i)=>{const c=e(i).attr("src");c&&!s.includes(c)&&s.push(c)}),s.slice(0,5)}resolveUrl(e,s){if(e.startsWith("http"))return e;try{return new URL(e,s).href}catch{return e}}cacheResult(e,s){this.cache.set(e,{data:s,timestamp:Date.now()})}clearCache(){this.cache.clear()}setCacheDuration(e){this.cacheDuration=e*60*1e3}}const Ze=new Ye,x=$.databaseId,P=$.collections.products,J="product_descriptions",de=$.storageId;function et(n){let e=0;for(let s=0;s<n.length;s++){const r=n.charCodeAt(s);e=(e<<5)-e+r,e=e&e}return Math.abs(e).toString(36)}async function ue(n,e=!0){try{console.log("ğŸ” Starting advanced scraping for:",n);const s=await Ze.scrape(n,e);if(!s.name||s.name==="Ù…Ù†ØªØ¬ Ù…Ø³ØªÙˆØ±Ø¯")throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬");return console.log("âœ… Successfully scraped:",s.name),{name:s.name,price:s.price||0,description:s.description||"",images:s.images||[],category:s.category||"imported",specifications:{brand:s.brand,sku:s.sku,availability:s.availability,rating:s.rating,reviewCount:s.reviewCount}}}catch(s){throw console.error("âŒ Error scraping product:",s),new Error("ÙØ´Ù„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬: "+s.message)}}async function tt(n){try{const s=await(await fetch(n)).blob(),r=`imported-${Date.now()}-${Math.random().toString(36).substr(2,9)}.jpg`,i=new File([s],r,{type:s.type}),c=await re.createFile(de,O.unique(),i);return re.getFileView(de,c.$id).toString()}catch(e){return console.error("Error uploading image:",e),""}}async function pe(n,e,s){try{const r=await Ue.get(),i=await ue(n);let c;typeof e=="number"?c=i.price+e:e.type==="percentage"?c=i.price*(1+e.value/100):c=i.price+e.value;const l=[];if(i.images&&i.images.length>0)for(const m of i.images)try{const p=await tt(m);p&&l.push(p)}catch(p){console.error("Error uploading image:",m,p)}let o=s;if(!o)try{const m=await g.listDocuments(x,$.collections.categories,[f.equal("name","Ù…Ù†ØªØ¬Ø§Øª Ù…Ø³ØªÙˆØ±Ø¯Ø©"),f.limit(1)]);m.documents.length>0?o=m.documents[0].$id:o=(await g.createDocument(x,$.collections.categories,O.unique(),{name:"Ù…Ù†ØªØ¬Ø§Øª Ù…Ø³ØªÙˆØ±Ø¯Ø©",slug:"imported-products",description:"Ù…Ù†ØªØ¬Ø§Øª ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯Ù‡Ø§ Ù…Ù† Ù…ÙˆØ§Ù‚Ø¹ Ø£Ø®Ø±Ù‰",isActive:!0})).$id}catch(m){throw console.error("Error getting/creating category:",m),new Error("ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªØµÙ†ÙŠÙ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")}const d={name:i.name,description:i.description||"",price:Math.round(c*100)/100,originalPrice:i.price,priceMarkup:typeof e=="number"?e:e.value,priceMarkupType:typeof e=="number"?"fixed":e.type,sourceUrl:n,sourceUrlHash:et(n),images:l.length>0?l:["https://via.placeholder.com/400"],categoryId:o,stock:999,isActive:!0,merchantId:r.$id,merchantName:r.name,intermediaryId:r.$id,intermediaryName:r.name};return{success:!0,productId:(await g.createDocument(x,P,O.unique(),d)).$id,scrapedData:i}}catch(r){return console.error("Error importing product:",r),{success:!1,error:r instanceof Error?r.message:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬"}}}async function rt(n,e,s){const r=[];let i=0,c=0;for(const l of n)try{const o=await pe(l,e,s);r.push(o),o.success?i++:c++}catch(o){r.push({success:!1,error:`ÙØ´Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${l}: ${o instanceof Error?o.message:"Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}`}),c++}return{success:i,failed:c,results:r}}async function st(n){try{return(await g.listDocuments(x,P,[f.equal("intermediaryId",n),f.orderDesc("$createdAt"),f.limit(100)])).documents}catch(e){throw console.error("Error fetching intermediary products:",e),e}}async function it(n,e){try{return await g.updateDocument(x,P,n,{price:Math.round(e*100)/100,priceOverride:Math.round(e*100)/100}),{success:!0}}catch(s){throw console.error("Error updating product price:",s),s}}async function at(n,e){try{const s=await g.getDocument(x,P,n);let r;try{r=(await g.listDocuments(x,J,[f.equal("productId",n),f.limit(1)])).documents[0]}catch{r=null}return r?await g.updateDocument(x,J,r.$id,{customDescription:e}):await g.createDocument(x,J,O.unique(),{productId:n,originalDescription:s.description||"",customDescription:e,intermediaryId:s.intermediaryId}),await g.updateDocument(x,P,n,{description:e}),{success:!0}}catch(s){throw console.error("Error updating product description:",s),s}}async function nt(n){try{const e=await g.getDocument(x,P,n);if(!e.sourceUrl)throw new Error("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ù…ØµØ¯Ø± Ù„Ù„Ù…Ù†ØªØ¬");const s=await ue(e.sourceUrl),r={lastSyncedAt:new Date().toISOString()};return s.price&&s.price!==e.originalPrice&&(r.originalPrice=s.price,e.priceOverride||(e.priceMarkupType==="percentage"?r.price=s.price*(1+(e.priceMarkup||0)/100):r.price=s.price+(e.priceMarkup||0),r.price=Math.round(r.price*100)/100)),s.description&&!e.customDescription?(r.originalDescription=s.description,r.description=s.description):s.description&&(r.originalDescription=s.description),s.name&&s.name!==e.name&&(r.name=s.name),await g.updateDocument(x,P,n,r),{success:!0,changes:{priceChanged:!!r.originalPrice,descriptionUpdated:!!r.originalDescription,nameUpdated:!!r.name}}}catch(e){throw console.error("Error syncing product:",e),e}}async function ct(n){try{const e=new Date,s=[f.equal("autoSyncEnabled",!0),f.isNotNull("sourceUrl"),f.limit(100)];return n&&s.push(f.equal("intermediaryId",n)),(await g.listDocuments(x,P,s)).documents.filter(c=>{if(!c.lastSyncedAt)return!0;const l=new Date(c.lastSyncedAt),o=(c.syncIntervalMinutes||10)*60*1e3,d=new Date(l.getTime()+o);return e>=d})}catch(e){throw console.error("Error getting products needing sync:",e),e}}async function ot(n){try{const e=await ct(n),s={total:e.length,synced:0,failed:0,errors:[]};for(const r of e)try{await nt(r.$id),s.synced++}catch(i){s.failed++,s.errors.push(`${r.name}: ${i.message}`)}return s}catch(e){throw console.error("Error bulk syncing products:",e),e}}function vt(){const{user:n}=Le(),{toast:e}=Re(),s=De(),[r,i]=u.useState([]),[c,l]=u.useState(!1),[o,d]=u.useState(""),[y,m]=u.useState("percentage"),[p,T]=u.useState("20"),[z,I]=u.useState(!1),[E,G]=u.useState(""),[_,me]=u.useState("percentage"),[B,he]=u.useState("20"),[K,Q]=u.useState(!1),[w,ge]=u.useState(null),[X,Y]=u.useState(""),[H,V]=u.useState(""),[xe,U]=u.useState(!1),[lt,dt]=u.useState(!1),[W,Z]=u.useState(!1);u.useEffect(()=>{n&&A()},[n]);const A=async()=>{if(n){l(!0);try{const a=await st(n.$id);i(a)}catch{e({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",variant:"destructive"})}finally{l(!1)}}},fe=async()=>{if(!o){e({title:"ØªØ­Ø°ÙŠØ±",description:"Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬",variant:"destructive"});return}I(!0);try{const a=y==="percentage"?{type:"percentage",value:parseFloat(p)}:{type:"fixed",value:parseFloat(p)},h=await pe(o,a);h.success?(e({title:"Ù†Ø¬Ø­!",description:"ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­"}),d(""),A()):e({title:"ÙØ´Ù„",description:h.error||"ÙØ´Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬",variant:"destructive"})}catch{e({title:"Ø®Ø·Ø£",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯",variant:"destructive"})}finally{I(!1)}},ye=async()=>{const a=E.split(`
`).filter(h=>h.trim());if(a.length===0){e({title:"ØªØ­Ø°ÙŠØ±",description:"Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",variant:"destructive"});return}Q(!0);try{const h=_==="percentage"?{type:"percentage",value:parseFloat(B)}:{type:"fixed",value:parseFloat(B)},ee=await rt(a,h);e({title:"Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯",description:`Ù†Ø¬Ø­: ${ee.success} | ÙØ´Ù„: ${ee.failed}`}),G(""),A()}catch{e({title:"Ø®Ø·Ø£",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ",variant:"destructive"})}finally{Q(!1)}},we=a=>{ge(a),Y(a.price.toString()),V(a.customDescription||a.description||""),U(!0)},je=async()=>{if(w)try{const a=parseFloat(X);a!==w.price&&await it(w.$id,a),H!==(w.customDescription||w.description)&&await at(w.$id,H),e({title:"Ù†Ø¬Ø­!",description:"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­"}),U(!1),A()}catch{e({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬",variant:"destructive"})}},ve=async()=>{if(n){Z(!0);try{const a=await ot(n.$id);e({title:"Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«",description:`ØªÙ… ØªØ­Ø¯ÙŠØ« ${a.synced} Ù…Ù† ${a.total} Ù…Ù†ØªØ¬`}),A()}catch{e({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ",variant:"destructive"})}finally{Z(!1)}}},be=r.length>0?(r.reduce((a,h)=>a+(h.priceMarkup||0),0)/r.length).toFixed(1):0,[L,Se]=u.useState(null);return u.useEffect(()=>{(async()=>{if(n)try{const h=await g.listDocuments(void 0,"userPreferences",[f.equal("userId",n.$id)]);h.documents.length>0&&Se(h.documents[0])}catch(h){console.error("Error loading intermediary info:",h)}})()},[n]),t.jsx("div",{className:"container mx-auto p-6",dir:"rtl",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold",children:"Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„ÙˆØ³ÙŠØ·"}),t.jsx("p",{className:"text-muted-foreground",children:"Ø§Ø³ØªÙˆØ±Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ù…ÙˆØ§Ù‚Ø¹ Ø£Ø®Ø±Ù‰ ÙˆØ­Ø¯Ø¯ Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­"})]}),L&&t.jsxs(v,{className:"w-80",children:[t.jsx(b,{className:"pb-3",children:t.jsx(S,{className:"text-sm font-medium",children:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆØ³ÙŠØ·"})}),t.jsxs(N,{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:"ÙƒÙˆØ¯ Ø§Ù„ÙˆØ³ÙŠØ·:"}),t.jsx("code",{className:"bg-purple-100 dark:bg-purple-900 px-2 py-1 rounded text-purple-700 dark:text-purple-300 font-mono",children:L.intermediaryCode})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:"Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:"}),t.jsxs("span",{className:"font-bold text-green-600",children:[L.defaultMarkupPercentage,"%"]})]}),t.jsxs(j,{variant:"outline",size:"sm",className:"w-full mt-2",onClick:()=>{const a=`${window.location.origin}/#/?ref=${L.intermediaryCode}`;navigator.clipboard.writeText(a),e({title:"ØªÙ… Ø§Ù„Ù†Ø³Ø®!",description:"ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ"})},children:[t.jsx(Pe,{className:"h-4 w-4 ml-2"}),"Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©"]})]})]})]}),t.jsxs(v,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950 dark:to-indigo-950 border-blue-200 dark:border-blue-800",children:[t.jsx(b,{children:t.jsxs(S,{className:"flex items-center gap-2",children:[t.jsx(te,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),"Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Vendoor"]})}),t.jsxs(N,{children:[t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Ø§Ø³ØªÙˆØ±Ø¯ Ù…Ù†ØªØ¬Ø§Øª Vendoor Ø¨Ø³Ù‡ÙˆÙ„Ø© - Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø© Ø£Ùˆ Ù…Ù†ØªØ¬ ÙØ±Ø¯ÙŠ"}),t.jsxs(j,{onClick:()=>s("/intermediary/import"),className:"w-full",size:"lg",children:[t.jsx(te,{className:"ml-2 h-4 w-4"}),"Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯"]})]})]}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[t.jsxs(v,{children:[t.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(S,{className:"text-sm font-medium",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª"}),t.jsx(ke,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsx(N,{children:t.jsx("div",{className:"text-2xl font-bold",children:r.length})})]}),t.jsxs(v,{children:[t.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(S,{className:"text-sm font-medium",children:"Ù…ØªÙˆØ³Ø· Ø§Ù„Ù‡Ø§Ù…Ø´"}),t.jsx(Te,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsx(N,{children:t.jsxs("div",{className:"text-2xl font-bold",children:[be,"%"]})})]}),t.jsxs(v,{children:[t.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(S,{className:"text-sm font-medium",children:"Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©"}),t.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsx(N,{children:t.jsx("div",{className:"text-2xl font-bold",children:"0"})})]})]}),t.jsxs(Ge,{defaultValue:"single",className:"w-full",children:[t.jsxs(Ke,{className:"grid w-full grid-cols-2",children:[t.jsx(oe,{value:"single",children:"Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù†ØªØ¬ ÙˆØ§Ø­Ø¯"}),t.jsx(oe,{value:"bulk",children:"Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¬Ù…Ø§Ø¹ÙŠ"})]}),t.jsx(le,{value:"single",children:t.jsxs(v,{children:[t.jsx(b,{children:t.jsx(S,{children:"Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù†ØªØ¬ Ù…Ù† Ø±Ø§Ø¨Ø·"})}),t.jsxs(N,{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(C,{children:"Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬"}),t.jsx(R,{placeholder:"https://example.com/product/...",value:o,onChange:a=>d(a.target.value)})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(C,{children:"Ù†ÙˆØ¹ Ø§Ù„Ù‡Ø§Ù…Ø´"}),t.jsxs(se,{value:y,onValueChange:a=>m(a),children:[t.jsx(ie,{children:t.jsx(ae,{})}),t.jsxs(ne,{children:[t.jsx(q,{value:"percentage",children:"Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© (%)"}),t.jsx(q,{value:"fixed",children:"Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª (Ø¬Ù†ÙŠÙ‡)"})]})]})]}),t.jsxs("div",{children:[t.jsx(C,{children:"Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‡Ø§Ù…Ø´"}),t.jsx(R,{type:"number",value:p,onChange:a=>T(a.target.value),placeholder:y==="percentage"?"20":"50"})]})]}),t.jsx(j,{onClick:fe,disabled:z,className:"w-full",children:z?"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯...":"Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬"})]})]})}),t.jsx(le,{value:"bulk",children:t.jsxs(v,{children:[t.jsx(b,{children:t.jsx(S,{children:"Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¹Ø¯Ø© Ù…Ù†ØªØ¬Ø§Øª"})}),t.jsxs(N,{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(C,{children:"Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø±Ø§Ø¨Ø· Ù„ÙƒÙ„ Ø³Ø·Ø±)"}),t.jsx("textarea",{className:"w-full min-h-[200px] p-3 border rounded-md",placeholder:`https://example.com/product1
https://example.com/product2
https://example.com/product3`,value:E,onChange:a=>G(a.target.value)})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(C,{children:"Ù†ÙˆØ¹ Ø§Ù„Ù‡Ø§Ù…Ø´"}),t.jsxs(se,{value:_,onValueChange:a=>me(a),children:[t.jsx(ie,{children:t.jsx(ae,{})}),t.jsxs(ne,{children:[t.jsx(q,{value:"percentage",children:"Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© (%)"}),t.jsx(q,{value:"fixed",children:"Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª (Ø¬Ù†ÙŠÙ‡)"})]})]})]}),t.jsxs("div",{children:[t.jsx(C,{children:"Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‡Ø§Ù…Ø´"}),t.jsx(R,{type:"number",value:B,onChange:a=>he(a.target.value),placeholder:_==="percentage"?"20":"50"})]})]}),t.jsx(j,{onClick:ye,disabled:K,className:"w-full",children:K?"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯...":"Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª"})]})]})})]}),t.jsxs(v,{children:[t.jsx(b,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(S,{children:"Ù…Ù†ØªØ¬Ø§ØªÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(j,{onClick:ve,variant:"outline",size:"sm",disabled:W,children:[t.jsx(Ee,{className:`h-4 w-4 ml-2 ${W?"animate-spin":""}`}),W?"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...":"Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙƒÙ„"]}),t.jsxs(j,{onClick:A,variant:"outline",size:"sm",children:[t.jsx(Ae,{className:"h-4 w-4 ml-2"}),"ØªØ­Ø¯ÙŠØ«"]})]})]})}),t.jsx(N,{children:c?t.jsx("div",{className:"text-center py-8",children:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..."}):r.length===0?t.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø³ØªÙˆØ±Ø¯Ø© Ø¨Ø¹Ø¯"}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs(Ve,{children:[t.jsx(We,{children:t.jsxs(ce,{children:[t.jsx(F,{children:"Ø§Ù„ØµÙˆØ±Ø©"}),t.jsx(F,{children:"Ø§Ù„Ø§Ø³Ù…"}),t.jsx(F,{children:"Ø§Ù„Ø³Ø¹Ø±"}),t.jsx(F,{children:"Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª"})]})}),t.jsx(Je,{children:r.map(a=>{var h;return t.jsxs(ce,{children:[t.jsx(M,{children:t.jsx("img",{src:((h=a.images)==null?void 0:h[0])||"/placeholder.png",alt:a.name,className:"w-12 h-12 object-cover rounded"})}),t.jsx(M,{className:"max-w-[200px]",children:t.jsx("div",{className:"truncate",children:a.name})}),t.jsxs(M,{className:"font-bold",children:[a.price," Ø¬Ù†ÙŠÙ‡"]}),t.jsx(M,{children:t.jsx("div",{className:"flex gap-2",children:t.jsx(j,{size:"sm",variant:"outline",onClick:()=>we(a),children:t.jsx($e,{className:"h-4 w-4"})})})})]},a.$id)})})]})})})]}),t.jsx(qe,{open:xe,onOpenChange:U,children:t.jsxs(Fe,{className:"sm:max-w-[600px]",dir:"rtl",children:[t.jsxs(Me,{children:[t.jsx(Oe,{children:"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬"}),t.jsx(ze,{children:"Ù‚Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø± ÙˆÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬. Ø³ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©."})]}),w&&t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(C,{htmlFor:"edit-price",children:"Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"}),t.jsx(R,{id:"edit-price",type:"number",step:"0.01",value:X,onChange:a=>Y(a.target.value)}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ: ",w.originalPrice," Ø¬Ù†ÙŠÙ‡"]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(C,{htmlFor:"edit-description",children:"Ø§Ù„ÙˆØµÙ"}),t.jsx(_e,{id:"edit-description",rows:6,value:H,onChange:a=>V(a.target.value),className:"resize-none"}),w.originalDescription&&t.jsx(j,{type:"button",variant:"outline",size:"sm",onClick:()=>V(w.originalDescription),children:"Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ÙˆØµÙ Ø§Ù„Ø£ØµÙ„ÙŠ"})]})]}),t.jsxs(Be,{children:[t.jsx(j,{variant:"outline",onClick:()=>U(!1),children:"Ø¥Ù„ØºØ§Ø¡"}),t.jsx(j,{onClick:je,children:"Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª"})]})]})})]})})}export{vt as default};
