import{r,b as fe,a0 as y,a8 as Y,a9 as M,j as e,D as Ne,h as ye,B as p,P as De,i as be,k as we,l as Ce,s as E,I as T,C as o,e as m,f as h,o as Q,g as x,n as U,q as Se,aE as Te,ap as _,aq as J,ar as K,as as W,at as c,N as Ae,a as X,a1 as Oe}from"./index-Ce-RwxJS.js";import{T as ke,a as Me,b as P,c as g,d as Ee,e as u}from"./table-DhT4s9qg.js";import{D as Pe}from"./download-UgG-gTV9.js";import{C as L}from"./clock-D_TAAEO_.js";import{C as Z}from"./circle-check-big-DrIPWHSB.js";import{f as Re}from"./format-C_NiWi2W.js";import{a as Fe}from"./ar-tf8aslgS.js";import"./en-US-BI35v3bL.js";function _e(){const[B,R]=r.useState([]),[F,ee]=r.useState([]),[se,q]=r.useState([]),[v,te]=r.useState({totalOrders:0,pendingShipment:0,inTransit:0,delivered:0,averageDeliveryTime:0,onTimeDeliveryRate:0}),[$e,ae]=r.useState(null),[Ie,Le]=r.useState([]),[Be,ie]=r.useState(!1),[le,$]=r.useState(!1),[A,re]=r.useState(""),[f,ne]=r.useState("all"),[d,ce]=r.useState(1),[N,de]=r.useState(1),[z,oe]=r.useState(0),[O,H]=r.useState(!1),D=20,{toast:b}=fe(),[w,C]=r.useState({name:"",description:"",cost:0,estimatedDays:1,supportedRegions:[],isActive:!0});r.useEffect(()=>{S(),me()},[]),r.useEffect(()=>{he()},[F]),r.useEffect(()=>{S(1)},[f]);const S=async(s=1)=>{H(!0);try{const t=(s-1)*D,i=[y.orderDesc("$createdAt"),y.limit(D),y.offset(t)];f!=="all"&&i.push(y.equal("status",f));const j=await Y.listDocuments(M.databaseId,M.collections.orders,i),k=j.documents.map(a=>({id:a.$id,orderNumber:a.orderNumber||`EGY-${a.$id.slice(0,8)}`,customerName:a.customerName||"غير محدد",customerEmail:a.customerEmail||"",customerPhone:a.customerPhone||"",shippingAddress:a.shippingAddress||{street:"",city:"",state:"",postalCode:"",country:"مصر"},items:a.items||[],total:a.totalAmount||0,status:a.status||"pending",shippingMethod:a.shippingMethod||"standard",trackingNumber:a.trackingNumber,estimatedDelivery:a.estimatedDelivery?new Date(a.estimatedDelivery):void 0,actualDelivery:a.actualDelivery?new Date(a.actualDelivery):void 0,createdAt:new Date(a.$createdAt),updatedAt:new Date(a.$updatedAt)}));if(R(k),oe(j.total),de(Math.ceil(j.total/D)),ce(s),s===1){const I=(await Y.listDocuments(M.databaseId,M.collections.orders,[y.orderDesc("$createdAt"),y.limit(1e3)])).documents.map(l=>({id:l.$id,orderNumber:l.orderNumber||`EGY-${l.$id.slice(0,8)}`,customerName:l.customerName||"غير محدد",customerEmail:l.customerEmail||"",customerPhone:l.customerPhone||"",shippingAddress:l.shippingAddress||{street:"",city:"",state:"",postalCode:"",country:"مصر"},items:l.items||[],total:l.totalAmount||0,status:l.status||"pending",shippingMethod:l.shippingMethod||"standard",trackingNumber:l.trackingNumber,estimatedDelivery:l.estimatedDelivery?new Date(l.estimatedDelivery):void 0,actualDelivery:l.actualDelivery?new Date(l.actualDelivery):void 0,createdAt:new Date(l.$createdAt),updatedAt:new Date(l.$updatedAt)}));ee(I)}k.length===0&&console.log("No orders found")}catch(t){console.error("Error loading orders:",t),b({title:"خطأ",description:"فشل في تحميل الطلبات",variant:"destructive"}),R([])}finally{H(!1)}},me=async()=>{try{q([{id:"1",name:"الشحن السريع",description:"توصيل خلال 24 ساعة",cost:100,estimatedDays:1,isActive:!0,supportedRegions:["القاهرة","الجيزة"]},{id:"2",name:"الشحن العادي",description:"توصيل خلال 3-5 أيام",cost:50,estimatedDays:3,isActive:!0,supportedRegions:["جميع المحافظات"]},{id:"3",name:"الشحن الاقتصادي",description:"توصيل خلال 7-10 أيام",cost:25,estimatedDays:7,isActive:!0,supportedRegions:["جميع المحافظات"]}])}catch(s){console.error("Failed to load shipping methods:",s)}},he=async()=>{try{const s=F.length>0?F:B,t=s.length,i=s.filter(n=>n.status==="pending"||n.status==="processing").length,j=s.filter(n=>n.status==="shipped").length,k=s.filter(n=>n.status==="delivered").length,a=s.filter(n=>n.status==="delivered"&&n.actualDelivery&&n.createdAt),I=a.length>0?a.reduce((n,G)=>{const ve=Math.ceil((G.actualDelivery.getTime()-G.createdAt.getTime())/864e5);return n+ve},0)/a.length:0,l=a.filter(n=>!n.estimatedDelivery||!n.actualDelivery?!1:n.actualDelivery<=n.estimatedDelivery).length,ge=a.length>0?l/a.length*100:0;te({totalOrders:t,pendingShipment:i,inTransit:j,delivered:k,averageDeliveryTime:I,onTimeDeliveryRate:ge})}catch(s){console.error("Failed to load stats:",s)}},xe=async(s,t)=>{try{R(i=>i.map(j=>j.id===s?{...j,status:t,updatedAt:new Date}:j)),b({title:"نجح",description:"تم تحديث حالة الطلب بنجاح"})}catch{b({title:"خطأ",description:"فشل في تحديث حالة الطلب",variant:"destructive"})}},ue=async()=>{try{const s={id:Date.now().toString(),...w};q(t=>[...t,s]),C({name:"",description:"",cost:0,estimatedDays:1,supportedRegions:[],isActive:!0}),$(!1),b({title:"نجح",description:"تم إنشاء طريقة الشحن بنجاح"})}catch{b({title:"خطأ",description:"فشل في إنشاء طريقة الشحن",variant:"destructive"})}},je=s=>{const t={pending:{label:"في الانتظار",variant:"secondary"},processing:{label:"قيد المعالجة",variant:"default"},shipped:{label:"تم الشحن",variant:"default"},delivered:{label:"تم التسليم",variant:"default"},cancelled:{label:"ملغي",variant:"destructive"}},i=t[s]||t.pending;return e.jsx(X,{variant:i.variant,children:i.label})},pe=s=>{switch(s){case"pending":return e.jsx(L,{className:"w-4 h-4"});case"processing":return e.jsx(Q,{className:"w-4 h-4"});case"shipped":return e.jsx(U,{className:"w-4 h-4"});case"delivered":return e.jsx(Z,{className:"w-4 h-4"});case"cancelled":return e.jsx(Oe,{className:"w-4 h-4"});default:return e.jsx(L,{className:"w-4 h-4"})}},V=B.filter(s=>{const t=s.orderNumber.toLowerCase().includes(A.toLowerCase())||s.customerName.toLowerCase().includes(A.toLowerCase())||s.customerEmail.toLowerCase().includes(A.toLowerCase()),i=f==="all"||s.status===f;return t&&i});return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"إدارة الشحن والتتبع"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(Ne,{open:le,onOpenChange:$,children:[e.jsx(ye,{asChild:!0,children:e.jsxs(p,{variant:"outline",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"إضافة طريقة شحن"]})}),e.jsxs(be,{children:[e.jsx(we,{children:e.jsx(Ce,{children:"إضافة طريقة شحن جديدة"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"methodName",children:"اسم طريقة الشحن"}),e.jsx(T,{id:"methodName",value:w.name,onChange:s=>C(t=>({...t,name:s.target.value})),placeholder:"الشحن السريع"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"methodDescription",children:"الوصف"}),e.jsx(T,{id:"methodDescription",value:w.description,onChange:s=>C(t=>({...t,description:s.target.value})),placeholder:"توصيل خلال 24 ساعة"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"methodCost",children:"التكلفة (جنيه)"}),e.jsx(T,{id:"methodCost",type:"number",value:w.cost,onChange:s=>C(t=>({...t,cost:parseFloat(s.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"estimatedDays",children:"الأيام المتوقعة"}),e.jsx(T,{id:"estimatedDays",type:"number",value:w.estimatedDays,onChange:s=>C(t=>({...t,estimatedDays:parseInt(s.target.value)||1}))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{variant:"outline",onClick:()=>$(!1),children:"إلغاء"}),e.jsx(p,{onClick:ue,children:"إضافة"})]})]})]})]}),e.jsxs(p,{children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"تصدير التقرير"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"إجمالي الطلبات"}),e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.totalOrders})})]}),e.jsxs(o,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"في الانتظار"}),e.jsx(L,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.pendingShipment})})]}),e.jsxs(o,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"قيد النقل"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.inTransit})})]}),e.jsxs(o,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"تم التسليم"}),e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.delivered})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(h,{children:"متوسط وقت التسليم"})}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-3xl font-bold",children:[v.averageDeliveryTime," أيام"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"متوسط الوقت من الشحن إلى التسليم"})]})]}),e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(h,{children:"معدل التسليم في الوقت"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"معدل التسليم في الوقت"}),e.jsxs("span",{children:[v.onTimeDeliveryRate,"%"]})]}),e.jsx(Se,{value:v.onTimeDeliveryRate,className:"h-2"})]})})]})]}),e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(h,{children:"فلترة الطلبات"})}),e.jsx(x,{children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(T,{placeholder:"البحث في رقم الطلب، اسم العميل، أو البريد الإلكتروني...",value:A,onChange:s=>re(s.target.value),className:"pl-10"})]})}),e.jsxs(_,{value:f,onValueChange:ne,children:[e.jsx(J,{className:"w-48",children:e.jsx(K,{placeholder:"فلترة حسب الحالة"})}),e.jsxs(W,{children:[e.jsx(c,{value:"all",children:"جميع الحالات"}),e.jsx(c,{value:"pending",children:"في الانتظار"}),e.jsx(c,{value:"processing",children:"قيد المعالجة"}),e.jsx(c,{value:"shipped",children:"تم الشحن"}),e.jsx(c,{value:"delivered",children:"تم التسليم"}),e.jsx(c,{value:"cancelled",children:"ملغي"})]})]})]})})]}),e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(h,{children:"الطلبات"})}),e.jsxs(x,{children:[e.jsxs(ke,{children:[e.jsx(Me,{children:e.jsxs(P,{children:[e.jsx(g,{children:"رقم الطلب"}),e.jsx(g,{children:"العميل"}),e.jsx(g,{children:"العنوان"}),e.jsx(g,{children:"المبلغ"}),e.jsx(g,{children:"الحالة"}),e.jsx(g,{children:"رقم التتبع"}),e.jsx(g,{children:"تاريخ الإنشاء"}),e.jsx(g,{children:"الإجراءات"})]})}),e.jsx(Ee,{children:O?e.jsx(P,{children:e.jsx(u,{colSpan:8,className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{children:"جاري التحميل..."})]})})}):V.length===0?e.jsx(P,{children:e.jsx(u,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"لا توجد طلبات"})}):V.map(s=>e.jsxs(P,{children:[e.jsx(u,{children:e.jsx("div",{className:"font-medium",children:s.orderNumber})}),e.jsx(u,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customerName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.customerEmail})]})}),e.jsx(u,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:s.shippingAddress.street}),e.jsxs("div",{children:[s.shippingAddress.city,", ",s.shippingAddress.state]})]})}),e.jsx(u,{children:e.jsxs("div",{className:"font-medium",children:[s.total.toLocaleString()," جنيه"]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[pe(s.status),je(s.status)]})}),e.jsx(u,{children:s.trackingNumber?e.jsx("code",{className:"bg-muted px-2 py-1 rounded text-sm",children:s.trackingNumber}):e.jsx("span",{className:"text-muted-foreground",children:"غير متوفر"})}),e.jsx(u,{children:Re(s.createdAt,"dd/MM/yyyy",{locale:Fe})}),e.jsx(u,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{ae(s),ie(!0)},children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsxs(_,{value:s.status,onValueChange:t=>xe(s.id,t),children:[e.jsx(J,{className:"w-32",children:e.jsx(K,{})}),e.jsxs(W,{children:[e.jsx(c,{value:"pending",children:"في الانتظار"}),e.jsx(c,{value:"processing",children:"قيد المعالجة"}),e.jsx(c,{value:"shipped",children:"تم الشحن"}),e.jsx(c,{value:"delivered",children:"تم التسليم"}),e.jsx(c,{value:"cancelled",children:"ملغي"})]})]})]})})]},s.id))})]}),N>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["عرض ",(d-1)*D+1," إلى ",Math.min(d*D,z)," من ",z," طلب"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>S(d-1),disabled:d===1||O,children:"السابق"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,N)},(s,t)=>{let i;return N<=5||d<=3?i=t+1:d>=N-2?i=N-4+t:i=d-2+t,e.jsx(p,{variant:d===i?"default":"outline",size:"sm",onClick:()=>S(i),disabled:O,className:"w-10",children:i},i)})}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>S(d+1),disabled:d===N||O,children:"التالي"})]})]})]})]}),e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(h,{children:"طرق الشحن المتاحة"})}),e.jsx(x,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:se.map(s=>e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(h,{className:"text-lg",children:s.name})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"التكلفة:"}),e.jsxs("span",{className:"font-medium",children:[s.cost," جنيه"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"الوقت المتوقع:"}),e.jsxs("span",{className:"font-medium",children:[s.estimatedDays," أيام"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"الحالة:"}),e.jsx(X,{variant:s.isActive?"default":"secondary",children:s.isActive?"نشط":"غير نشط"})]})]})})]},s.id))})})]})]})}export{_e as default};
