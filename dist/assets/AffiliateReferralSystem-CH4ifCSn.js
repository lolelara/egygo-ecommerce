import{r as x,j as e,U as C,bO as G,M as ee,i as Q,aT as _,bt as se,bB as F,bI as z,bq as H,b5 as R,au as w,b4 as te}from"./vendor-react-BTCGZZAN.js";import{o as re,d as k,c as m,K as M,u as ae,C as h,f as u,r as O,s as U,I as K,e as E,B as y}from"./index-DAwEpow4.js";import{T as le,a as ne,b as J,c as P}from"./tabs-43GTZMZA.js";import{Q as d}from"./vendor-appwrite-BQhTxLk4.js";import{bi as ce}from"./vendor-other-ws_0vYaO.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-GexG3wnZ.js";import"./vendor-animations-W1Z2cmit.js";function ie(){const{user:o}=re(),[S,f]=x.useState(!0),[g,j]=x.useState([]),[c,N]=x.useState([]),[D,B]=x.useState({totalReferrals:0,activeReferrals:0,completedReferrals:0,totalEarnings:0,pendingEarnings:0,thisMonthReferrals:0,thisMonthEarnings:0}),[v,$]=x.useState(""),[T,L]=x.useState(""),p=async()=>{if(o){f(!0);try{const t=(await k.listDocuments(m.databaseId,m.collections.referrals,[d.equal("referrerId",o.$id),d.orderDesc("$createdAt"),d.limit(100)])).documents;j(t);const l=(await k.listDocuments(m.databaseId,m.collections.referral_earnings||"referral_earnings",[d.equal("referrerId",o.$id),d.orderDesc("$createdAt"),d.limit(100)])).documents;N(l),r(t,l),await A()}catch(s){console.error("Error loading referral data:",s)}finally{f(!1)}}},A=async()=>{if(o)try{const s=await k.listDocuments(m.databaseId,m.collections.userPreferences,[d.equal("userId",o.$id),d.limit(1)]);if(s.documents.length>0){const t=s.documents[0].affiliateCode;$(t),L(`${window.location.origin}/register?ref=${t}`)}}catch(s){console.error("Error loading affiliate code:",s)}},r=(s,t)=>{const i=new Date,l=new Date(i.getFullYear(),i.getMonth(),1),n={totalReferrals:s.length,activeReferrals:s.filter(a=>a.status==="active").length,completedReferrals:s.filter(a=>a.status==="completed").length,totalEarnings:t.filter(a=>a.status==="completed"||a.status==="paid").reduce((a,b)=>a+b.amount,0),pendingEarnings:t.filter(a=>a.status==="pending").reduce((a,b)=>a+b.amount,0),thisMonthReferrals:s.filter(a=>new Date(a.$createdAt)>=l).length,thisMonthEarnings:t.filter(a=>(a.status==="completed"||a.status==="paid")&&new Date(a.$createdAt)>=l).reduce((a,b)=>a+b.amount,0)};B(n)},q=async(s,t,i,l)=>{try{const n=await M.createExecution("referral-handler",JSON.stringify({action:"register",userId:s,userName:t,userEmail:i,referralCode:l}));return JSON.parse(n.responseBody)}catch(n){throw console.error("Error registering with referral:",n),n}},I=async(s,t,i)=>{try{const l=await M.createExecution("referral-handler",JSON.stringify({action:"first_purchase",userId:s,orderId:t,orderAmount:i})),n=JSON.parse(l.responseBody);return await p(),n}catch(l){throw console.error("Error handling first purchase:",l),l}},V=async(s,t,i)=>{try{const l=await M.createExecution("referral-handler",JSON.stringify({action:"purchase",userId:s,orderId:t,orderAmount:i})),n=JSON.parse(l.responseBody);return await p(),n}catch(l){throw console.error("Error handling purchase commission:",l),l}},W=async s=>{try{const t=await k.listDocuments(m.databaseId,m.collections.userPreferences,[d.equal("affiliateCode",s),d.limit(1)]);return t.documents.length>0?t.documents[0]:null}catch(t){return console.error("Error getting referral by code:",t),null}},Y=s=>c.filter(t=>t.type===s),X=s=>c.filter(t=>t.level===s),Z=(s,t)=>{const i=new Date(s,t-1,1),l=new Date(s,t,0);return c.filter(n=>{const a=new Date(n.$createdAt);return a>=i&&a<=l})};return x.useEffect(()=>{o&&p()},[o]),{loading:S,referrals:g,earnings:c,stats:D,affiliateCode:v,referralLink:T,loadReferralData:p,registerWithReferral:q,handleFirstPurchase:I,handlePurchaseCommission:V,getReferralByCode:W,getEarningsByType:Y,getEarningsByLevel:X,getEarningsByMonth:Z}}function je(){const{toast:o}=ae(),{loading:S,referrals:f,stats:g,affiliateCode:j,referralLink:c}=ie(),[N,D]=x.useState("");x.useEffect(()=>{c&&B()},[c]);const B=async()=>{try{const r=await ce.toDataURL(c,{width:300,margin:2,color:{dark:"#000000",light:"#ffffff"}});D(r)}catch(r){console.error("Error generating QR code:",r)}},v=()=>{navigator.clipboard.writeText(c),o({title:"✅ تم النسخ",description:"تم نسخ رابط الإحالة"})},$=()=>{navigator.clipboard.writeText(j),o({title:"✅ تم النسخ",description:"تم نسخ كود الإحالة"})},T=async()=>{if(navigator.share)try{await navigator.share({title:"انضم إلى EgyGo",text:`استخدم كود الإحالة الخاص بي: ${j}`,url:c})}catch(r){console.error("Error sharing:",r)}else v()},L=()=>{const r=document.createElement("a");r.download=`referral-qr-${j}.png`,r.href=N,r.click()},p=r=>{switch(r){case"pending":return e.jsxs(y,{variant:"outline",className:"bg-yellow-50",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),"قيد الانتظار"]});case"active":return e.jsxs(y,{variant:"outline",className:"bg-blue-50",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"نشط"]});case"completed":return e.jsxs(y,{variant:"outline",className:"bg-green-50",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"مكتمل"]});default:return e.jsx(y,{variant:"outline",children:r})}},A=r=>{const q=["bg-bronze","bg-silver","bg-gold","bg-platinum"],I=["المستوى 1","المستوى 2","المستوى 3","المستوى 4"];return e.jsx(y,{className:q[r-1]||"bg-gray-500",children:I[r-1]||`المستوى ${r}`})};return S?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",dir:"rtl",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(C,{className:"h-8 w-8"}),"نظام الإحالة"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"احصل على مكافآت عند دعوة أصدقائك"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(h,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي الإحالات"}),e.jsx("p",{className:"text-3xl font-bold",children:g.totalReferrals})]}),e.jsx(C,{className:"h-12 w-12 text-blue-500 opacity-20"})]})})}),e.jsx(h,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إحالات نشطة"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:g.activeReferrals})]}),e.jsx(G,{className:"h-12 w-12 text-blue-500 opacity-20"})]})})}),e.jsx(h,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي الأرباح"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:[g.totalEarnings," ج.م"]})]}),e.jsx(ee,{className:"h-12 w-12 text-green-500 opacity-20"})]})})}),e.jsx(h,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"أرباح هذا الشهر"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-600",children:[g.thisMonthEarnings," ج.م"]})]}),e.jsx(Q,{className:"h-12 w-12 text-purple-500 opacity-20"})]})})})]}),e.jsxs(h,{children:[e.jsx(O,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"أدوات الإحالة"]})}),e.jsx(u,{children:e.jsxs(le,{defaultValue:"link",className:"w-full",children:[e.jsxs(ne,{className:"grid w-full grid-cols-3",children:[e.jsxs(J,{value:"link",children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"الرابط"]}),e.jsxs(J,{value:"code",children:[e.jsx(F,{className:"h-4 w-4 mr-1"}),"الكود"]}),e.jsxs(J,{value:"qr",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"QR Code"]})]}),e.jsxs(P,{value:"link",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"رابط الإحالة الخاص بك"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{value:c,readOnly:!0,className:"font-mono text-sm"}),e.jsx(E,{onClick:v,variant:"outline",children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx(E,{onClick:T,children:e.jsx(_,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"شارك هذا الرابط مع أصدقائك للحصول على مكافآت"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5 text-blue-600"}),"المكافآت"]}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"50 ج.م عند تسجيل صديقك"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"100 ج.م عند أول عملية شراء"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"5% من مشتريات صديقك مدى الحياة"})]})]})]})]}),e.jsxs(P,{value:"code",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"كود الإحالة الخاص بك"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{value:j,readOnly:!0,className:"font-mono text-2xl font-bold text-center"}),e.jsx(E,{onClick:$,variant:"outline",children:e.jsx(H,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"يمكن لأصدقائك إدخال هذا الكود عند التسجيل"})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"كيفية الاستخدام:"}),e.jsxs("ol",{className:"space-y-2 text-sm list-decimal list-inside",children:[e.jsx("li",{children:"شارك الكود مع أصدقائك"}),e.jsx("li",{children:"يقوم صديقك بالتسجيل في الموقع"}),e.jsx("li",{children:'يدخل الكود في حقل "كود الإحالة"'}),e.jsx("li",{children:"تحصل على المكافأة فوراً!"})]})]})]}),e.jsx(P,{value:"qr",className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[N&&e.jsx("img",{src:N,alt:"QR Code",className:"border-4 border-gray-200 rounded-lg"}),e.jsxs(E,{onClick:L,className:"w-full max-w-xs",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"تحميل QR Code"]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"اطبع هذا الكود أو شاركه على وسائل التواصل الاجتماعي"})]})})]})})]}),e.jsxs(h,{children:[e.jsx(O,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),"إحالاتي (",f.length,")"]})}),e.jsx(u,{children:f.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"h-16 w-16 mx-auto text-muted-foreground opacity-20 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد إحالات بعد"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"ابدأ بمشاركة رابط الإحالة مع أصدقائك"})]}):e.jsx("div",{className:"space-y-4",children:f.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(C,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:r.referredUserName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.referredUserEmail}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(r.createdAt).toLocaleDateString("ar-EG")})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[A(r.level),p(r.status),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"المكافأة"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[r.reward," ج.م"]})]})]})]},r.$id))})})]}),e.jsxs(h,{children:[e.jsx(O,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"مستويات الإحالة"]})}),e.jsxs(u,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"h-5 w-5 text-orange-600"}),e.jsx("h3",{className:"font-bold",children:"المستوى 1"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"الإحالة المباشرة"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:"50 ج.م"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"+ 5% من المشتريات"})]}),e.jsxs("div",{className:"p-4 border rounded-lg bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900/20 dark:to-gray-800/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"font-bold",children:"المستوى 2"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"إحالة الإحالة"}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:"25 ج.م"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"+ 2.5% من المشتريات"})]}),e.jsxs("div",{className:"p-4 border rounded-lg bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"h-5 w-5 text-yellow-600"}),e.jsx("h3",{className:"font-bold",children:"المستوى 3"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"المستوى الثالث"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:"10 ج.م"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"+ 1% من المشتريات"})]}),e.jsxs("div",{className:"p-4 border rounded-lg bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"h-5 w-5 text-purple-600"}),e.jsx("h3",{className:"font-bold",children:"المستوى 4"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"المستوى الرابع"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:"5 ج.م"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"+ 0.5% من المشتريات"})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-blue-600"}),"كيف يعمل نظام المستويات؟"]}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"المستوى 1:"})," الأشخاص الذين تحيلهم مباشرة"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"المستوى 2:"})," الأشخاص الذين يحيلهم أصدقاؤك"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"المستوى 3:"})," الأشخاص الذين يحيلهم أصدقاء أصدقائك"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"المستوى 4:"})," المستوى الرابع من الإحالات"]})]})]})]})]})]})}export{je as default};
