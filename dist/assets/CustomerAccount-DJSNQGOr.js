import{Y as ne,Z as ce,_ as ie,$ as H,a0 as p,w as le,b as de,r as m,j as e,L as M,C as n,g as c,a1 as oe,B as o,o as L,H as G,a2 as me,a3 as he,a4 as v,a5 as w,e as y,f as b,a6 as I,s as O,I as A,N as ue,a as U,a7 as xe}from"./index-Ce-RwxJS.js";import{S as je}from"./shopping-bag-CvqvafLt.js";import{C as pe}from"./credit-card-Diutn1QU.js";import{M as J}from"./map-pin-lmMdVeac.js";const W=new ie,ge="https://fra.cloud.appwrite.io/v1",fe="68d8b9db00134c41e7c8";W.setEndpoint(ge).setProject(fe);const Ne=new ne(W),i=new ce(W),l="68de037e003bd03c4d45",Q="users",V="orders",$="wishlist",P="addresses",ve="products",h={async getUserProfile(r){try{return(await i.listDocuments(l,Q,[p.equal("email",r)])).documents[0]||null}catch(t){return console.error("Error fetching user profile:",t),null}},async updateUserProfile(r,t){try{return await i.updateDocument(l,Q,r,t)}catch(a){throw console.error("Error updating user profile:",a),a}},async getUserOrders(r){try{return(await i.listDocuments(l,V,[p.equal("userId",r),p.orderDesc("$createdAt"),p.limit(20)])).documents}catch(t){return console.error("Error fetching orders:",t),[]}},async getOrderDetails(r){try{return await i.getDocument(l,V,r)}catch(t){return console.error("Error fetching order details:",t),null}},async getUserWishlist(r){try{const t=await i.listDocuments(l,$,[p.equal("userId",r),p.orderDesc("$createdAt")]);return await Promise.all(t.documents.map(async g=>{try{const u=await i.getDocument(l,ve,g.productId);return{...g,productName:u.name,productPrice:u.price,productImage:u.images?.[0]||u.image,inStock:u.stock>0}}catch{return g}}))}catch(t){return console.error("Error fetching wishlist:",t),[]}},async addToWishlist(r,t){try{return await i.createDocument(l,$,H.unique(),{userId:r,productId:t,createdAt:new Date().toISOString()})}catch(a){throw console.error("Error adding to wishlist:",a),a}},async removeFromWishlist(r){try{return await i.deleteDocument(l,$,r),!0}catch(t){throw console.error("Error removing from wishlist:",t),t}},async getUserAddresses(r){try{return(await i.listDocuments(l,P,[p.equal("userId",r),p.orderDesc("isDefault")])).documents}catch(t){return console.error("Error fetching addresses:",t),[]}},async addAddress(r,t){try{return await i.createDocument(l,P,H.unique(),{userId:r,...t,createdAt:new Date().toISOString()})}catch(a){throw console.error("Error adding address:",a),a}},async updateAddress(r,t){try{return await i.updateDocument(l,P,r,t)}catch(a){throw console.error("Error updating address:",a),a}},async deleteAddress(r){try{return await i.deleteDocument(l,P,r),!0}catch(t){throw console.error("Error deleting address:",t),t}},async getUserStats(r){try{const t=await this.getUserOrders(r),a=await this.getUserWishlist(r),g=t.length,u=t.filter(j=>["pending","processing","shipped"].includes(j.status?.toLowerCase())).length,D=t.filter(j=>j.status?.toLowerCase()==="delivered").length,S=t.reduce((j,N)=>j+(N.total||N.totalAmount||0),0);return{totalOrders:g,activeOrders:u,completedOrders:D,totalSpent:S,savedItems:a.length,reviews:0}}catch(t){return console.error("Error calculating user stats:",t),{totalOrders:0,activeOrders:0,completedOrders:0,totalSpent:0,savedItems:0,reviews:0}}}};function Se(){const{user:r}=le(),{toast:t}=de(),[a,g]=m.useState("profile"),[u,D]=m.useState(!0),[S,j]=m.useState(!1),[N,Y]=m.useState(null),[_,Z]=m.useState([]),[k,F]=m.useState([]),[R,q]=m.useState([]),[C,B]=m.useState({totalOrders:0,activeOrders:0,completedOrders:0,totalSpent:0,savedItems:0,reviews:0}),[d,E]=m.useState({name:"",phone:"",birthdate:""});m.useEffect(()=>{r&&z()},[r]);const z=async()=>{if(r){D(!0);try{const s=await h.getUserProfile(r.email);s&&(Y(s),E({name:s.name||r.name||"",phone:s.phone||"",birthdate:s.birthdate||""}));const x=await h.getUserOrders(r.$id);Z(x);const f=await h.getUserWishlist(r.$id);F(f);const re=await h.getUserAddresses(r.$id);q(re);const ae=await h.getUserStats(r.$id);B(ae)}catch(s){console.error("Error loading data:",s),t({title:"خطأ في التحميل",description:"حدث خطأ أثناء تحميل البيانات",variant:"destructive"})}finally{D(!1)}}},K=async()=>{if(N?.$id){j(!0);try{d.name!==r?.name&&await Ne.updateName(d.name),await h.updateUserProfile(N.$id,{name:d.name,phone:d.phone,birthdate:d.birthdate,updatedAt:new Date().toISOString()}),t({title:"تم التحديث",description:"تم تحديث معلوماتك بنجاح"}),await z()}catch(s){console.error("Error updating profile:",s),t({title:"خطأ",description:"حدث خطأ في تحديث المعلومات",variant:"destructive"})}finally{j(!1)}}},X=async s=>{try{await h.removeFromWishlist(s),t({title:"تم الحذف",description:"تم إزالة المنتج من المفضلة"});const x=await h.getUserWishlist(r?.$id||"");F(x),B(f=>({...f,savedItems:x.length}))}catch{t({title:"خطأ",description:"حدث خطأ في إزالة المنتج",variant:"destructive"})}},ee=async s=>{try{await h.deleteAddress(s),t({title:"تم الحذف",description:"تم حذف العنوان بنجاح"});const x=await h.getUserAddresses(r?.$id||"");q(x)}catch{t({title:"خطأ",description:"حدث خطأ في حذف العنوان",variant:"destructive"})}},se=s=>s?new Date(s).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric"}):"",T=s=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(s||0),te=s=>{const f={pending:{label:"قيد الانتظار",variant:"secondary"},processing:{label:"قيد المعالجة",variant:"default"},shipped:{label:"تم الشحن",variant:"default"},delivered:{label:"تم التوصيل",variant:"success"},cancelled:{label:"ملغي",variant:"destructive"}}[s?.toLowerCase()]||{label:s||"غير محدد",variant:"secondary"};return e.jsx(U,{variant:f.variant,children:f.label})};return u?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-primary"})}):r?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"حسابي"}),e.jsxs("p",{className:"text-muted-foreground",children:["مرحباً ",r?.name||r?.email," - إدارة معلوماتك وطلباتك"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-8",children:[e.jsx(n,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي الطلبات"}),e.jsx("p",{className:"text-2xl font-bold",children:C.totalOrders})]}),e.jsx(L,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(n,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"طلبات نشطة"}),e.jsx("p",{className:"text-2xl font-bold",children:C.activeOrders})]}),e.jsx(je,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(n,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي المشتريات"}),e.jsx("p",{className:"text-2xl font-bold",children:T(C.totalSpent)})]}),e.jsx(pe,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(n,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"المفضلة"}),e.jsx("p",{className:"text-2xl font-bold",children:C.savedItems})]}),e.jsx(G,{className:"h-8 w-8 text-muted-foreground"})]})})})]}),e.jsxs(me,{value:a,onValueChange:g,children:[e.jsxs(he,{className:"grid w-full grid-cols-5",children:[e.jsx(v,{value:"profile",children:"الملف الشخصي"}),e.jsx(v,{value:"orders",children:"طلباتي"}),e.jsx(v,{value:"wishlist",children:"المفضلة"}),e.jsx(v,{value:"addresses",children:"العناوين"}),e.jsx(v,{value:"settings",children:"الإعدادات"})]}),e.jsx(w,{value:"profile",className:"space-y-4",children:e.jsxs(n,{children:[e.jsxs(y,{children:[e.jsx(b,{children:"المعلومات الشخصية"}),e.jsx(I,{children:"قم بتحديث معلوماتك الشخصية"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"name",children:"الاسم الكامل"}),e.jsx(A,{id:"name",value:d.name,onChange:s=>E({...d,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"email",children:"البريد الإلكتروني"}),e.jsx(A,{id:"email",type:"email",value:r?.email||"",disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"phone",children:"رقم الهاتف"}),e.jsx(A,{id:"phone",value:d.phone,onChange:s=>E({...d,phone:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"birthdate",children:"تاريخ الميلاد"}),e.jsx(A,{id:"birthdate",type:"date",value:d.birthdate,onChange:s=>E({...d,birthdate:s.target.value})})]})]}),e.jsxs(o,{onClick:K,disabled:S,children:[S&&e.jsx(M,{className:"ml-2 h-4 w-4 animate-spin"}),"حفظ التغييرات"]})]})]})}),e.jsx(w,{value:"orders",className:"space-y-4",children:e.jsxs(n,{children:[e.jsxs(y,{children:[e.jsx(b,{children:"طلباتي"}),e.jsx(I,{children:"تتبع وإدارة طلباتك"})]}),e.jsx(c,{children:_.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد طلبات حتى الآن"}),e.jsx(o,{className:"mt-4",onClick:()=>window.location.href="/products",children:"تسوق الآن"})]}):e.jsx("div",{className:"space-y-4",children:_.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 rounded bg-gray-100 flex items-center justify-center",children:e.jsx(L,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["#",s.orderNumber||s.$id.slice(-6)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.items?.length||0," منتجات - ",se(s.$createdAt)]}),te(s.status)]})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-lg font-bold",children:T(s.total||s.totalAmount||0)}),e.jsxs(o,{variant:"outline",size:"sm",className:"mt-2",children:[e.jsx(ue,{className:"h-4 w-4 ml-1"}),"التفاصيل"]})]})]},s.$id))})})]})}),e.jsx(w,{value:"wishlist",className:"space-y-4",children:e.jsxs(n,{children:[e.jsxs(y,{children:[e.jsx(b,{children:"قائمة المفضلة"}),e.jsx(I,{children:"المنتجات التي قمت بحفظها"})]}),e.jsx(c,{children:k.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(G,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"قائمة المفضلة فارغة"}),e.jsx(o,{className:"mt-4",onClick:()=>window.location.href="/products",children:"اكتشف المنتجات"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:k.map(s=>e.jsx(n,{children:e.jsxs(c,{className:"p-4",children:[e.jsx("img",{src:s.productImage||"/placeholder.svg",alt:s.productName,className:"w-full h-40 object-cover rounded mb-3"}),e.jsx("h4",{className:"font-semibold mb-2",children:s.productName}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-lg font-bold",children:T(s.productPrice)}),e.jsx(U,{variant:s.inStock?"default":"secondary",children:s.inStock?"متوفر":"نفذ"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-3",children:[e.jsx(o,{size:"sm",disabled:!s.inStock,children:"أضف للسلة"}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>X(s.$id),children:"إزالة"})]})]})},s.$id))})})]})}),e.jsx(w,{value:"addresses",className:"space-y-4",children:e.jsxs(n,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(b,{children:"عناويني"}),e.jsx(I,{children:"إدارة عناوين الشحن"})]}),e.jsxs(o,{children:[e.jsx(J,{className:"h-4 w-4 ml-2"}),"إضافة عنوان"]})]})}),e.jsx(c,{children:R.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد عناوين محفوظة"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:R.map(s=>e.jsx(n,{children:e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.label}),s.isDefault&&e.jsx(U,{variant:"secondary",className:"mt-1",children:"العنوان الافتراضي"})]})}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:[s.street,", ",s.city,", ",s.country]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.phone}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",children:"تعديل"}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>ee(s.$id),children:"حذف"})]})]})},s.$id))})})]})}),e.jsx(w,{value:"settings",className:"space-y-4",children:e.jsxs(n,{children:[e.jsx(y,{children:e.jsx(b,{children:"الأمان"})}),e.jsx(c,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"تغيير كلمة المرور"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"قم بتحديث كلمة المرور الخاصة بك"})]}),e.jsxs(o,{variant:"outline",children:[e.jsx(xe,{className:"h-4 w-4 ml-2"}),"تغيير"]})]})})]})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsx(n,{className:"max-w-md w-full",children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(oe,{className:"h-12 w-12 text-yellow-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"يرجى تسجيل الدخول"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"يجب عليك تسجيل الدخول للوصول إلى حسابك"}),e.jsx(o,{onClick:()=>window.location.href="/login",children:"تسجيل الدخول"})]})})})})}export{Se as default};
