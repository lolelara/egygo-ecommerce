import{b as R,r as o,j as e,D as E,h as A,B as g,P as U,i as k,k as F,l as L,b5 as O,C as p,e as f,f as N,g as C,o as q,aE as _,I as b,T as G,b6 as J,s as v,v as K,m as Q}from"./index-Ce-RwxJS.js";import{A as H,F as V}from"./AdminLayout-DRAN_nM7.js";import{T as W,a as X,b as P,c as u,d as Y,e as j}from"./table-DhT4s9qg.js";import{d as D}from"./admin-api-DJKkOHRe.js";import{S as Z}from"./square-pen-BvEjHzCI.js";import"./tag-BB9opunb.js";import"./settings-DdUeHZqS.js";const z=({category:l,onSubmit:i,onCancel:x})=>{const[n,c]=o.useState({name:l?.name||"",slug:l?.slug||"",description:l?.description||"",image:l?.image||""}),h=t=>{t.preventDefault(),i(n)},w=t=>t.toLowerCase().replace(/[أ-ي]/g,r=>({أ:"a",ب:"b",ت:"t",ث:"th",ج:"j",ح:"h",خ:"kh",د:"d",ذ:"dh",ر:"r",ز:"z",س:"s",ش:"sh",ص:"s",ض:"d",ط:"t",ظ:"dh",ع:"a",غ:"gh",ف:"f",ق:"q",ك:"k",ل:"l",م:"m",ن:"n",ه:"h",و:"w",ي:"y"})[r]||r).replace(/\s+/g,"-").replace(/[^\w\-]+/g,""),y=t=>{c(r=>({...r,name:t,slug:l?r.slug:w(t)}))};return e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"name",children:"اسم الفئة"}),e.jsx(b,{id:"name",value:n.name,onChange:t=>y(t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"slug",children:"الرابط (Slug)"}),e.jsx(b,{id:"slug",value:n.slug,onChange:t=>c(r=>({...r,slug:t.target.value})),placeholder:"electronics",required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["سيكون الرابط: /category/",n.slug]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"description",children:"الوصف"}),e.jsx(K,{id:"description",value:n.description,onChange:t=>c(r=>({...r,description:t.target.value})),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"image",children:"رابط الصورة"}),e.jsx(b,{id:"image",value:n.image,onChange:t=>c(r=>({...r,image:t.target.value})),placeholder:"/placeholder.svg"})]}),e.jsxs(Q,{children:[e.jsx(g,{type:"button",variant:"outline",onClick:x,children:"إلغاء"}),e.jsx(g,{type:"submit",children:l?"تحديث الفئة":"إضافة الفئة"})]})]})};function ie(){const{toast:l}=R(),[i,x]=o.useState([]),[n,c]=o.useState(!0),[h,w]=o.useState(""),[y,t]=o.useState(!1),[r,m]=o.useState(null);o.useEffect(()=>{(async()=>{c(!0);try{const a=await J.getAll();x(a.categories)}catch(a){console.error("Error fetching categories:",a)}c(!1)})()},[]);const S=i.filter(s=>s.name.toLowerCase().includes(h.toLowerCase())||s.slug.toLowerCase().includes(h.toLowerCase())),B=async s=>{try{console.log("Creating category with data:",s);const a=await D.create(s);console.log("Category created successfully:",a),x(d=>[a,...d]),t(!1),l({title:"تم بنجاح",description:"تم إضافة الفئة بنجاح"})}catch(a){console.error("Error adding category:",a);const d=a?.message||a?.toString()||"فشل في إضافة الفئة";l({variant:"destructive",title:"خطأ",description:d})}},I=async s=>{if(r)try{const a=await D.update(r.id,s);x(d=>d.map(T=>T.id===r.id?{...T,...a}:T)),m(null)}catch(a){console.error("Error updating category:",a),alert("فشل في تحديث الفئة")}},M=async s=>{if(confirm("هل أنت متأكد من حذف هذه الفئة؟"))try{await D.delete(s),x(a=>a.filter(d=>d.id!==s))}catch(a){console.error("Error deleting category:",a),alert("فشل في حذف الفئة")}};return n?e.jsx(H,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"إدارة الفئات"})}),e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-10 bg-muted rounded mb-4"}),e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,a)=>e.jsx("div",{className:"h-16 bg-muted rounded"},a))})]})]})}):e.jsx(H,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"إدارة الفئات"}),e.jsxs(E,{open:y,onOpenChange:t,children:[e.jsx(A,{asChild:!0,children:e.jsxs(g,{children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"إضافة فئة جديدة"]})}),e.jsxs(k,{className:"max-w-md",children:[e.jsxs(F,{children:[e.jsx(L,{children:"إضافة فئة جديدة"}),e.jsx(O,{children:"أدخل تفاصيل الفئة الجديدة"})]}),e.jsx(z,{onSubmit:B,onCancel:()=>t(!1)})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"إجمالي الفئات"}),e.jsx(V,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold",children:i.length})})]}),e.jsxs(p,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"إجمالي المنتجات"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold",children:i.reduce((s,a)=>s+a.productCount,0)})})]}),e.jsxs(p,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"متوسط المنتجات"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold",children:i.length>0?Math.round(i.reduce((s,a)=>s+a.productCount,0)/i.length):0})})]})]}),e.jsx("div",{className:"flex gap-4",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(b,{placeholder:"البحث في الفئات...",value:h,onChange:s=>w(s.target.value),className:"pl-10"})]})})}),e.jsxs(p,{children:[e.jsx(f,{children:e.jsxs(N,{children:["الفئات (",S.length,")"]})}),e.jsx(C,{children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(P,{children:[e.jsx(u,{children:"الفئة"}),e.jsx(u,{children:"الرابط"}),e.jsx(u,{children:"الوصف"}),e.jsx(u,{children:"عدد المنتجات"}),e.jsx(u,{className:"text-center",children:"الإجراءات"})]})}),e.jsx(Y,{children:S.map(s=>e.jsxs(P,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.image||"/placeholder.svg",alt:s.name,className:"w-10 h-10 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: ",s.id]})]})]})}),e.jsx(j,{children:e.jsxs("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:["/category/",s.slug]})}),e.jsx(j,{children:e.jsx("div",{className:"max-w-[300px] truncate text-sm text-muted-foreground",children:s.description||"لا يوجد وصف"})}),e.jsx(j,{children:e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-medium",children:s.productCount})})}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsxs(E,{open:r?.id===s.id,onOpenChange:a=>!a&&m(null),children:[e.jsx(A,{asChild:!0,children:e.jsx(g,{variant:"outline",size:"sm",onClick:()=>m(s),children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsxs(k,{className:"max-w-md",children:[e.jsxs(F,{children:[e.jsx(L,{children:"تعديل الفئة"}),e.jsx(O,{children:"تعديل تفاصيل الفئة"})]}),r&&e.jsx(z,{category:r,onSubmit:I,onCancel:()=>m(null)})]})]}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>{confirm("هل أنت متأكد من حذف هذه الفئة؟")&&M(s.id)},children:e.jsx(G,{className:"h-4 w-4 text-red-600"})})]})})]},s.id))})]})})]})]})})}export{ie as default};
