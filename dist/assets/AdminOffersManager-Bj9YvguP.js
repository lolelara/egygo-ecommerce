import{r as c,j as e,bp as T,af as F,ax as Q,aJ as _,c2 as J,aZ as K}from"./vendor-react-CCFRLLzk.js";import{u as M,d as p,e as r,f as d,C as I,x as U,y as X,h as $,B as v,$ as E,D as Z,z as W,A as Y,E as ee,F as te,L as n,I as O,T as se,S as C,i as y,j as A,k as N,l as x,G as ie}from"./index-D-h96Znd.js";import{Q as L,I as re}from"./vendor-appwrite-CuqfvTq9.js";import{T as ae,a as le,b as B,c as u,d as ne,e as h}from"./table-5aMgMluw.js";import"./vendor-ui-BA32w1ww.js";import"./vendor-query-j_rPqiug.js";import"./vendor-other-CzBBjgu5.js";import"./vendor-animations-CPHPqPXb.js";const ce=[{value:"from-brand-purple via-brand-orange to-brand-purple",label:"بنفسجي - برتقالي"},{value:"from-green-500 via-emerald-500 to-teal-500",label:"أخضر"},{value:"from-blue-500 via-cyan-500 to-blue-600",label:"أزرق"},{value:"from-red-500 via-pink-500 to-red-600",label:"أحمر"},{value:"from-yellow-500 via-orange-500 to-yellow-600",label:"أصفر - برتقالي"},{value:"from-purple-500 via-pink-500 to-purple-600",label:"بنفسجي - وردي"}],oe=[{value:"text-white",label:"أبيض"},{value:"text-black",label:"أسود"},{value:"text-yellow-300",label:"أصفر فاتح"}];function ve(){const[j,R]=c.useState([]),[H,f]=c.useState(!0),[V,m]=c.useState(!1),[o,k]=c.useState(null),[b,w]=c.useState(!1),{toast:l}=M(),[s,a]=c.useState({title:"",description:"",backgroundColor:"from-brand-purple via-brand-orange to-brand-purple",textColor:"text-white",isActive:!0,targetAudience:"all",priority:1});c.useEffect(()=>{g()},[]);const g=async()=>{try{f(!0);const t=await p.listDocuments(r.databaseId,r.collections.offers,[L.orderDesc("priority"),L.limit(50)]);R(t.documents.map(i=>({$id:i.$id,title:i.title,description:i.description,backgroundColor:i.backgroundColor,textColor:i.textColor,isActive:i.isActive,targetAudience:i.targetAudience,priority:i.priority,createdAt:i.$createdAt})))}catch(t){console.error("Error loading offers:",t),l({title:"خطأ",description:"فشل تحميل العروض",variant:"destructive"})}finally{f(!1)}},q=async t=>{t.preventDefault(),w(!0);try{o!=null&&o.$id?(await p.updateDocument(r.databaseId,r.collections.offers,o.$id,{title:s.title,description:s.description,backgroundColor:s.backgroundColor,textColor:s.textColor,isActive:s.isActive,targetAudience:s.targetAudience,priority:s.priority}),l({title:"✅ تم التحديث",description:"تم تحديث العرض بنجاح"})):(await p.createDocument(r.databaseId,r.collections.offers,re.unique(),{title:s.title,description:s.description,backgroundColor:s.backgroundColor,textColor:s.textColor,isActive:s.isActive,targetAudience:s.targetAudience,priority:s.priority}),l({title:"✅ تمت الإضافة",description:"تم إضافة العرض بنجاح"})),m(!1),S(),g()}catch(i){console.error("Error saving offer:",i),l({title:"خطأ",description:"فشل حفظ العرض",variant:"destructive"})}finally{w(!1)}},z=async t=>{if(confirm("هل أنت متأكد من حذف هذا العرض؟"))try{await p.deleteDocument(r.databaseId,r.collections.offers,t),l({title:"✅ تم الحذف",description:"تم حذف العرض بنجاح"}),g()}catch(i){console.error("Error deleting offer:",i),l({title:"خطأ",description:"فشل حذف العرض",variant:"destructive"})}},G=async t=>{try{await p.updateDocument(r.databaseId,r.collections.offers,t.$id,{isActive:!t.isActive}),l({title:"✅ تم التحديث",description:t.isActive?"تم إيقاف العرض":"تم تفعيل العرض"}),g()}catch(i){console.error("Error toggling offer:",i),l({title:"خطأ",description:"فشل تحديث حالة العرض",variant:"destructive"})}},P=t=>{k(t),a({title:t.title,description:t.description,backgroundColor:t.backgroundColor,textColor:t.textColor,isActive:t.isActive,targetAudience:t.targetAudience,priority:t.priority}),m(!0)},D=()=>{S(),m(!0)},S=()=>{k(null),a({title:"",description:"",backgroundColor:"from-brand-purple via-brand-orange to-brand-purple",textColor:"text-white",isActive:!0,targetAudience:"all",priority:1})};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"إدارة العروض"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"إدارة العروض الترويجية التي تظهر في شريط الإعلانات"})]}),e.jsxs(d,{onClick:D,children:[e.jsx(T,{className:"h-4 w-4 ml-2"}),"إضافة عرض جديد"]})]}),e.jsxs(I,{className:"mb-6",children:[e.jsx(U,{children:e.jsx(X,{children:"معاينة"})}),e.jsx($,{children:j.filter(t=>t.isActive).length>0?e.jsx("div",{className:"space-y-2",children:j.filter(t=>t.isActive).slice(0,3).map(t=>e.jsxs("div",{className:`bg-gradient-to-r ${t.backgroundColor} ${t.textColor} py-2 px-4 rounded text-center text-sm font-medium`,children:[e.jsx("span",{className:"font-bold",children:t.title}),t.description&&e.jsxs(e.Fragment,{children:[" - ",t.description]})]},t.$id))}):e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"لا توجد عروض نشطة حالياً"})})]}),e.jsx(I,{children:e.jsx($,{className:"p-6",children:H?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-primary"})}):j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"لا توجد عروض بعد"}),e.jsxs(d,{onClick:D,children:[e.jsx(T,{className:"h-4 w-4 ml-2"}),"إضافة أول عرض"]})]}):e.jsxs(ae,{children:[e.jsx(le,{children:e.jsxs(B,{children:[e.jsx(u,{children:"الأولوية"}),e.jsx(u,{children:"العنوان"}),e.jsx(u,{children:"الوصف"}),e.jsx(u,{children:"الجمهور المستهدف"}),e.jsx(u,{children:"الحالة"}),e.jsx(u,{className:"text-left",children:"الإجراءات"})]})}),e.jsx(ne,{children:j.map(t=>e.jsxs(B,{children:[e.jsx(h,{children:e.jsx(v,{variant:"outline",children:t.priority})}),e.jsx(h,{className:"font-medium",children:t.title}),e.jsx(h,{className:"max-w-xs truncate",children:t.description}),e.jsx(h,{children:e.jsx(v,{variant:"secondary",children:t.targetAudience==="all"?"الكل":t.targetAudience==="customer"?"عملاء":t.targetAudience==="affiliate"?"مسوقين":"تجار"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{checked:t.isActive,onCheckedChange:()=>G(t)}),t.isActive?e.jsxs(v,{className:"bg-green-500",children:[e.jsx(Q,{className:"h-3 w-3 ml-1"}),"نشط"]}):e.jsxs(v,{variant:"secondary",children:[e.jsx(_,{className:"h-3 w-3 ml-1"}),"متوقف"]})]})}),e.jsx(h,{className:"text-left",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>P(t),children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(d,{variant:"destructive",size:"sm",onClick:()=>z(t.$id),children:e.jsx(K,{className:"h-4 w-4"})})]})})]},t.$id))})]})})}),e.jsx(Z,{open:V,onOpenChange:m,children:e.jsxs(W,{className:"max-w-2xl",children:[e.jsxs(Y,{children:[e.jsx(ee,{children:o?"تعديل العرض":"إضافة عرض جديد"}),e.jsx(te,{children:"العرض سيظهر في شريط الإعلانات أعلى الموقع"})]}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"title",children:"العنوان *"}),e.jsx(O,{id:"title",value:s.title,onChange:t=>a({...s,title:t.target.value}),placeholder:"مثال: عروض خاصة!",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"description",children:"الوصف"}),e.jsx(se,{id:"description",value:s.description,onChange:t=>a({...s,description:t.target.value}),placeholder:"مثال: شحن مجاني على جميع الطلبات فوق 500 ج.م",rows:2})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"backgroundColor",children:"لون الخلفية"}),e.jsxs(C,{value:s.backgroundColor,onValueChange:t=>a({...s,backgroundColor:t}),children:[e.jsx(y,{children:e.jsx(A,{})}),e.jsx(N,{children:ce.map(t=>e.jsx(x,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"textColor",children:"لون النص"}),e.jsxs(C,{value:s.textColor,onValueChange:t=>a({...s,textColor:t}),children:[e.jsx(y,{children:e.jsx(A,{})}),e.jsx(N,{children:oe.map(t=>e.jsx(x,{value:t.value,children:t.label},t.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"targetAudience",children:"الجمهور المستهدف"}),e.jsxs(C,{value:s.targetAudience,onValueChange:t=>a({...s,targetAudience:t}),children:[e.jsx(y,{children:e.jsx(A,{})}),e.jsxs(N,{children:[e.jsx(x,{value:"all",children:"الكل"}),e.jsx(x,{value:"customer",children:"العملاء فقط"}),e.jsx(x,{value:"affiliate",children:"المسوقين فقط"}),e.jsx(x,{value:"merchant",children:"التجار فقط"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"priority",children:"الأولوية (الأعلى يظهر أولاً)"}),e.jsx(O,{id:"priority",type:"number",min:"1",value:s.priority,onChange:t=>a({...s,priority:parseInt(t.target.value)||1})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(E,{id:"isActive",checked:s.isActive,onCheckedChange:t=>a({...s,isActive:t})}),e.jsx(n,{htmlFor:"isActive",className:"cursor-pointer",children:"عرض نشط"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"معاينة"}),e.jsxs("div",{className:`bg-gradient-to-r ${s.backgroundColor} ${s.textColor} py-2 px-4 rounded text-center text-sm font-medium mt-2`,children:[e.jsx("span",{className:"font-bold",children:s.title||"العنوان"}),s.description&&e.jsxs(e.Fragment,{children:[" - ",s.description]})]})]})]}),e.jsxs(ie,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:b,children:"إلغاء"}),e.jsx(d,{type:"submit",disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-4 w-4 ml-2 animate-spin"}),"جاري الحفظ..."]}):e.jsx(e.Fragment,{children:o?"تحديث":"إضافة"})})]})]})]})})]})}export{ve as default};
