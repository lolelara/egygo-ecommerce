# ูุธุงู ุงูููุงููุฉ ุนูู ุงูุญุณุงุจุงุช - ุฏููู ุดุงูู

**ุชุงุฑูุฎ ุงูุฅุถุงูุฉ**: 9 ุฃูุชูุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ**: 1.0  
**Commit**: 157f053

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ูุธุงู ููุงููุฉ ุงุญุชุฑุงูู ูุญุณุงุจุงุช ุงูุชุฌุงุฑ ูุงููุณูููู ูุถูุงู ุฌูุฏุฉ ุงูุฎุฏูุฉ ูุญูุงูุฉ ุงูููุตุฉ.

### ุงูุฃูุฏุงู:
- โ ุงูุชุญูู ูู ูููุฉ ุงูุชุฌุงุฑ ูุงููุณูููู ูุจู ููุญูู ุงูุตูุงุญูุงุช
- โ ุถูุงู ุฌูุฏุฉ ุงูููุชุฌุงุช ูุงูุฎุฏูุงุช ุงูููุฏูุฉ
- โ ุญูุงูุฉ ุงูููุตุฉ ูู ุงูุญุณุงุจุงุช ุงูููููุฉ ุฃู ุงููุดุจููุฉ
- โ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุงูููุงุฆู

---

## ๐ ุขููุฉ ุนูู ุงููุธุงู

### 1. ุฃููุงุน ุงูุญุณุงุจุงุช

| ููุน ุงูุญุณุงุจ | ุงูููุงููุฉ | ุงูุญุงูุฉ ุงูุงูุชุฑุงุถูุฉ | ุงููุตูู |
|------------|----------|-------------------|--------|
| ๐ค **ุนููู** | ููุฑูุฉ | `approved` | ูุงูู ููุฑุงู |
| ๐ฐ **ูุณูู** | ุชุชุทูุจ ููุงููุฉ | `pending` | ูุญุฏูุฏ ุญุชู ุงูููุงููุฉ |
| ๐ช **ุชุงุฌุฑ** | ุชุชุทูุจ ููุงููุฉ | `pending` | ูุญุฏูุฏ ุญุชู ุงูููุงููุฉ |

### 2. ูุฑุงุญู ุงูุญุณุงุจ

```
ุงูุชุณุฌูู โ pending โ (ูุฑุงุฌุนุฉ ุงูุฃุฏูู) โ approved/rejected
```

#### ุญุงูุฉ `pending` (ููุฏ ุงููุฑุงุฌุนุฉ):
- โ ูููู ุชุณุฌูู ุงูุฏุฎูู
- โ ูุง ูููู ุฅุถุงูุฉ ููุชุฌุงุช (ุชุฌุงุฑ)
- โ ูุง ูููู ุฅูุดุงุก ุฑูุงุจุท ุชุณููููุฉ (ูุณูููู)
- โ๏ธ ุฑุณุงูุฉ ุชูุจูู ุชุธูุฑ ูู ููุญุฉ ุงูุชุญูู

#### ุญุงูุฉ `approved` (ูู๏ฟฝ๏ฟฝู ุนููู):
- โ ูุตูู ูุงูู ูุฌููุน ุงููููุฒุงุช
- โ ูููู ุฅุถุงูุฉ ููุชุฌุงุช (ุชุฌุงุฑ)
- โ ูููู ุฅูุดุงุก ุฑูุงุจุท ุชุณููููุฉ (ูุณูููู)
- โ ูุธูุฑ ูู ููุงุฆู ุงูุชุฌุงุฑ/ุงููุณูููู ุงููุดุทูู

#### ุญุงูุฉ `rejected` (ูุฑููุถ):
- โ ุญุณุงุจ ูุนุทู
- โน๏ธ ุฑุณุงูุฉ ุชูุถุญ ุณุจุจ ุงูุฑูุถ
- ๐ ูููู ุงูุชูุงุตู ูุน ุงูุฏุนู ูุฅุนุงุฏุฉ ุงูุชูุฏูู

---

## ๐ ุงูุชุนุฏููุงุช ุนูู ุตูุญุฉ ุงูุชุณุฌูู

### 1. ุญููู ุฌุฏูุฏุฉ

#### ุฑูู ุงููุงุชู ุงูุฃุณุงุณู (ูุทููุจ):
```tsx
<Input
  id="phone"
  name="phone"
  type="tel"
  required
  placeholder="ูุซุงู: 01012345678"
/>
```

#### ุชุฃููุฏ ุชููุฑ WhatsApp (ูุทููุจ):
```tsx
<Checkbox
  id="whatsapp-available"
  checked={phoneAvailableOnWhatsApp}
  onCheckedChange={(checked) => setPhoneAvailableOnWhatsApp(!!checked)}
/>
<Label>
  ูุฐุง ุงูุฑูู ูุชุงุญ ุนูู WhatsApp ุฃู ููุงุชุตุงู *
</Label>
```

**ููุงุฐุง ูููุ**
- ๐ ูุถูู ุฅููุงููุฉ ุงูุชูุงุตู ูุน ุงูุชุงุฌุฑ/ุงููุณูู
- โ ูุฒูุฏ ูู ูุตุฏุงููุฉ ุงูุญุณุงุจ
- ๐ ูููู ูู ุงูุญุณุงุจุงุช ุงูููููุฉ

#### ุฑูู ูุงุชู ุจุฏูู (ุงุฎุชูุงุฑู):
```tsx
<Input
  id="alternativePhone"
  name="alternativePhone"
  type="tel"
  placeholder="ุฑูู ุฅุถุงูู ููุชูุงุตู (ุงุฎุชูุงุฑู)"
/>
```

**ุงููุงุฆุฏุฉ**:
- ูููุฑ ูุณููุฉ ุชูุงุตู ุจุฏููุฉ
- ูููุฏ ูู ุญุงูุฉ ุนุฏู ุชููุฑ ุงูุฑูู ุงูุฃุณุงุณู

### 2. ูุคุดุฑุงุช ุงูููุงููุฉ

```tsx
{/* ูููุณูููู */}
<p className="text-xs text-amber-600 mt-1 font-medium">
  โณ ูุชุทูุจ ููุงููุฉ ุงูุฅุฏุงุฑุฉ
</p>

{/* ููุชุฌุงุฑ */}
<p className="text-xs text-purple-600 mt-1 font-medium">
  โณ ูุชุทูุจ ููุงููุฉ ุงูุฅุฏุงุฑุฉ
</p>
```

### 3. ุฑุณุงูุฉ ุจุนุฏ ุงูุชุณุฌูู

```javascript
if (accountType === 'affiliate' || accountType === 'merchant') {
  const accountTypeArabic = accountType === 'affiliate' ? 'ูุณูู' : 'ุชุงุฌุฑ';
  alert(
    `ุชู ุฅูุดุงุก ุญุณุงุจู ูู${accountTypeArabic} ุจูุฌุงุญ!\n\n` +
    `โณ ุญุณุงุจู ููุฏ ุงููุฑุงุฌุนุฉ ูู ูุจู ุงูุฅุฏุงุฑุฉ\n` +
    `๐ง ุณูุชู ุฅุฎุทุงุฑู ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููุฑ ุงูููุงููุฉ\n` +
    `โ๏ธ ูู ุชุชููู ูู ุงููุตูู ููุงูู ุงููููุฒุงุช ุญุชู ุชุชู ุงูููุงููุฉ ุนูู ุญุณุงุจู`
  );
  navigate("/login");
}
```

---

## ๐๏ธ ุงูุชุนุฏููุงุช ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุญููู ุงูุฌุฏูุฏุฉ ูู ุฌุฏูู `users`:

| ุงูุญูู | ุงูููุน | ูุทููุจ | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ | ุงููุตู |
|------|------|-------|-------------------|-------|
| `alternativePhone` | String(255) | โ | `""` | ุฑูู ูุงุชู ุจุฏูู |
| `accountStatus` | Enum | โ | `approved` | ุญุงูุฉ ุงูุญุณุงุจ |
| `approvedAt` | DateTime | โ | `null` | ุชุงุฑูุฎ ุงูููุงููุฉ |
| `approvedBy` | String(255) | โ | `null` | ูุนุฑู ุงูุฃุฏูู ุงูุฐู ูุงูู |
| `rejectionReason` | String(1000) | โ | `null` | ุณุจุจ ุงูุฑูุถ |

### Enum Values ูู `accountStatus`:
- `pending` - ููุฏ ุงููุฑุงุฌุนุฉ
- `approved` - ููุงูู ุนููู
- `rejected` - ูุฑููุถ

### ุชุดุบูู ุงูุณูุฑูุจุช:

```bash
# 1. ุงุญุตู ุนูู API Key ูู Appwrite Console
# Settings โ API Keys โ Create API Key
# ุงูุตูุงุญูุงุช ุงููุทููุจุฉ: databases.write

# 2. ูู ุจุชุนููู ุงูููุชุงุญ
$env:APPWRITE_API_KEY="YOUR_API_KEY_HERE"

# 3. ุดุบู ุงูุณูุฑูุจุช
node add-approval-system-attributes.mjs
```

---

## ๐ง ุงูุชุนุฏููุงุช ุนูู AppwriteAuthContext

### ุฏุงูุฉ register ุงููุญุฏุซุฉ:

```typescript
const register = async (
  email: string, 
  password: string, 
  name: string, 
  accountType: 'customer' | 'affiliate' | 'merchant' | 'intermediary' = 'customer', 
  phone?: string,
  alternativePhone?: string  // โ ุฌุฏูุฏ
) => {
  // ุชุญุฏูุฏ ุฅุฐุง ูุงู ุงูุญุณุงุจ ูุญุชุงุฌ ููุงููุฉ
  const needsApproval = accountType === 'affiliate' || accountType === 'merchant';
  const accountStatus = needsApproval ? 'pending' : 'approved';
  
  const preferences = {
    role: accountType,
    phone: phone || '',
    alternativePhone: alternativePhone || '',  // โ ุฌุฏูุฏ
    accountStatus: accountStatus,              // โ ุฌุฏูุฏ
    approvedAt: needsApproval ? null : new Date().toISOString(),  // โ ุฌุฏูุฏ
    // ... ุจุงูู ุงูุญููู
  };
  
  // ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  await databases.createDocument(
    DATABASE_ID,
    'users',
    currentUser.$id,
    {
      email,
      name,
      phone: phone || '',
      alternativePhone: alternativePhone || '',
      accountStatus,
      approvedAt: preferences.approvedAt,
      isActive: !needsApproval, // ูุดุท ููุท ุฅุฐุง ูุง ูุญุชุงุฌ ููุงููุฉ
      // ... ุจุงูู ุงูุญููู
    }
  );
};
```

---

## ๐จโ๐ผ ููุญุฉ ุชุญูู ุงูุฃุฏูู (ูุทููุจ ุชุทููุฑูุง)

### ุงูุตูุญุงุช ุงููุทููุจุฉ:

#### 1. ุตูุญุฉ ุงูุญุณุงุจุงุช ุงููุนููุฉ
```
/admin/pending-accounts
```

**ุงููููุฒุงุช**:
- ูุงุฆูุฉ ุจุฌููุน ุงูุญุณุงุจุงุช ุจุญุงูุฉ `pending`
- ููุชุฑุฉ ุญุณุจ ุงูููุน (ูุณูู/ุชุงุฌุฑ)
- ุนุฑุถ ูุนูููุงุช ุงูุญุณุงุจ:
  * ุงูุงุณู ูุงูุจุฑูุฏ ุงูุฅููุชุฑููู
  * ุฑูู ุงููุงุชู (ูุน ุฑุงุจุท WhatsApp)
  * ุฑูู ุงููุงุชู ุงูุจุฏูู
  * ุชุงุฑูุฎ ุงูุชุณุฌูู
  * ููุน ุงูุญุณุงุจ

**ุงูุฅุฌุฑุงุกุงุช**:
```tsx
// ููุงููุฉ
<Button onClick={() => approveAccount(userId)}>
  โ ููุงููุฉ
</Button>

// ุฑูุถ ูุน ุณุจุจ
<Button onClick={() => rejectAccount(userId, reason)}>
  โ ุฑูุถ
</Button>
```

#### 2. ุฏูุงู ุงูููุงููุฉ/ุงูุฑูุถ

```typescript
// ุงูููุงููุฉ ุนูู ุงูุญุณุงุจ
const approveAccount = async (userId: string) => {
  await databases.updateDocument(
    DATABASE_ID,
    'users',
    userId,
    {
      accountStatus: 'approved',
      approvedAt: new Date().toISOString(),
      approvedBy: currentAdminId,
      isActive: true
    }
  );
  
  // ุฅุฑุณุงู ุฅูููู ูููุณุชุฎุฏู
  await sendApprovalEmail(userId);
};

// ุฑูุถ ุงูุญุณุงุจ
const rejectAccount = async (userId: string, reason: string) => {
  await databases.updateDocument(
    DATABASE_ID,
    'users',
    userId,
    {
      accountStatus: 'rejected',
      rejectionReason: reason,
      isActive: false
    }
  );
  
  // ุฅุฑุณุงู ุฅูููู ูููุณุชุฎุฏู
  await sendRejectionEmail(userId, reason);
};
```

---

## ๐ง ุญูุงูุฉ Routes ูุงููููุฒุงุช

### 1. ูู ููุญุฉ ุชุญูู ุงูุชุงุฌุฑ:

```typescript
// MerchantDashboard.tsx
useEffect(() => {
  if (user?.accountStatus === 'pending') {
    // ุนุฑุถ ุฑุณุงูุฉ ุชูุจูู
    alert('ุญุณุงุจู ููุฏ ุงููุฑุงุฌุนุฉ. ุณูุชู ุฅุฎุทุงุฑู ุนูุฏ ุงูููุงููุฉ.');
  }
  
  if (user?.accountStatus === 'rejected') {
    alert(`ุชู ุฑูุถ ุญุณุงุจู: ${user.rejectionReason}`);
    navigate('/');
  }
}, [user]);

// ุชุนุทูู ุฒุฑ ุฅุถุงูุฉ ููุชุฌ
<Button 
  disabled={user?.accountStatus !== 'approved'}
  onClick={addProduct}
>
  {user?.accountStatus === 'pending' 
    ? 'โณ ููุฏ ุงููุฑุงุฌุนุฉ' 
    : 'ุฅุถุงูุฉ ููุชุฌ'}
</Button>
```

### 2. ูู API endpoints:

```typescript
// server/routes/products.ts
app.post('/api/merchant/products', async (req, res) => {
  const user = await getUser(req);
  
  // ุงูุชุญูู ูู ุงูููุงููุฉ
  if (user.accountStatus !== 'approved') {
    return res.status(403).json({
      error: 'ุญุณุงุจู ููุฏ ุงููุฑุงุฌุนุฉ. ูุฑุฌู ุงูุงูุชุธุงุฑ ุญุชู ุชุชู ุงูููุงููุฉ.'
    });
  }
  
  // ุฅุถุงูุฉ ุงูููุชุฌ
  // ...
});
```

---

## ๐ง ูุธุงู ุงูุฅุดุนุงุฑุงุช (ููุตู ุจู)

### ุฅููููุงุช ูุฌุจ ุฅุฑุณุงููุง:

#### 1. ุจุนุฏ ุงูุชุณุฌูู (ูููุณูู/ุงูุชุงุฌุฑ):
```
ุงูููุถูุน: ุชู ุงุณุชูุงู ุทูุจู - ุฅูุฌู ุฌู

ูุฑุญุจุงู [ุงูุงุณู],

ุดูุฑุงู ูุชุณุฌููู ูู[ุชุงุฌุฑ/ูุณูู] ูู ุฅูุฌู ุฌู!

โณ ุญุณุงุจู ููุฏ ุงููุฑุงุฌุนุฉ ุญุงููุงู
๐ง ุณูุฑุณู ูู ุฅูููู ููุฑ ุงูููุงููุฉ ุนูู ุญุณุงุจู
โฑ๏ธ ุนุงุฏุฉ ุชุณุชุบุฑู ุงููุฑุงุฌุนุฉ 24-48 ุณุงุนุฉ

ูู ุญุงูุฉ ูุฌูุฏ ุฃู ุงุณุชูุณุงุฑุ ุชูุงุตู ูุนูุง ุนูู:
๐ WhatsApp: [ุฑูู ุงูุฏุนู]
๐ง Email: support@egygo.me

ูุน ุชุญูุงุช ูุฑูู ุฅูุฌู ุฌู
```

#### 2. ุนูุฏ ุงูููุงููุฉ:
```
ุงูููุถูุน: ๐ ุชูุช ุงูููุงููุฉ ุนูู ุญุณุงุจู!

ูุฑุญุจุงู [ุงูุงุณู],

ูุจุงุฑู ูู! ุชูุช ุงูููุงููุฉ ุนูู ุญุณุงุจู ูู[ุชุงุฌุฑ/ูุณูู] โ

ููููู ุงูุขู:
โ [ููุชุงุฌุฑ] ุฅุถุงูุฉ ูุฅุฏุงุฑุฉ ููุชุฌุงุชู
โ [ูููุณูู] ุฅูุดุงุก ุฑูุงุจุท ุชุณููููุฉ
โ ุงููุตูู ููุงูู ูููุฒุงุช ุงูููุตุฉ

ุงุจุฏุฃ ุงูุขู: https://egygo.me/login

ูุน ุชุญูุงุช ูุฑูู ุฅูุฌู ุฌู
```

#### 3. ุนูุฏ ุงูุฑูุถ:
```
ุงูููุถูุน: ุชุญุฏูุซ ุญูู ุทูุจ ุญุณุงุจู

ูุฑุญุจุงู [ุงูุงุณู],

ููุฃุณูุ ูู ูุชููู ูู ุงูููุงููุฉ ุนูู ุญุณุงุจู ุญุงููุงู.

ุงูุณุจุจ: [ุณุจุจ ุงูุฑูุถ]

๐ ููููู:
โข ูุฑุงุฌุนุฉ ุงููุนูููุงุช ูุฅุนุงุฏุฉ ุงูุชูุฏูู
โข ุงูุชูุงุตู ูุนูุง ููุงุณุชูุณุงุฑ

๐ WhatsApp: [ุฑูู ุงูุฏุนู]
๐ง Email: support@egygo.me

ูุชุทูุน ูุฎุฏูุชู!
ูุฑูู ุฅูุฌู ุฌู
```

---

## ๐ ุฅุญุตุงุฆูุงุช ุงูููุงููุฉ

### Dashboard metrics:

```typescript
// ุนุฏุฏ ุงูุญุณุงุจุงุช ุงููุนููุฉ
const pendingCount = await databases.listDocuments(
  DATABASE_ID,
  'users',
  [Query.equal('accountStatus', 'pending')]
).total;

// ูุชูุณุท ููุช ุงููุฑุงุฌุนุฉ
const avgApprovalTime = calculateAverage(
  approvedAccounts.map(acc => 
    new Date(acc.approvedAt) - new Date(acc.$createdAt)
  )
);

// ูุนุฏู ุงูููุงููุฉ
const approvalRate = (approvedCount / totalApplications) * 100;
```

---

## โ Checklist ููุชุทุจูู ุงููุงูู

### ูุทููุจ ููุฑุงู:
- [x] ุชุนุฏูู ุตูุญุฉ ุงูุชุณุฌูู (ุญููู + ุชุญูู)
- [x] ุชุนุฏูู AppwriteAuthContext (ูุธุงู ุงูููุงููุฉ)
- [x] ุฅูุดุงุก ุณูุฑูุจุช ุฅุถุงูุฉ ุงูุญููู
- [x] ุชุญุฏูุซ User interface/type
- [ ] ุชุดุบูู ุงูุณูุฑูุจุช ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- [ ] ุงุฎุชุจุงุฑ ุงูุชุณุฌูู

### ููุญุฉ ุชุญูู ุงูุฃุฏูู:
- [ ] ุตูุญุฉ ุงูุญุณุงุจุงุช ุงููุนููุฉ
- [ ] ุฏุงูุฉ ุงูููุงููุฉ
- [ ] ุฏุงูุฉ ุงูุฑูุถ (ูุน ุณุจุจ)
- [ ] ููุชุฑุฉ ูุจุญุซ
- [ ] ุนุฑุถ ุชูุงุตูู ุงูุญุณุงุจ

### ุงูุญูุงูุฉ:
- [ ] ุชุนุทูู ูููุฒุงุช ุงูุชุฌุงุฑ (pending)
- [ ] ุชุนุทูู ูููุฒุงุช ุงููุณูููู (pending)
- [ ] ุฑุณุงุฆู ุชูุจูู ูู Dashboards
- [ ] ุญูุงูุฉ API endpoints

### ุงูุฅุดุนุงุฑุงุช:
- [ ] ุฅูููู ุจุนุฏ ุงูุชุณุฌูู
- [ ] ุฅูููู ุนูุฏ ุงูููุงููุฉ
- [ ] ุฅูููู ุนูุฏ ุงูุฑูุถ
- [ ] ุฅุดุนุงุฑุงุช ุฏุงุฎู ุงูุชุทุจูู

### UX Enhancements:
- [ ] Badge ููุญุงูุฉ ูู Profile
- [ ] Progress indicator
- [ ] FAQ ููุญุณุงุจุงุช ุงููุนููุฉ
- [ ] ูููุฐุฌ ุฅุนุงุฏุฉ ุงูุชูุฏูู

---

## ๐ ุงุนุชุจุงุฑุงุช ุงูุฃูุงู

### 1. ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:
```typescript
// ูุจู ุฃู ุนูููุฉ ุญุณุงุณุฉ
if (user.accountStatus !== 'approved') {
  throw new Error('Unauthorized: Account not approved');
}
```

### 2. Rate Limiting:
```typescript
// ุญูุงูุฉ ูู ุฅุนุงุฏุฉ ุงูุชูุฏูู ุงููุชูุฑุฑ
const recentApplications = await checkRecentApplications(email);
if (recentApplications > 3) {
  throw new Error('Too many applications. Please wait 24 hours.');
}
```

### 3. Logging:
```typescript
// ุชุณุฌูู ุฌููุน ุนูููุงุช ุงูููุงููุฉ/ุงูุฑูุถ
await logApprovalAction({
  userId,
  action: 'approve',
  adminId: currentAdminId,
  timestamp: new Date()
});
```

---

## ๐ ูุนูููุงุช ุงูุชูุงุตู

ููุฏุนู ูุงูุงุณุชูุณุงุฑุงุช:
- **WhatsApp**: [ุฃุถู ุงูุฑูู]
- **Email**: support@egygo.me
- **ุงููููุน**: https://egygo.me

---

**ุขุฎุฑ ุชุญุฏูุซ**: 9 ุฃูุชูุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ**: 1.0  
**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู (ูุญุชุงุฌ ุชุดุบูู ุงูุณูุฑูุจุช)
