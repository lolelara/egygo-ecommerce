# ๐ฅ ุฏููู ูุฒุงููุฉ ุงููุณุชุฎุฏููู - EgyGo

## ๐ ุงููุดููุฉ

**ุงููุณุชุฎุฏููู ุงููุฏูุงุก ูุง ูุธูุฑูู ูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู**

### ุงูุณุจุจ:
- ุงููุณุชุฎุฏููู ุงููุฏูุงุก ููุฌูุฏูู ููุท ูู **Appwrite Auth**
- ููููู ุบูุฑ ููุฌูุฏูู ูู **users collection**
- ุงููููุน ูุฌูุจ ุงููุณุชุฎุฏููู ูู collection ูููุณ ูู Auth ูุจุงุดุฑุฉ

---

## โ ุงูุญููู ุงููุชุงุญุฉ

### ุงูุญู 1: ูุฒุงููุฉ ุงููุณุชุฎุฏููู ุจุงุณุชุฎุฏุงู Server-side Script โญ (ููุตู ุจู)

#### ุงูุฎุทูุงุช:

1. **ุฅุถุงูุฉ API Key ูู `.env`:**
```env
# ูู ููู .env
APPWRITE_API_KEY=your_api_key_here
```

**ููููุฉ ุงูุญุตูู ุนูู API Key:**
- ุงูุชุญ Appwrite Console
- ุงุฐูุจ ุฅูู Project Settings > API Keys
- ุงุถุบุท "Create API Key"
- ุฃุนุทู ุงูุตูุงุญูุงุช ุงูุชุงููุฉ:
  - `users.read`
  - `databases.read`
  - `databases.write`
- ุงูุณุฎ ุงูู API Key ูุถุนู ูู `.env`

2. **ุชุดุบูู ุณูุฑูุจุช ุงููุฒุงููุฉ:**
```bash
# ูุฒุงููุฉ ุฌููุน ุงููุณุชุฎุฏููู
pnpm run sync-users sync

# ุฃู ุฅูุดุงุก ูุณุชุฎุฏู ูุณูู ุชุฌุฑูุจู
pnpm run sync-users test
```

3. **ุงููุชูุฌุฉ:**
- โ ุณูุชู ูุณุฎ ุฌููุน ุงููุณุชุฎุฏููู ูู Auth ุฅูู Collection
- โ ุณูุชู ุงูุญูุงุธ ุนูู ุฌููุน ุงูุจูุงูุงุช (preferences)
- โ ุณูุธูุฑ ุงููุณุชุฎุฏููู ูู ุตูุญุฉ ุงูุฅุฏุงุฑุฉ

---

### ุงูุญู 2: ุฅูุดุงุก ุงููุณุชุฎุฏููู ูุฏููุงู ูู Appwrite Console

#### ุงูุฎุทูุงุช:

1. ุงูุชุญ Appwrite Console
2. ุงุฐูุจ ุฅูู Databases > egygo > users collection
3. ุงุถุบุท "Add Document"
4. ุฃุถู ุงูุจูุงูุงุช ุงูุชุงููุฉ:

```json
{
  "$id": "user_id_from_auth",
  "email": "user@example.com",
  "name": "ุงุณู ุงููุณุชุฎุฏู",
  "phone": "01234567890",
  "isAffiliate": false,
  "isMerchant": false,
  "affiliateCode": null,
  "commissionRate": 0.15,
  "totalEarnings": 0,
  "pendingEarnings": 0,
  "referralCount": 0,
  "accountStatus": "approved",
  "isActive": true
}
```

**ููุงุญุธุฉ:** ูุฌุจ ุฃู ูููู `$id` ูู ููุณ ID ุงููุณุชุฎุฏู ูู Auth

---

### ุงูุญู 3: ุฅูุดุงุก Appwrite Function (ูุชูุฏู)

#### ุงูุฎุทูุงุช:

1. ุฅูุดุงุก Function ูู Appwrite Console
2. ุฑูุน ุงูููุฏ ูู `scripts/sync-users-to-collection.ts`
3. ุถุจุท Environment Variables
4. ุชุดุบูู ุงูู Function

---

## ๐ ูููู users Collection ุงููุทููุจ

### Attributes:

| Attribute | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `email` | string | โ | - | ุงูุจุฑูุฏ ุงูุฅููุชุฑููู |
| `name` | string | โ | - | ุงูุงุณู |
| `phone` | string | โ | '' | ุฑูู ุงููุงุชู |
| `alternativePhone` | string | โ | '' | ุฑูู ุจุฏูู |
| `isAffiliate` | boolean | โ | false | ูุณููุ |
| `isMerchant` | boolean | โ | false | ุชุงุฌุฑุ |
| `affiliateCode` | string | โ | null | ููุฏ ุงููุณูู |
| `commissionRate` | double | โ | 0.15 | ูุณุจุฉ ุงูุนูููุฉ |
| `totalEarnings` | double | โ | 0 | ุฅุฌูุงูู ุงูุฃุฑุจุงุญ |
| `pendingEarnings` | double | โ | 0 | ุงูุฃุฑุจุงุญ ุงููุนููุฉ |
| `referralCount` | integer | โ | 0 | ุนุฏุฏ ุงูุฅุญุงูุงุช |
| `accountStatus` | string | โ | 'approved' | ุญุงูุฉ ุงูุญุณุงุจ |
| `isActive` | boolean | โ | true | ูุดุทุ |
| `approvedAt` | datetime | โ | null | ุชุงุฑูุฎ ุงูููุงููุฉ |
| `approvedBy` | string | โ | null | ูู ูุงูู |
| `rejectionReason` | string | โ | null | ุณุจุจ ุงูุฑูุถ |

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. ุงูุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏููู:

```bash
# ุงูุชุญ Appwrite Console
# ุงุฐูุจ ุฅูู Databases > egygo > users
# ุชุญูู ูู ุนุฏุฏ ุงููุณุชูุฏุงุช
```

### 2. ุงุฎุชุจุงุฑ ุตูุญุฉ ุงูุฅุฏุงุฑุฉ:

```
https://egygo.me/#/admin/users
```

ูุฌุจ ุฃู ุชุฑู:
- โ ุฌููุน ุงููุณุชุฎุฏููู
- โ ูุนูููุงุชูู ูุงููุฉ
- โ ุญุงูุฉ ุงูุญุณุงุจ
- โ ููุน ุงูุญุณุงุจ (ุนููู/ุชุงุฌุฑ/ูุณูู)

### 3. ุงุฎุชุจุงุฑ ุงููุณูููู:

```
https://egygo.me/#/admin/users
# ุงุถุบุท ุนูู ุชุจููุจ "ุงููุณูููู ุจุงูุนูููุฉ"
```

ูุฌุจ ุฃู ุชุฑู:
- โ ุฌููุน ุงููุณูููู
- โ ููุฏ ุงููุณูู
- โ ูุณุจุฉ ุงูุนูููุฉ
- โ ุงูุฃุฑุจุงุญ
- โ ุนุฏุฏ ุงูุฅุญุงูุงุช

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: "APPWRITE_API_KEY ุบูุฑ ููุฌูุฏ"

**ุงูุญู:**
```bash
# ุฃุถู API Key ูู .env
APPWRITE_API_KEY=your_api_key_here
```

### ุงููุดููุฉ: "Collection not found"

**ุงูุญู:**
1. ุชุฃูุฏ ูู ูุฌูุฏ `users` collection ูู Appwrite
2. ุชุฃูุฏ ูู ุตุญุฉ DATABASE_ID ูู `.env`
3. ุชุฃูุฏ ูู ุตุญุฉ COLLECTION_ID ูู `.env`

### ุงููุดููุฉ: "Permission denied"

**ุงูุญู:**
1. ุชุฃูุฏ ูู ุฃู API Key ูุฏูู ุงูุตูุงุญูุงุช ุงููุทููุจุฉ:
   - `users.read`
   - `databases.read`
   - `databases.write`

### ุงููุดููุฉ: "ุงููุณุชุฎุฏููู ูุง ูุฒุงููู ูุง ูุธูุฑูู"

**ุงูุญู:**
1. ุงูุชุญ Console ูู ุงููุชุตูุญ (F12)
2. ุงุจุญุซ ุนู ุฃุฎุทุงุก ูู Console tab
3. ุชุญูู ูู Network tab
4. ุชุฃูุฏ ูู ุชุดุบูู ุณูุฑูุจุช ุงููุฒุงููุฉ ุจูุฌุงุญ

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ๏ธ ุงูุฃูุงู:
- **ูุง ุชุดุงุฑู API Key ุฃุจุฏุงู**
- **ูุง ุชุฑูุน `.env` ุนูู GitHub**
- **ุงุณุชุฎุฏู API Key ููุท ูู Server-side**

### ๐ ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ:
ุจุนุฏ ุชุดุบูู ุงูุณูุฑูุจุช ูุฑุฉ ูุงุญุฏุฉุ ุฌููุน ุงููุณุชุฎุฏููู ุงูุฌุฏุฏ ุณูุชู ุฅูุดุงุคูู ุชููุงุฆูุงู ูู Collection ุนูุฏ ุงูุชุณุฌูู (ุงูููุฏ ููุฌูุฏ ูู `AppwriteAuthContext.tsx`)

### ๐ ุงูุจูุงูุงุช:
- ุงููุณุชุฎุฏููู ุงููุฏูุงุก: `accountStatus = 'approved'`
- ุงููุณุชุฎุฏููู ุงูุฌุฏุฏ (ุชุฌุงุฑ/ูุณูููู): `accountStatus = 'pending'`

---

## ๐ฏ ุงูุฎูุงุตุฉ

**ุงูุญู ุงูููุตู ุจู:**
1. โ ุฃุถู APPWRITE_API_KEY ูู `.env`
2. โ ุดุบู `pnpm run sync-users sync`
3. โ ุชุญูู ูู ุตูุญุฉ ุงูุฅุฏุงุฑุฉ

**ุงููุชูุฌุฉ:**
- โ ุฌููุน ุงููุณุชุฎุฏููู ุงููุฏูุงุก ุณูุธูุฑูู
- โ ุฌููุน ุงููุณูููู ุณูุธูุฑูู ูุน ุจูุงูุงุชูู
- โ ุงููุธุงู ุฌุงูุฒ ููุนูู ุจุดูู ูุงูู

---

**ูููุฒูุฏ ูู ุงููุนูููุงุช:**
- ุฑุงุฌุน `scripts/sync-users-to-collection.ts`
- ุฑุงุฌุน `CODE_REVIEW_REPORT.md`
- ุฑุงุฌุน `PENDING_ACCOUNTS_GUIDE.md`
